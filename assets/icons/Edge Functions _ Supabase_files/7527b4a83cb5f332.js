;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="8605955f-42fe-2461-9804-ece8f7db7bc7")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,1962,e=>{"use strict";var t=e.i(478902),a=e.i(459323),r=e.i(389959),s=e.i(837491),n=e.i(57352);let i="Progress",[o,l]=(0,s.createContextScope)(i),[c,d]=o(i),u=(0,r.forwardRef)((e,t)=>{let{__scopeProgress:s,value:i,max:o,getValueLabel:l=h,...d}=e,u=x(o)?o:100,m=g(i,u)?i:null,j=f(m)?l(m,u):void 0;return(0,r.createElement)(c,{scope:s,value:m,max:u},(0,r.createElement)(n.Primitive.div,(0,a.default)({"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":f(m)?m:void 0,"aria-valuetext":j,role:"progressbar","data-state":p(m,u),"data-value":null!=m?m:void 0,"data-max":u},d,{ref:t})))});u.propTypes={max(e,t,a){var r,s;let n=e[t],i=String(n);return n&&!x(n)?Error((r=i,s=a,`Invalid prop \`max\` of value \`${r}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`)):null},value(e,t,a){var r,s;let n=e[t],i=String(n),o=x(e.max)?e.max:100;return null==n||g(n,o)?null:Error((r=i,s=a,`Invalid prop \`value\` of value \`${r}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` if the progress is indeterminate.

Defaulting to \`null\`.`))}};let m=(0,r.forwardRef)((e,t)=>{var s;let{__scopeProgress:i,...o}=e,l=d("ProgressIndicator",i);return(0,r.createElement)(n.Primitive.div,(0,a.default)({"data-state":p(l.value,l.max),"data-value":null!=(s=l.value)?s:void 0,"data-max":l.max},o,{ref:t}))});function h(e,t){return`${Math.round(e/t*100)}%`}function p(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function f(e){return"number"==typeof e}function x(e){return f(e)&&!isNaN(e)&&e>0}function g(e,t){return f(e)&&!isNaN(e)&&e<=t&&e>=0}var j=e.i(843778);let b=r.forwardRef(({className:e,value:a,...r},s)=>(0,t.jsx)(u,{ref:s,className:(0,j.cn)("relative h-1 w-full overflow-hidden rounded-full bg-surface-300",e),...r,children:(0,t.jsx)(m,{className:"h-full w-full flex-1 bg-foreground transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));b.displayName=u.displayName,e.s(["Progress",()=>b],1962)},513826,182074,e=>{"use strict";var t=e.i(478902);let a=(0,e.i(388019).default)("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);e.s(["BookOpen",()=>a],182074);var r=e.i(837710);e.s(["DocsButton",0,({href:e,abbrev:s=!0,className:n})=>(0,t.jsx)(r.Button,{asChild:!0,type:"default",className:n,icon:(0,t.jsx)(a,{}),onClick:e=>e.stopPropagation(),children:(0,t.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:e,children:s?"Docs":"Documentation"})})],513826)},719754,e=>{"use strict";var t=e.i(130843);e.s(["SelectValue_Shadcn_",()=>t.SelectValue])},171137,e=>{"use strict";var t=e.i(688554);e.s(["SqlEditor",()=>t.default])},91810,e=>{"use strict";let t=(0,e.i(388019).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["default",()=>t])},466472,e=>{"use strict";var t=e.i(478902),a=e.i(389959),r=e.i(837710),s=e.i(843778),n=e.i(253214),i=e.i(710483);let o=(0,a.forwardRef)(({title:e,description:o,size:l="small",visible:c,onCancel:d,onConfirm:u,loading:m,cancelLabel:h="Cancel",confirmLabel:p="Submit",confirmLabelLoading:f,alert:x,children:g,variant:j="default",disabled:b,className:y,...v},S)=>{let[w,_]=(0,a.useState)(void 0!==m&&m);return(0,a.useEffect)(()=>{c&&void 0===m&&_(!1)},[c]),(0,a.useEffect)(()=>{void 0!==m&&_(m)},[m]),(0,t.jsx)(n.Dialog,{open:c,...v,onOpenChange:()=>{c&&d()},children:(0,t.jsxs)(n.DialogContent,{"aria-describedby":void 0,ref:S,className:"p-0 gap-0 pb-5 !block",size:l,children:[(0,t.jsxs)(n.DialogHeader,{className:(0,s.cn)("border-b"),padding:"small",children:[(0,t.jsx)(n.DialogTitle,{children:e}),o&&(0,t.jsx)(n.DialogDescription,{children:o})]}),x&&(0,t.jsx)(i.Admonition,{type:j,label:x.title,description:x.description,className:"border-x-0 rounded-none -mt-px",...x?.base}),g&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.DialogSection,{padding:"small",className:y,children:g}),(0,t.jsx)(n.DialogSectionSeparator,{})]}),(0,t.jsxs)("div",{className:"flex gap-2 px-5 pt-5",children:[(0,t.jsx)(r.Button,{size:"medium",block:!0,type:"default",disabled:w,onClick:()=>d(),children:h}),(0,t.jsx)(r.Button,{block:!0,size:"medium",type:"destructive"===j?"danger":"warning"===j?"warning":"primary",htmlType:"submit",loading:w,disabled:w||b,onClick:e=>{e.preventDefault(),e.stopPropagation(),u(),void 0===m&&_(!0)},className:"truncate",children:w&&f?f:p})]})]})})});o.displayName="ConfirmationModal",e.s(["ConfirmationModal",0,o,"default",0,o])},479095,e=>{"use strict";var t=e.i(478902),a=e.i(389959),r=e.i(369158),s="horizontal",n=["horizontal","vertical"],i=a.forwardRef((e,a)=>{var i;let{decorative:o,orientation:l=s,...c}=e,d=(i=l,n.includes(i))?l:s;return(0,t.jsx)(r.Primitive.div,{"data-orientation":d,...o?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...c,ref:a})});i.displayName="Separator";var o=e.i(843778);let l=a.forwardRef(({className:e,orientation:a="horizontal",decorative:r=!0,...s},n)=>(0,t.jsx)(i,{ref:n,decorative:r,orientation:a,className:(0,o.cn)("shrink-0 bg-border-muted","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",e),...s}));l.displayName=i.displayName,e.s(["Separator",()=>l],479095)},955909,e=>{"use strict";var t=e.i(478902),a=e.i(55956),r=e.i(488194),s=e.i(421781),n=e.i(389959),i=e.i(843778),o=e.i(375761),l=e.i(613580);a.default.extend(r.default),a.default.extend(s.default);let c=e=>a.default.unix(Number(e)/1e3/1e3).toISOString(),d=e=>{let t=16===String(e).length;return!Number.isNaN(Number(e))&&t},u=({utcTimestamp:e,format:t})=>{let r=d(e)?c(e):e;return a.default.utc(r).local().format(t)},m=({utcTimestamp:e,format:t})=>{let r=d(e)?c(e):e;return a.default.utc(r).format(t)};e.s(["TimestampInfo",0,({utcTimestamp:e,className:r,displayAs:s="local",format:h="DD MMM YY HH:mm:ss",labelFormat:p="DD MMM YY HH:mm:ss",label:f})=>{let x=u({utcTimestamp:e,format:h}),g=m({utcTimestamp:e,format:h}),j=(({utcTimestamp:e})=>{let t=d(e)?c(e):e;return a.default.utc(t).fromNow()})({utcTimestamp:e}),[b,y]=(0,n.useState)("start"),v=(0,n.useRef)(null),S=Intl.DateTimeFormat().resolvedOptions().timeZone;(0,n.useEffect)(()=>{let e=()=>{if(v.current){let e=v.current.getBoundingClientRect(),t=window.innerHeight;y(e.top<t/2?"start":"end")}};return e(),window.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]);let w=({label:e,value:a})=>{let[r,s]=(0,n.useState)(!1);return(0,t.jsxs)("div",{onPointerDown:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),e.preventDefault(),(0,o.copyToClipboard)(a,()=>{s(!0),setTimeout(()=>{s(!1)},1e3)})},className:(0,i.cn)("relative cursor-pointer flex gap-y-2 gap-x-0.5 hover:bg-surface-100 px-2 py-1 group",{"bg-surface-100":r}),children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2 text-left truncate",children:[(0,t.jsx)("p",{children:e}),(0,t.jsx)("div",{className:"border-t w-full border-dashed"})]}),(0,t.jsxs)("div",{className:"relative flex items-center gap-x-2 flex-grow",children:[(0,t.jsx)("div",{className:"border-t w-full border-dashed z-10"}),r&&(0,t.jsx)("span",{className:"flex items-center justify-end w-full absolute inset-0 flex items-right text-brand-600 bg-surface-100",children:"Copied!"}),(0,t.jsx)("span",{className:"flex items-center gap-x-2 justify-end whitespace-nowrap",children:a})]})]})};return(0,t.jsxs)(l.Tooltip,{children:[(0,t.jsx)(l.TooltipTrigger,{asChild:!0,ref:v,className:`text-xs ${r} border-b border-transparent hover:border-dashed hover:border-foreground-light`,children:(0,t.jsx)("span",{children:f||("local"===s?u({utcTimestamp:e,format:p}):m({utcTimestamp:e,format:p}))})}),(0,t.jsxs)(l.TooltipContent,{align:b,side:"right",className:"font-mono p-0 py-1 min-w-80",children:[(0,t.jsx)(w,{label:"UTC",value:g}),(0,t.jsx)(w,{label:S,value:x}),(0,t.jsx)(w,{label:"Relative",value:j}),(0,t.jsx)(w,{label:"Timestamp",value:String(e)})]})]})},"timestampLocalFormatter",0,u])},417403,e=>{"use strict";var t=e.i(907019);e.s(["default",0,t])},918117,e=>{"use strict";var t=e.i(479084),a=e.i(21150);e.s(["getLiveTupleEstimate",0,(e,a="public")=>`
SELECT n_live_tup AS live_tuple_estimate
FROM pg_stat_user_tables
WHERE schemaname = ${(0,t.literal)(a)}
AND relname = ${(0,t.literal)(e)};
`.trim(),"getLiveTupleEstimateKey",0,(e,t,r="public")=>a.sqlKeys.query(e,["live-tuple-estimate",r,t])])},240788,e=>{"use strict";var t=e.i(242882),a=e.i(234745),r=e.i(68205);async function s({projectRef:e},t){if(!e)throw Error("projectRef is required");let{data:r,error:s}=await (0,a.get)("/v1/projects/{ref}/functions",{params:{path:{ref:e}},signal:t});return s&&(0,a.handleError)(s),r}e.s(["useEdgeFunctionsQuery",0,({projectRef:e},{enabled:a=!0,...n}={})=>(0,t.useQuery)({queryKey:r.edgeFunctionsKeys.list(e),queryFn:({signal:t})=>s({projectRef:e},t),enabled:a&&void 0!==e,...n})])},440401,701823,e=>{"use strict";var t=e.i(478902),a=e.i(867637),r=e.i(938933);let s={tiny:14,small:16,medium:20,large:24,xlarge:32};function n({style:e,size:n="medium"}){let i=(0,r.default)("inputErrorIcon");return(0,t.jsx)("div",{className:i.base,style:e,children:(0,t.jsx)(a.AlertCircle,{size:s[n],strokeWidth:2})})}e.s(["default",()=>n],440401);var i=e.i(843778);function o({icon:e,className:a,size:s}){let n=(0,r.default)("inputIconContainer");return(0,t.jsx)("div",{className:(0,i.cn)(n.base,n.size[s],a),children:e})}e.s(["default",()=>o],701823)},440523,e=>{"use strict";var t=e.i(478902),a=e.i(816467),r=e.i(389959),s=e.i(282410),n=e.i(753515),i=e.i(440401),o=e.i(701823),l=e.i(938933),c=e.i(375761),d=e.i(843778),u=e.i(837710),m=e.i(140449);function h({autoComplete:e,autoFocus:h,className:p,inputClassName:f,iconContainerClassName:x,copy:g,defaultValue:j,descriptionText:b,disabled:y,error:v,icon:S,id:w="",name:_="",inputRef:C,label:N,afterLabel:R,beforeLabel:E,labelOptional:k,layout:D,onChange:T,onBlur:A,onCopy:z,placeholder:P,type:I="text",value:F,style:L,reveal:q=!1,actions:$,size:M="medium",borderless:O=!1,validation:B,...K}){let[H,Q]=(0,r.useState)("Copy"),[W,U]=(0,r.useState)(!0),V=(0,l.default)("input"),{formContextOnChange:J,values:G,errors:Z,handleBlur:Y,touched:X,fieldLevelValidation:ee}=(0,m.useFormContext)();G&&!F&&(F=G[w||_]),v||(Z&&!v&&(v=Z[w||_]),v=X&&X[w]?v:void 0),(0,r.useEffect)(()=>{B&&ee(w,B(F))},[]);let et=["peer/input",V.base];return v&&et.push(V.variants.error),v||et.push(V.variants.standard),M&&et.push(V.size[M]),S&&et.push(V.with_icon[M]),y&&et.push(V.disabled),f&&et.push(f),(0,t.jsx)(n.FormLayout,{label:N,afterLabel:R,beforeLabel:E,labelOptional:k,layout:D,id:w,error:v,descriptionText:b,style:L,size:M,className:p,children:(0,t.jsxs)("div",{className:V.container,children:[(0,t.jsx)("input",{"data-size":M,autoComplete:e,autoFocus:h,defaultValue:j,disabled:y,id:w,name:_,onChange:function(e){T&&T(e),J&&J(e),B&&ee(w,B(e.target.value))},onBlur:function(e){Y&&setTimeout(()=>{Y(e)},100),A&&A(e)},onCopy:z,placeholder:P,ref:C,type:I,value:q&&W?s.HIDDEN_PLACEHOLDER:F,className:(0,d.cn)(et),...K}),S&&(0,t.jsx)(o.default,{size:M,icon:S,className:x}),g||v||$?(0,t.jsxs)("div",{className:V.actions_container,children:[v&&(0,t.jsx)(i.default,{size:M}),g&&!(q&&W)?(0,t.jsx)(u.Button,{size:"tiny",type:"default",icon:(0,t.jsx)(a.Copy,{}),onClick:()=>{var e;return e=F,void(0,c.copyToClipboard)(e,()=>{Q("Copied"),setTimeout(()=>{Q("Copy")},3e3),z?.()})},children:H}):null,q&&W?(0,t.jsx)(u.Button,{size:"tiny",type:"default",onClick:function(){U(!1)},children:"Reveal"}):null,$&&$]}):null]})})}h.TextArea=function({className:e,textAreaClassName:s,descriptionText:o,disabled:d,error:h,icon:p,id:f="",name:x="",label:g,afterLabel:j,beforeLabel:b,labelOptional:y,layout:v,onChange:S,onBlur:w,placeholder:_,value:C,style:N,rows:R=4,limit:E,size:k="medium",borderless:D=!1,validation:T,copy:A=!1,onCopy:z,actions:P,...I}){let[F,L]=(0,r.useState)(0),[q,$]=(0,r.useState)("Copy"),{formContextOnChange:M,values:O,errors:B,handleBlur:K,touched:H,fieldLevelValidation:Q}=(0,m.useFormContext)();O&&!C&&(C=O[f||x]),h||(B&&!h&&(h=B[f||x]),h=H&&H[f||x]?h:void 0),(0,r.useEffect)(()=>{T&&Q(f,T(C))},[]);let W=(0,l.default)("input"),U=[W.base];return h&&U.push(W.variants.error),h||U.push(W.variants.standard),p&&U.push(W.with_icon[k]),k&&U.push(W.size[k]),d&&U.push(W.disabled),s&&U.push(s),(0,t.jsx)(n.FormLayout,{className:e,label:g,afterLabel:j,beforeLabel:b,labelOptional:y,layout:v,id:f,error:h,descriptionText:o,style:N,size:k,children:(0,t.jsxs)("div",{className:W.container,children:[(0,t.jsx)("textarea",{disabled:d,id:f,name:x,rows:R,cols:100,placeholder:_,onChange:function(e){L(e.target.value.length),S&&S(e),M&&M(e),T&&Q(f,T(e.target.value))},onBlur:function(e){K&&setTimeout(()=>{K(e)},100),w&&w(e)},onCopy:z,value:C,className:U.join(" "),maxLength:E,...I}),A||h||P?(0,t.jsx)("div",{className:W.textarea_actions_container,children:(0,t.jsxs)("div",{className:W.textarea_actions_container_items,children:[h&&(0,t.jsx)(i.default,{size:k}),A&&(0,t.jsx)(u.Button,{size:"tiny",type:"default",onClick:()=>{var e;return e=C,void(0,c.copyToClipboard)(e,()=>{$("Copied"),setTimeout(()=>{$("Copy")},3e3),z?.()})},icon:(0,t.jsx)(a.Copy,{}),children:q}),P&&P]})}):null]})})},e.s(["default",0,h])},171997,e=>{"use strict";var t=e.i(440523);e.s(["Input",()=>t.default])},471998,e=>{"use strict";let t=(0,e.i(388019).default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);e.s(["MoreVertical",()=>t],471998)},170149,e=>{"use strict";var t=e.i(478902);e.i(128328);var a=e.i(657588),r=e.i(532728),s=e.i(370410),n=e.i(816467),i=e.i(389959),o=e.i(408891),l=e.i(837710),c=e.i(843778),d=e.i(375761),u=e.i(253214),m=e.i(428353),h=e.i(24315),p=e.i(215317),f=e.i(61863),x=e.i(191209),g=e.i(837243),j=e.i(846887),b=e.i(378277),y=e.i(97429),v=e.i(710483);let S=(0,i.forwardRef)(({title:e,size:a="small",onConfirm:S,visible:w,onCancel:_,loading:C,cancelLabel:N="Cancel",confirmLabel:R="Submit",confirmPlaceholder:E,confirmString:k,alert:D,input:T,label:A,description:z,formMessage:P,text:I,children:F,blockDeleteButton:L=!0,variant:q="default",errorMessage:$="Value entered does not match",enableCopy:M=!1,...O},B)=>{let[K,H]=(0,i.useState)(!1),Q=y.z.object({confirmValue:y.z.preprocess(e=>"string"==typeof e?e.trim():e,y.z.literal(k.trim(),{errorMap:()=>({message:$})}))}),W=(0,o.useForm)({resolver:(0,r.zodResolver)(Q),reValidateMode:"onChange",defaultValues:{confirmValue:""}}),U=W.formState.isValid;return(0,i.useEffect)(()=>{k&&W.reset()},[k]),(0,i.useEffect)(()=>{if(!K)return;let e=setTimeout(()=>H(!1),2e3);return()=>clearTimeout(e)},[K]),(0,t.jsx)(u.Dialog,{open:w,...O,onOpenChange:()=>{w&&_()},children:(0,t.jsxs)(u.DialogContent,{ref:B,className:"p-0 gap-0 pb-5 !block",size:a,children:[(0,t.jsx)(u.DialogHeader,{className:(0,c.cn)("border-b"),padding:"small",children:(0,t.jsx)(u.DialogTitle,{className:"",children:e})}),D&&(0,t.jsx)(v.Admonition,{type:q,label:D.title,description:D.description,className:"border-x-0 rounded-none -mt-px",...D?.base}),F&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.DialogSection,{padding:"small",children:F}),(0,t.jsx)(u.DialogSectionSeparator,{})]}),void 0!==I&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.DialogSection,{className:"p-5",padding:"small",children:(0,t.jsx)("p",{className:"text-foreground-light text-sm",children:I})}),(0,t.jsx)(u.DialogSectionSeparator,{})]}),(0,t.jsx)(m.Form_Shadcn_,{...W,children:(0,t.jsxs)("form",{autoComplete:"off",onSubmit:W.handleSubmit(function(e){S()}),className:"px-5 flex flex-col gap-y-3 pt-3",children:[(0,t.jsx)(f.FormField_Shadcn_,{control:W.control,name:"confirmValue",render:({field:e})=>(0,t.jsxs)(x.FormItem_Shadcn_,{className:"flex flex-col gap-y-2",children:[(0,t.jsxs)(g.FormLabel_Shadcn_,{...A,enableSelection:!M,children:["Type"," ",M?(0,t.jsx)(l.Button,{type:"default",className:"h-[23px] px-1.5 py-0 border-muted text-sm whitespace-pre break-all",iconRight:K?(0,t.jsx)(s.Check,{strokeWidth:2,className:"text-brand"}):(0,t.jsx)(n.Copy,{}),onClick:()=>{H(!0),(0,d.copyToClipboard)(k)},children:k}):(0,t.jsx)("span",{className:"text-foreground break-all whitespace-pre",children:k})," ","to confirm."]}),(0,t.jsx)(h.FormControl_Shadcn_,{children:(0,t.jsx)(b.Input_Shadcn_,{autoComplete:"off",placeholder:E,...T,...e})}),!!z&&(0,t.jsx)(p.FormDescription_Shadcn_,{...z}),(0,t.jsx)(j.FormMessage_Shadcn_,{...P})]})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[!L&&(0,t.jsx)(l.Button,{size:"medium",block:!0,type:"default",disabled:C,onClick:_,children:N}),(0,t.jsx)(l.Button,{block:!0,size:"medium",type:"destructive"===q?"danger":"warning"===q?"warning":"primary",htmlType:"submit",loading:C,disabled:!U||C,className:"truncate",children:R})]})]})})]})})});S.displayName="TextConfirmModal",e.s(["TextConfirmModal",0,e=>{let r=(0,a.useFlag)("textConfirmationModalClickToCopy");return(0,t.jsx)(S,{...e,enableCopy:r})}],170149)},610144,e=>{"use strict";var t=e.i(755216),a=e.i(479084),r=e.i(38429),s=e.i(356003),n=e.i(355901),i=e.i(78162),o=e.i(714403),l=e.i(667286);async function c({projectRef:e,connectionString:r,schema:s,name:n,version:i,cascade:l=!1,createSchema:c=!1}){let d=new Headers;r&&d.set("x-connection-encrypted",r);let{sql:u}=t.default.extensions.create({schema:s,name:n,version:i,cascade:l}),{result:m}=await (0,o.executeSql)({projectRef:e,connectionString:r,sql:c?`create schema if not exists ${(0,a.ident)(s)}; ${u}`:u,queryKey:["extension","create"]});return m}e.s(["useDatabaseExtensionEnableMutation",0,({onSuccess:e,onError:t,...a}={})=>{let o=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>c(e),async onSuccess(t,a,r){let{projectRef:s}=a;await Promise.all([o.invalidateQueries({queryKey:l.databaseExtensionsKeys.list(s)}),o.invalidateQueries({queryKey:i.configKeys.upgradeEligibility(s)})]),await e?.(t,a,r)},async onError(e,a,r){void 0===t?n.toast.error(`Failed to enable database extension: ${e.message}`):t(e,a,r)},...a})}])},388034,e=>{"use strict";let t=(0,e.i(388019).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["default",()=>t])},61187,e=>{"use strict";var t=e.i(388034);e.s(["RefreshCw",()=>t.default])},224521,e=>{"use strict";var t=e.i(389959),a=e.i(274664),r=e.i(295047),s=e.i(678001),n=e.i(174617),i=e.i(826524),o=e.i(546595),l=e.i(503867),c=e.i(889251),d=e.i(904641),u=e.i(478902),m="Collapsible",[h,p]=(0,a.createContextScope)(m),[f,x]=h(m),g=t.forwardRef((e,a)=>{let{__scopeCollapsible:r,open:s,defaultOpen:n,disabled:l,onOpenChange:c,...h}=e,[p,x]=(0,i.useControllableState)({prop:s,defaultProp:n??!1,onChange:c,caller:m});return(0,u.jsx)(f,{scope:r,disabled:l,contentId:(0,d.useId)(),open:p,onOpenToggle:t.useCallback(()=>x(e=>!e),[x]),children:(0,u.jsx)(o.Primitive.div,{"data-state":w(p),"data-disabled":l?"":void 0,...h,ref:a})})});g.displayName=m;var j="CollapsibleTrigger",b=t.forwardRef((e,t)=>{let{__scopeCollapsible:a,...r}=e,s=x(j,a);return(0,u.jsx)(o.Primitive.button,{type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":w(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled,...r,ref:t,onClick:(0,n.composeEventHandlers)(e.onClick,s.onOpenToggle)})});b.displayName=j;var y="CollapsibleContent",v=t.forwardRef((e,t)=>{let{forceMount:a,...r}=e,s=x(y,e.__scopeCollapsible);return(0,u.jsx)(c.Presence,{present:a||s.open,children:({present:e})=>(0,u.jsx)(S,{...r,ref:t,present:e})})});v.displayName=y;var S=t.forwardRef((e,a)=>{let{__scopeCollapsible:r,present:n,children:i,...c}=e,d=x(y,r),[m,h]=t.useState(n),p=t.useRef(null),f=(0,s.useComposedRefs)(a,p),g=t.useRef(0),j=g.current,b=t.useRef(0),v=b.current,S=d.open||m,_=t.useRef(S),C=t.useRef(void 0);return t.useEffect(()=>{let e=requestAnimationFrame(()=>_.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,l.useLayoutEffect)(()=>{let e=p.current;if(e){C.current=C.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();g.current=t.height,b.current=t.width,_.current||(e.style.transitionDuration=C.current.transitionDuration,e.style.animationName=C.current.animationName),h(n)}},[d.open,n]),(0,u.jsx)(o.Primitive.div,{"data-state":w(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!S,...c,ref:f,style:{"--radix-collapsible-content-height":j?`${j}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...e.style},children:S&&i})});function w(e){return e?"open":"closed"}var _=e.i(2664),C="Accordion",N=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[R,E,k]=(0,r.createCollection)(C),[D,T]=(0,a.createContextScope)(C,[k,p]),A=p(),z=t.default.forwardRef((e,t)=>{let{type:a,...r}=e;return(0,u.jsx)(R.Provider,{scope:e.__scopeAccordion,children:"multiple"===a?(0,u.jsx)($,{...r,ref:t}):(0,u.jsx)(q,{...r,ref:t})})});z.displayName=C;var[P,I]=D(C),[F,L]=D(C,{collapsible:!1}),q=t.default.forwardRef((e,a)=>{let{value:r,defaultValue:s,onValueChange:n=()=>{},collapsible:o=!1,...l}=e,[c,d]=(0,i.useControllableState)({prop:r,defaultProp:s??"",onChange:n,caller:C});return(0,u.jsx)(P,{scope:e.__scopeAccordion,value:t.default.useMemo(()=>c?[c]:[],[c]),onItemOpen:d,onItemClose:t.default.useCallback(()=>o&&d(""),[o,d]),children:(0,u.jsx)(F,{scope:e.__scopeAccordion,collapsible:o,children:(0,u.jsx)(B,{...l,ref:a})})})}),$=t.default.forwardRef((e,a)=>{let{value:r,defaultValue:s,onValueChange:n=()=>{},...o}=e,[l,c]=(0,i.useControllableState)({prop:r,defaultProp:s??[],onChange:n,caller:C}),d=t.default.useCallback(e=>c((t=[])=>[...t,e]),[c]),m=t.default.useCallback(e=>c((t=[])=>t.filter(t=>t!==e)),[c]);return(0,u.jsx)(P,{scope:e.__scopeAccordion,value:l,onItemOpen:d,onItemClose:m,children:(0,u.jsx)(F,{scope:e.__scopeAccordion,collapsible:!0,children:(0,u.jsx)(B,{...o,ref:a})})})}),[M,O]=D(C),B=t.default.forwardRef((e,a)=>{let{__scopeAccordion:r,disabled:i,dir:l,orientation:c="vertical",...d}=e,m=t.default.useRef(null),h=(0,s.useComposedRefs)(m,a),p=E(r),f="ltr"===(0,_.useDirection)(l),x=(0,n.composeEventHandlers)(e.onKeyDown,e=>{if(!N.includes(e.key))return;let t=e.target,a=p().filter(e=>!e.ref.current?.disabled),r=a.findIndex(e=>e.ref.current===t),s=a.length;if(-1===r)return;e.preventDefault();let n=r,i=s-1,o=()=>{(n=r+1)>i&&(n=0)},l=()=>{(n=r-1)<0&&(n=i)};switch(e.key){case"Home":n=0;break;case"End":n=i;break;case"ArrowRight":"horizontal"===c&&(f?o():l());break;case"ArrowDown":"vertical"===c&&o();break;case"ArrowLeft":"horizontal"===c&&(f?l():o());break;case"ArrowUp":"vertical"===c&&l()}let d=n%s;a[d].ref.current?.focus()});return(0,u.jsx)(M,{scope:r,disabled:i,direction:l,orientation:c,children:(0,u.jsx)(R.Slot,{scope:r,children:(0,u.jsx)(o.Primitive.div,{...d,"data-orientation":c,ref:h,onKeyDown:i?void 0:x})})})}),K="AccordionItem",[H,Q]=D(K),W=t.default.forwardRef((e,t)=>{let{__scopeAccordion:a,value:r,...s}=e,n=O(K,a),i=I(K,a),o=A(a),l=(0,d.useId)(),c=r&&i.value.includes(r)||!1,m=n.disabled||e.disabled;return(0,u.jsx)(H,{scope:a,open:c,disabled:m,triggerId:l,children:(0,u.jsx)(g,{"data-orientation":n.orientation,"data-state":X(c),...o,...s,ref:t,disabled:m,open:c,onOpenChange:e=>{e?i.onItemOpen(r):i.onItemClose(r)}})})});W.displayName=K;var U="AccordionHeader",V=t.default.forwardRef((e,t)=>{let{__scopeAccordion:a,...r}=e,s=O(C,a),n=Q(U,a);return(0,u.jsx)(o.Primitive.h3,{"data-orientation":s.orientation,"data-state":X(n.open),"data-disabled":n.disabled?"":void 0,...r,ref:t})});V.displayName=U;var J="AccordionTrigger",G=t.default.forwardRef((e,t)=>{let{__scopeAccordion:a,...r}=e,s=O(C,a),n=Q(J,a),i=L(J,a),o=A(a);return(0,u.jsx)(R.ItemSlot,{scope:a,children:(0,u.jsx)(b,{"aria-disabled":n.open&&!i.collapsible||void 0,"data-orientation":s.orientation,id:n.triggerId,...o,...r,ref:t})})});G.displayName=J;var Z="AccordionContent",Y=t.default.forwardRef((e,t)=>{let{__scopeAccordion:a,...r}=e,s=O(C,a),n=Q(Z,a),i=A(a);return(0,u.jsx)(v,{role:"region","aria-labelledby":n.triggerId,"data-orientation":s.orientation,...i,...r,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});function X(e){return e?"open":"closed"}Y.displayName=Z,e.s(["Content",()=>Y,"Header",()=>V,"Item",()=>W,"Root",()=>z,"Trigger",()=>G],224521)},412385,e=>{"use strict";var t=e.i(389959),a=e.i(323796);e.s(["useConfirmOnClose",0,({checkIsDirty:e,onClose:r})=>{let[s,n]=(0,t.useState)(!1),i=(0,a.default)(e),o=(0,a.default)(r),l=(0,t.useCallback)(()=>{i.current()?n(!0):o.current()},[]),c=(0,t.useCallback)(()=>{n(!1),o.current()},[]),d=(0,t.useCallback)(()=>{n(!1)},[]),u=(0,t.useMemo)(()=>({visible:s,onClose:c,onCancel:d}),[s,c,d]);return(0,t.useMemo)(()=>({confirmOnClose:l,modalProps:u}),[l,u])}])},248210,e=>{"use strict";var t=e.i(478902),a=e.i(843778);e.s(["LoadingLine",0,({loading:e})=>(0,t.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto",children:(0,t.jsx)("span",{className:(0,a.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",e&&"animate-line-loading-slower opacity-100",e?"opacity-100":"opacity-0")})})])},300424,e=>{"use strict";var t=e.i(478902),a=e.i(902858),r=e.i(370410),s=e.i(365257),n=e.i(479232),i=e.i(389959),o=e.i(801834),l=e.i(2579),c=e.i(635494),d=e.i(206413),u=e.i(592360),m=e.i(178527),h=e.i(837710),p=e.i(703526),f=e.i(917007),x=e.i(920432),g=e.i(549815),j=e.i(911509),b=e.i(996960),y=e.i(866205),v=e.i(793912),S=e.i(135144),w=e.i(689805),_=e.i(396831),C=e.i(903248);let N=({className:e,disabled:N=!1,size:R="tiny",showError:E=!0,selectedSchemaName:k,supportSelectAll:D=!1,excludedSchemas:T=[],onSelectSchema:A,onSelectCreateSchema:z,align:P="start"})=>{let[I,F]=(0,i.useState)(!1),{can:L}=(0,l.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"schemas"),{data:q}=(0,c.useSelectedProjectQuery)(),{data:$,isPending:M,isSuccess:O,isError:B,error:K,refetch:H}=(0,o.useSchemasQuery)({projectRef:q?.ref,connectionString:q?.connectionString}),Q=($||[]).filter(e=>!T.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,t.jsxs)("div",{className:e,children:[M&&(0,t.jsx)(h.Button,{type:"default",className:"w-full [&>span]:w-full",size:R,disabled:!0,children:(0,t.jsx)(C.Skeleton,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),E&&B&&(0,t.jsxs)(m.Alert_Shadcn_,{variant:"warning",className:"!px-3 !py-3",children:[(0,t.jsx)(u.AlertTitle_Shadcn_,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,t.jsxs)(d.AlertDescription_Shadcn_,{className:"text-xs mb-2 break-words",children:["Error: ",K?.message]}),(0,t.jsx)(h.Button,{type:"default",size:"tiny",onClick:()=>H(),children:"Reload schemas"})]}),O&&(0,t.jsxs)(w.Popover_Shadcn_,{open:I,onOpenChange:F,modal:!1,children:[(0,t.jsx)(S.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(h.Button,{size:R,disabled:N,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,t.jsx)(s.ChevronsUpDown,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:k?(0,t.jsxs)("div",{className:"w-full flex gap-1",children:[(0,t.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,t.jsx)("p",{className:"text-foreground",children:"*"===k?"All schemas":k})]}):(0,t.jsx)("div",{className:"w-full flex gap-1",children:(0,t.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema..."})})})}),(0,t.jsx)(v.PopoverContent_Shadcn_,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:P,sameWidthAsTrigger:!0,children:(0,t.jsxs)(y.Command_Shadcn_,{children:[(0,t.jsx)(x.CommandInput_Shadcn_,{className:"text-xs",placeholder:"Find schema..."}),(0,t.jsxs)(j.CommandList_Shadcn_,{children:[(0,t.jsx)(p.CommandEmpty_Shadcn_,{children:"No schemas found"}),(0,t.jsx)(f.CommandGroup_Shadcn_,{children:(0,t.jsxs)(_.ScrollArea,{className:(Q||[]).length>7?"h-[210px]":"",children:[D&&(0,t.jsxs)(g.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{A("*"),F(!1)},onClick:()=>{A("*"),F(!1)},children:[(0,t.jsx)("span",{children:"All schemas"}),"*"===k&&(0,t.jsx)(r.Check,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),Q?.map(e=>(0,t.jsxs)(g.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{A(e.name),F(!1)},onClick:()=>{A(e.name),F(!1)},children:[(0,t.jsx)("span",{children:e.name}),k===e.name&&(0,t.jsx)(r.Check,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==z&&L&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.CommandSeparator_Shadcn_,{}),(0,t.jsx)(f.CommandGroup_Shadcn_,{children:(0,t.jsxs)(g.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{z(),F(!1)},onClick:()=>{z(),F(!1)},children:[(0,t.jsx)(n.Plus,{size:12}),"Create a new schema"]})})]})]})]})})]})]})};e.s(["SchemaSelector",0,N,"default",0,N])},114378,e=>{"use strict";var t=e.i(533488),a=e.i(389959),r=e.i(355901);function s({enabled:e,urlKey:r,select:s,onError:n}){let[i,o]=(0,t.useQueryState)(r,t.parseAsString.withOptions({history:"push",clearOnDefault:!0})),l=(0,a.useMemo)(()=>i?s(i):void 0,[i,s]);return(0,a.useEffect)(()=>{e&&i&&!l&&(n(Error("not found"),i),o(null))},[e,n,i,o,l]),{value:l,setValue:o}}e.s(["handleErrorOnDelete",0,(e,t,a)=>{t!==e.current?r.toast.error(a):e.current=null},"useQueryStateWithSelect",()=>s])},713629,e=>{"use strict";let t=/^((ftp|http|https):\/\/)?(www.)?(?!.*(ftp|http|https|www.))[a-zA-Z0-9_*-]+(\.[a-zA-Z0-9_*-]+)+((\/)[\w#]+)*(\/\w+\?[a-zA-Z0-9_]+=\w+(&[a-zA-Z0-9_]+=\w+)*)+(?:\.[a-z]+)*(?::\d+)?(?![^<]*(?:<\/\w+>|\/?>))(.*)?\/?(.)*?$/gm,a=/^[a-z0-9-]+([.][a-z0-9]+)*:\/(\/[-a-z0-9._~!$&'()*+,;=:@%]+)+(?:\.[a-z]+)*(?::\d+)?(?![^<]*(?:<\/\w+>|\/?>))(.*)?\/?(.)*?$/i,r=/^(?:^|\s)((https?:\/\/)?(?:localhost|[\w-]+(?:\.[\w-]+)+)(:\d+)?(\/\S*)?)/i,s=/chrome-extension:\/\/([a-zA-Z]*)/gm,n=/^([a-zA-Z][a-zA-Z0-9+.-]*):(?:\/{1,3})?([a-zA-Z0-9_.-]*)$/,i=/^[a-zA-Z0-9-]+\.[a-zA-Z]{2,}$/;function o(e={excludeSimpleDomains:!0}){let{excludeSimpleDomains:l}=e,c=l?`(?!${i.source})`:"";return RegExp(`${c}((${t.source})|(${r.source})|(${a.source})|(${s.source})|(${n.source}))`,"i")}e.s(["NO_REQUIRED_CHARACTERS",0,"NO_REQUIRED_CHARS","urlRegex",()=>o])},644131,e=>{"use strict";var t=e.i(81798);e.s(["ContextMenuSeparator_Shadcn_",()=>t.ContextMenuSeparator])},418348,e=>{"use strict";var t=e.i(478902),a=e.i(20889),r=e.i(376577),s=e.i(389959),n=e.i(737018),i=e.i(843778);let o=s.forwardRef(({className:e,...r},s)=>(0,t.jsx)(a.Root,{className:(0,i.cn)("flex flex-col -space-y-px w-full",e),...r,ref:s}));o.displayName="RadioGroupStacked";let l=s.forwardRef(({image:e,label:s,showIndicator:o=!0,...l},c)=>(0,t.jsx)(a.Item,{ref:c,...l,className:(0,i.cn)("flex flex-col gap-2 w-full","bg-overlay/50 border shadow-sm","first-of-type:rounded-t-lg last-of-type:rounded-b-lg","disabled:opacity-50 disabled:cursor-not-allowed","enabled:cursor-pointer enabled:hover:bg-surface-300 enabled:hover:border-foreground-muted","hover:z-[1] focus-visible:z-[1] data-[state=checked]:z-[1]","data-[state=checked]:ring-1 data-[state=checked]:ring-border","data-[state=checked]:bg-surface-300 data-[state=checked]:border-foreground-muted","transition group",l.className),children:(0,t.jsxs)("div",{className:"flex gap-3 w-full px-[21px] py-3",children:[o&&(0,t.jsx)("div",{className:(0,i.cn)("aspect-square h-4 w-4 min-w-4 min-h-4 rounded-full border relative","flex items-center justify-center","ring-offset-background transition","group-data-[state=checked]:border-foreground-muted","group-focus:border-foreground-muted group-focus:outline-none","group-focus-visible:ring-2 group-focus-visible:ring-ring group-focus-visible:ring-offset-2","group-hover:border-foreground-muted"),children:(0,t.jsx)(a.Indicator,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(r.Circle,{size:10,strokeWidth:0,className:"fill-current text-current"})})}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.25 items-start",children:[(0,t.jsx)(n.Label,{htmlFor:l.value,className:(0,i.cn)("block -mt-[0.15rem] text-sm text-left text-light","transition-colors","enabled:group-hover:text-foreground group-data-[state=checked]:text-foreground"),children:s}),l.description&&(0,t.jsx)("p",{className:"text-left text-sm text-foreground-lighter text-balance",children:l.description}),l.children]})]})}));l.displayName="RadioGroupStackedItem",e.s(["RadioGroupStacked",()=>o,"RadioGroupStackedItem",()=>l])},843142,e=>{"use strict";var t=e.i(130843);e.s(["SelectSeparator_Shadcn_",()=>t.SelectSeparator])},121832,944334,e=>{"use strict";var t=e.i(478902),a=e.i(532728),r=e.i(513826),s=e.i(610144),n=e.i(801834),i=e.i(635494),o=e.i(392491),l=e.i(10429),c=e.i(408891),d=e.i(355901),u=e.i(587433),m=e.i(837710),h=e.i(253214),p=e.i(24315),f=e.i(61863),x=e.i(428353),g=e.i(378277),j=e.i(451031),b=e.i(831927),y=e.i(843142),v=e.i(156722),S=e.i(719754),w=e.i(449123),_=e.i(710483),C=e.i(108151),N=e.i(538482),R=e.i(531837),E=e.i(249909);let k={wrappers:"extensions"};e.s(["EXTENSION_DISABLE_WARNINGS",0,{pg_cron:"Disabling this extension will delete all scheduled jobs. This cannot be undone."},"HIDDEN_EXTENSIONS",0,["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_surgery","pg_visibility","supabase_vault","supautils","intagg","xml2","pg_tle","pg_stat_monitor"],"SEARCH_TERMS",0,{vector:["pgvector","pg_vector"]},"extensionsWithRecommendedSchemas",0,k],944334);var D=e.i(242882),T=e.i(714403),A=e.i(479084),z=e.i(667286);async function P({extension:e,projectRef:t,connectionString:a},r){if(!e)throw Error("extension is required");let s=(({extension:e})=>`
select name, version, schema from pg_available_extension_versions where name = ${(0,A.literal)(e)} limit 1;
`.trim())({extension:e}),{result:n}=await (0,T.executeSql)({projectRef:t,connectionString:a,sql:s,queryKey:["database-extension-default-schema",e]},r);return n[0]}let I=["vector","postgis"],F=R.object({name:R.string(),schema:R.string()}).superRefine((e,t)=>{"custom"===e.schema&&0===e.name.length&&t.addIssue({code:E.ZodIssueCode.custom,path:["name"],message:"Please provide a name for the schema"})});e.s(["EnableExtensionModal",0,({visible:e,extension:R,onCancel:E})=>{let T=(0,i.useIsOrioleDb)(),{data:A}=(0,i.useSelectedProjectQuery)(),{data:L}=(0,o.useProtectedSchemas)({excludeSchemas:["extensions"]}),q=k[R.name],{data:$=[],isPending:M}=(0,n.useSchemasQuery)({projectRef:A?.ref,connectionString:A?.connectionString},{enabled:e}),O=$.filter(e=>e.name===q||!L.some(t=>t.name===e.name)),{data:B,isPending:K}=(({projectRef:e,connectionString:t,extension:a},{enabled:r=!0,...s}={})=>(0,D.useQuery)({queryKey:z.databaseExtensionsKeys.defaultSchema(e,a),queryFn:({signal:r})=>P({projectRef:e,connectionString:t,extension:a},r),enabled:r&&void 0!==e&&void 0!==a,...s}))({projectRef:A?.ref,connectionString:A?.connectionString,extension:R.name},{enabled:e}),H="pg_cron"===R.name?"pg_catalog":B?.schema,Q=K||M,{mutate:W,isPending:U}=(0,s.useDatabaseExtensionEnableMutation)({onSuccess:()=>{d.toast.success(`Extension "${R.name}" is now enabled`),E()},onError:e=>{d.toast.error(`Failed to enable ${R.name}: ${e.message}`)}}),V={name:R.name,schema:q??"extensions"},J=(0,c.useForm)({mode:"onBlur",reValidateMode:"onBlur",resolver:(0,a.zodResolver)(F),defaultValues:V}),{schema:G}=J.watch(),Z=async e=>{if(void 0===A)return console.error("Project is required");let t=null!=H?H:"custom"===e.schema?e.name:e.schema;W({projectRef:A.ref,connectionString:A?.connectionString,schema:t,name:R.name,version:R.default_version,cascade:!0,createSchema:!t.startsWith("pg_")})};return(0,t.jsx)(h.Dialog,{open:e,onOpenChange:e=>{e||E()},children:(0,t.jsxs)(h.DialogContent,{size:"small","aria-describedby":void 0,children:[(0,t.jsx)(h.DialogHeader,{children:(0,t.jsxs)(h.DialogTitle,{children:["Enable ",R.name]})}),(0,t.jsx)(h.DialogSectionSeparator,{}),T&&I.includes(R.name)&&(0,t.jsxs)(_.Admonition,{type:"default",title:"Extension is limited by OrioleDB",className:"border-x-0 border-t-0 rounded-none",children:[(0,t.jsxs)("span",{className:"block",children:[R.name," cannot be accelerated by indexes on tables that are using the OrioleDB access method"]}),(0,t.jsx)(r.DocsButton,{abbrev:!1,className:"mt-2",href:`${l.DOCS_URL}`})]}),"pg_cron"===R.name&&A?.cloud_provider==="FLY"&&(0,t.jsxs)(_.Admonition,{type:"warning",title:"The pg_cron extension is not fully supported for Fly projects",className:"border-x-0 border-t-0 rounded-none",children:[(0,t.jsx)("p",{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,t.jsx)(r.DocsButton,{className:"mt-2",href:`${l.DOCS_URL}/guides/platform/fly-postgres#limitations`})]}),(0,t.jsx)(h.DialogSection,{children:(0,t.jsx)(x.Form_Shadcn_,{...J,children:(0,t.jsx)("form",{id:"enable-extensions-form",onSubmit:J.handleSubmit(Z),children:Q?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(C.ShimmeringLoader,{}),(0,t.jsx)("div",{className:"w-3/4",children:(0,t.jsx)(C.ShimmeringLoader,{})})]}):H?(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)(N.FormItemLayout,{isReactForm:!1,label:"Select a schema to enable the extension for",children:(0,t.jsx)(g.Input_Shadcn_,{disabled:!0,value:H})}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Extension must be installed in the “",H,"” schema."]})]}):(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)(f.FormField_Shadcn_,{name:"schema",control:J.control,render:({field:e})=>(0,t.jsx)(N.FormItemLayout,{name:"schema",label:"Select a schema to enable the extension for",children:(0,t.jsx)(p.FormControl_Shadcn_,{children:(0,t.jsxs)(w.Select_Shadcn_,{value:e.value,onValueChange:e.onChange,disabled:!!H,children:[(0,t.jsx)(v.SelectTrigger_Shadcn_,{children:(0,t.jsx)(S.SelectValue_Shadcn_,{placeholder:"Select a schema"})}),(0,t.jsxs)(j.SelectContent_Shadcn_,{children:[(0,t.jsxs)(b.SelectItem_Shadcn_,{value:"custom",children:["Create a new schema"," ",(0,t.jsx)("code",{className:"text-code-inline",children:R.name})]}),(0,t.jsx)(y.SelectSeparator_Shadcn_,{}),O.map(e=>(0,t.jsxs)(b.SelectItem_Shadcn_,{value:e.name,children:[e.name,e.name===q?(0,t.jsx)(u.Badge,{className:"ml-2",variant:"success",children:"Recommended"}):H||"extensions"!==e.name?null:(0,t.jsx)(u.Badge,{className:"ml-2",children:"Default"})]},e.id))]})]})})})},"schema"),!!q&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:['Use the "',q,'" schema for full compatibility with related features.']}),"custom"===G&&(0,t.jsx)(f.FormField_Shadcn_,{name:"name",control:J.control,render:({field:e})=>(0,t.jsx)(N.FormItemLayout,{name:"name",label:"Schema name",children:(0,t.jsx)(p.FormControl_Shadcn_,{children:(0,t.jsx)(g.Input_Shadcn_,{...e})})})},"name")]})})})}),(0,t.jsxs)(h.DialogFooter,{children:[(0,t.jsx)(m.Button,{type:"default",disabled:U,onClick:()=>E(),children:"Cancel"}),(0,t.jsx)(m.Button,{htmlType:"submit",form:"enable-extensions-form",loading:U,disabled:Q||U,children:"Enable extension"})]})]})})}],121832)},570958,e=>{"use strict";var t=e.i(10429);e.s(["createNavigationHandler",0,(e,a)=>r=>{if("key"in r){("Enter"===r.key||" "===r.key)&&(r.preventDefault(),r.metaKey||r.ctrlKey?window.open(`${t.BASE_PATH}${e}`,"_blank"):a.push(e));return}if("button"in r&&0===r.button&&(r.metaKey||r.ctrlKey)||"button"in r&&1===r.button){r.preventDefault(),window.open(`${t.BASE_PATH}${e}`,"_blank");return}a.push(e)}])},624982,e=>{"use strict";var t=e.i(91810);e.s(["CheckCircle2",()=>t.default])},350046,e=>{"use strict";var t=e.i(478902),a=e.i(224521),r=e.i(88816),s=e.i(389959),n=e.i(843778);let i=a.Root,o=s.forwardRef(({className:e,...r},s)=>(0,t.jsx)(a.Item,{ref:s,className:(0,n.cn)("border-b",e),...r}));o.displayName="AccordionItem";let l=s.forwardRef(({className:e,children:s,hideIcon:i,...o},l)=>(0,t.jsx)(a.Header,{className:"flex",children:(0,t.jsxs)(a.Trigger,{ref:l,className:(0,n.cn)("flex flex-1 gap-2 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180 text-left",e),...o,children:[s,!i&&(0,t.jsx)(r.ChevronDown,{className:"h-4 w-4 transition-transform duration-200 shrink-0"})]})}));l.displayName=a.Trigger.displayName;let c=s.forwardRef(({className:e,children:r,...s},i)=>(0,t.jsx)(a.Content,{ref:i,className:(0,n.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",e),...s,children:(0,t.jsx)("div",{className:"pb-4 pt-0",children:r})}));c.displayName=a.Content.displayName,e.s(["Accordion",()=>i,"AccordionContent",()=>c,"AccordionItem",()=>o,"AccordionTrigger",()=>l])},350341,e=>{"use strict";var t=e.i(350046);e.s(["Accordion_Shadcn_",()=>t.Accordion])},31227,154225,e=>{"use strict";var t=e.i(350046);e.s(["AccordionContent_Shadcn_",()=>t.AccordionContent],31227),e.s(["AccordionItem_Shadcn_",()=>t.AccordionItem],154225)},66212,e=>{"use strict";var t=e.i(350046);e.s(["AccordionTrigger_Shadcn_",()=>t.AccordionTrigger])},960432,e=>{"use strict";let t=(0,e.i(388019).default)("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);e.s(["ScrollText",()=>t],960432)},734706,e=>{"use strict";var t=e.i(242882),a=e.i(714403),r=e.i(918117);let s=(0,r.getLiveTupleEstimate)("job_run_details","cron"),n=e=>(0,r.getLiveTupleEstimateKey)(e,"job_run_details","cron");async function i({projectRef:e,connectionString:t}){if(!e)throw Error("Project ref is required");let{result:r}=await (0,a.executeSql)({projectRef:e,connectionString:t,sql:s,queryKey:n(e)});return r?.[0]?.live_tuple_estimate}function o(e,{projectRef:t,connectionString:a}){return e.fetchQuery({queryKey:n(t),queryFn:()=>i({projectRef:t,connectionString:a})})}e.s(["prefetchCronJobRunDetailsEstimate",()=>o,"useCronJobRunDetailsEstimateQuery",0,({projectRef:e,connectionString:a},{enabled:r=!0,...s}={})=>(0,t.useQuery)({queryKey:n(e),queryFn:()=>i({projectRef:e,connectionString:a}),enabled:r&&void 0!==e,staleTime:3e5,...s})])},869922,e=>{"use strict";var t=e.i(755216),a=e.i(242882),r=e.i(246230),s=e.i(714403);let n=t.default.functions.list();async function i({projectRef:e,connectionString:t},a,r){let i=new Headers(r),{result:o}=await (0,s.executeSql)({projectRef:e,connectionString:t,sql:n.sql,queryKey:["database-functions"]},a,i);return o}e.s(["useDatabaseFunctionsQuery",0,({projectRef:e,connectionString:t},{enabled:s=!0,...n}={})=>(0,a.useQuery)({queryKey:r.databaseKeys.databaseFunctions(e),queryFn:({signal:a})=>i({projectRef:e,connectionString:t},a),enabled:s&&void 0!==e,...n})])},269508,e=>{"use strict";var t=e.i(478902),a=e.i(605031),r=e.i(370410),s=e.i(365257),n=e.i(479232),i=e.i(389959);e.i(128328);var o=e.i(158639),l=e.i(869922),c=e.i(635494),d=e.i(210419),u=e.i(271226),m=e.i(206413),h=e.i(592360),p=e.i(178527),f=e.i(837710),x=e.i(703526),g=e.i(917007),j=e.i(920432),b=e.i(549815),y=e.i(911509),v=e.i(996960),S=e.i(866205),w=e.i(793912),_=e.i(135144),C=e.i(689805),N=e.i(396831);e.s(["default",0,({className:e,size:R="tiny",showError:E=!0,disabled:k=!1,schema:D,value:T,onChange:A,filterFunction:z=()=>!0,noResultsLabel:P=(0,t.jsx)("span",{children:"No functions found in this schema."})})=>{let I=(0,u.useRouter)(),{ref:F}=(0,o.useParams)(),{data:L}=(0,c.useSelectedProjectQuery)(),[q,$]=(0,i.useState)(!1),{data:M,error:O,isPending:B,isError:K,isSuccess:H,refetch:Q}=(0,l.useDatabaseFunctionsQuery)({projectRef:L?.ref,connectionString:L?.connectionString}),W=(M??[]).filter(e=>D&&e.schema===D).filter(z),U=(0,a.default)(W,e=>e.name);return(0,t.jsxs)("div",{className:e,children:[B&&(0,t.jsx)(f.Button,{type:"default",className:"justify-start",block:!0,size:R,loading:!0,children:"Loading functions..."}),E&&K&&(0,t.jsxs)(p.Alert_Shadcn_,{variant:"warning",className:"!px-3 !py-3",children:[(0,t.jsx)(h.AlertTitle_Shadcn_,{className:"text-xs text-amber-900",children:"Failed to load functions"}),(0,t.jsxs)(m.AlertDescription_Shadcn_,{className:"text-xs mb-2",children:["Error: ",O.message]}),(0,t.jsx)(f.Button,{type:"default",size:"tiny",onClick:()=>Q(),children:"Reload functions"})]}),H&&(0,t.jsxs)(C.Popover_Shadcn_,{open:q,onOpenChange:$,modal:!1,children:[(0,t.jsx)(_.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(f.Button,{size:R,disabled:!!k,type:"default",className:`w-full [&>span]:w-full ${"small"===R?"py-1.5":""}`,iconRight:(0,t.jsx)(s.ChevronsUpDown,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:T?(0,t.jsxs)("div",{className:"w-full flex gap-1",children:[(0,t.jsx)("p",{className:"text-foreground-lighter",children:"function:"}),(0,t.jsx)("p",{className:"text-foreground",children:T})]}):(0,t.jsx)("div",{className:"w-full flex gap-1",children:(0,t.jsx)("p",{className:"text-foreground-lighter",children:"Select a function"})})})}),(0,t.jsx)(w.PopoverContent_Shadcn_,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,t.jsxs)(S.Command_Shadcn_,{children:[(0,t.jsx)(j.CommandInput_Shadcn_,{placeholder:"Search functions..."}),(0,t.jsxs)(y.CommandList_Shadcn_,{children:[(0,t.jsx)(x.CommandEmpty_Shadcn_,{children:"No functions found"}),(0,t.jsx)(g.CommandGroup_Shadcn_,{children:(0,t.jsxs)(N.ScrollArea,{className:(U||[]).length>7?"h-[210px]":"",children:[!U.length&&(0,t.jsx)(b.CommandItem_Shadcn_,{disabled:!0,className:"flex items-center justify-between space-x-2 w-full",children:P},"no-function-found"),U.map(e=>(0,t.jsxs)(b.CommandItem_Shadcn_,{value:e.name.replaceAll('"',""),className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{A(e.name),$(!1)},onClick:()=>{A(e.name),$(!1)},children:[(0,t.jsx)("span",{children:e.name}),T===e.name&&(0,t.jsx)(r.Check,{className:"text-brand",size:14,strokeWidth:2})]},e.id))]})}),(0,t.jsx)(v.CommandSeparator_Shadcn_,{}),(0,t.jsx)(g.CommandGroup_Shadcn_,{children:(0,t.jsx)(b.CommandItem_Shadcn_,{className:"cursor-pointer w-full",onSelect:()=>{$(!1),I.push(`/project/${F}/database/functions`)},onClick:()=>$(!1),children:(0,t.jsxs)(d.default,{href:`/project/${F}/database/functions`,onClick:()=>{$(!1)},className:"w-full flex items-center gap-2",children:[(0,t.jsx)(n.Plus,{size:14,strokeWidth:1.5}),(0,t.jsx)("p",{children:"New function"})]})})})]})]})})]})]})}])},248002,e=>{"use strict";let t=(0,e.i(388019).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["default",()=>t])},163671,e=>{"use strict";var t=e.i(248002);e.s(["XCircle",()=>t.default])},85945,e=>{"use strict";var t=e.i(478902),a=e.i(774803),r=e.i(271226),s=e.i(533488),n=e.i(389959),i=e.i(355901);e.i(128328);var o=e.i(158639),l=e.i(242742),c=e.i(450972),d=e.i(162082),u=e.i(114378),m=e.i(265735),h=e.i(635494),p=e.i(412385),f=e.i(570958),x=e.i(403481),g=e.i(48189),j=e.i(248210),b=e.i(725137),y=e.i(466472),v=e.i(862905),S=e.i(624982),w=e.i(61187),_=e.i(163671),C=e.i(837710),N=e.i(672044),R=e.i(1962),E=e.i(449123),k=e.i(451031),D=e.i(831927),T=e.i(156722),A=e.i(719754),z=e.i(710483),P=e.i(479084),I=e.i(21150);function F(e,t){if(!Number.isFinite(e)||!Number.isInteger(e)||e<0)throw Error(`${t} must be a finite non-negative integer, got: ${e}`)}let L=(e,t,a)=>{F(t,"startPage"),F(a,"endPage");let r=(0,P.literal)(`(${t},0)`),s=(0,P.literal)(`(${a},0)`);return`
WITH deleted AS (
  DELETE FROM cron.job_run_details
  WHERE ctid >= ${r}::tid
    AND ctid < ${s}::tid
    AND end_time < now() - interval ${(0,P.literal)(e)}
  RETURNING 1
)
SELECT count(*) as deleted_count FROM deleted;
`.trim()},q=(e,t,a)=>I.sqlKeys.query(e,["cron-job-run-details","delete-batch",t,a]),$=e=>`
SELECT cron.schedule(
  ${(0,P.literal)("delete-job-run-details")},
  ${(0,P.literal)("0 12 * * *")},
  $$DELETE FROM cron.job_run_details WHERE end_time < now() - interval ${(0,P.literal)(e)}$$
);
`.trim(),M=[{label:"Older than 1 day",value:"1 day"},{label:"Older than 7 days",value:"7 days"},{label:"Older than 1 month",value:"1 month"},{label:"Older than 6 months",value:"6 months"}],O=({estimatedRows:e,mode:a,cleanupState:r,selectedInterval:s,onIntervalChange:n,onRunDeleteSql:i,onRunScheduleSql:o,onCancelDeletion:l,onRetryDeletion:c,onRefresh:d})=>{let u="number"==typeof e?e.toLocaleString():"unknown",m="confirmed"===a?`We detected approximately ${u} rows in cron.job_run_details, which prevents the overview from running.`:"Loading the cron job overview timed out. The issue might be caused by your cron.job_run_details table having too many rows.",h="deleting"===r.status,p="scheduling"===r.status,f="delete-success"===r.status,x="delete-error"===r.status,g="schedule-success"===r.status,j=h||p;return(0,t.jsx)(z.Admonition,{type:"warning",title:"confirmed"===a?"cron.job_run_details is too large to load":"Cron job overview timed out",description:m,className:"max-w-3xl w-full",children:(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("p",{children:["Remove old run history now, then schedule a cron job that keeps trimming"," ",(0,t.jsx)("code",{children:"cron.job_run_details"})," automatically so the overview remains responsive."]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"font-medium text-foreground",children:"Step 1: Delete older entries"}),h?(0,t.jsx)(B,{progress:r.progress,onCancel:l}):f?(0,t.jsx)(K,{totalRowsDeleted:r.totalRowsDeleted}):x?(0,t.jsx)(H,{error:r.error,onRetry:c}):(0,t.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,t.jsx)("div",{className:"sm:w-64",children:(0,t.jsxs)(E.Select_Shadcn_,{value:s,onValueChange:n,disabled:j,children:[(0,t.jsx)(T.SelectTrigger_Shadcn_,{className:"w-full",children:(0,t.jsx)(A.SelectValue_Shadcn_,{placeholder:"Select an interval"})}),(0,t.jsx)(k.SelectContent_Shadcn_,{children:M.map(e=>(0,t.jsx)(D.SelectItem_Shadcn_,{value:e.value,children:e.label},e.value))})]})}),(0,t.jsx)(C.Button,{type:"default",disabled:j,onClick:i,children:"Delete rows now"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"font-medium text-foreground",children:"Step 2: Schedule an automated cleanup"}),f||g?g?(0,t.jsx)(Q,{onRefresh:d}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.CodeBlock,{hideLineNumbers:!0,language:"sql",value:$(s),className:"py-3 px-4 text-xs",wrapperClassName:"max-w-full"}),(0,t.jsx)(C.Button,{type:"default",className:"mt-1",loading:p,disabled:p,onClick:o,children:"Schedule cleanup job"})]}):(0,t.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Complete step 1 to enable scheduling a daily cleanup job."})]})]})})},B=({progress:e,onCancel:a})=>{let{currentBatch:r,totalBatches:s,totalRowsDeleted:n}=e,i=s>0?Math.min(Math.round(r/s*100),100):0;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(R.Progress,{value:i,className:"flex-1 h-2"}),(0,t.jsxs)("span",{className:"text-xs text-foreground-light whitespace-nowrap",children:[i,"% (",r,"/",s," batches)"]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-foreground-light",children:["Deleted ",n.toLocaleString()," rows so far..."]}),(0,t.jsx)(C.Button,{type:"outline",size:"tiny",onClick:a,children:"Cancel"})]})]})},K=({totalRowsDeleted:e})=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-brand",children:[(0,t.jsx)(S.CheckCircle2,{size:16}),(0,t.jsxs)("span",{className:"text-sm",children:["Successfully deleted ",e.toLocaleString()," rows."]})]}),H=({error:e,onRetry:a})=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,t.jsx)(_.XCircle,{size:16}),(0,t.jsxs)("span",{className:"text-sm",children:["Deletion failed: ",e]})]}),(0,t.jsx)(C.Button,{type:"default",size:"small",onClick:a,children:"Retry"})]}),Q=({onRefresh:e})=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-brand",children:[(0,t.jsx)(S.CheckCircle2,{size:16}),(0,t.jsx)("span",{className:"text-sm",children:"Daily cleanup job scheduled successfully."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Refresh to reload the cron jobs and view the new cleanup job."}),(0,t.jsx)(C.Button,{type:"default",size:"tiny",icon:(0,t.jsx)(w.RefreshCw,{size:14}),onClick:e})]})]});var W=e.i(591385),U=e.i(567558),V=e.i(843778),J=e.i(108151);let G=({columns:e,rows:a,isLoading:r,error:s,searchQuery:n,onScroll:i,onRowClick:o,overlay:l})=>{let c=l?(0,t.jsx)("div",{className:"absolute top-20 px-6 w-full flex justify-center",children:l}):r?(0,t.jsx)("div",{className:"absolute top-12 px-6 w-full",children:(0,t.jsx)(J.GenericSkeletonLoader,{})}):s?(0,t.jsx)("div",{className:"absolute top-28 px-10 flex flex-col items-center justify-center w-full",children:(0,t.jsx)(U.default,{subject:"Failed to retrieve cron jobs",error:s})}):(0,t.jsx)("div",{className:"absolute top-32 px-6 w-full",children:(0,t.jsxs)("div",{className:"text-center text-sm flex flex-col gap-y-1",children:[(0,t.jsx)("p",{className:"text-foreground",children:n?"No cron jobs found":"No cron jobs in your project"}),(0,t.jsx)("p",{className:"text-foreground-light",children:n?"There are currently no cron jobs based on the search applied":"There are currently no cron jobs created yet in your project"})]})});return(0,t.jsx)(W.default,{className:"flex-grow border-t-0",rowHeight:44,headerRowHeight:36,columns:e,rows:a,onScroll:i,rowKeyGetter:e=>e.jobid,rowClass:()=>(0,V.cn)("cursor-pointer","[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-8"),renderers:{renderRow:(e,a)=>(0,t.jsx)(W.Row,{...a,onClick:e=>{o(a.row,e)}},a.row.jobid),noRowsFallback:c}})},Z=({error:e,isRetrying:a,onRetry:r})=>(0,t.jsx)(z.Admonition,{type:"warning",title:"Error displaying cron jobs",description:"There was an error displaying cron jobs. Please try again.",className:"max-w-3xl w-full",children:(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[e?.message&&(0,t.jsxs)("p",{className:"text-foreground-light break-words",children:["Error message: ",(0,t.jsx)("code",{className:"text-xs",children:e.message})]}),r&&(0,t.jsx)(C.Button,{type:"default",loading:a,disabled:a,className:"mt-1",onClick:r,children:"Retry check"})]})});var Y=e.i(366652),X=e.i(975924),ee=e.i(746301);let et=({search:e,isRefreshing:a,onSearchChange:r,onSearchSubmit:s,onClearSearch:n,onRefresh:i,onCreateJob:o})=>(0,t.jsxs)("div",{className:"bg-surface-200 py-3 px-10 flex items-center justify-between flex-wrap gap-y-2",children:[(0,t.jsx)(ee.Input,{size:"tiny",className:"w-52",placeholder:"Search for a job",icon:(0,t.jsx)(Y.Search,{}),value:e,onChange:e=>r(e.target.value),onKeyDown:e=>{("Enter"===e.key||"NumpadEnter"===e.code)&&s()},actions:[e&&(0,t.jsx)(C.Button,{size:"tiny",type:"text",icon:(0,t.jsx)(X.X,{}),onClick:n,className:"p-0 h-5 w-5"},"clear-search")]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(C.Button,{type:"default",icon:(0,t.jsx)(w.RefreshCw,{}),loading:a,onClick:i,children:"Refresh"}),(0,t.jsx)(C.Button,{onClick:o,children:"Create job"})]})]});var ea=e.i(617361),er=e.i(201844),es=e.i(734706),en=e.i(242882),ei=e.i(714403),eo=e.i(918117);let el=(0,eo.getLiveTupleEstimate)("job","cron"),ec=e=>(0,eo.getLiveTupleEstimateKey)(e,"job","cron");async function ed({projectRef:e,connectionString:t}){if(!e)throw Error("Project ref is required");let{result:a}=await (0,ei.executeSql)({projectRef:e,connectionString:t,sql:el,queryKey:ec(e)});return a?.[0]?.live_tuple_estimate}var eu=e.i(517750);let em="select count(jobid) from cron.job;".trim();async function eh({projectRef:e,connectionString:t}){if(!e)throw Error("Project ref is required");let{result:a}=await (0,ei.executeSql)({projectRef:e,connectionString:t,sql:em,queryKey:["cron-jobs-count"]});return a[0].count}var ep=e.i(867088);async function ef({projectRef:e,connectionString:t,searchTerm:a,page:r=0}){if(!e)throw Error("Project ref is required");let{result:s}=await (0,ei.executeSql)({projectRef:e,connectionString:t,sql:(({searchTerm:e,page:t})=>`
WITH latest_runs AS (
  SELECT 
    jobid,
    status,
    MAX(start_time) AS latest_run
  FROM cron.job_run_details
  GROUP BY jobid, status
), most_recent_runs AS (
  SELECT 
    jobid, 
    status, 
    latest_run
  FROM latest_runs lr1
  WHERE latest_run = (
    SELECT MAX(latest_run) 
    FROM latest_runs lr2 
    WHERE lr2.jobid = lr1.jobid
  )
)
SELECT 
  job.jobid,
  job.jobname,
  job.schedule,
  job.command,
  job.active,
  mr.latest_run,
  mr.status
FROM 
  cron.job job
LEFT JOIN most_recent_runs mr ON job.jobid = mr.jobid
${e?`WHERE job.jobname ILIKE '%${e}%'`:""}
ORDER BY job.jobid
LIMIT 20
OFFSET ${20*t};
`.trim())({searchTerm:a,page:r}),queryKey:["cron-jobs"]});return s}var ex=e.i(170149),eg=e.i(38429),ej=e.i(356003);async function eb({projectRef:e,connectionString:t,jobId:a}){let{result:r}=await (0,ei.executeSql)({projectRef:e,connectionString:t,sql:`SELECT cron.unschedule(${a});`,queryKey:eu.databaseCronJobsKeys.delete()});return r}let ey=({cronJob:e,visible:a,onClose:r,onDeleteStart:n})=>{let{data:o}=(0,h.useSelectedProjectQuery)(),{data:l}=(0,m.useSelectedOrganizationQuery)(),[c]=(0,s.useQueryState)("search",s.parseAsString.withDefault("")),{mutate:u}=(0,d.useSendEventMutation)(),{mutate:p,isPending:f}=(({onSuccess:e,onError:t,...a}={})=>{let r=(0,ej.useQueryClient)();return(0,eg.useMutation)({mutationFn:e=>eb(e),async onSuccess(t,a,s){let{projectRef:n,searchTerm:i}=a;await r.invalidateQueries({queryKey:eu.databaseCronJobsKeys.listInfinite(n,i)}),await e?.(t,a,s)},async onError(e,a,r){void 0===t?i.toast.error(`Failed to delete database cron job: ${e.message}`):t(e,a,r)},...a})})({onSuccess:()=>{u({action:"cron_job_removed",groups:{project:o?.ref??"Unknown",organization:l?.slug??"Unknown"}}),i.toast.success(`Successfully removed cron job ${e.jobname}`),r()}});async function x(){if(!o)return console.error("Project is required");n?.(e.jobid.toString()),p({jobId:e.jobid,projectRef:o.ref,connectionString:o.connectionString,searchTerm:c})}return e?e.jobname?(0,t.jsx)(ex.TextConfirmModal,{variant:"destructive",visible:a,onConfirm:x,onCancel:()=>{r(),(0,g.cleanPointerEventsNoneOnBody)()},title:"Delete this cron job",loading:f,confirmLabel:`Delete cron job ${e.jobname}`,confirmPlaceholder:"Type in name of cron job",confirmString:e.jobname??"Unknown",text:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"This will delete the cron job"})," ",(0,t.jsx)("span",{className:"text-bold text-foreground",children:e.jobname})]}),alert:{title:"You cannot recover this cron job once deleted."}}):(0,t.jsx)(y.ConfirmationModal,{variant:"destructive",visible:a,onCancel:()=>{r(),(0,g.cleanPointerEventsNoneOnBody)()},onConfirm:x,title:"Delete the cron job",loading:f,confirmLabel:"Delete",alert:{title:"You cannot recover this cron job once deleted."}}):null},ev={jobname:"",schedule:"",active:!0,command:""},eS=({count:e})=>(0,t.jsx)("div",{className:"flex justify-between min-h-9 h-9 overflow-hidden items-center px-6 w-full border-t text-xs text-foreground-light",children:e.isLoading?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(a.Loader2,{size:14,className:"animate-spin"})," Loading..."]}):`Total: ${e.value??0} jobs${e.isEstimate?" (estimate)":""}`}),ew=({visible:e,onClose:a,onCancel:r})=>(0,t.jsx)(y.default,{visible:e,title:"Discard changes",confirmLabel:"Discard",onCancel:r,onConfirm:a,children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})});e.s(["CronjobsTab",0,()=>{let e=(0,r.useRouter)(),{ref:a}=(0,o.useParams)(),{data:y}=(0,h.useSelectedProjectQuery)(),{data:S}=(0,m.useSelectedOrganizationQuery)(),[w,_]=(0,s.useQueryState)("search",s.parseAsString.withDefault("")),[C,N]=(0,n.useState)(w),{dataStatus:R,isQueryEnabled:E,grid:k,count:D}=function({projectRef:e,connectionString:t,searchQuery:a}){let r=!!e,{data:s,error:i,isError:o,isPending:l,isRefetching:c,refetch:d}=(0,es.useCronJobRunDetailsEstimateQuery)({projectRef:e,connectionString:t},{enabled:r}),u="number"==typeof s&&s>2e5,m=r&&!l&&!o&&!u,{data:h,error:p,isLoading:f,isError:x,isRefetching:g,isFetchingNextPage:j,hasNextPage:b=!1,refetch:y,fetchNextPage:v}=(({projectRef:e,connectionString:t,searchTerm:a},{enabled:r=!0,...s}={})=>(0,ep.useInfiniteQuery)({queryKey:eu.databaseCronJobsKeys.listInfinite(e,a),queryFn:({pageParam:r})=>ef({projectRef:e,connectionString:t,searchTerm:a,page:r}),staleTime:0,enabled:r&&void 0!==e,initialPageParam:0,getNextPageParam(e,t){let a=t.length;if(e.length>=20)return a},...s}))({projectRef:e,connectionString:t,searchTerm:a??void 0},{placeholderData:a?er.keepPreviousData:void 0,staleTime:1/0,enabled:m}),S=(0,n.useMemo)(()=>h?.pages.flatMap(e=>e)??[],[h?.pages]),{data:w,isPending:_,isError:C}=(({projectRef:e,connectionString:t},{enabled:a=!0,...r}={})=>(0,en.useQuery)({queryKey:ec(e),queryFn:()=>ed({projectRef:e,connectionString:t}),enabled:a&&void 0!==e,staleTime:3e5,...r}))({projectRef:e,connectionString:t},{enabled:r}),N=r&&!_&&!C&&!("number"==typeof w&&w>2e5),{data:R,isPending:E}=(({projectRef:e,connectionString:t},{enabled:a=!0,...r}={})=>(0,en.useQuery)({queryKey:eu.databaseCronJobsKeys.count(e),queryFn:()=>eh({projectRef:e,connectionString:t}),enabled:a&&void 0!==e,...r}))({projectRef:e,connectionString:t},{enabled:N}),k=x&&"string"==typeof p?.message&&p.message.toLowerCase().includes("timeout"),D=(0,n.useMemo)(()=>!r||l?{status:"loading"}:o?{status:"estimate-error",error:i,isRetrying:c,retry:d}:u?{status:"overflow-confirmed",estimatedRows:s}:k?{status:"overflow-suspected",estimatedRows:s}:{status:"ready"},[r,l,o,i,c,d,u,s,k]),T="loading"===D.status||"ready"===D.status&&f,A="ready"===D.status&&x&&!k?p??null:null;return{dataStatus:D,isQueryEnabled:m,grid:{rows:S,isLoading:T,error:A,isRefetching:g,isFetchingNextPage:j,hasNextPage:b,refetch:y,fetchNextPage:v},count:{value:N?R:w,isEstimate:!N,isLoading:N?E:_}}}({projectRef:y?.ref,connectionString:y?.connectionString,searchQuery:w}),{cleanupInterval:T,setCleanupInterval:A,cleanupState:z,runBatchedDeletion:P,scheduleCleanup:F,cancelDeletion:B}=(({projectRef:e,connectionString:t})=>{let[a,r]=(0,n.useState)(M[0].value),[s,o]=(0,n.useState)({status:"idle"}),l=(0,n.useRef)(!1),{mutateAsync:c}=(0,ea.useExecuteSqlMutation)({onError:()=>{}}),d=(0,n.useCallback)(async a=>{if(!e){console.error("[CronJobsTab > batch deletion] Project reference is required"),i.toast.error("There was an error running the cleanup. Please try again.");return}l.current=!1;try{o({status:"deleting",progress:{currentBatch:0,totalBatches:0,totalRowsDeleted:0}});let r=await c({projectRef:e,connectionString:t,sql:`
SELECT pg_relation_size(oid) / current_setting('block_size')::int8 AS num_pages
FROM pg_class
WHERE relname = 'job_run_details'
  AND relnamespace = 'cron'::regnamespace;
`.trim(),queryKey:I.sqlKeys.query(e,["cron-job-run-details","page-count"])}),s=r.result?.[0]?.num_pages??0,n=Number(s);if(!Number.isFinite(n)||n<0)throw Error(`[CronJobs > cleanup actions] Invalid page count returned: ${s}`);if(0===n){o({status:"delete-success",totalRowsDeleted:0}),i.toast.success("The job_run_details table is empty.");return}let d=Math.ceil(n/5e3),u=0;for(let r=0;r<d;r++){if(l.current){o({status:"idle"}),i.toast.info("Deletion cancelled.");return}let s=5e3*r,m=Math.min((r+1)*5e3,n+1);o({status:"deleting",progress:{currentBatch:r+1,totalBatches:d,totalRowsDeleted:u}});let h=await c({projectRef:e,connectionString:t,sql:L(a,s,m),queryKey:q(e,a,s)}),p=h.result?.[0]?.deleted_count??0;if(u+=p,l.current){o({status:"idle"}),i.toast.info("Deletion cancelled.");return}r<d-1&&await new Promise(e=>setTimeout(e,100))}o({status:"delete-success",totalRowsDeleted:u}),i.toast.success(`Deleted ${u.toLocaleString()} cron job runs older than ${a}.`)}catch(e){console.error("[CronJobs] Batch deletion failed with error: %O",e),o({status:"delete-error",error:e instanceof Error?e.message:"Unknown error"}),i.toast.error("Running the cleanup failed. Please try again.")}},[e,t,c]);return{cleanupInterval:a,setCleanupInterval:r,cleanupState:s,runBatchedDeletion:d,scheduleCleanup:(0,n.useCallback)(async a=>{if(!e){console.error("[CronJobsTab > schedule cleanup] Project reference is required"),i.toast.error("There was an error scheduling the cleanup. Please try again.");return}try{o({status:"scheduling"}),await c({projectRef:e,connectionString:t,sql:$(a),queryKey:I.sqlKeys.query(e,["cron-job-run-details","schedule",a])}),o({status:"schedule-success"}),i.toast.success("Scheduled daily cleanup job.")}catch(e){console.error("[CronJobs] Failed to schedule cleanup with error: %O",e),o({status:"schedule-error",error:e instanceof Error?e.message:"Unknown error"}),i.toast.error("Scheduling the cleanup job failed. Please try again.")}},[e,t,c]),cancelDeletion:(0,n.useCallback)(()=>{l.current=!0,o({status:"idle"})},[])}})({projectRef:y?.ref,connectionString:y?.connectionString}),K=(0,n.useMemo)(()=>{switch(R.status){case"overflow-confirmed":return(0,t.jsx)(O,{mode:"confirmed",estimatedRows:R.estimatedRows,selectedInterval:T,onIntervalChange:A,cleanupState:z,onRunDeleteSql:()=>P(T),onRunScheduleSql:()=>F(T),onCancelDeletion:B,onRetryDeletion:()=>P(T),onRefresh:k.refetch});case"overflow-suspected":return(0,t.jsx)(O,{mode:"suspected",estimatedRows:R.estimatedRows,selectedInterval:T,onIntervalChange:A,cleanupState:z,onRunDeleteSql:()=>P(T),onRunScheduleSql:()=>F(T),onCancelDeletion:B,onRetryDeletion:()=>P(T),onRefresh:k.refetch});case"estimate-error":return(0,t.jsx)(Z,{error:R.error,isRetrying:R.isRetrying,onRetry:R.retry});default:return}},[R,T,A,z,P,F,B,k.refetch]),H=(0,n.useRef)(null),{setValue:Q,value:W}=(0,u.useQueryStateWithSelect)({urlKey:"edit",select:e=>{if(!e)return;let t=k.rows.find(t=>t.jobid.toString()===e);return t?{jobname:t.jobname,schedule:t.schedule,active:t.active,command:t.command}:void 0},enabled:k.rows.length>0&&!k.isLoading,onError:()=>i.toast.error("Cron job not found")}),{setValue:U,value:V}=(0,u.useQueryStateWithSelect)({urlKey:"delete",select:e=>e?k.rows.find(t=>t.jobid.toString()===e):void 0,enabled:k.rows.length>0&&!k.isLoading,onError:(e,t)=>(0,u.handleErrorOnDelete)(H,t,"Cron job not found")}),{data:J=[]}=(0,c.useDatabaseExtensionsQuery)({projectRef:y?.ref,connectionString:y?.connectionString}),Y=J.find(e=>"pg_cron"===e.name),X=!!Y?.installed_version&&(0,x.isGreaterThanOrEqual)(Y.installed_version,"1.5"),{mutate:ee}=(0,d.useSendEventMutation)(),ei=(0,n.useMemo)(()=>(0,v.formatCronJobColumns)({onSelectEdit:e=>{ee({action:"cron_job_update_clicked",groups:{project:a??"Unknown",organization:S?.slug??"Unknown"}}),Q(e.jobid.toString())},onSelectDelete:e=>{ee({action:"cron_job_delete_clicked",groups:{project:a??"Unknown",organization:S?.slug??"Unknown"}}),U(e.jobid.toString())}}),[S?.slug,a,ee,Q,U]),eo=(0,n.useRef)(0),[el,em]=(0,s.useQueryState)("new",s.parseAsBoolean.withDefault(!1).withOptions({clearOnDefault:!0})),[ex,eg]=(0,n.useState)(!1),ej=()=>{Q(null),em(!1),(0,g.cleanPointerEventsNoneOnBody)(500)},{confirmOnClose:eb,modalProps:e_}=(0,p.useConfirmOnClose)({checkIsDirty:()=>ex,onClose:()=>{eg(!1),ej()}});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-full w-full space-y-4",children:(0,t.jsxs)("div",{className:"h-full w-full flex flex-col relative",children:[(0,t.jsx)(et,{search:C,isRefreshing:k.isRefetching&&!k.isFetchingNextPage,onSearchChange:N,onSearchSubmit:()=>{let e=C.trim();_(e.length>0?e:null)},onClearSearch:()=>{N(""),_(null)},onRefresh:k.refetch,onCreateJob:()=>{ee({action:"cron_job_create_clicked",groups:{project:y?.ref??"Unknown",organization:S?.slug??"Unknown"}}),em(!0)}}),(0,t.jsx)(j.LoadingLine,{loading:k.isLoading||k.isRefetching||k.isFetchingNextPage}),(0,t.jsx)(G,{columns:ei,rows:k.rows,isLoading:k.isLoading,error:k.error,searchQuery:w,onScroll:e=>{if(!E)return;let t=eo.current!==e.currentTarget.scrollLeft;eo.current=e.currentTarget.scrollLeft,!k.isLoading&&!k.isFetchingNextPage&&!t&&(0,g.isAtBottom)(e)&&k.hasNextPage&&k.fetchNextPage()},onRowClick:(t,r)=>{let{jobid:s,jobname:n}=t,i=`/project/${a}/integrations/cron/jobs/${s}?child-label=${encodeURIComponent(n||`Job #${s}`)}`;ee({action:"cron_job_history_clicked",groups:{project:a??"Unknown",organization:S?.slug??"Unknown"}}),(0,f.createNavigationHandler)(i,e)(r)},overlay:K}),(0,t.jsx)(eS,{count:D})]})}),V&&(0,t.jsx)(ey,{visible:!!V,onClose:()=>{H.current=null,U(null)},onDeleteStart:e=>{H.current=e},cronJob:V}),(0,t.jsx)(b.Sheet,{open:!!el||!!W,onOpenChange:eb,children:(0,t.jsx)(b.SheetContent,{size:"default",tabIndex:void 0,children:(0,t.jsx)(l.CreateCronJobSheet,{selectedCronJob:W??ev,supportsSeconds:X,onDirty:eg,onClose:ej,onCloseWithConfirmation:eb})})}),(0,t.jsx)(ew,{...e_})]})}],85945)},524943,e=>{e.n(e.i(85945))}]);

//# debugId=8605955f-42fe-2461-9804-ece8f7db7bc7
//# sourceMappingURL=a94286b745bc4d28.js.map