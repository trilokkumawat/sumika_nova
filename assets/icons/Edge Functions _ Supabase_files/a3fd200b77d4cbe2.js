;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="2f2a2e03-62aa-4d6d-0271-157e230791de")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,270629,84001,580984,518152,811419,e=>{"use strict";var t=e.i(755216),a=e.i(38429),r=e.i(356003),n=e.i(355901);let i=["anon","authenticated"],s=["SELECT","INSERT","UPDATE","DELETE"],l={anon:[...s],authenticated:[...s]};e.s(["API_ACCESS_ROLES",0,i,"API_PRIVILEGE_TYPES",0,s,"DEFAULT_DATA_API_PRIVILEGES",0,l,"EMPTY_DATA_API_PRIVILEGES",0,{anon:[],authenticated:[]},"checkDataApiPrivilegesNonEmpty",0,e=>!!e&&Object.values(e).some(e=>e.length>0),"isApiAccessRole",0,e=>i.includes(e),"isApiPrivilegeType",0,e=>s.includes(e)],84001);var o=e.i(714403),c=e.i(915993),d=e.i(972089);async function u({projectRef:e,connectionString:a,relationId:r,privileges:n}){let l=[];for(let e of i){let a=n[e],i=s.filter(e=>!a.includes(e));if(i.length>0){let a=i.map(t=>({grantee:e,privilegeType:t,relationId:r})),n=t.default.tablePrivileges.revoke(a).sql.trim();n&&l.push(n)}if(a.length>0){let n=a.map(t=>({grantee:e,privilegeType:t,relationId:r})),i=t.default.tablePrivileges.grant(n).sql.trim();i&&l.push(i)}}if(0===l.length)return null;let{result:c}=await (0,o.executeSql)({projectRef:e,connectionString:a,sql:l.join("\n"),queryKey:["table-api-access","update-privileges"]});return c}e.s(["useTableApiAccessPrivilegesMutation",0,({onSuccess:e,onError:t,...i}={})=>{let s=(0,r.useQueryClient)();return(0,a.useMutation)({mutationFn:e=>u(e),async onSuccess(t,a,r){let{projectRef:n}=a;await Promise.all([(0,d.invalidateTablePrivilegesQuery)(s,n),s.invalidateQueries({queryKey:c.lintKeys.lint(n)})]),await e?.(t,a,r)},async onError(e,a,r){void 0===t?n.toast.error(`Failed to update API access privileges: ${e.message}`):t(e,a,r)},...i})}],270629),e.i(128328);var m=e.i(657588),h=e.i(10429),p=e.i(761755);e.s(["useDataApiGrantTogglesEnabled",0,()=>{let e=(0,m.useFlag)("dataApiExposedBadge"),t=(0,p.usePHFlag)("tableEditorApiAccessToggle");return!!h.IS_TEST_ENV||e&&!!t}],580984);var g=e.i(25912);async function f({projectRef:e,connectionString:a,name:r,tables:n=[],publish_insert:i=!1,publish_update:s=!1,publish_delete:l=!1,publish_truncate:c=!1}){let{sql:d}=t.default.publications.create({name:r,tables:n,publish_insert:i,publish_update:s,publish_delete:l,publish_truncate:c}),{result:u}=await (0,o.executeSql)({projectRef:e,connectionString:a,sql:d,queryKey:["publication","create"]});return u}e.s(["useDatabasePublicationCreateMutation",0,({onSuccess:e,onError:t,...i}={})=>{let s=(0,r.useQueryClient)();return(0,a.useMutation)({mutationFn:e=>f(e),async onSuccess(t,a,r){let{projectRef:n}=a;await s.invalidateQueries({queryKey:g.databasePublicationsKeys.list(n)}),await e?.(t,a,r)},async onError(e,a,r){void 0===t?n.toast.error(`Failed to create database publication: ${e.message}`):t(e,a,r)},...i})}],518152),e.i(967533);var x=e.i(721490),y=e.i(162082),b=e.i(265735),v=e.i(908937),j=e.i(201461),S=e.i(790819);function N({table:e,payload:t,returning:a=!1,enumArrayColumns:r}){return new x.Query().from(e.name,e.schema??void 0).insert([t],{returning:a,enumArrayColumns:r}).toSql()}async function C({projectRef:e,connectionString:t,table:a,payload:r,enumArrayColumns:n,returning:i,roleImpersonationState:s}){let l=(0,v.wrapWithRoleImpersonation)(N({table:a,payload:r,enumArrayColumns:n,returning:i}),s),{result:c}=await (0,o.executeSql)({projectRef:e,connectionString:t,sql:l,isRoleImpersonationEnabled:(0,j.isRoleImpersonationEnabled)(s?.role)});return c}e.s(["getTableRowCreateSql",()=>N,"useTableRowCreateMutation",0,({onSuccess:e,onError:t,...i}={})=>{let s=(0,r.useQueryClient)(),{mutate:l}=(0,y.useSendEventMutation)(),{data:o}=(0,b.useSelectedOrganizationQuery)();return(0,a.useMutation)({mutationFn:e=>C(e),async onSuccess(t,a,r){let{projectRef:n,table:i}=a;try{l({action:"table_data_added",properties:{method:"table_editor",schema_name:i.schema,table_name:i.name},groups:{project:n,...o?.slug&&{organization:o.slug}}})}catch(e){console.error("Failed to track table data insertion event:",e)}await s.invalidateQueries({queryKey:S.tableRowKeys.tableRowsAndCount(n,i.id)}),await e?.(t,a,r)},async onError(e,a,r){void 0===t?n.toast.error(e.message):t(e,a,r)},...i})}],811419)},478145,e=>{"use strict";var t=e.i(38429),a=e.i(356003),r=e.i(355901);e.i(967533);var n=e.i(721490),i=e.i(714403),s=e.i(908937),l=e.i(201461),o=e.i(790819);function c({table:e,configuration:t,payload:a,returning:r=!1,enumArrayColumns:i}){return new n.Query().from(e.name,e.schema??void 0).update(a,{returning:r,enumArrayColumns:i}).match(t.identifiers).toSql()}async function d({projectRef:e,connectionString:t,table:a,payload:r,configuration:n,enumArrayColumns:o,returning:d,roleImpersonationState:u}){let m=(0,s.wrapWithRoleImpersonation)(c({table:a,configuration:n,payload:r,enumArrayColumns:o,returning:d}),u),{result:h}=await (0,i.executeSql)({projectRef:e,connectionString:t,sql:m,isRoleImpersonationEnabled:(0,l.isRoleImpersonationEnabled)(u?.role),queryKey:["table-row-update",a.id]});return h}e.s(["getTableRowUpdateSql",()=>c,"useTableRowUpdateMutation",0,({onSuccess:e,onError:n,...i}={})=>{let s=(0,a.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>d(e),async onSuccess(t,a,r){let{projectRef:n,table:i}=a;await s.invalidateQueries({queryKey:o.tableRowKeys.tableRows(n,{table:{id:i.id}})}),await e?.(t,a,r)},async onError(e,t,a){void 0===n?r.toast.error(`Failed to update table row: ${e.message}`):n(e,t,a)},...i})}])},627487,78071,e=>{"use strict";var t,a=e.i(55956),r=e.i(421781),n=e.i(125509),i=e.i(761755),s=e.i(10429),l=e.i(389959);a.default.extend(r.default);let o=["control","variation"];function c(e){return"string"==typeof e&&o.includes(e)}function d({isNewRecord:e=!1,projectInsertedAt:t}){let r=(0,i.usePHFlag)("tableCreateGeneratePolicies"),o=(0,l.useMemo)(()=>!!s.IS_PLATFORM&&"variation"===r,[r]),d=(0,l.useMemo)(()=>{if(!t)return;let e=a.default.utc(t);if(e.isValid())return a.default.utc().diff(e,"day")},[t]),u=s.IS_PLATFORM&&e&&c(r)&&void 0!==d;return(0,n.useTrackExperimentExposure)("table_create_generate_policies",u?r:void 0,{days_since_project_creation:d}),{enabled:o}}e.s(["isValidExperimentVariant",()=>c,"useTableCreateGeneratePolicies",()=>d],627487);var u=e.i(242882),m=e.i(714403),h=e.i(246230),p=((t={}).CHECK_CONSTRAINT="c",t.FOREIGN_KEY_CONSTRAINT="f",t.PRIMARY_KEY_CONSTRAINT="p",t.UNIQUE_CONSTRAINT="u",t.CONSTRAINT_TRIGGER="t",t.EXCLUSION_CONSTRAINT="x",t);async function g({projectRef:e,connectionString:t,id:a},r){let n=(({id:e})=>`
  with table_info as (
    select 
      n.nspname::text as schema,
      c.relname::text as name,
      to_regclass(concat('"', n.nspname, '"."', c.relname, '"')) as regclass
    from pg_class c
    join pg_namespace n on n.oid = c.relnamespace
    where c.oid = ${e}
)
select 
    con.oid as id,
    con.conname as name,
    con.contype as type
from pg_catalog.pg_constraint con
inner join pg_catalog.pg_class rel
        on rel.oid = con.conrelid
inner join pg_catalog.pg_namespace nsp
        on nsp.oid = connamespace
inner join table_info ti
        on ti.schema = nsp.nspname 
        and ti.name = rel.relname;
`.trim())({id:a}),{result:i}=await (0,m.executeSql)({projectRef:e,connectionString:t,sql:n,queryKey:["table-constraints",a]},r);return i??[]}e.s(["CONSTRAINT_TYPE",()=>p,"useTableConstraintsQuery",0,({projectRef:e,connectionString:t,id:a},{enabled:r=!0,...n}={})=>(0,u.useQuery)({queryKey:h.databaseKeys.tableConstraints(e,a),queryFn:({signal:r})=>g({projectRef:e,connectionString:t,id:a},r),enabled:r&&void 0!==e&&void 0!==a,...n})],78071)},471994,e=>{"use strict";var t=e.i(242882),a=e.i(714403),r=e.i(246230);async function n({projectRef:e,connectionString:t,schema:r},n){let i=(({schema:e})=>{if(!e)throw Error("schema is required");return`
SELECT 
  con.oid as id, 
  con.conname as constraint_name, 
  con.confdeltype as deletion_action,
  con.confupdtype as update_action,
  rel.oid as source_id,
  nsp.nspname as source_schema, 
  rel.relname as source_table, 
  (
    SELECT 
      array_agg(
        att.attname 
        ORDER BY 
          un.ord
      ) 
    FROM 
      unnest(con.conkey) WITH ORDINALITY un (attnum, ord) 
      INNER JOIN pg_attribute att ON att.attnum = un.attnum 
    WHERE 
      att.attrelid = rel.oid
  ) source_columns, 
  frel.oid as target_id,
  fnsp.nspname as target_schema, 
  frel.relname as target_table, 
  (
    SELECT 
      array_agg(
        att.attname 
        ORDER BY 
          un.ord
      ) 
    FROM 
      unnest(con.confkey) WITH ORDINALITY un (attnum, ord) 
      INNER JOIN pg_attribute att ON att.attnum = un.attnum 
    WHERE 
      att.attrelid = frel.oid
  ) target_columns 
FROM 
  pg_constraint con 
  INNER JOIN pg_class rel ON rel.oid = con.conrelid 
  INNER JOIN pg_namespace nsp ON nsp.oid = rel.relnamespace 
  INNER JOIN pg_class frel ON frel.oid = con.confrelid 
  INNER JOIN pg_namespace fnsp ON fnsp.oid = frel.relnamespace 
WHERE 
  con.contype = 'f'
  AND nsp.nspname = '${e}'
`.trim()})({schema:r}),{result:s}=await (0,a.executeSql)({projectRef:e,connectionString:t,sql:i,queryKey:["foreign-key-constraints",r]},n);return(s??[]).map(e=>({...e,source_columns:e.source_columns.replace("{","").replace("}","").split(","),target_columns:e.target_columns.replace("{","").replace("}","").split(",")}))}e.s(["useForeignKeyConstraintsQuery",0,({projectRef:e,connectionString:a,schema:i},{enabled:s=!0,...l}={})=>(0,t.useQuery)({queryKey:r.databaseKeys.foreignKeyConstraints(e,i),queryFn:({signal:t})=>n({projectRef:e,connectionString:a,schema:i},t),enabled:s&&void 0!==e&&void 0!==i&&i.length>0,...l})])},390974,947300,e=>{"use strict";var t,a=e.i(721329),r=((t={}).NO_ACTION="a",t.RESTRICT="r",t.CASCADE="c",t.SET_NULL="n",t.SET_DEFAULT="d",t);e.s(["FOREIGN_KEY_CASCADE_ACTION",()=>r],947300);var n=e.i(48189),i=e.i(355901);let s=e=>{if(["CURRENT_DATE"].includes(e)||"("===e[0]&&")"===e[e.length-1])return!0;let t=e.indexOf("("),a=e.indexOf(")");return!(e.indexOf(" ")>=0)&&!!(t>=0)&&!!(a>t)};e.s(["generateColumnField",0,(e={})=>{let{name:t,table:a,schema:r,format:i}=e;return{id:(0,n.uuidv4)(),name:t||"",table:a||"",schema:r||"",comment:"",format:i||"",defaultValue:null,foreignKey:void 0,check:null,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}},"generateColumnFieldFromPostgresColumn",0,(e,t,a)=>{let{primary_keys:i}=t,s=i.map(e=>e.name),l=((e,t,a)=>{let{relationships:n}=t,i=n.find(t=>t.source_schema===e.schema&&t.source_table_name===e.table&&t.source_column_name===e.name);if(void 0===i)return i;{let e=a.find(e=>e.id===i.id);return{...i,deletion_action:e?.deletion_action??r.NO_ACTION,update_action:e?.update_action??r.NO_ACTION}}})(e,t,a),o=e?.data_type==="ARRAY";return{foreignKey:l,id:e?.id??(0,n.uuidv4)(),table:e.table,schema:e.schema,name:e.name,comment:e?.comment,format:o?e.format.slice(1):e.format,defaultValue:e?.default_value,check:e.check,isArray:o,isNullable:e.is_nullable,isIdentity:e.is_identity,isUnique:e.is_unique,isNewColumn:!1,isEncrypted:!1,isPrimaryKey:s.includes(e.name)}},"generateCreateColumnPayload",0,(e,t)=>{let r,n=!!t.format.includes("int")&&t.isIdentity,i=t.defaultValue;return{schema:e.schema,table:e.name,isIdentity:n,name:t.name.trim(),comment:t.comment?.trim(),type:t.isArray?`${t.format}[]`:t.format,check:t.check?.trim()||void 0,isUnique:t.isUnique,isPrimaryKey:t.isPrimaryKey,...!t.isPrimaryKey&&!n&&{isNullable:t.isNullable},...!n&&{defaultValue:t.isArray&&i?(r=i)?r.replaceAll("[","{").replaceAll("]","}"):null:i},...!n&&i&&{defaultValueFormat:(0,a.default)(i)||s(i)?"expression":"literal"}}},"generateUpdateColumnPayload",0,(e,t,r)=>{let n=t.primary_keys.map(e=>e.name).includes(e.name),i=r.name.trim(),l=r.isArray?`${r.format}[]`:r.format,o=r.comment?.trim(),c=r.check?.trim(),d={};if(e.name.trim()!==i&&(d.name=i),e.comment?.trim()!==o&&(d.comment=o),e.check?.trim()!==c&&(d.check=c),("ARRAY"===e.data_type?`${e.format.replace(/^_/,"")}[]`:e.format)!==l&&(d.type=l),e.default_value!==r.defaultValue){let e=r.defaultValue;d.defaultValue=e,d.defaultValueFormat=(0,a.default)(e)||s(e)?"expression":"literal"}return e.is_identity!==r.isIdentity&&(d.isIdentity=r.isIdentity),e.is_nullable!==r.isNullable&&(d.isNullable=r.isNullable),e.is_unique!==r.isUnique&&(d.isUnique=r.isUnique),n!==r.isPrimaryKey&&(d.isPrimaryKey=r.isPrimaryKey),d},"getForeignKeyCascadeAction",0,e=>{switch(e){case r.CASCADE:return"Cascade";case r.RESTRICT:return"Restrict";case r.SET_DEFAULT:return"Set default";case r.SET_NULL:return"Set NULL";default:return}},"getPlaceholderText",0,(e,t)=>{let a=t||"column_name";switch(e){case"int2":case"int4":case"int8":case"numeric":return`"${a}" > 0`;case"float4":case"float8":return`"${a}" > 0.0`;case"text":case"varchar":return`length("${a}") <= 50`;case"json":case"jsonb":return`jsonb_typeof("${a}"->'active') = 'boolean'`;case"bool":return`"${a}" in (true, false)`;case"date":return`"${a}" > '2024-01-01'`;case"time":return`"${a}" between '09:00:00' and '12:00:00'`;case"timetz":return`"${a}" at time zone 'UTC' between '09:00:00+00' and '17:00:00+00'`;case"uuid":return`"${a}" '00000000-0000-0000-0000-000000000000'`;case"timestamp":return`"${a}" > '2023-01-01 00:00' and "${a}" < '2025-01-01 00:00'`;case"timestamptz":return`"${a}" > '2023-01-01 00:00:00+00' and "${a}" < '2025-01-01 00:00:00+00'`;default:return`length("${a}") < 500`}},"validateFields",0,e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your column",i.toast.error(t.name)),0===e.format.length&&(t.format="Please select a type for your column",i.toast.error(t.format)),t}],390974)},687256,e=>{"use strict";var t=e.i(478902),a=e.i(947300),r=e.i(382490),n=e.i(613580),i=e.i(390974);e.s(["formatForeignKeys",0,e=>e.map(e=>({id:e.id,name:e.constraint_name,tableId:e.target_id,schema:e.target_schema,table:e.target_table,columns:e.source_columns.map((t,a)=>({source:t,target:e.target_columns[a]})),deletionAction:e.deletion_action,updateAction:e.update_action})),"generateCascadeActionDescription",0,(e,s,l)=>{let o="update"===e?"Updating":"Deleting",c=(0,i.getForeignKeyCascadeAction)(s)??"No action";switch(s){case a.FOREIGN_KEY_CASCADE_ACTION.NO_ACTION:return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-foreground-light",children:c}),": ",o," a record from"," ",(0,t.jsx)("code",{className:"text-code-inline",children:l})," will"," ",(0,t.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case a.FOREIGN_KEY_CASCADE_ACTION.CASCADE:return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-foreground-light",children:c}),": ",o," a record from"," ",(0,t.jsx)("code",{className:"text-code-inline",children:l})," will"," ",(0,t.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case a.FOREIGN_KEY_CASCADE_ACTION.RESTRICT:return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-foreground-light",children:c}),(0,t.jsxs)(n.Tooltip,{children:[(0,t.jsx)(n.TooltipTrigger,{className:"translate-y-[3px] mx-1",children:(0,t.jsx)(r.HelpCircle,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,t.jsx)(n.TooltipContent,{side:"bottom",className:"w-80",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})]}),": ",o," a record from ",(0,t.jsx)("code",{className:"text-code-inline",children:l})," will"," ",(0,t.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",o.toLowerCase()]})," ","existing referencing rows from this table."]});case a.FOREIGN_KEY_CASCADE_ACTION.SET_DEFAULT:return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-foreground-light",children:c}),": ",o," a record from"," ",(0,t.jsx)("code",{className:"text-code-inline",children:l})," will set the value of any existing records in this table referencing it to their"," ",(0,t.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case a.FOREIGN_KEY_CASCADE_ACTION.SET_NULL:return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-foreground-light",children:c}),": ",o," a record from"," ",(0,t.jsx)("code",{className:"text-code-inline",children:l})," will set the value of any existing records in this table referencing it"," ",(0,t.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}}])},565074,36380,231766,e=>{"use strict";var t=e.i(478902),a=e.i(964727),r=e.i(384429),n=e.i(707409);let i=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],s=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],l={uuid:[{name:"auth.uid()",value:"auth.uid()",description:"Returns the user's ID when rows are added or updated through the API"},{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[...i],timetz:[...i],timestamp:[...i],timestamptz:[...i],text:[...s],varchar:[...s]};e.s(["typeExpressionSuggestions",0,l],36380);var o=a,c=e.i(738225),d=e.i(389959),u=e.i(215312),m=e.i(874311),h=e.i(171997);let p=({label:e,description:a,placeholder:r,size:n,layout:i,disabled:s=!1,className:l="",value:p="",suggestions:g=[],suggestionsTooltip:f,suggestionsHeader:x,onChange:y=o.default,onSelectSuggestion:b=o.default,"data-testid":v})=>{let j=(0,d.useRef)(null),[S,N]=(0,d.useState)(g),C=S.length>0;return(0,d.useEffect)(()=>{N(g.slice(0,3))},[g]),(0,t.jsx)("div",{ref:j,className:"relative",children:(0,t.jsx)(h.Input,{label:e,descriptionText:a,placeholder:r,size:n,layout:i,disabled:s,className:l,inputClassName:"pr-10",type:"text",value:p,onChange:e=>{y(e);let t=e.target.value;g.length>3&&N((t?g.filter(e=>-1!==e.name.indexOf(t)):g).slice(0,3))},"data-testid":v,actions:C&&(0,t.jsxs)(m.DropdownMenu,{children:[(0,t.jsx)(m.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(u.ButtonTooltip,{type:"default",className:"!px-1 mr-0.5",tooltip:{content:{text:f||"Suggestions",side:"bottom"}},children:(0,t.jsx)(c.List,{strokeWidth:1.5,size:14})})}),(0,t.jsxs)(m.DropdownMenuContent,{align:"end",side:"bottom",children:[(0,t.jsx)(m.DropdownMenuLabel,{children:x||"Suggestions"}),(0,t.jsx)(m.DropdownMenuSeparator,{}),S.map(e=>(0,t.jsxs)(m.DropdownMenuItem,{className:"space-x-2",onClick:()=>b(e),children:[(0,t.jsx)("div",{children:e.name}),(0,t.jsx)("div",{className:"text-foreground-lighter",children:e.description})]},e.name))]})]})})})};e.s(["default",0,p],231766),e.s(["default",0,({columnFields:e,enumTypes:i=[],onUpdateField:s=a.default})=>{let o=l?.[e.format]??[];if(!n.POSTGRES_DATA_TYPES.includes(e.format)&&i.some(t=>t.name===e.format)){let a=i.find(t=>t.name===e.format),n=a?.enums??[],l=e?.defaultValue??"",o=l.includes("::")?l.split("::")[0].slice(1,-1):l;if(void 0!==a)return(0,t.jsxs)(r.Select,{label:"Default Value",layout:"vertical",value:o,onChange:e=>s({defaultValue:e.target.value}),children:[(0,t.jsx)(r.Select.Option,{value:"",children:"NULL"},"empty-enum"),n.map(e=>(0,t.jsx)(r.Select.Option,{value:e,children:e},e))]})}return(0,t.jsx)(p,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"==typeof e.defaultValue&&0===e.defaultValue.length?"EMPTY":"NULL",value:e?.defaultValue??"",suggestions:o,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>s({defaultValue:e.target.value}),onSelectSuggestion:e=>s({defaultValue:e.value})})}],565074)},159876,e=>{"use strict";var t=e.i(755216),a=e.i(242882),r=e.i(741391),n=e.i(714403),i=e.i(138658);async function s({projectRef:e,connectionString:a,name:r,schema:s},l){let{sql:o,zod:c}=t.default.tables.retrieve({name:r,schema:s}),{result:d}=await (0,n.executeSql)({projectRef:e,connectionString:a,sql:o,queryKey:i.tableKeys.retrieve(e,r,s)},l);return c.parse(d[0])}let l=async({projectRef:e,name:t,schema:a,connectionString:n})=>{let l=(0,r.getQueryClient)();return await l.fetchQuery({queryKey:i.tableKeys.retrieve(e,t,a),queryFn:({signal:r})=>s({projectRef:e,connectionString:n,name:t,schema:a},r)})};e.s(["getTable",()=>s,"getTableQuery",0,l,"useTableQuery",0,({projectRef:e,connectionString:t,name:r,schema:n},{enabled:l=!0,...o}={})=>(0,a.useQuery)({queryKey:i.tableKeys.retrieve(e,r,n),queryFn:({signal:a})=>s({projectRef:e,connectionString:t,name:r,schema:n},a),enabled:l&&void 0!==e,...o})])},274418,502653,72313,956592,e=>{"use strict";var t=e.i(478902);e.i(128328);var a=e.i(158639),r=e.i(64102),n=e.i(78071),i=e.i(471994),s=e.i(155482),l=e.i(635494),o=e.i(392491),c=e.i(10429),d=e.i(666050),u=e.i(964727),m=e.i(17203),h=e.i(479232),p=e.i(210419),g=e.i(389959),f=e.i(837710),x=e.i(815545),y=e.i(171997),b=e.i(539013),v=e.i(905596),j=e.i(973512),S=e.i(687256),N=e.i(707409),C=e.i(565074),w=e.i(390974),T=e.i(415190),E=e.i(339098),_=e.i(710377),D=e.i(667042),P=e.i(382490),I=e.i(774803),O=e.i(495486),R=e.i(975924),A=e.i(206413),k=e.i(592360),L=e.i(178527),F=e.i(331077),M=e.i(513826),$=e.i(102703),K=e.i(947300),U=e.i(801834),q=e.i(159876),z=e.i(738196),Y=e.i(983783),H=e.i(48189);let B=[{key:"no-action",label:"No action",value:K.FOREIGN_KEY_CASCADE_ACTION.NO_ACTION},{key:"cascade",label:"Cascade",value:K.FOREIGN_KEY_CASCADE_ACTION.CASCADE},{key:"restrict",label:"Restrict",value:K.FOREIGN_KEY_CASCADE_ACTION.RESTRICT},{key:"set-default",label:"Set default",value:K.FOREIGN_KEY_CASCADE_ACTION.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:K.FOREIGN_KEY_CASCADE_ACTION.SET_NULL}],Q={id:void 0,schema:"public",table:"",columns:[],deletionAction:K.FOREIGN_KEY_CASCADE_ACTION.NO_ACTION,updateAction:K.FOREIGN_KEY_CASCADE_ACTION.NO_ACTION},V=({visible:e,table:a,column:r,foreignKey:n,onClose:i,onSaveRelation:s})=>{let{data:o}=(0,l.useSelectedProjectQuery)(),{selectedSchema:d}=(0,Y.useQuerySchemaState)(),[u,m]=(0,g.useState)(Q),[h,p]=(0,g.useState)({}),x=(h.types??[]).length>0,y=(h.typeNotice??[]).length>0,{data:v=[]}=(0,U.useSchemasQuery)({projectRef:o?.ref,connectionString:o?.connectionString}),C=[...v].sort((e,t)=>e.name.localeCompare(t.name)),{data:w}=(0,z.useTablesQuery)({projectRef:o?.ref,connectionString:o?.connectionString,schema:u.schema,includeColumns:!1}),{data:T,isLoading:K}=(0,q.useTableQuery)({projectRef:o?.ref,connectionString:o?.connectionString,schema:u.schema,name:u.table},{enabled:!!o?.ref&&!!u.schema&&!!u.table}),V=K||void 0===T||x,W=(e,t,r)=>{let n=u.columns.map((n,i)=>{if(i!==e)return n;if("target"===t){let e=T?.columns?.find(e=>e.name===r)?.format;return{...n,[t]:r,targetType:e}}{let e=a.columns.find(e=>e.name===r)?.format;return{...n,[t]:r,sourceType:e}}});m({...u,columns:n})},G=(e,t)=>{p({}),m({...u,[e]:t})};return(0,g.useEffect)(()=>{e&&(void 0!==n?m(n):m({...Q,id:(0,H.uuidv4)()}))},[e]),(0,g.useEffect)(()=>{let t,r;e&&(t=[],r=[],u.columns.forEach(e=>{let{source:n,target:i,sourceType:s,targetType:l}=e,o=a.columns.find(e=>e.name===n),c=s??o?.format??"",d=l??T?.columns?.find(e=>e.name===i)?.format??"";if(!(""===n||""===i||N.NUMERICAL_TYPES.includes(c)&&N.NUMERICAL_TYPES.includes(d)||N.TEXT_TYPES.includes(c)&&N.TEXT_TYPES.includes(d)||"uuid"===c&&"uuid"===d)&&c!==d){if(o?.isNewColumn&&""!==d)return t.push({source:n,sourceType:c,target:i,targetType:d});r.push({source:n,sourceType:c,target:i,targetType:d})}}),p({types:r,typeNotice:t}))},[u,e]),(0,t.jsx)(b.SidePanel,{visible:e,onCancel:i,className:"max-w-[480px]",header:`${void 0===n?"Add":"Manage"} foreign key relationship${void 0===n?" to":"s for"} ${a.name.length>0?a.name:"new table"}`,customFooter:(0,t.jsx)(j.ActionBar,{backButtonLabel:"Cancel",disableApply:V,applyButtonLabel:"Save",closePanel:i,applyFunction:e=>(e=>{let t={};if(u.columns.filter(e=>""===e.source||""===e.target).length>0&&(t.columns="Please ensure that columns are selected"),Object.keys(t).length>0){p(t),e();return}""!==u.table&&s(u),i(),e()})(e)}),children:(0,t.jsx)(b.SidePanel.Content,{children:(0,t.jsxs)("div",{className:"py-6 space-y-6",children:[(0,t.jsx)($.default,{icon:(0,t.jsx)(P.HelpCircle,{size:20,strokeWidth:1.5}),title:"What are foreign keys?",description:`Foreign keys help maintain referential integrity of your data by ensuring that no
                one can insert rows into the table that do not have a matching entry to another
                table.`,url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation"}),(0,t.jsx)(F.Listbox,{id:"schema",label:"Select a schema",value:u.schema,onChange:e=>{m({...Q,id:u.id,schema:e})},children:C.map(e=>(0,t.jsx)(F.Listbox.Option,{value:e.name,label:e.name,className:"min-w-96",addOnBefore:()=>(0,t.jsx)(D.Database,{size:16,strokeWidth:1.5}),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"hidden",children:e.name}),(0,t.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))}),(0,t.jsxs)(F.Listbox,{id:"table",label:"Select a table to reference to",value:T?.id??1,onChange:e=>{var t;let a;return t=Number(e),p({}),void((a=(w??[]).find(e=>e.id===t))&&m({...Q,id:u.id,name:u.name,tableId:a.id,schema:a.schema,table:a.name,columns:void 0!==r?[{source:r.name,target:""}]:[{source:"",target:""}]}))},disabled:K,children:[(0,t.jsx)(F.Listbox.Option,{className:"min-w-96",value:1,label:"---",children:"---"},"empty"),(0,E.default)(w,["schema"]).map(e=>(0,t.jsx)(F.Listbox.Option,{value:e.id,label:e.name,className:"min-w-96",addOnBefore:()=>(0,t.jsx)(O.Table,{size:16,strokeWidth:1.5}),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"hidden",children:e.name}),(0,t.jsx)("span",{className:"text-foreground-lighter",children:e.schema}),(0,t.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))]}),u.schema&&u.table&&(0,t.jsxs)(t.Fragment,{children:[K?(0,t.jsxs)("div",{className:"flex py-6 flex-col items-center justify-center space-y-2",children:[(0,t.jsx)(I.Loader2,{size:14,className:"animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading table columns"})]}):(0,t.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,t.jsxs)("label",{className:"text-foreground-light text-sm",children:["Select columns from"," ",(0,t.jsxs)("code",{className:"text-code-inline",children:[u.schema,".",u.table]})," ","to reference to"]}),(0,t.jsxs)("div",{className:"grid grid-cols-10 gap-y-2",children:[(0,t.jsxs)("div",{className:"col-span-5 text-xs text-foreground-lighter",children:[d,".",a.name.length>0?a.name:"[unnamed table]"]}),(0,t.jsxs)("div",{className:"col-span-4 text-xs text-foreground-lighter text-right",children:[u.schema,".",u.table]}),0===u.columns.length&&(0,t.jsx)(L.Alert_Shadcn_,{className:"col-span-10 py-2 px-3",children:(0,t.jsx)(A.AlertDescription_Shadcn_,{children:"There are no foreign key relations between the tables"})}),u.columns.map((e,r)=>(0,t.jsxs)(g.Fragment,{children:[(0,t.jsx)("div",{className:"col-span-4",children:(0,t.jsxs)(F.Listbox,{id:"column",value:u.columns[r].source,onChange:e=>W(r,"source",e),children:[(0,t.jsx)(F.Listbox.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(a?.columns??[]).filter(e=>0!==e.name.length).map(e=>(0,t.jsx)(F.Listbox.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-foreground",children:e.name}),(0,t.jsx)("span",{className:"text-foreground-lighter",children:""===e.format?"-":e.format})]})},e.id))]})}),(0,t.jsx)("div",{className:"col-span-1 flex justify-center items-center",children:(0,t.jsx)(_.ArrowRight,{})}),(0,t.jsx)("div",{className:"col-span-4",children:(0,t.jsxs)(F.Listbox,{id:"column",value:u.columns[r].target,onChange:e=>W(r,"target",e),children:[(0,t.jsx)(F.Listbox.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(T?.columns??[]).map(e=>(0,t.jsx)(F.Listbox.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-foreground",children:e.name}),(0,t.jsx)("span",{className:"text-foreground-lighter",children:e.format})]})},e.id))]})}),(0,t.jsx)("div",{className:"col-span-1 flex justify-end items-center",children:(0,t.jsx)(f.Button,{type:"default",className:"px-1",icon:(0,t.jsx)(R.X,{}),disabled:1===u.columns.length,onClick:()=>{m({...u,columns:u.columns.filter((e,t)=>t!==r)})}})})]},`${u.schema}-${u.table}-${r}`))]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(f.Button,{type:"default",onClick:()=>{m({...u,columns:u.columns.concat([{source:"",target:""}])})},children:"Add another column"}),h.columns&&(0,t.jsx)("p",{className:"text-red-900 text-sm",children:h.columns}),x&&(0,t.jsxs)(L.Alert_Shadcn_,{variant:"warning",children:[(0,t.jsx)(k.AlertTitle_Shadcn_,{children:"Column types do not match"}),(0,t.jsx)(A.AlertDescription_Shadcn_,{children:"The following columns cannot be referenced as they are not of the same type:"}),(0,t.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(h?.types??[]).map((e,a)=>void 0===e?null:(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"text-code-inline",children:e.source})," (",e.sourceType,") and ",(0,t.jsx)("code",{className:"text-code-inline",children:e.target}),"(",e.targetType,")"]},`type-error-${a}`))})]}),y&&(0,t.jsxs)(L.Alert_Shadcn_,{children:[(0,t.jsx)(k.AlertTitle_Shadcn_,{children:"Column types will be updated"}),(0,t.jsx)(A.AlertDescription_Shadcn_,{children:"The following columns will have their types updated to match their referenced column"}),(0,t.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(h?.typeNotice??[]).map((e,a)=>void 0===e?null:(0,t.jsx)("li",{children:(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("code",{className:"text-code-inline",children:e.source})," ",(0,t.jsx)(_.ArrowRight,{size:14})," ",e.targetType]})},`type-error-${a}`))})]})]})]}),!K&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.SidePanel.Separator,{}),(0,t.jsx)($.default,{icon:(0,t.jsx)(P.HelpCircle,{size:"20",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,t.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"text-code-inline",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"text-code-inline",children:"Restrict"})," or"," ",(0,t.jsx)("code",{className:"text-code-inline",children:"No action"}),": if the two tables represent independent objects"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"text-code-inline",children:"Set NULL"})," or"," ",(0,t.jsx)("code",{className:"text-code-inline",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,t.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,t.jsx)(F.Listbox,{id:"updateAction",value:u.updateAction,label:"Action if referenced row is updated",descriptionText:(0,t.jsx)("p",{children:(0,S.generateCascadeActionDescription)("update",u.updateAction,`${u.schema}.${u.table}`)}),onChange:e=>G("updateAction",e),children:B.filter(e=>["no-action","cascade","restrict"].includes(e.key)).map(e=>(0,t.jsx)(F.Listbox.Option,{value:e.value,label:e.label,children:(0,t.jsx)("p",{className:"text-foreground",children:e.label})},e.key))}),(0,t.jsx)(F.Listbox,{id:"deletionAction",value:u.deletionAction,className:"[&>div>label]:flex [&>div>label]:items-center",label:"Action if referenced row is removed",labelOptional:(0,t.jsx)(M.DocsButton,{href:`${c.DOCS_URL}/guides/database/postgres/cascade-deletes`}),descriptionText:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("p",{children:(0,S.generateCascadeActionDescription)("delete",u.deletionAction,`${u.schema}.${u.table}`)})}),onChange:e=>G("deletionAction",e),children:B.map(e=>(0,t.jsx)(F.Listbox.Option,{value:e.value,label:e.label,children:(0,t.jsx)("p",{className:"text-foreground",children:e.label})},e.key))})]})]})]})})})};e.s(["ForeignKeySelector",0,V],502653);var W=e.i(310474),G=e.i(587433),J=e.i(843778);let X=({foreignKey:e,disabled:r=!1,status:n,layout:i="horizontal",closePanel:s,onSelectEdit:l,onSelectRemove:o,onSelectUndoRemove:d})=>{let{ref:u}=(0,a.useParams)();return(0,t.jsxs)("div",{className:(0,J.cn)("horizontal"===i?"items-center justify-between gap-x-2":"flex-col gap-y-3","flex border border-strong px-4 py-4","border-b-0 last:border-b first:rounded-t-md last:rounded-b-md"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.name&&(0,t.jsx)("p",{title:e.name,className:"text-xs text-foreground font-mono",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==n&&(0,t.jsx)(G.Badge,{variant:"ADD"===n?"success":"UPDATE"===n?"warning":"destructive",children:n}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:[e.columns.length>1?"Composite foreign":"Foreign"," key relation to:"]}),(0,t.jsx)(f.Button,{asChild:!0,type:"default",title:`${e.schema}.${e.table}`,className:"py-0.5 px-1.5 font-mono",icon:(0,t.jsx)(W.default,{className:"table-icon",src:`${c.BASE_PATH}/img/icons/table-icon.svg`,style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"'),loader:(0,t.jsx)("span",{className:"block w-4 h-4 bg-[#133929] rounded-sm"}),cacheRequests:!0}),children:(0,t.jsxs)(p.default,{target:"_blank",rel:"norefererer",href:`/project/${u}/editor/${e.tableId}`,children:[e.schema,".",e.table]})})]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-y-1",children:e.columns.map((a,r)=>(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)("code",{className:(0,J.cn)("text-xs",0===(a?.source??"").length&&"text-foreground-light"),children:a.source||"[column_name]"}),(0,t.jsx)(_.ArrowRight,{size:16}),(0,t.jsxs)("code",{className:"text-code-inline",children:[e.schema,".",e.table,".",a.target]})]},`relation-${r}}`))})]}),!r&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(f.Button,{type:"default",onClick:l,children:"Edit"}),e.toRemove?(0,t.jsx)(f.Button,{type:"default",onClick:d,children:"Cancel remove"}):(0,t.jsx)(f.Button,{type:"default",onClick:o,children:"Remove"})]})]})};e.s(["ForeignKeyRow",0,X],72313);var Z=e.i(822574);let ee=(e,t)=>{let a=t.columns.map(e=>e.source),r=t.columns.map(e=>e.target);return e.deletion_action!==t.deletionAction||e.update_action!==t.updateAction||e.target_schema!==t.schema||e.target_table!==t.table||!(0,Z.default)(e.source_columns,a)||!(0,Z.default)(e.target_columns,r)};e.s(["checkIfRelationChanged",0,ee],956592);let et=({column:e,relations:r,closePanel:n,onUpdateColumnType:s,onUpdateFkRelations:o})=>{let{id:c}=(0,a.useParams)(),[d,u]=(0,g.useState)(!1),[m,h]=(0,g.useState)(),{data:p}=(0,l.useSelectedProjectQuery)(),{data:x}=(0,i.useForeignKeyConstraintsQuery)({projectRef:p?.ref,connectionString:p?.connectionString,schema:e.schema}),y=c?Number(c):void 0,{data:b}=(0,T.useTableEditorQuery)({projectRef:p?.ref,connectionString:p?.connectionString,id:y}),v=(b?.columns??[]).map(t=>({id:t.id,name:t.name,format:t.format||e.format,isNewColumn:!1}));return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[r.length>0&&(0,t.jsx)("div",{children:r.map(e=>{var a;let i,s,l=(a=e,i=(x??[]).find(e=>e.id===a.id),s=r.find(e=>e.id===a.id),s?.toRemove?"REMOVE":void 0===i&&void 0!==s?"ADD":void 0!==i&&void 0!==s?ee(i,s)?"UPDATE":void 0:void 0);return(0,t.jsx)(X,{layout:"vertical",status:l,foreignKey:e,closePanel:n,onSelectEdit:()=>{u(!0),h(e)},onSelectRemove:()=>{"ADD"===l?o(r.filter(t=>t.id!==e.id)):o(r.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{o(r.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,t.jsx)(f.Button,{type:"default",className:"w-min",onClick:()=>u(!0),children:"Add foreign key"})]}),void 0!=b&&(0,t.jsx)(V,{visible:d,column:e,table:{id:b.id,name:b.name,columns:e.isNewColumn&&e.name?v.concat(e):v.map(t=>t.id===e.id?{...t,name:e.name}:t)},foreignKey:m,onClose:()=>{u(!1),h(void 0)},onSaveRelation:t=>{let a=r.map(e=>e.id);void 0!==t.id&&a.includes(t.id)?o(r.map(e=>e.id===t.id?t:e)):o(r.concat([t]));let n=t.columns.find(t=>t.source===e.name)?.targetType;n&&s(n)}})]})};var ea=e.i(832237);let er=({table:e,column:a})=>a?(0,t.jsxs)(t.Fragment,{children:["Update column ",(0,t.jsx)("code",{children:a.name})," from ",(0,t.jsx)("code",{children:a.table})]}):(0,t.jsxs)(t.Fragment,{children:["Add new column to ",(0,t.jsx)("code",{children:e.name})]});e.s(["ColumnEditor",0,({column:e,selectedTable:T,visible:E=!1,closePanel:_=u.default,saveChanges:D=u.default,updateEditorDirty:P=u.default})=>{let{ref:I}=(0,a.useParams)(),{data:O}=(0,l.useSelectedProjectQuery)(),[R,A]=(0,g.useState)({}),[k,L]=(0,g.useState)(),[F,M]=(0,g.useState)([]),[$,K]=(0,g.useState)((0,w.getPlaceholderText)(k?.format,k?.name)),{data:U}=(0,s.useEnumeratedTypesQuery)({projectRef:O?.ref,connectionString:O?.connectionString}),{data:q}=(0,o.useProtectedSchemas)({excludeSchemas:["extensions"]}),z=(U??[]).filter(e=>!q.find(t=>t.name===e.schema)),{data:Y}=(0,n.useTableConstraintsQuery)({projectRef:O?.ref,connectionString:O?.connectionString,id:T?.id}),H=(Y??[]).find(e=>e.type===n.CONSTRAINT_TYPE.PRIMARY_KEY_CONSTRAINT),{data:B}=(0,i.useForeignKeyConstraintsQuery)({projectRef:O?.ref,connectionString:O?.connectionString,schema:T?.schema}),Q=void 0===e,V=B||[],W=V.filter(t=>t.source_id===e?.table_id&&t.source_columns.includes(e.name)),G=void 0!==F.find(e=>void 0!==e.columns.find(e=>e.source===k?.name)&&!e.toRemove);if((0,g.useEffect)(()=>{E&&(A({}),L(Q?(0,w.generateColumnField)({schema:T.schema,table:T.name}):(0,w.generateColumnFieldFromPostgresColumn)(e,T,V)),M((0,S.formatForeignKeys)(W)))},[E]),!k)return null;let J=e=>{N.TEXT_TYPES.includes(k.format)||""!==e.defaultValue||(e.defaultValue=null);let t="name"in e&&e.name!==k.name,a="format"in e&&e.format!==k.format;t&&F.find(e=>e.columns.find(({source:e})=>e===k?.name))&&M(F.map(t=>({...t,columns:t.columns.map(t=>t.source===k?.name?{...t,source:e.name}:t)}))),(t||a)&&K((0,w.getPlaceholderText)(e.format||k.format,e.name||k.name)),L({...k,...e}),P();let r={...R};for(let t of Object.keys(e))delete r[t];A(r)},X=t=>{if(k){let a=(0,w.validateFields)(k);(A(a),(0,d.default)(a))?D(Q?(0,w.generateCreateColumnPayload)(T,k):(0,w.generateUpdateColumnPayload)(e,T,k),Q,{columnId:e?.id,primaryKey:H,foreignKeyRelations:F,existingForeignKeyRelations:W},t):t()}};return(0,t.jsxs)(b.SidePanel,{size:"xlarge",visible:E,onConfirm:e=>X(e),header:(0,t.jsx)(er,{table:T,column:e}),onCancel:_,customFooter:(0,t.jsx)(j.ActionBar,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:_,applyFunction:e=>X(e),visible:E}),children:[(0,t.jsx)(r.FormSection,{header:(0,t.jsx)(r.FormSectionLabel,{className:"lg:!col-span-4",children:"General"}),children:(0,t.jsxs)(r.FormSectionContent,{loading:!1,className:"lg:!col-span-8",children:[(0,t.jsx)(y.Input,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:R.name,value:k?.name??"",onChange:e=>J({name:e.target.value})}),(0,t.jsx)(y.Input,{label:"Description",labelOptional:"Optional",type:"text",value:k?.comment??"",onChange:e=>J({comment:e.target.value})})]})}),(0,t.jsx)(b.SidePanel.Separator,{}),(0,t.jsx)(r.FormSection,{header:(0,t.jsx)(r.FormSectionLabel,{className:"lg:!col-span-4",description:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(f.Button,{asChild:!0,type:"default",size:"tiny",icon:(0,t.jsx)(h.Plus,{strokeWidth:2}),children:(0,t.jsx)(p.default,{href:`/project/${I}/database/types`,target:"_blank",rel:"noreferrer",children:"Create enum types"})}),(0,t.jsx)(f.Button,{asChild:!0,type:"default",size:"tiny",icon:(0,t.jsx)(m.ExternalLink,{size:14,strokeWidth:2}),children:(0,t.jsx)(p.default,{href:`${c.DOCS_URL}/guides/database/tables#data-types`,target:"_blank",rel:"noreferrer",children:"About data types"})})]}),children:"Data Type"}),children:(0,t.jsxs)(r.FormSectionContent,{loading:!1,className:"lg:!col-span-8",children:[(0,t.jsx)(ea.default,{showRecommendation:!0,value:k?.format??"",layout:"vertical",enumTypes:z,error:R.format,description:G?"Column type cannot be changed as it has a foreign key relation":"",disabled:G,onOptionSelect:e=>J({format:e,defaultValue:null})}),void 0===k.foreignKey&&(0,t.jsxs)("div",{className:"space-y-4",children:[k.format.includes("int")&&(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(x.Checkbox,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:k.isIdentity,onChange:()=>{let e=!k.isIdentity,t=!e&&k.isArray;J({isIdentity:e,isArray:t})}})}),!k.isPrimaryKey&&(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(x.Checkbox,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:k.isArray,onChange:()=>{let e=!k.isArray,t=!e&&k.isIdentity;J({isArray:e,isIdentity:t})}})})]}),(0,t.jsx)(C.default,{columnFields:k,enumTypes:z,onUpdateField:J})]})}),(0,t.jsx)(b.SidePanel.Separator,{}),(0,t.jsx)(r.FormSection,{header:(0,t.jsx)(r.FormSectionLabel,{className:"lg:!col-span-4",children:"Foreign Keys"}),children:(0,t.jsx)(r.FormSectionContent,{loading:!1,className:"lg:!col-span-8",children:(0,t.jsx)(et,{column:k,relations:F,closePanel:_,onUpdateColumnType:e=>{"_"===e[0]?J({format:e.slice(1),isArray:!0,isIdentity:!1}):J({format:e})},onUpdateFkRelations:M})})}),(0,t.jsx)(b.SidePanel.Separator,{}),(0,t.jsx)(r.FormSection,{header:(0,t.jsx)(r.FormSectionLabel,{className:"lg:!col-span-4",children:"Constraints"}),children:(0,t.jsxs)(r.FormSectionContent,{loading:!1,className:"lg:!col-span-8",children:[(0,t.jsx)(v.Toggle,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:k?.isPrimaryKey??!1,onChange:()=>J({isPrimaryKey:!k?.isPrimaryKey})}),(0,t.jsx)(v.Toggle,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:k.isNullable,onChange:()=>J({isNullable:!k.isNullable})}),(0,t.jsx)(v.Toggle,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:k.isUnique,onChange:()=>J({isUnique:!k.isUnique})}),(0,t.jsx)(y.Input,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:$,type:"text",value:k?.check??"",onChange:e=>J({check:e.target.value}),className:"[&_input]:font-mono"})]})})]},"ColumnEditor")}],274418)},595519,346423,32027,276423,e=>{"use strict";var t,a,r=e.i(478902),n=e.i(759813),i=e.i(869176);function s(e,t,...a){if(void 0!==i.default&&void 0===t)throw Error("invariant requires an error message argument");if(!e){let e;if(void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let r=0;(e=Error(t.replace(/%s/g,function(){return a[r++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}function l(e){return"object"==typeof e}e.s(["invariant",()=>s],346423);let o="dnd-core/INIT_COORDS",c="dnd-core/BEGIN_DRAG",d="dnd-core/PUBLISH_DRAG_SOURCE",u="dnd-core/HOVER",m="dnd-core/DROP",h="dnd-core/END_DRAG";function p(e,t){return{type:o,payload:{sourceClientOffset:t||null,clientOffset:e||null}}}let g={type:o,payload:{clientOffset:null,sourceClientOffset:null}};function f(e,t){return null===t?null===e:Array.isArray(e)?e.some(e=>e===t):e===t}class x{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){var e,t,a,r,n;let i=this,{dispatch:o}=this.store,x={beginDrag:(e=this,function(t=[],a={publishSource:!0}){var r,n,i;let{publishSource:o=!0,clientOffset:d,getSourceClientOffset:u}=a,m=e.getMonitor(),h=e.getRegistry();e.dispatch(p(d)),r=t,n=m,i=h,s(!n.isDragging(),"Cannot call beginDrag while dragging."),r.forEach(function(e){s(i.getSource(e),"Expected sourceIds to be registered.")});let f=function(e,t){let a=null;for(let r=e.length-1;r>=0;r--)if(t.canDragSource(e[r])){a=e[r];break}return a}(t,m);if(null==f)return void e.dispatch(g);let x=null;if(d){if(!u)throw Error("getSourceClientOffset must be defined");s("function"==typeof u,"When clientOffset is provided, getSourceClientOffset must be a function."),x=u(f)}e.dispatch(p(d,x));let y=h.getSource(f).beginDrag(m,f);if(null!=y)return s(l(y),"Item must be an object."),h.pinSource(f),{type:c,payload:{itemType:h.getSourceType(f),item:y,sourceId:f,clientOffset:d||null,sourceClientOffset:x||null,isSourcePublic:!!o}}}),publishDragSource:(t=this,function(){if(t.getMonitor().isDragging())return{type:d}}),hover:(a=this,function(e,{clientOffset:t}={}){var r,n,i;s(Array.isArray(e),"Expected targetIds to be an array.");let l=e.slice(0),o=a.getMonitor(),c=a.getRegistry();return function(e,t,a){for(let r=e.length-1;r>=0;r--){let n=e[r];f(t.getTargetType(n),a)||e.splice(r,1)}}(l,c,o.getItemType()),function(e,t,a){s(t.isDragging(),"Cannot call hover while not dragging."),s(!t.didDrop(),"Cannot call hover after drop.");for(let t=0;t<e.length;t++){let r=e[t];s(e.lastIndexOf(r)===t,"Expected targetIds to be unique in the passed array."),s(a.getTarget(r),"Expected targetIds to be registered.")}}(l,o,c),r=l,n=o,i=c,r.forEach(function(e){i.getTarget(e).hover(n,e)}),{type:u,payload:{targetIds:l,clientOffset:t||null}}}),drop:(r=this,function(e={}){var t,a;let n,i=r.getMonitor(),o=r.getRegistry();s((t=i).isDragging(),"Cannot call drop while not dragging."),s(!t.didDrop(),"Cannot call drop twice during one drag operation."),((n=(a=i).getTargetIds().filter(a.canDropOnTarget,a)).reverse(),n).forEach((t,a)=>{var n,c,d,u,h;let p,g,f={type:m,payload:{dropResult:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){var r;r=a[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},e,(n=t,c=a,d=o,u=i,s(void 0===(h=g=(p=d.getTarget(n))?p.drop(u,n):void 0)||l(h),"Drop result must either be an object or undefined."),void 0===g&&(g=0===c?{}:u.getDropResult()),g))}};r.dispatch(f)})}),endDrag:(n=this,function(){let e=n.getMonitor(),t=n.getRegistry();s(e.isDragging(),"Cannot call endDrag while not dragging.");let a=e.getSourceId();return null!=a&&(t.getSource(a,!0).endDrag(e,a),t.unpinSource()),{type:h}})};return Object.keys(x).reduce((e,t)=>{let a=x[t];return e[t]=(...e)=>{let t=a.apply(i,e);void 0!==t&&o(t)},e},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{let e=this.store.getState().refCount>0;this.backend&&(e&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!e&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function y(e,t){return{x:e.x-t.x,y:e.y-t.y}}let b=[],v=[];b.__IS_NONE__=!0,v.__IS_ALL__=!0;class j{subscribeToStateChange(e,t={}){let{handlerIds:a}=t;s("function"==typeof e,"listener must be a function."),s(void 0===a||Array.isArray(a),"handlerIds, when specified, must be an array of strings.");let r=this.store.getState().stateId,n=()=>{let t=this.store.getState(),n=t.stateId;try{n===r||n===r+1&&!function(e,t){return e!==b&&(e===v||void 0===t||t.filter(t=>e.indexOf(t)>-1).length>0)}(t.dirtyHandlerIds,a)||e()}finally{r=n}};return this.store.subscribe(n)}subscribeToOffsetChange(e){s("function"==typeof e,"listener must be a function.");let t=this.store.getState().dragOffset,a=()=>{let a=this.store.getState().dragOffset;a!==t&&(t=a,e())};return this.store.subscribe(a)}canDragSource(e){if(!e)return!1;let t=this.registry.getSource(e);return s(t,`Expected to find a valid source. sourceId=${e}`),!this.isDragging()&&t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;let t=this.registry.getTarget(e);return s(t,`Expected to find a valid target. targetId=${e}`),!(!this.isDragging()||this.didDrop())&&f(this.registry.getTargetType(e),this.getItemType())&&t.canDrop(this,e)}isDragging(){return!!this.getItemType()}isDraggingSource(e){if(!e)return!1;let t=this.registry.getSource(e,!0);return s(t,`Expected to find a valid source. sourceId=${e}`),!!this.isDragging()&&!!this.isSourcePublic()&&this.registry.getSourceType(e)===this.getItemType()&&t.isDragging(this,e)}isOverTarget(e,t={shallow:!1}){if(!e)return!1;let{shallow:a}=t;if(!this.isDragging())return!1;let r=this.registry.getTargetType(e),n=this.getItemType();if(n&&!f(r,n))return!1;let i=this.getTargetIds();if(!i.length)return!1;let s=i.indexOf(e);return a?s===i.length-1:s>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return!!this.store.getState().dragOperation.isSourcePublic}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return function(e){let{clientOffset:t,initialClientOffset:a,initialSourceClientOffset:r}=e;return t&&a&&r?y({x:t.x+r.x,y:t.y+r.y},a):null}(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return function(e){let{clientOffset:t,initialClientOffset:a}=e;return t&&a?y(t,a):null}(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}let S=e.g,N=S.MutationObserver||S.WebKitMutationObserver;function C(e){return function(){let t=setTimeout(r,0),a=setInterval(r,50);function r(){clearTimeout(t),clearInterval(a),e()}}}let w="function"==typeof N?function(e){let t=1,a=new N(e),r=document.createTextNode("");return a.observe(r,{characterData:!0}),function(){r.data=t=-t}}:C;class T{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}let E=new class{enqueueTask(e){let{queue:t,requestFlush:a}=this;t.length||(a(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{let{queue:e}=this;for(;this.index<e.length;){let t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let t=0,a=e.length-this.index;t<a;t++)e[t]=e[t+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=w(this.flush),this.requestErrorThrow=C(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}},_=new class{create(e){let t=this.freeTasks,a=t.length?t.pop():new T(this.onError,e=>t[t.length]=e);return a.task=e,a}constructor(e){this.onError=e,this.freeTasks=[]}}(E.registerPendingError),D="dnd-core/ADD_SOURCE",P="dnd-core/ADD_TARGET",I="dnd-core/REMOVE_SOURCE",O="dnd-core/REMOVE_TARGET";function R(e,t){t&&Array.isArray(e)?e.forEach(e=>R(e,!1)):s("string"==typeof e||"symbol"==typeof e,t?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}(t=a||(a={})).SOURCE="SOURCE",t.TARGET="TARGET";let A=0;function k(e){switch(e[0]){case"S":return a.SOURCE;case"T":return a.TARGET;default:throw Error(`Cannot parse handler ID: ${e}`)}}function L(e,t){let a=e.entries(),r=!1;do{let{done:e,value:[,n]}=a.next();if(n===t)return!0;r=!!e}while(!r)return!1}class F{addSource(e,t){R(e),s("function"==typeof t.canDrag,"Expected canDrag to be a function."),s("function"==typeof t.beginDrag,"Expected beginDrag to be a function."),s("function"==typeof t.endDrag,"Expected endDrag to be a function.");let r=this.addHandler(a.SOURCE,e,t);return this.store.dispatch({type:D,payload:{sourceId:r}}),r}addTarget(e,t){R(e,!0),s("function"==typeof t.canDrop,"Expected canDrop to be a function."),s("function"==typeof t.hover,"Expected hover to be a function."),s("function"==typeof t.drop,"Expected beginDrag to be a function.");let r=this.addHandler(a.TARGET,e,t);return this.store.dispatch({type:P,payload:{targetId:r}}),r}containsHandler(e){return L(this.dragSources,e)||L(this.dropTargets,e)}getSource(e,t=!1){return s(this.isSourceId(e),"Expected a valid source ID."),t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return s(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return s(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return s(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return k(e)===a.SOURCE}isTargetId(e){return k(e)===a.TARGET}removeSource(e){var t;s(this.getSource(e),"Expected an existing source."),this.store.dispatch({type:I,payload:{sourceId:e}}),t=()=>{this.dragSources.delete(e),this.types.delete(e)},E.enqueueTask(_.create(t))}removeTarget(e){s(this.getTarget(e),"Expected an existing target."),this.store.dispatch({type:O,payload:{targetId:e}}),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){let t=this.getSource(e);s(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){s(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,r){let n=function(e){let t=(A++).toString();switch(e){case a.SOURCE:return`S${t}`;case a.TARGET:return`T${t}`;default:throw Error(`Unknown Handler Role: ${e}`)}}(e);return this.types.set(n,t),e===a.SOURCE?this.dragSources.set(n,r):e===a.TARGET&&this.dropTargets.set(n,r),n}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}let M={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function $(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){var r;r=a[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}let K={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function U(e={},t){var a;return{dirtyHandlerIds:function(e=b,t){let a,r,n;switch(t.type){case u:break;case D:case P:case O:case I:return b;default:return v}let{targetIds:i=[],prevTargetIds:s=[]}=t.payload,l=(a=new Map,r=e=>{a.set(e,a.has(e)?a.get(e)+1:1)},i.forEach(r),s.forEach(r),n=[],a.forEach((e,t)=>{1===e&&n.push(t)}),n);if(!(l.length>0||!function(e,t,a=(e,t)=>e===t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!a(e[r],t[r]))return!1;return!0}(i,s)))return b;let o=s[s.length-1],c=i[i.length-1];return o!==c&&(o&&l.push(o),c&&l.push(c)),l}(e.dirtyHandlerIds,{type:t.type,payload:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){var r;r=a[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},t.payload,{prevTargetIds:(a=[],"dragOperation.targetIds".split(".").reduce((e,t)=>e&&e[t]?e[t]:a||null,e))})}),dragOffset:function(e=M,t){let{payload:a}=t;switch(t.type){case o:case c:return{initialSourceClientOffset:a.sourceClientOffset,initialClientOffset:a.clientOffset,clientOffset:a.clientOffset};case u:var r,n;if(r=e.clientOffset,n=a.clientOffset,!r&&!n||r&&n&&r.x===n.x&&r.y===n.y)return e;return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){var r;r=a[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},e,{clientOffset:a.clientOffset});case h:case m:return M;default:return e}}(e.dragOffset,t),refCount:function(e=0,t){switch(t.type){case D:case P:return e+1;case I:case O:return e-1;default:return e}}(e.refCount,t),dragOperation:function(e=K,t){let{payload:a}=t;switch(t.type){case c:return $({},e,{itemType:a.itemType,item:a.item,sourceId:a.sourceId,isSourcePublic:a.isSourcePublic,dropResult:null,didDrop:!1});case d:return $({},e,{isSourcePublic:!0});case u:return $({},e,{targetIds:a.targetIds});case O:var r,n;if(-1===e.targetIds.indexOf(a.targetId))return e;return $({},e,{targetIds:(r=e.targetIds,n=a.targetId,r.filter(e=>e!==n))});case m:return $({},e,{dropResult:a.dropResult,didDrop:!0,targetIds:[]});case h:return $({},e,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return e}}(e.dragOperation,t),stateId:function(e=0){return e+1}(e.stateId)}}var q=e.i(389959);let z=(0,q.createContext)({dragDropManager:void 0});e.s(["DndContext",0,z],32027);let Y=0,H=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var B=(0,q.memo)(function(t){var a,{children:i}=t;let[s,l]="manager"in(a=function(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}(t,["children"]))?[{dragDropManager:a.manager},!1]:[function(t,a=function(){return e.g}(),r,i){return a[H]||(a[H]={dragDropManager:function(e,t,a={},r=!1){var i;let s,l=(i=r,s="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__,(0,n.createStore)(U,i&&s&&s({name:"dnd-core",instanceId:"dnd-core"}))),o=new j(l,new F(l)),c=new x(l,o),d=e(c,t,a);return c.receiveBackend(d),c}(t,a,r,i)}),a[H]}(a.backend,a.context,a.options,a.debugMode),!a.context];return(0,q.useEffect)(()=>{if(l){let t=e.g;return++Y,()=>{0==--Y&&(t[H]=null)}}},[]),(0,r.jsx)(z.Provider,{value:s,children:i})});function Q(e){let t=null;return()=>(null==t&&(t=e()),t)}e.s(["DndProvider",()=>B],595519);class V{enter(e){var t,a;let r,n,i,s=this.entered.length,l=t=>this.isNodeInDocument(t)&&(!t.contains||t.contains(e));return this.entered=(t=this.entered.filter(l),a=[e],r=new Set,n=e=>r.add(e),t.forEach(n),a.forEach(n),i=[],r.forEach(e=>i.push(e)),i),0===s&&this.entered.length>0}leave(e){var t;let a=this.entered.length;return this.entered=(t=this.entered.filter(this.isNodeInDocument),t.filter(t=>t!==e)),a>0&&0===this.entered.length}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class W{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get:()=>(console.warn(`Browser doesn't allow reading "${e}" until the drop event.`),null)})})}loadDataTransfer(e){if(e){let t={};Object.keys(this.config.exposeProperties).forEach(a=>{let r=this.config.exposeProperties[a];null!=r&&(t[a]={value:r(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}let G="__NATIVE_FILE__",J="__NATIVE_URL__",X="__NATIVE_TEXT__",Z="__NATIVE_HTML__";function ee(e,t,a){let r=t.reduce((t,a)=>t||e.getData(a),"");return null!=r?r:a}e.s(["FILE",0,G,"HTML",0,Z,"TEXT",0,X,"URL",0,J],712755);let et={[G]:{exposeProperties:{files:e=>Array.prototype.slice.call(e.files),items:e=>e.items,dataTransfer:e=>e},matchesTypes:["Files"]},[Z]:{exposeProperties:{html:(e,t)=>ee(e,t,""),dataTransfer:e=>e},matchesTypes:["Html","text/html"]},[J]:{exposeProperties:{urls:(e,t)=>ee(e,t,"").split("\n"),dataTransfer:e=>e},matchesTypes:["Url","text/uri-list"]},[X]:{exposeProperties:{text:(e,t)=>ee(e,t,""),dataTransfer:e=>e},matchesTypes:["Text","text/plain"]}};function ea(e){if(!e)return null;let t=Array.prototype.slice.call(e.types||[]);return Object.keys(et).filter(e=>{let a=et[e];return!!(null==a?void 0:a.matchesTypes)&&a.matchesTypes.some(e=>t.indexOf(e)>-1)})[0]||null}var er=e.i(712755);let en=Q(()=>/firefox/i.test(navigator.userAgent)),ei=Q(()=>!!window.safari);class es{interpolate(e){let t,{xs:a,ys:r,c1s:n,c2s:i,c3s:s}=this,l=a.length-1;if(e===a[l])return r[l];let o=0,c=s.length-1;for(;o<=c;){let n=a[t=Math.floor(.5*(o+c))];if(n<e)o=t+1;else{if(!(n>e))return r[t];c=t-1}}let d=e-a[l=Math.max(0,c)],u=d*d;return r[l]+n[l]*d+i[l]*u+s[l]*d*u}constructor(e,t){let a,r,n;const{length:i}=e,s=[];for(let e=0;e<i;e++)s.push(e);s.sort((t,a)=>e[t]<e[a]?-1:1);const l=[],o=[],c=[];for(let n=0;n<i-1;n++)a=e[n+1]-e[n],r=t[n+1]-t[n],o.push(a),l.push(r),c.push(r/a);const d=[c[0]];for(let e=0;e<o.length-1;e++){const t=c[e],r=c[e+1];if(t*r<=0)d.push(0);else{a=o[e];const n=o[e+1],i=a+n;d.push(3*i/((i+n)/t+(i+a)/r))}}d.push(c[c.length-1]);const u=[],m=[];for(let e=0;e<d.length-1;e++){n=c[e];const t=d[e],a=1/o[e],r=t+d[e+1]-n-n;u.push((n-t-r)*a),m.push(r*a*a)}this.xs=e,this.ys=t,this.c1s=d,this.c2s=u,this.c3s=m}}function el(e){let t=1===e.nodeType?e:e.parentElement;if(!t)return null;let{top:a,left:r}=t.getBoundingClientRect();return{x:r,y:a}}function eo(e){return{x:e.clientX,y:e.clientY}}class ec{get window(){return this.globalContext?this.globalContext:"undefined"!=typeof window?window:void 0}get document(){var e;return(null==(e=this.globalContext)?void 0:e.document)?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return(null==(e=this.optionsArgs)?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}}function ed(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){var r;r=a[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}class eu{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:(null==(e=this.dragStartSourceIds)?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:(null==(t=this.dragOverTargetIds)?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){let e=this.rootElement;if(void 0!==e){if(e.__isReactDndBackendSetUp)throw Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){let e=this.rootElement;if(void 0!==e&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var t;null==(t=this.window)||t.cancelAnimationFrame(this.asyncEndDragFrameId)}}connectDragPreview(e,t,a){return this.sourcePreviewNodeOptions.set(e,a),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,a){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,a);let r=t=>this.handleDragStart(t,e),n=e=>this.handleSelectStart(e);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",r),t.addEventListener("selectstart",n),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",r),t.removeEventListener("selectstart",n),t.setAttribute("draggable","false")}}connectDropTarget(e,t){let a=t=>this.handleDragEnter(t,e),r=t=>this.handleDragOver(t,e),n=t=>this.handleDrop(t,e);return t.addEventListener("dragenter",a),t.addEventListener("dragover",r),t.addEventListener("drop",n),()=>{t.removeEventListener("dragenter",a),t.removeEventListener("dragover",r),t.removeEventListener("drop",n)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){let e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return ed({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){let e=this.monitor.getSourceId();return ed({anchorX:.5,anchorY:.5,captureDraggingState:!1},this.sourcePreviewNodeOptions.get(e)||{})}isDraggingNativeItem(){let e=this.monitor.getItemType();return Object.keys(er).some(t=>er[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=function(e,t){let a=et[e];if(!a)throw Error(`native type ${e} has no configuration`);let r=new W(a);return r.loadDataTransfer(t),r}(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e,this.mouseMoveTimeoutTimer=setTimeout(()=>{var e;return null==(e=this.rootElement)?void 0:e.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},1e3)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var e;null==(e=this.window)||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){null===this.dragOverTargetIds&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,a){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=e=>{let t=this.sourceNodes.get(e);return t&&el(t)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=e=>!!(e&&this.document&&this.document.body&&this.document.body.contains(e)),this.endDragIfSourceWasRemovedFromDOM=()=>{let e=this.currentDragSourceNode;null==e||this.isNodeInDocument(e)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=e=>{null===this.hoverRafId&&"undefined"!=typeof requestAnimationFrame&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(e||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{null!==this.hoverRafId&&"undefined"!=typeof cancelAnimationFrame&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=e=>{if(e.defaultPrevented)return;let{dragStartSourceIds:t}=this;this.dragStartSourceIds=null;let a=eo(e);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(t||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:a});let{dataTransfer:r}=e,n=ea(r);if(this.monitor.isDragging()){if(r&&"function"==typeof r.setDragImage){let e=this.monitor.getSourceId(),t=this.sourceNodes.get(e),n=this.sourcePreviewNodes.get(e)||t;if(n){let{anchorX:e,anchorY:i,offsetX:s,offsetY:l}=this.getCurrentSourcePreviewNodeOptions(),o=function(e,t,a,r,n){var i;let s,l,o,c="IMG"===t.nodeName&&(en()||!(null==(i=document.documentElement)?void 0:i.contains(t))),d=el(c?e:t),u={x:a.x-d.x,y:a.y-d.y},{offsetWidth:m,offsetHeight:h}=e,{anchorX:p,anchorY:g}=r,{dragPreviewWidth:f,dragPreviewHeight:x}=(s=c?t.width:m,l=c?t.height:h,ei()&&c&&(l/=window.devicePixelRatio,s/=window.devicePixelRatio),{dragPreviewWidth:s,dragPreviewHeight:l}),{offsetX:y,offsetY:b}=n;return{x:0===y||y?y:new es([0,.5,1],[u.x,u.x/m*f,u.x+f-m]).interpolate(p),y:0===b||b?b:(o=new es([0,.5,1],[u.y,u.y/h*x,u.y+x-h]).interpolate(g),ei()&&c&&(o+=(window.devicePixelRatio-1)*x),o)}}(t,n,a,{anchorX:e,anchorY:i},{offsetX:s,offsetY:l});r.setDragImage(n,o.x,o.y)}}try{null==r||r.setData("application/json",{})}catch(e){}this.setCurrentDragSourceNode(e.target);let{captureDraggingState:t}=this.getCurrentSourcePreviewNodeOptions();t?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(n)this.beginDragNativeItem(n);else{if(r&&!r.types&&(e.target&&!e.target.hasAttribute||!e.target.hasAttribute("draggable")))return;e.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=e=>{if(this.dragEnterTargetIds=[],this.isDraggingNativeItem()){var t;null==(t=this.currentNativeSource)||t.loadDataTransfer(e.dataTransfer)}if(!this.enterLeaveCounter.enter(e.target)||this.monitor.isDragging())return;let{dataTransfer:a}=e,r=ea(a);r&&this.beginDragNativeItem(r,a)},this.handleTopDragEnter=e=>{let{dragEnterTargetIds:t}=this;this.dragEnterTargetIds=[],!this.monitor.isDragging()||(this.altKeyPressed=e.altKey,t.length>0&&this.actions.hover(t,{clientOffset:eo(e)}),t.some(e=>this.monitor.canDropOnTarget(e))&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())))},this.handleTopDragOverCapture=e=>{if(this.dragOverTargetIds=[],this.isDraggingNativeItem()){var t;null==(t=this.currentNativeSource)||t.loadDataTransfer(e.dataTransfer)}},this.handleTopDragOver=e=>{let{dragOverTargetIds:t}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging()){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none");return}this.altKeyPressed=e.altKey,this.lastClientOffset=eo(e),this.scheduleHover(t),(t||[]).some(e=>this.monitor.canDropOnTarget(e))?(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?e.preventDefault():(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=e=>{this.isDraggingNativeItem()&&e.preventDefault(),this.enterLeaveCounter.leave(e.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=e=>{if(this.dropTargetIds=[],this.isDraggingNativeItem()){var t;e.preventDefault(),null==(t=this.currentNativeSource)||t.loadDataTransfer(e.dataTransfer)}else ea(e.dataTransfer)&&e.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=e=>{let{dropTargetIds:t}=this;this.dropTargetIds=[],this.actions.hover(t,{clientOffset:eo(e)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=e=>{let t=e.target;"function"!=typeof t.dragDrop||"INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||(e.preventDefault(),t.dragDrop())},this.options=new ec(t,a),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new V(this.isNodeInDocument)}}e.s(["HTML5Backend",0,function(e,t,a){return new eu(e,t,a)}],276423)},847948,e=>{"use strict";var t=e.i(478902),a=e.i(356003),r=e.i(61187);e.i(128328);var n=e.i(158639),i=e.i(826843),s=e.i(215312),l=e.i(790819);e.s(["RefreshButton",0,({tableId:e,isRefetching:o})=>{let{ref:c}=(0,n.useParams)(),d=(0,a.useQueryClient)(),{invalidate:u}=(0,i.useTableIndexAdvisor)(),m=l.tableRowKeys.tableRowsAndCount(c,e);async function h(){await d.invalidateQueries({queryKey:m}),await u()}return(0,t.jsx)(s.ButtonTooltip,{type:"outline",loading:o,icon:(0,t.jsx)(r.RefreshCw,{}),onClick:()=>h(),className:"w-7 h-7 p-0",tooltip:{content:{side:"bottom",text:"Refresh table data"}}})}])},174416,(e,t,a)=>{t.exports=function(e){if("function"!=typeof e)throw TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},798229,(e,t,a)=>{var r=e.r(530013),n=e.r(847799),i=e.r(553319),s=e.r(931297),l=e.r(173517);t.exports=function(e,t,a,o){if(!s(e))return e;t=n(t,e);for(var c=-1,d=t.length,u=d-1,m=e;null!=m&&++c<d;){var h=l(t[c]),p=a;if("__proto__"===h||"constructor"===h||"prototype"===h)break;if(c!=u){var g=m[h];void 0===(p=o?o(g,h,m):void 0)&&(p=s(g)?g:i(t[c+1])?[]:{})}r(m,h,p),m=m[h]}return e}},4177,(e,t,a)=>{var r=e.r(803658),n=e.r(798229),i=e.r(847799);t.exports=function(e,t,a){for(var s=-1,l=t.length,o={};++s<l;){var c=t[s],d=r(e,c);a(d,c)&&n(o,i(c,e),d)}return o}},626478,(e,t,a)=>{var r=e.r(959472),n=e.r(274798),i=e.r(531089),s=e.r(696907);t.exports=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,i(e)),e=n(e);return t}:s},47334,(e,t,a)=>{var r=e.r(734522),n=e.r(626478),i=e.r(31518);t.exports=function(e){return r(e,i,n)}},904582,(e,t,a)=>{var r=e.r(632981),n=e.r(567265),i=e.r(4177),s=e.r(47334);t.exports=function(e,t){if(null==e)return{};var a=r(s(e),function(e){return[e]});return t=n(t),i(e,a,function(e,a){return t(e,a[0])})}},458170,(e,t,a)=>{var r=e.r(567265),n=e.r(174416),i=e.r(904582);t.exports=function(e,t){return i(e,n(r(t)))}},73558,4617,163989,681438,458184,328675,605283,891521,580136,602730,76025,636284,657990,616475,247529,697448,e=>{"use strict";var t=e.i(701275);function a(e,a){let r=e;if(a?.gridColumns){r=[];let n=a.gridColumns.filter(e=>e?.name!=="");for(let t=0;t<n.length;t++){let a=n[t],i=e.find(e=>e.key===a.key);i&&r.push({...i,width:a.width,frozen:a.frozen})}let i=e.filter(e=>!n.find(t=>t.key===e.key)&&""!==e.name);r=r.concat(i);let s=e.find(e=>e.key===t.SELECT_COLUMN_KEY);s&&(r=[s,...r]);let l=e.find(e=>e.key===t.ADD_COLUMN_KEY);l&&r.push(l)}return r}e.s(["getInitialGridColumns",()=>a],73558);var r=e.i(478902);e.s(["DefaultValue",0,()=>(0,r.jsx)("span",{className:"sb-grid-default-value opacity-50",children:"DEFAULT"})],4617);let n=()=>(0,r.jsx)("span",{className:"null-value opacity-50",children:"NULL"});e.s(["NullValue",0,n],163989);var i=e.i(384429);e.s(["BooleanEditor",0,({row:e,column:t,isNullable:a,onRowChange:n,onClose:s})=>{let l=e[t.key];return(0,r.jsxs)(i.Select,{autoFocus:!0,id:"boolean-editor",name:"boolean-editor",size:"small",onBlur:()=>s(!1),onChange:a=>{let r=a.target.value;"null"===r?n({...e,[t.key]:null},!0):n({...e,[t.key]:"true"===r},!0)},defaultValue:null==l?"null":l.toString(),style:{width:`${t.width}px`},children:[(0,r.jsx)(i.Select.Option,{value:"true",children:"TRUE"}),(0,r.jsx)(i.Select.Option,{value:"false",children:"FALSE"}),a&&(0,r.jsx)(i.Select.Option,{value:"null",children:"NULL"})]})}],681438);var s=e.i(55956),l=e.i(88816),o=e.i(389959),c=e.i(837710),d=e.i(843778),u=e.i(874311),m=e.i(689805),h=e.i(793912),p=e.i(135144),g=e.i(955909),f=e.i(746301);let x=({value:e,children:t,onEscape:a,onEnter:n,ignoreOutsideClicks:i=!1})=>{let s=(0,o.useRef)(null),l=(e=>{let[t,a]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let t=t=>{e.current&&!e.current.contains(t.target)?a(!0):a(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[e]),t})(s),c=(0,o.useCallback)(t=>{switch(t.key){case"Escape":t.stopPropagation(),a&&a(e);break;case"Enter":t.stopPropagation(),!t.shiftKey&&n&&(t.preventDefault(),n(e))}},[e]);return(0,o.useEffect)(()=>{!i&&l&&void 0!==n&&n(e)},[l]),(0,r.jsx)("div",{ref:s,onKeyDown:c,children:t})},y={date:"YYYY-MM-DD",datetime:"YYYY-MM-DD HH:mm:ss",datetimetz:"YYYY-MM-DD HH:mm:ss+ZZ"};function b({row:e,column:t,type:a,isNullable:n,onRowChange:i,onClose:b}){let v=(0,o.useRef)(null),j=y[a],S=e[t.key],[N,C]=(0,o.useState)(S),w=N?Number((0,s.default)(N,j)):N,T=a=>{("string"!=typeof a||0!==a.length)&&"Invalid Date"!==w&&i({...e,[t.key]:a},!0)},E=()=>{T((0,s.default)().format("date"===a?"YYYY-MM-DD":"datetimetz"===a?"YYYY-MM-DDTHH:mm:ssZ":"YYYY-MM-DDTHH:mm:ss"))};return(0,o.useEffect)(()=>{try{v.current?.focus({preventScroll:!0})}catch(e){v.current?.focus()}},[]),(0,r.jsxs)(m.Popover_Shadcn_,{open:!0,children:[(0,r.jsx)(p.PopoverTrigger_Shadcn_,{children:(0,r.jsx)("div",{className:(0,d.cn)("px-[8px]",null===S?"text-foreground-lighter":""),children:null===S?"NULL":S})}),(0,r.jsxs)(h.PopoverContent_Shadcn_,{align:"start",className:"p-0 rounded-none w-64",children:[(0,r.jsx)(x,{ignoreOutsideClicks:!0,value:N,onEscape:()=>b(!1),onEnter:T,children:(0,r.jsx)(f.Input,{ref:v,value:N??"",placeholder:j,onChange:e=>C(e.target.value),className:"border-0 rounded-none bg-dash-sidebar outline-none !ring-0 !ring-offset-0"})}),(0,r.jsxs)("div",{className:"px-3 py-1 flex flex-col gap-y-0.5",children:[(0,r.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Formatted value:"}),0===(N??"").length?(0,r.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Enter a valid date format"}):"Invalid Date"===w?(0,r.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Invalid date format"}):"datetimetz"===a?(0,r.jsx)(g.TimestampInfo,{displayAs:"utc",utcTimestamp:w,labelFormat:"DD MMM YYYY HH:mm:ss (ZZ)",className:"text-left !text-sm font-mono tracking-tight"}):(0,r.jsx)("p",{className:"text-sm font-mono tracking-tight",children:(0,g.timestampLocalFormatter)({utcTimestamp:w,format:"date"===a?"DD MMM YYYY":"datetime"===a?"DD MMM YYYY HH:mm:ss":void 0})})]}),(0,r.jsxs)("div",{className:"px-3 pt-1 pb-2 flex justify-between gap-x-1",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1.5 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:""})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,r.jsx)("div",{className:"flex",children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Button,{type:"default",className:"rounded-r-none",onClick:()=>T(null),children:"Set NULL"}),(0,r.jsxs)(u.DropdownMenu,{children:[(0,r.jsx)(u.DropdownMenuTrigger,{asChild:!0,children:(0,r.jsx)(c.Button,{type:"default",icon:(0,r.jsx)(l.ChevronDown,{}),className:"px-1 rounded-l-none border-l-0"})}),(0,r.jsx)(u.DropdownMenuContent,{className:"w-20",align:"end",children:(0,r.jsx)(u.DropdownMenuItem,{onClick:E,children:"Set to NOW"})})]})]}):(0,r.jsx)(c.Button,{type:"default",onClick:E,children:"Set to NOW"})})]})]})]})}function v(e,t){return a=>(0,r.jsx)(b,{...a,type:e,isNullable:t})}e.s(["DateTimeEditor",()=>v],458184);let j=(0,e.i(388019).default)("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);var S=e.i(355901);e.i(128328);var N=e.i(158639),C=e.i(201780),w=e.i(310959),T=e.i(48189),E=e.i(240987),_=e.i(822574),D=e.i(721329),P=e.i(792252),I=e.i(458170),O=e.i(707409);let R=(e,t)=>{if(!t||0==t.length)return"";if(O.TIMESTAMP_TYPES.includes(e))return(0,s.default)(t).format("YYYY-MM-DDTHH:mm:ss");if(!O.TIME_TYPES.includes(e))return t;{let e=t&&t.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return(0,s.default)(t,e).format("HH:mm:ss")}},A=(e,t)=>{if(!t||0==t.length)return null;switch(e){case"timestamptz":return(0,s.default)(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return(0,s.default)(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return(0,s.default)(t,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return(0,s.default)(t,"HH:mm:ss").format("HH:mm:ss");default:return t}},k=(e,t=!1)=>{let a={};return e.forEach(e=>{let t=e.format.startsWith("_"),r=O.TEXT_TYPES.includes(e.format)?e.value:0===(e?.value??"").length?null:e.value;if(t&&null!==r)a[e.name]=(0,T.tryParseJson)(r);else if(e.format.includes("json"))"object"==typeof e.value?a[e.name]=r:(0,P.default)(r)&&(a[e.name]=(0,T.tryParseJson)(r));else if("bool"===e.format&&r)"null"===r?a[e.name]=null:a[e.name]="true"===r;else if(O.DATETIME_TYPES.includes(e.format)){let t=2===(r||"").split(":").length?`${r}:00`:r;a[e.name]=A(e.format,t)}else a[e.name]=r}),t?a:(0,I.default)(a,D.default)},L=e=>"string"==typeof e&&e.endsWith("...")&&e.length>w.MAX_CHARACTERS||"string"==typeof e&&e.startsWith('["')&&e.endsWith(',"..."]')&&(e.match(/","/g)||[]).length===w.MAX_ARRAY_SIZE||"string"==typeof e&&e.startsWith('[["')||"string"==typeof e&&e.endsWith(',{"truncated":true}]'),F=e=>{try{return`\\x${C.Buffer.from(e.data).toString("hex")}`}catch{return e}};e.s(["convertByteaToHex",0,F,"generateRowFields",0,(e,t,a)=>{let{primary_keys:r=[]}=t,n=r.map(e=>e.name);return(t.columns??[]).map(t=>{let r=(({column:e,row:t})=>{if(void 0===t)if(O.TEXT_TYPES.includes(e.format))return null;else if("bool"!==e.format)return"";else if(e.default_value)return e.default_value;else if(e.is_nullable)return"null";else return null;return"bool"===e.format&&null===t[e.name]?"null":O.DATETIME_TYPES.includes(e.format)?R(e.format,t[e.name]):((e,t)=>{try{if(null===e||"string"==typeof e&&0===e.length)return e;if("number"==typeof e||!t)return e;if("bytea"===t)return F(e);else if("object"==typeof e)return JSON.stringify(e);else if("boolean"==typeof e)return e.toString();else return e}catch(t){return e}})(t[e.name],e.format)})({column:t,row:e}),i=a.find(e=>e.columns.map(e=>e.source).includes(t.name));return{value:r,foreignKey:void 0!==i?{id:i.id,constraint_name:i.name,source_schema:t.schema,source_table_name:t.table,source_column_name:t.name,target_table_schema:i.schema,target_table_name:i.table,target_column_name:i.columns.find(e=>e.source===t.name)?.target??""}:void 0,id:t.id,name:t.name,comment:(e=>{if(!e)return"";let t=(0,E.default)(e.split("\n"));return 1==t.length?e:2==t.length?`${t[0]} ${t[1]?.split(".<")[0]}`:t.length>2?`${t[0]} (${t[1]} ${t[2]?.split(".<")[0]})`:""})(t.comment),format:t.format,enums:t.enums,defaultValue:t?.default_value,isNullable:t.is_nullable,isIdentity:t.is_identity,isPrimaryKey:n.includes(t.name)}})},"generateRowObjectFromFields",0,k,"generateUpdateRowPayload",0,(e,t)=>{let a=k(t,!0),r={};return Object.keys(a).forEach(n=>{let i=t.find(e=>e.name===n),s=i?.format;if(void 0!==s&&O.DATETIME_TYPES.includes(s)){let t=R(s,e[n]);A(s,t)!==a[n]&&(r[n]=a[n])}else if(void 0!==s&&O.JSON_TYPES.includes(s))L(i?.value)||(r[n]=a[n]);else{let t=void 0===e[n]?null:e[n],i=a[n];(0,_.default)(t,i)||(r[n]=i)}}),r},"isValueTruncated",0,L,"validateFields",0,e=>{let t={};return e.forEach(e=>{if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch{t[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(e.value?.length??0)>0){if(L(e.value))return;try{(0,T.minifyJSON)(e.value??"")}catch{t[e.name]="Value is invalid JSON"}}if(e.isIdentity||e.defaultValue)return}),t}],328675);var M=e.i(415190),$=e.i(962217),K=e.i(38429);e.i(967533);var U=e.i(721490),q=e.i(714403);async function z({projectRef:e,connectionString:t,table:a,column:r,pkMatch:n}){let i=function({table:e,column:t,pkMatch:a}){return new U.Query().from(e.name,e.schema??void 0).select(`"${t}"`).match(a).toSql()}({table:a,column:r,pkMatch:n}),{result:s}=await (0,q.executeSql)({projectRef:e,connectionString:t,sql:i});return s?.[0][r]}let Y=({onSuccess:e,onError:t,...a}={})=>(0,K.useMutation)({mutationFn:e=>z(e),async onSuccess(t,a,r){await e?.(t,a,r)},async onError(e,a,r){void 0===t?S.toast.error(e.message):t(e,a,r)},...a});e.s(["useGetCellValueMutation",0,Y],605283);var H=e.i(635494),B=e.i(463783),Q=e.i(613580),V=e.i(181827);let W=({isLoading:e,loadFullValue:t})=>(0,r.jsxs)("div",{className:(0,d.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-xs w-full h-full px-3 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,r.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,r.jsxs)("p",{children:["Value is larger than ",w.MAX_CHARACTERS.toLocaleString()," characters"]}),(0,r.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire value, but your browser may run into performance issues"})]}),(0,r.jsx)(c.Button,{type:"default",loading:e,onClick:t,children:"Load full value"})]});function G(e){e?.focus(),e?.select()}function J({row:e,column:t,onRowChange:a,onClose:n}){let i=e[t.key];return(0,r.jsx)("input",{className:"sb-grid-number-editor",ref:G,value:i??"",onChange:function(r){let n=r.target.value;""===n?a({...e,[t.key]:null}):a({...e,[t.key]:n})},onBlur:function(){n(!0)},type:"number"})}function X({row:e,column:t,onRowChange:a,onClose:n,options:s,isNullable:l}){let o=e[t.key];return(0,r.jsxs)(i.Select,{autoFocus:!0,id:"select-editor",name:"select-editor",size:"small",defaultValue:o??"",className:"sb-grid-select-editor !gap-2",style:{width:`${t.width}px`},onChange:function(r){r.target.value&&""!=r.target.value?a({...e,[t.key]:r.target.value},!0):a({...e,[t.key]:null},!0)},onBlur:function(){n(!1)},children:[l&&(0,r.jsx)(i.Select.Option,{value:"",children:"NULL"}),s.map(({label:e,_value:t})=>(0,r.jsx)(i.Select.Option,{value:t,selected:t===o,children:e},t))]})}e.s(["JsonEditor",0,({row:e,column:t,isEditable:a=!0,onRowChange:i,onExpandEditor:s})=>{let{id:l}=(0,N.useParams)(),c=l?Number(l):void 0,{data:d}=(0,H.useSelectedProjectQuery)(),{data:u}=(0,M.useTableEditorQuery)({projectRef:d?.ref,connectionString:d?.connectionString,id:c}),m=e[t.key],h=null==m||"string"==typeof m?m:JSON.stringify(m),p=(0,T.prettifyJSON)(h?(e=>{try{let t=JSON.parse(e);return JSON.stringify(t)}catch(t){if("string"==typeof e)return e.replaceAll('"','"');return JSON.stringify(e)}})(h):""),g=L(h),[f,y]=(0,o.useState)(!0),[b,v]=(0,o.useState)(p),{mutate:C,isPending:w,isSuccess:E}=Y(),_=(0,o.useCallback)(()=>{a&&i(e,!0),y(!1)},[]),D=(0,o.useCallback)(e=>{(null!==e?(0,T.removeJSONTrailingComma)(e):e)!==b?P(e):y(!1)},[E]),P=r=>{if(a)if(r)if((e=>{try{return JSON.parse(e),!0}catch(e){return!1}})(r)){let a=JSON.parse(r);i({...e,[t.key]:a},!0),y(!1)}else S.toast.error("Please enter a valid JSON");else i({...e,[t.key]:null},!0),y(!1)};return(0,r.jsx)(B.Popover,{open:f,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:g&&!E?(0,r.jsxs)("div",{style:{width:`${t.width}px`},className:"flex items-center justify-center flex-col relative",children:[(0,r.jsx)(V.MonacoEditor,{readOnly:!0,onChange:()=>{},width:`${t.width}px`,value:b??"",language:"markdown"}),(0,r.jsx)(W,{isLoading:w,loadFullValue:()=>{if(void 0===u||void 0===d||!(0,$.isTableLike)(u))return;if(0===u.primary_keys.length)return(0,S.toast)("Unable to load value as table has no primary keys");let a=u.primary_keys.reduce((t,a)=>({...t,[a.name]:e[a.name]}),{});C({table:{schema:u.schema,name:u.name},column:t.name,pkMatch:a,projectRef:d?.ref,connectionString:d?.connectionString},{onSuccess:e=>{v(JSON.stringify(e))}})}})]}):(0,r.jsxs)(x,{value:b,onEscape:_,onEnter:D,children:[(0,r.jsx)(V.MonacoEditor,{width:`${t.width}px`,value:b??"",language:"json",readOnly:!a,onChange:e=>{a&&(e&&""!=e?v(e):v(null))}}),(0,r.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 gap-x-2",children:[a&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:""})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,r.jsxs)(Q.Tooltip,{children:[(0,r.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,r.jsx)("div",{className:"border border-strong rounded p-1 flex items-center justify-center transition cursor-pointer bg-selection hover:bg-border-strong",onClick:()=>void(_(),s(t.key,{...e,[t.key]:(0,T.tryParseJson)(b)||e[t.key]})),children:(0,r.jsx)(j,{size:12,strokeWidth:2})})}),(0,r.jsx)(Q.TooltipContent,{side:"bottom",align:"center",children:(0,r.jsx)("span",{children:"Expand editor"})})]})]})]}),children:(0,r.jsx)("div",{className:`${b&&0==p.trim().length?"sb-grid-fill-container":""} sb-grid-json-editor__trigger`,onClick:()=>y(!f),children:null===b||""===b?(0,r.jsx)(n,{}):p})})}],891521),e.s(["NumberEditor",()=>J],580136),e.s(["SelectEditor",()=>X],602730);var Z=e.i(463333),ee=e.i(466472);let et=()=>(0,r.jsx)("span",{className:"sb-grid-empty-value opacity-50",children:"EMPTY"});e.s(["EmptyValue",0,et],76025),e.s(["TextEditor",0,({row:e,column:t,isNullable:a,isEditable:i,onRowChange:s,onExpandEditor:l})=>{let{id:u}=(0,N.useParams)(),m=u?Number(u):void 0,{data:h}=(0,H.useSelectedProjectQuery)(),{data:p}=(0,M.useTableEditorQuery)({projectRef:h?.ref,connectionString:h?.connectionString,id:m}),g=e[t.key],f=g||""===g?String(g):null,[y,b]=(0,o.useState)(!0),[v,C]=(0,o.useState)(f),[w,T]=(0,o.useState)(!1),E=(0,Z.useIsQueueOperationsEnabled)(),{mutate:_,isPending:D,isSuccess:P}=Y(),I=L(f),O=(0,o.useCallback)(()=>{i&&s(e,!0),b(!1)},[]),R=(0,o.useCallback)(a=>{i&&a!==v&&s({...e,[t.key]:a},!0),b(!1)},[P]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.Popover,{open:y,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:I&&!P?(0,r.jsxs)("div",{style:{width:`${t.width}px`},className:"flex items-center justify-center flex-col relative",children:[(0,r.jsx)(V.MonacoEditor,{readOnly:!0,onChange:()=>{},width:`${t.width}px`,value:v??"",language:"markdown"}),(0,r.jsx)(W,{isLoading:D,loadFullValue:()=>{if(void 0===p||void 0===h||!(0,$.isTableLike)(p))return;if(0===p.primary_keys.length)return(0,S.toast)("Unable to load value as table has no primary keys");let a=p.primary_keys.reduce((t,a)=>({...t,[a.name]:e[a.name]}),{});_({table:{schema:p.schema,name:p.name},column:t.name,pkMatch:a,projectRef:h?.ref,connectionString:h?.connectionString},{onSuccess:e=>C(e)})}})]}):(0,r.jsxs)(x,{value:v,onEscape:O,onEnter:R,ignoreOutsideClicks:w,children:[(0,r.jsx)(V.MonacoEditor,{width:`${t.width}px`,value:v??"",readOnly:!i,onChange:e=>{i&&(e?C(e):C(""))}}),i&&(0,r.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:""})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,r.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-y-1",children:[(0,r.jsxs)(Q.Tooltip,{children:[(0,r.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,r.jsx)(c.Button,{type:"default",className:"px-1",onClick:()=>void(O(),l(t.key,{...e,[t.key]:v||e[t.key]})),icon:(0,r.jsx)(j,{size:12,strokeWidth:2})})}),(0,r.jsx)(Q.TooltipContent,{side:"bottom",children:"Expand editor"})]}),a&&(0,r.jsx)(c.Button,{size:"tiny",type:"default",htmlType:"button",onClick:()=>{E?R(null):T(!0)},children:"Set to NULL"})]})]})]}),children:(0,r.jsx)("div",{className:(0,d.cn)(!!v&&0===v.toString().trim().length&&"sb-grid-fill-container","sb-grid-text-editor__trigger"),onClick:()=>b(!y),children:null===v?(0,r.jsx)(n,{}):""===v?(0,r.jsx)(et,{}):v})}),(0,r.jsx)(ee.default,{visible:w,title:"Confirm setting value to NULL",confirmLabel:"Confirm",onCancel:()=>T(!1),onConfirm:()=>{R(null)},children:(0,r.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you wish to set this value to NULL? This action cannot be undone."})})]})}],636284);var ea=e.i(170286);function er(e){e?.focus(),e?.select()}s.default.extend(ea.default);let en="HH:mm:ss";function ei({row:e,column:t,format:a,onRowChange:n,onClose:i}){let l=e[t.key],o=l?(0,s.default)(l,a).format(en):l;return(0,r.jsx)("input",{className:"sb-grid-time-editor",ref:er,value:o??"",onChange:function(r){let i=r.target.value;if(""==i)n({...e,[t.key]:null});else{let r=(0,s.default)(i,en).format(a);n({...e,[t.key]:r})}},onBlur:()=>i(!0),type:"time",step:"1"})}function es(e){return(0,r.jsx)(ei,{...e,format:"HH:mm:ss"})}function el(e){return(0,r.jsx)(ei,{...e,format:"HH:mm:ssZZ"})}e.s(["TimeEditor",()=>es,"TimeWithTimezoneEditor",()=>el],657990),e.s(["BinaryFormatter",0,e=>{let t=e.row[e.column.key];if(!t)return(0,r.jsx)(n,{});let a=F(t);return(0,r.jsx)(r.Fragment,{children:a})}],616475),e.s(["BooleanFormatter",0,e=>{let t=e.row[e.column.key];return null===t?(0,r.jsx)(n,{}):(0,r.jsx)(r.Fragment,{children:t?"TRUE":"FALSE"})}],247529),e.s(["DefaultFormatter",0,e=>{let t=e.row[e.column.key];return null===t?(0,r.jsx)(n,{}):""===t?(0,r.jsx)(et,{}):(("object"==typeof t||Array.isArray(t))&&(t=JSON.stringify(t)),(0,r.jsx)(r.Fragment,{children:t}))}],697448)},910612,(e,t,a)=>{"use strict";t.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;if(Array.isArray(t)){if((r=t.length)!=a.length)return!1;for(n=r;0!=n--;)if(!e(t[n],a[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((r=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(n=r;0!=n--;)if(!Object.prototype.hasOwnProperty.call(a,i[n]))return!1;for(n=r;0!=n--;){var r,n,i,s=i[n];if(!e(t[s],a[s]))return!1}return!0}return t!=t&&a!=a}},707338,716458,631794,242533,736404,e=>{"use strict";e.s(["ForeignKeyFormatter",()=>T],707338);var t=e.i(478902),a=e.i(710377),r=e.i(328675),n=e.i(215312),i=e.i(415190),s=e.i(962217),l=e.i(159876),o=e.i(635494),c=e.i(689805),d=e.i(793912),u=e.i(135144),m=e.i(108151),h=e.i(163989),p=e.i(546024),g=e.i(591385),f=e.i(201844);e.i(128328);var x=e.i(158639),y=e.i(701275),b=e.i(680418),v=e.i(941381),j=e.i(70756),S=e.i(837710),N=e.i(843778),C=e.i(613580);let w=({table:e,column:a,value:n})=>{let{ref:i}=(0,x.useParams)(),{data:s}=(0,o.useSelectedProjectQuery)(),{data:l,error:c,isSuccess:d,isError:u,isPending:h}=(0,j.useTableRowsQuery)({projectRef:s?.ref,connectionString:s?.connectionString,tableId:e.id,filters:[{column:a,operator:"=",value:n}],page:1,limit:10},{placeholderData:f.keepPreviousData}),w=e.primary_keys.map(e=>e.name),T=(e?.columns??[]).map(e=>{let a=(0,b.getColumnDefaultWidth)({dataType:e.data_type,format:e.format}),n=(e.name.length+e.format.length)*b.ESTIMATED_CHARACTER_PIXEL_WIDTH,i=w.includes(e.name);return{key:e.name,name:e.name,resizable:!1,draggable:!1,sortable:!1,width:a<n?n:a,minWidth:y.COLUMN_MIN_WIDTH,headerCellClass:"outline-none !shadow-none",renderHeaderCell:()=>(0,t.jsxs)("div",{className:"flex h-full items-center justify-center gap-x-2",children:[i&&(0,t.jsxs)(C.Tooltip,{children:[(0,t.jsx)(C.TooltipTrigger,{children:(0,t.jsx)(p.Key,{size:14,strokeWidth:2,className:"text-brand rotate-45"})}),(0,t.jsx)(C.TooltipContent,{side:"bottom",children:"Primary key"})]}),(0,t.jsx)("span",{className:"text-xs truncate",children:e.name}),(0,t.jsx)("span",{className:"text-xs text-foreground-light font-normal",children:e.format})]}),renderCell:({column:a,row:n})=>{let i=n[a.name],s="bytea"===e.format?(0,r.convertByteaToHex)(i):i;return(0,t.jsx)("div",{className:(0,N.cn)("flex items-center h-full w-full whitespace-pre",null===s&&"text-foreground-lighter"),children:null===s?"NULL":s})}}});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"px-2 py-2 text-xs text-foreground-light border-b",children:["Referencing record from"," ",(0,t.jsxs)("span",{className:"text-foreground",children:[e.schema,".",e.name]}),":"]}),(0,t.jsx)(g.default,{className:"h-32 rounded-b border-0",columns:T,rows:l?.rows??[],onCellDoubleClick:(e,t)=>{t.preventDefault(),t.stopPropagation()},renderers:{noRowsFallback:(0,t.jsxs)("div",{className:"w-96 px-2",children:[h&&(0,t.jsx)("div",{className:"py-2",children:(0,t.jsx)(m.ShimmeringLoader,{})}),u&&(0,t.jsxs)("p",{className:"text-foreground-light",children:["Failed to find referencing row: ",c.message]}),d&&(0,t.jsx)("p",{className:"text-foreground-light",children:"No results were returned"})]})}}),(0,t.jsx)("div",{className:"flex items-center justify-end px-2 py-1",children:(0,t.jsx)(v.EditorTablePageLink,{href:`/project/${i}/editor/${e.id}?schema=${e.schema}&filter=${a}%3Aeq%3A${n}`,projectRef:i,id:String(e.id),filters:[{column:a,operator:"=",value:String(n)}],children:(0,t.jsx)(S.Button,{type:"default",children:"Open table"})})})]})},T=e=>{let{tableId:p,row:g,column:f}=e,{data:x}=(0,o.useSelectedProjectQuery)(),{data:y,isPending:b}=(0,i.useTableEditorQuery)({projectRef:x?.ref,connectionString:x?.connectionString,id:p}),v=y?.columns.find(e=>e.name===f.key),j=(0,s.isTableLike)(y)?y:void 0,S=(j?.relationships??[]).find(e=>e.source_schema===j?.schema&&e.source_table_name===j?.name&&e.source_column_name===f.name),{data:N,isPending:C}=(0,l.useTableQuery)({projectRef:x?.ref,connectionString:x?.connectionString,schema:S?.target_table_schema??"",name:S?.target_table_name??""},{enabled:!!x?.ref&&!!S?.target_table_schema&&!!S?.target_table_name}),T=g[f.key],E=v?.format==="bytea"&&T?(0,r.convertByteaToHex)(T):T;return(0,t.jsxs)("div",{className:"sb-grid-foreign-key-formatter flex justify-between",children:[(0,t.jsx)("span",{className:"sb-grid-foreign-key-formatter__text",children:null===E?(0,t.jsx)(h.NullValue,{}):E}),b&&null!==E&&(0,t.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:(0,t.jsx)(m.ShimmeringLoader,{className:"w-4 h-4"})}),!b&&void 0!==S&&null!==E&&(0,t.jsxs)(t.Fragment,{children:[C&&(0,t.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:(0,t.jsx)(m.ShimmeringLoader,{className:"w-4 h-4"})}),!C&&void 0!==N&&(0,t.jsxs)(c.Popover_Shadcn_,{children:[(0,t.jsx)(u.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(n.ButtonTooltip,{type:"default",className:"w-6 h-6",icon:(0,t.jsx)(a.ArrowRight,{}),onClick:e=>e.stopPropagation(),tooltip:{content:{side:"bottom",text:"View referencing record"}}})}),(0,t.jsx)(d.PopoverContent_Shadcn_,{align:"end",className:"p-0 w-96",children:(0,t.jsx)(w,{table:N,column:S.target_column_name,value:E})})]})]})]})};var E=e.i(76025);e.s(["JsonFormatter",0,e=>{let a=e.row[e.column.key];if(null===a)return(0,t.jsx)(h.NullValue,{});if(""===a)return(0,t.jsx)(E.EmptyValue,{});if("string"==typeof a&&a.endsWith("..."))return(0,t.jsx)(t.Fragment,{children:a});try{let e=JSON.parse(a);return(0,t.jsx)(t.Fragment,{children:JSON.stringify(e)})}catch(e){return(0,t.jsx)(t.Fragment,{children:JSON.stringify(a)})}}],716458);var _=e.i(479232),D=e.i(636047),P=e.i(697448);let I={key:y.ADD_COLUMN_KEY,name:"",idx:999,width:100,maxWidth:100,resizable:!1,sortable:!1,frozen:!1,isLastFrozenColumn:!1,renderHeaderCell:()=>(0,t.jsx)(O,{"aria-label":"Add New Row"}),renderCell:P.DefaultFormatter,parent:void 0,level:0,minWidth:0,draggable:!1},O=()=>{let e=(0,D.useTableEditorStateSnapshot)();return(0,t.jsx)("div",{className:"flex h-full w-full py-1.5 flex items-center",children:(0,t.jsx)(S.Button,{block:!0,type:"text",onClick:e.onAddColumn,icon:(0,t.jsx)(_.Plus,{})})})};e.s(["AddColumn",0,I],631794);var R=e.i(346423),A=e.i(910612),k=e.i(389959);let L="undefined"!=typeof window?k.useLayoutEffect:k.useEffect;function F(e,t,a){return function(e,t,a){let[r,n]=function(e,t,a){let[r,n]=(0,k.useState)(()=>t(e)),i=(0,k.useCallback)(()=>{let i=t(e);!(0,A.default)(r,i)&&(n(i),a&&a())},[r,e,a]);return L(i),[r,i]}(e,t,a);return L(function(){let t=e.getHandlerId();if(null!=t)return e.subscribeToStateChange(n,{handlerIds:[t]})},[e,n]),r}(t,e||(()=>({})),()=>a.reconnect())}function M(e,t){let a=[...t||[]];return null==t&&"function"!=typeof e&&a.push(e),(0,k.useMemo)(()=>"function"==typeof e?e():e,a)}function $(e,t,a,r){let n=a?a.call(r,e,t):void 0;if(void 0!==n)return!!n;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;let l=Object.prototype.hasOwnProperty.bind(t);for(let s=0;s<i.length;s++){let o=i[s];if(!l(o))return!1;let c=e[o],d=t[o];if(!1===(n=a?a.call(r,c,d,o):void 0)||void 0===n&&c!==d)return!1}return!0}function K(e){return null!==e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function U(e){let t={};return Object.keys(e).forEach(a=>{let r=e[a];if(a.endsWith("Ref"))t[a]=e[a];else{let e=(e=null,t=null)=>{var a,n;let i;return(0,k.isValidElement)(e)?(!function(e){if("string"==typeof e.type)return;let t=e.type.displayName||e.type.name||"the component";throw Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${t} into a <div>, or turn it into a drag source or a drop target itself.`)}(e),a=e,n=t?e=>r(e,t):r,i=a.ref,((0,R.invariant)("string"!=typeof i,"Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),i)?(0,k.cloneElement)(a,{ref:e=>{q(i,e),q(n,e)}}):(0,k.cloneElement)(a,{ref:n})):(r(e,t),e)};t[a]=()=>e}}),t}function q(e,t){"function"==typeof e?e(t):e.current=t}class z{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){let e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){let e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId&&(e?t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)):this.lastConnectedDragSource=e),t}reconnectDragPreview(e=!1){let t=this.dragPreview,a=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(a&&this.disconnectDragPreview(),this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}a&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!$(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!$(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=U({dragSource:(e,t)=>{this.clearDragSource(),this.dragSourceOptions=t||null,K(e)?this.dragSourceRef=e:this.dragSourceNode=e,this.reconnectDragSource()},dragPreview:(e,t)=>{this.clearDragPreview(),this.dragPreviewOptions=t||null,K(e)?this.dragPreviewRef=e:this.dragPreviewNode=e,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}var Y=e.i(32027);function H(){let{dragDropManager:e}=(0,k.useContext)(Y.DndContext);return(0,R.invariant)(null!=e,"Expected drag drop context"),e}let B=!1,Q=!1;class V{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){(0,R.invariant)(!B,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return B=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{B=!1}}isDragging(){if(!this.sourceId)return!1;(0,R.invariant)(!Q,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Q=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{Q=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class W{beginDrag(){let e=this.spec,t=this.monitor,a=null;return null!=(a="object"==typeof e.item?e.item:"function"==typeof e.item?e.item(t):{})?a:null}canDrag(){let e=this.spec,t=this.monitor;return"boolean"==typeof e.canDrag?e.canDrag:"function"!=typeof e.canDrag||e.canDrag(t)}isDragging(e,t){let a=this.spec,r=this.monitor,{isDragging:n}=a;return n?n(r):t===e.getSourceId()}endDrag(){let e=this.spec,t=this.monitor,a=this.connector,{end:r}=e;r&&r(t.getItem(),t),a.reconnect()}constructor(e,t,a){this.spec=e,this.monitor=t,this.connector=a}}function G(e,t){var a,r;let n,i,s,l,o,c,d,u=M(e,t);(0,R.invariant)(!u.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");let m=(n=H(),(0,k.useMemo)(()=>new V(n),[n])),h=(a=u.options,r=u.previewOptions,i=H(),L(()=>(s.dragSourceOptions=a||null,s.reconnect(),()=>s.disconnectDragSource()),[s=(0,k.useMemo)(()=>new z(i.getBackend()),[i]),a]),L(()=>(s.dragPreviewOptions=r||null,s.reconnect(),()=>s.disconnectDragPreview()),[s,r]),s);return l=H(),o=(0,k.useMemo)(()=>new W(u,m,h),[m,h]),(0,k.useEffect)(()=>{o.spec=u},[u]),L(function(){if(null!=d){let e,t,[a,r]=[t=(e=l.getRegistry()).addSource(d,c),()=>e.removeSource(t)];return m.receiveHandlerId(a),h.receiveHandlerId(a),r}},[l,m,h,c=o,d=(0,k.useMemo)(()=>{let e=u.type;return(0,R.invariant)(null!=e,"spec.type must be defined"),e},[u])]),[F(u.collect,m,h),(0,k.useMemo)(()=>h.hooks.dragSource(),[h]),(0,k.useMemo)(()=>h.hooks.dragPreview(),[h])]}e.s(["useDrag",()=>G],242533);class J{get connectTarget(){return this.dropTarget}reconnect(){let e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();let t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!$(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=U({dropTarget:(e,t)=>{this.clearDropTarget(),this.dropTargetOptions=t,K(e)?this.dropTargetRef=e:this.dropTargetNode=e,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}let X=!1;class Z{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;(0,R.invariant)(!X,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return X=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{X=!1}}isOver(e){return!!this.targetId&&this.internalMonitor.isOverTarget(this.targetId,e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class ee{canDrop(){let e=this.spec,t=this.monitor;return!e.canDrop||e.canDrop(t.getItem(),t)}hover(){let e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){let e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function et(e,t){var a;let r,n,i,s,l,o,c,d=M(e,t),u=(r=H(),(0,k.useMemo)(()=>new Z(r),[r])),m=(a=d.options,n=H(),i=(0,k.useMemo)(()=>new J(n.getBackend()),[n]),L(()=>(i.dropTargetOptions=a||null,i.reconnect(),()=>i.disconnectDropTarget()),[a]),i);return s=H(),l=(0,k.useMemo)(()=>new ee(d,u),[u]),(0,k.useEffect)(()=>{l.spec=d},[d]),L(function(){let e,t,[a,r]=[t=(e=s.getRegistry()).addTarget(c,o),()=>e.removeTarget(t)];return u.receiveHandlerId(a),m.receiveHandlerId(a),r},[s,u,o=l,m,(c=function(e){let{accept:t}=e;return(0,k.useMemo)(()=>((0,R.invariant)(null!=e.accept,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}(d)).map(e=>e.toString()).join("|")]),[F(d.collect,u,m),(0,k.useMemo)(()=>m.hooks.dropTarget(),[m])]}e.s(["useDrop",()=>et],736404)},200722,e=>{"use strict";var t=e.i(271226),a=e.i(389959);e.s(["useTableEditorFiltersSort",0,()=>{let e=(0,t.useRouter)(),r=(0,a.useMemo)(()=>new URLSearchParams(e.asPath.split("?")[1]),[e.asPath]),n=(0,a.useMemo)(()=>r.getAll("filter"),[r]),i=(0,a.useMemo)(()=>r.getAll("sort"),[r]);return{filters:n,sorts:i,setParams:t=>{let a=t({filter:n,sort:i}),r=void 0!==a.filter,s=void 0!==a.sort;e.push({query:{...e.query,...r?{filter:a.filter}:{},...s?{sort:a.sort}:{}}})}}}])},70255,821276,680418,e=>{"use strict";e.s(["TableEditorTableStateContextProvider",()=>ec,"useTableEditorTableStateSnapshot",()=>ed],70255);var t=e.i(478902);e.i(128328);var a=e.i(657588),r=e.i(19583),n=e.i(826843),i=e.i(73558);e.s(["ESTIMATED_CHARACTER_PIXEL_WIDTH",()=>ea,"getColumnDefaultWidth",()=>en,"getGridColumns",()=>er],680418);var s=e.i(701275),l=e.i(4617),o=e.i(163989),c=e.i(681438),d=e.i(458184),u=e.i(891521),m=e.i(580136),h=e.i(602730),p=e.i(636284),g=e.i(657990),f=e.i(616475),x=e.i(247529),y=e.i(697448),b=e.i(707338),v=e.i(716458),j=e.i(631794),S=e.i(710377),N=e.i(546024),C=e.i(924115),w=e.i(819993),T=e.i(250503),E=e.i(389959),_=e.i(242533),D=e.i(736404),P=e.i(390974),I=e.i(947300),O=e.i(613580),R=e.i(177948),A=e.i(749844),k=e.i(88816),L=e.i(53071),F=e.i(211570),M=e.i(701087);e.s(["useTableSort",()=>K],821276);var $=e.i(200722);function K(){let{sorts:e,setParams:t}=(0,$.useTableEditorFiltersSort)(),a=ed(),n=(0,E.useMemo)(()=>a.table?.name||"",[a]),i=(0,E.useMemo)(()=>(0,r.formatSortURLParams)(n,e),[n,e]),s=(0,E.useCallback)(e=>{if(!n)return console.warn("[useTableSort] Table name missing in callback, cannot apply sort correctly.");let a=e.map(e=>({...e,table:n})),i=(0,r.sortsToUrlParams)(a);t(e=>({...e,sort:i}))},[a,t]),l=(0,E.useCallback)((e,t)=>{if(!n||!e)return;let a=i.findIndex(t=>t.column===e),r=[...i];-1!==a?r[a]={...r[a],ascending:t}:r.unshift({table:n,column:e,ascending:t}),s(r)},[n,i,s]),o=(0,E.useCallback)(e=>{n&&e&&s(i.filter(t=>t.column!==e))},[n,i,s]);return{sorts:i,urlSorts:e,onApplySorts:s,addOrUpdateSort:l,removeSort:o}}var U=e.i(636047),q=e.i(837710),z=e.i(843778),Y=e.i(874311);let H=({column:e,isEncrypted:a})=>{let r,n=(0,U.useTableEditorStateSnapshot)(),i=ed(),{sorts:s,addOrUpdateSort:l,removeSort:o}=K(),c=e.key;function d(e){if(!c)return;let t=s.find(e=>e.column===c);t&&t.ascending===e?o(c):l(c,e)}return e.name,(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Y.DropdownMenu,{children:[(0,t.jsx)(Y.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(q.Button,{className:"opacity-50 flex",type:"text",style:{padding:"3px"},onClick:e=>{e.stopPropagation()},icon:(0,t.jsx)(k.ChevronDown,{})})}),(0,t.jsx)(Y.DropdownMenuContent,{align:"end",side:"bottom",children:(r=s.find(e=>e.column===c),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Y.DropdownMenuItem,{className:(0,z.cn)("space-x-2",r?.ascending&&"bg-surface-200 dark:bg-surface-400 text-foreground"),onClick:()=>d(!0),children:[(0,t.jsx)(A.ArrowUp,{size:14,strokeWidth:r?.ascending?3:1.5}),(0,t.jsx)("span",{children:"Sort Ascending"})]}),(0,t.jsxs)(Y.DropdownMenuItem,{className:(0,z.cn)("space-x-2",r&&!r.ascending&&"bg-surface-200 dark:bg-surface-400 text-foreground"),onClick:()=>d(!1),children:[(0,t.jsx)(R.ArrowDown,{size:14,strokeWidth:r&&!r.ascending?3:1.5}),(0,t.jsx)("span",{children:"Sort Descending"})]}),i.editable&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.DropdownMenuSeparator,{}),(0,t.jsxs)(O.Tooltip,{children:[(0,t.jsx)(O.TooltipTrigger,{asChild:!0,className:`${a?"opacity-50":""}`,children:(0,t.jsxs)(Y.DropdownMenuItem,{className:"space-x-2",onClick:function(){let t=i.originalTable.columns.find(t=>t.name===e.name);t&&n.onEditColumn(t)},disabled:a,children:[(0,t.jsx)(L.Edit,{size:14,strokeWidth:1.5}),(0,t.jsx)("span",{children:"Edit column"})]})}),a&&(0,t.jsx)(O.TooltipContent,{side:"bottom",children:"Encrypted columns cannot be edited"})]})]}),(0,t.jsx)(Y.DropdownMenuItem,{className:"space-x-2",onClick:e.frozen?function(){i.unfreezeColumn(c)}:function(){i.freezeColumn(c)},children:e.frozen?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.Unlock,{size:14,strokeWidth:1.5}),(0,t.jsx)("span",{children:"Unfreeze column"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.Lock,{size:14,strokeWidth:1.5}),(0,t.jsx)("span",{children:"Freeze column"})]})}),i.editable&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.DropdownMenuSeparator,{}),(0,t.jsxs)(Y.DropdownMenuItem,{className:"space-x-2",onClick:function(){let t=i.originalTable.columns.find(t=>t.name===e.name);t&&n.onDeleteColumn(t)},children:[(0,t.jsx)(F.Trash,{size:14,className:"text-destructive"}),(0,t.jsx)("span",{children:"Delete column"})]})]})]}))})]})})};function B({column:e,columnType:a,isPrimaryKey:r,isEncrypted:i,format:s,foreignKey:l,comment:o}){var c,d;let u=(0,E.useRef)(null),m=e.idx,h=e.key,p=(c=a,d=s,"array"==c?`${d.replace("_","")}[]`:d),g=ed();e.name;let f=(0,n.useColumnHasIndexSuggestion)(e.name),{openSheet:x}=(0,n.useTableIndexAdvisor)();(0,E.useEffect)(()=>{g.gridColumns[m]?.key!=h&&g.updateColumnIdx(h,m)},[h,m,g.gridColumns]);let[{isDragging:y},b]=(0,_.useDrag)({type:"column-header",item:()=>({key:h,index:m}),canDrag:()=>!e.frozen,collect:e=>({isDragging:e.isDragging()})}),[{handlerId:v},j]=(0,D.useDrop)({accept:"column-header",collect:e=>({handlerId:e.getHandlerId()}),hover(t,a){if(!u.current||e.frozen)return;let r=t.index,n=t.key;if(r===m)return;let i=u.current?.getBoundingClientRect(),s=(i.right-i.left)/2,l=a.getClientOffset().x-i.left;r<m&&l<s||r>m&&l>s||(g.moveColumn(n,h),t.index=m)}}),R=e.frozen?"sb-grid-column-header--cursor":"";return b(j(u)),(0,t.jsx)("div",{ref:u,"data-handler-id":v,style:{opacity:+!y},className:"w-full",children:(0,t.jsxs)("div",{className:`sb-grid-column-header ${R}`,children:[(0,t.jsxs)("div",{className:"sb-grid-column-header__inner",children:[function(e,a){let{name:r,foreignKey:n}=a;return"foreign_key"===e?(0,t.jsxs)(O.Tooltip,{children:[(0,t.jsx)(O.TooltipTrigger,{children:(0,t.jsx)(w.Link,{size:14,strokeWidth:2})}),(0,t.jsx)(O.TooltipContent,{side:"bottom",children:(0,t.jsxs)("div",{className:"font-normal",children:[(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)("p",{className:"text-xs !text-foreground",children:r}),(0,t.jsx)(S.ArrowRight,{size:14,strokeWidth:1.5,className:"!text-foreground-light"}),(0,t.jsxs)("p",{className:"text-xs !text-foreground",children:[n?.targetTableSchema,".",n?.targetTableName,".",n?.targetColumnName]})]}),n?.updateAction!==I.FOREIGN_KEY_CASCADE_ACTION.NO_ACTION&&(0,t.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On update: ",(0,P.getForeignKeyCascadeAction)(n?.updateAction)]}),n?.deletionAction!==I.FOREIGN_KEY_CASCADE_ACTION.NO_ACTION&&(0,t.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On delete: ",(0,P.getForeignKeyCascadeAction)(n?.deletionAction)]})]})})]}):null}(a,{name:e.name,foreignKey:l}),r&&(0,t.jsxs)(O.Tooltip,{children:[(0,t.jsx)(O.TooltipTrigger,{children:(0,t.jsx)("div",{className:"sb-grid-column-header__inner__primary-key",children:(0,t.jsx)(N.Key,{size:14,strokeWidth:2})})}),(0,t.jsx)(O.TooltipContent,{side:"bottom",className:"font-normal",children:"Primary key"})]}),(0,t.jsxs)(O.Tooltip,{children:[(0,t.jsx)(O.TooltipTrigger,{children:(0,t.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e.name})}),!!o&&(0,t.jsx)(O.TooltipContent,{side:"bottom",className:"max-w-xs text-center",children:o})]}),(0,t.jsxs)("span",{className:"sb-grid-column-header__inner__format",children:[p,"bytea"===p?" (hex)":""]}),i&&(0,t.jsxs)(O.Tooltip,{children:[(0,t.jsx)(O.TooltipTrigger,{children:(0,t.jsx)(T.Lock,{size:14,strokeWidth:2})}),(0,t.jsx)(O.TooltipContent,{side:"bottom",className:"font-normal",children:"Encrypted column"})]}),f&&(0,t.jsxs)(O.Tooltip,{children:[(0,t.jsx)(O.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"flex items-center",onClick:()=>x(e.name),children:(0,t.jsx)(C.Lightbulb,{size:14,strokeWidth:2,className:"!text-warning"})})}),(0,t.jsx)(O.TooltipContent,{side:"bottom",className:"font-normal",children:"Index might improve performance. Click for details."})]})]}),(0,t.jsx)(H,{column:e,isEncrypted:i})]})})}var Q=e.i(180148),V=e.i(591385),W=e.i(215312);let G={key:s.SELECT_COLUMN_KEY,name:"",idx:0,width:65,maxWidth:65,resizable:!1,sortable:!1,frozen:!0,isLastFrozenColumn:!1,renderHeaderCell:e=>{let[a,r]=(0,V.useRowSelection)();return(0,t.jsx)(Z,{"aria-label":"Select All",tabIndex:e.tabIndex,value:a,onChange:e=>r({type:"HEADER",checked:e})})},renderCell:e=>{let[a,r]=(0,V.useRowSelection)();return(0,t.jsx)(X,{"aria-label":"Select",tabIndex:e.tabIndex,value:a,row:e.row,onChange:(t,a)=>{r({type:"ROW",row:e.row,checked:t,isShiftClick:a})},onClick:J})},renderGroupCell:e=>{let[a,r]=(0,V.useRowSelection)();return(0,t.jsx)(X,{"aria-label":"Select Group",tabIndex:e.tabIndex,value:a,onChange:t=>{r({type:"ROW",row:e.row,checked:t,isShiftClick:!1})},onClick:J})},parent:void 0,level:0,minWidth:0,draggable:!1};function J(e){e.stopPropagation()}function X({row:e,value:a,tabIndex:r,disabled:n,onClick:i,onChange:s,"aria-label":l,"aria-labelledby":o}){let c=(0,U.useTableEditorStateSnapshot)();return(0,t.jsxs)("div",{className:"sb-grid-select-cell__formatter",children:[(0,t.jsx)("input",{"aria-label":l,"aria-labelledby":o,tabIndex:r,type:"checkbox",className:"rdg-row__select-column__select-action",disabled:n,checked:a,onChange:function(e){s(e.target.checked,e.nativeEvent.shiftKey)},onClick:i}),e&&(0,t.jsx)(W.ButtonTooltip,{type:"text",size:"tiny",className:"px-1 rdg-row__select-column__edit-action",icon:(0,t.jsx)(Q.Maximize2,{}),onClick:function(t){t.stopPropagation(),e&&c.onEditRow(e)},tooltip:{content:{side:"bottom",text:"Expand row"}}})]})}function Z({disabled:e,tabIndex:a,value:r,onChange:n,onClick:i,"aria-label":s,"aria-labelledby":l}){let o=ed(),c=(0,E.useRef)(null),d=o.selectedRows.size>0&&!o.allRowsSelected;return(0,E.useEffect)(()=>{c.current&&(c.current.indeterminate=d)},[d]),(0,t.jsx)("div",{className:"sb-grid-select-cell__header",children:(0,t.jsx)("input",{ref:c,"aria-label":s,"aria-labelledby":l,tabIndex:a,type:"checkbox",className:"sb-grid-select-cell__header__input",disabled:e,checked:r,onChange:function(e){n(e.target.checked,e.nativeEvent.shiftKey)},onClick:i})})}e.i(505572);var ee=e.i(859791),et=e.i(585673);let ea=9;function er(e,a){let r=[G,...e.columns.map((e,r)=>{let n=function(e){if((0,et.isForeignKeyColumn)(e))return"foreign_key";if((0,et.isNumericalColumn)(e.dataType))return"number";if((0,et.isArrayColumn)(e.dataType))return"array";if((0,et.isJsonColumn)(e.dataType))return"json";if((0,et.isTextColumn)(e.dataType))return"text";else if((0,et.isCiTextColumn)(e.format))return"citext";else if((0,et.isDateColumn)(e.format))return"date";else if((0,et.isTimeColumn)(e.format))return"time";else if((0,et.isDateTimeColumn)(e.format))return"datetime";else if((0,et.isBoolColumn)(e.dataType))return"boolean";else if((0,et.isEnumColumn)(e.dataType))return"enum";else if((0,et.isBinaryColumn)(e.dataType))return"binary";else return"unknown"}(e),i=en(e),j=(e.name.length+e.format.length)*ea,S=a?.defaultWidth?a.defaultWidth:i<j?j:i;return{key:e.name,name:e.name,idx:r+1,resizable:!0,sortable:!0,width:S,minWidth:s.COLUMN_MIN_WIDTH,frozen:e.isPrimaryKey||!1,isLastFrozenColumn:!1,renderHeaderCell:a=>(0,t.jsx)(B,{...a,columnType:n,isPrimaryKey:e.isPrimaryKey,isEncrypted:e.isEncrypted,format:e.format,foreignKey:e.foreignKey,comment:e.comment}),renderEditCell:a?function(e,a,r,n,i){if(!r)if(["array","json"].includes(a))return e=>(0,t.jsx)(u.JsonEditor,{...e,isEditable:r,onExpandEditor:n});else if(!["number","boolean"].includes(a))return e=>(0,t.jsx)(p.TextEditor,{...e,isEditable:r,onExpandEditor:i});else return;if(!e.isPrimaryKey&&e.isUpdatable)switch(a){case"boolean":return a=>(0,t.jsx)(c.BooleanEditor,{...a,isNullable:e.isNullable});case"date":return(0,d.DateTimeEditor)("date",e.isNullable||!1);case"datetime":return e.format.endsWith("z")?(0,d.DateTimeEditor)("datetimetz",e.isNullable||!1):(0,d.DateTimeEditor)("datetime",e.isNullable||!1);case"time":return e.format.endsWith("z")?g.TimeWithTimezoneEditor:g.TimeEditor;case"enum":{let a=e.enum.map(e=>({label:e,value:e}));return r=>(0,t.jsx)(h.SelectEditor,{...r,options:a,isNullable:e.isNullable})}case"array":case"json":return e=>(0,t.jsx)(u.JsonEditor,{...e,onExpandEditor:n});case"number":return m.NumberEditor;case"citext":case"text":return a=>(0,t.jsx)(p.TextEditor,{...a,isEditable:r,isNullable:e.isNullable,onExpandEditor:i});default:return}}(e,n,a?.editable??!1,a.onExpandJSONEditor,a.onExpandTextEditor):void 0,renderCell:function(e,a,r){var n;let i;switch(a){case"boolean":i=x.BooleanFormatter;break;case"foreign_key":i=e.isUpdatable?e=>(0,t.jsx)(b.ForeignKeyFormatter,{...e,tableId:r.tableId}):y.DefaultFormatter;break;case"binary":i=f.BinaryFormatter;break;case"json":i=v.JsonFormatter;break;default:i=y.DefaultFormatter}return n=i,function(a){let r=a.row[a.column.key];if((0,ee.isPendingAddRow)(a.row)&&(null==r||""===r)){if(void 0!==e.defaultValue&&null!==e.defaultValue||e.isIdentity||e.isGeneratable)return(0,t.jsx)(l.DefaultValue,{});if(e.isNullable)return(0,t.jsx)(o.NullValue,{})}return(0,t.jsx)(n,{...a})}}(e,n,{tableId:a?.tableId}),parent:void 0,level:0,maxWidth:void 0,draggable:!1}})];return a?.onAddColumn&&r.push(j.AddColumn),r}function en(e){return(0,et.isNumericalColumn)(e.dataType)?120:(0,et.isDateTimeColumn)(e.format)||(0,et.isDateColumn)(e.format)||(0,et.isTimeColumn)(e.format)?150:(0,et.isBoolColumn)(e.dataType)?120:(0,et.isEnumColumn)(e.dataType)?150:250}var ei=e.i(991435),es=e.i(416785),el=e.i(878594);let eo=(0,E.createContext)(void 0),ec=({children:e,projectRef:s,table:l,...o})=>{let c=(0,a.useFlag)("ShowIndexAdvisorOnTableEditor"),d=(0,U.useTableEditorStateSnapshot)(),u=(0,E.useRef)((({projectRef:e,table:t,editable:a=!0,onAddColumn:n,onExpandJSONEditor:s,onExpandTextEditor:l})=>{let o=(0,r.parseSupaTable)(t),c=(0,r.loadTableEditorStateFromLocalStorage)(e,o.id),d=(0,i.getInitialGridColumns)(er(o,{tableId:o.id,editable:a,onAddColumn:a?n:void 0,onExpandJSONEditor:s,onExpandTextEditor:l}),c),u=(0,ei.proxy)({table:o,originalTable:t,_originalTableRef:(0,ei.ref)(t),updateTable:e=>{let t=(0,r.parseSupaTable)(e),a=(0,i.getInitialGridColumns)(er(t,{tableId:e.id,editable:u.editable,onAddColumn:u.editable?n:void 0,onExpandJSONEditor:s,onExpandTextEditor:l}),{gridColumns:u.gridColumns});u.table=t,u.gridColumns=a,u.originalTable=e,u._originalTableRef=(0,ei.ref)(e)},selectedRows:(0,el.proxySet)(),allRowsSelected:!1,setSelectedRows:(e,t)=>{u.allRowsSelected=t??!1,u.selectedRows=(0,el.proxySet)(e)},resetSelectedRows:()=>{u.allRowsSelected=!1,u.selectedRows=(0,el.proxySet)(new Set)},gridColumns:d,moveColumn:(e,t)=>{let a=u.gridColumns.findIndex(t=>t.key===e),r=u.gridColumns.findIndex(e=>e.key===t),n=u.gridColumns[a];u.gridColumns.splice(a,1),u.gridColumns.splice(r,0,n)},updateColumnSize:(e,t)=>{u.gridColumns[e]&&(u.gridColumns[e].width=t)},freezeColumn:e=>{let t=u.gridColumns.findIndex(t=>t.key===e);u.gridColumns[t]&&(u.gridColumns[t].frozen=!0)},unfreezeColumn:e=>{let t=u.gridColumns.findIndex(t=>t.key===e);u.gridColumns[t]&&(u.gridColumns[t].frozen=!1)},updateColumnIdx:(e,t)=>{let a=u.gridColumns.findIndex(t=>t.key===e);u.gridColumns[a]&&(u.gridColumns[a].idx=t),u.gridColumns.sort((e,t)=>e.idx-t.idx)},selectedCellPosition:null,setSelectedCellPosition:e=>{u.selectedCellPosition=e},enforceExactCount:!1,setEnforceExactCount:e=>{u.enforceExactCount=e},page:1,setPage:e=>{u.page=e,u.setSelectedRows(new Set)},editable:a,setEditable:e=>{u.editable=e,u.gridColumns=(0,i.getInitialGridColumns)(er(u.table,{tableId:o.id,editable:e,onAddColumn:e?n:void 0,onExpandJSONEditor:s,onExpandTextEditor:l}),{gridColumns:u.gridColumns})},filters:[],setFilters:e=>{u.filters=e},clearFilters:()=>{u.filters=[]}});return u})({...o,projectRef:s,table:l,onAddColumn:d.onAddColumn,onExpandJSONEditor:(e,t)=>{d.onExpandJSONEditor({column:e,row:t,value:JSON.stringify(t[e])||""})},onExpandTextEditor:(e,t)=>{d.onExpandTextEditor(e,t)}})).current;return(0,E.useEffect)(()=>(0,ei.subscribe)(u,()=>{(0,r.saveTableEditorStateToLocalStorageDebounced)({gridColumns:u.gridColumns,projectRef:s,tableId:u.table.id})}),[]),(0,E.useEffect)(()=>{u._originalTableRef!==l&&u.updateTable(l)},[l]),(0,E.useEffect)(()=>{u.editable!==o.editable&&u.setEditable(o.editable??!0)},[o.editable,u]),(0,t.jsx)(eo.Provider,{value:u,children:c&&u.table.schema?(0,t.jsx)(n.TableIndexAdvisorProvider,{schema:u.table.schema??"public",table:u.table.name,children:e}):e})},ed=e=>{let t=(0,E.useContext)(eo);return(0,es.useSnapshot)(t,e)}},205311,e=>{"use strict";var t=e.i(478902),a=e.i(423782),r=e.i(874311);e.s(["DropdownControl",0,({children:e,side:n,align:i,options:s,onSelect:l,className:o})=>(0,t.jsxs)(r.DropdownMenu,{children:[(0,t.jsx)(r.DropdownMenuTrigger,{className:o,children:e}),(0,t.jsx)(r.DropdownMenuContent,{side:n,align:i,children:(0,t.jsxs)("div",{className:"dropdown-control",style:{maxHeight:"30vh"},children:[0===s.length&&(0,t.jsx)("p",{className:"dropdown-control__empty-text",children:"No more items"}),s.map(e=>(0,t.jsx)(a.DropdownMenuItemTooltip,{disabled:e.disabled,tooltip:{content:{side:"right",text:e.tooltip}},onClick:()=>l(e.value),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.preLabel&&(0,t.jsx)("span",{className:"grow text-foreground-lighter",children:e.preLabel}),(0,t.jsx)("span",{children:e.label}),e.postLabel&&(0,t.jsx)("span",{className:"text-foreground-lighter",children:e.postLabel})]})},e.value))]})})]})])},816232,e=>{"use strict";var t=e.i(478902),a=e.i(822574),r=e.i(532427),n=e.i(479232),i=e.i(389959),s=e.i(70255),l=e.i(837710),o=e.i(793912),c=e.i(162530),d=e.i(135144),u=e.i(689805),m=e.i(88816),h=e.i(975924),p=e.i(205311),g=e.i(171997),f=e.i(198512);let x=(0,i.memo)(({filter:e,filterIdx:a,onChange:r,onDelete:n,onKeyDown:i})=>{let o=(0,s.useTableEditorTableStateSnapshot)(),c=o.table.columns.find(t=>t.name===e.column),d=o.table.columns?.map(e=>({value:e.name,label:e.name,postLabel:e.dataType}))||[],u=c?.format==="timestamptz"?"yyyy-mm-dd hh:mm:ss+zz":c?.format==="timestamp"?"yyyy-mm-dd hh:mm:ss":"Enter a value";return(0,t.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-1 px-3",children:[(0,t.jsx)(p.DropdownControl,{align:"start",options:d,onSelect:t=>r(a,{...e,column:t}),children:(0,t.jsx)(l.Button,{asChild:!0,type:"outline",icon:(0,t.jsx)("div",{className:"text-foreground-lighter",children:(0,t.jsx)(m.ChevronDown,{strokeWidth:1.5})}),className:"w-32 justify-start",children:(0,t.jsx)("span",{children:c?.name??""})})}),(0,t.jsx)(p.DropdownControl,{align:"start",options:f.FilterOperatorOptions,onSelect:t=>r(a,{...e,operator:t}),children:(0,t.jsx)(l.Button,{asChild:!0,type:"outline",icon:(0,t.jsx)("div",{className:"text-foreground-lighter",children:(0,t.jsx)(m.ChevronDown,{strokeWidth:1.5})}),children:(0,t.jsx)("span",{children:e.operator})})}),(0,t.jsx)(g.Input,{size:"tiny",className:"w-full",placeholder:u,value:e.value,onChange:t=>r(a,{...e,value:t.target.value}),onKeyDown:i}),(0,t.jsx)(l.Button,{type:"text",className:"px-1",icon:(0,t.jsx)(h.X,{strokeWidth:1.5}),onClick:()=>n(a)})]})});e.s(["FilterPopoverPrimitive",0,({buttonText:e,filters:m,onApplyFilters:h})=>{let[p,g]=(0,i.useState)(!1),f=(0,s.useTableEditorTableStateSnapshot)(),[y,b]=(0,i.useState)(m);(0,i.useMemo)(()=>{b(m)},[m]);let v=e??(m.length>0?`Filtered by ${m.length} rule${m.length>1?"s":""}`:"Filter"),j=(0,i.useCallback)((e,t)=>{b(a=>[...a.slice(0,e),t,...a.slice(e+1)])},[]),S=(0,i.useCallback)(e=>{b(t=>[...t.slice(0,e),...t.slice(e+1)])},[]),N=()=>{let e=y.map(e=>{let t=f.table.columns.find(t=>t.name===e.column);return t?.format==="uuid"?{...e,value:e.value.trim()}:e});b(e),h(e)};function C(e){"Enter"===e.key&&N()}return(0,t.jsxs)(u.Popover_Shadcn_,{open:p,onOpenChange:g,modal:!1,children:[(0,t.jsx)(d.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(l.Button,{type:m.length>0?"link":"text",icon:(0,t.jsx)(r.Filter,{}),children:v})}),(0,t.jsx)(o.PopoverContent_Shadcn_,{className:"p-0 w-96",side:"bottom",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2 py-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[y.map((e,a)=>(0,t.jsx)(x,{filter:e,filterIdx:a,onChange:j,onDelete:S,onKeyDown:C},`filter-${e.column}-${[a]}`)),0==y.length&&(0,t.jsxs)("div",{className:"space-y-1 px-3",children:[(0,t.jsx)("h5",{className:"text-xs text-foreground-light",children:"No filters applied to this view"}),(0,t.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to filter the view"})]})]}),(0,t.jsx)(c.PopoverSeparator_Shadcn_,{}),(0,t.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[(0,t.jsx)(l.Button,{icon:(0,t.jsx)(n.Plus,{}),type:"dashed",onClick:()=>{let e=f.table.columns[0]?.name;e&&b([...y,{column:e,operator:"=",value:""}])},children:"Add filter"}),(0,t.jsx)(l.Button,{disabled:(0,a.default)(y,m),type:"default",onClick:()=>N(),children:"Apply filter"})]})]})})]})}],816232)},632459,e=>{"use strict";var t=e.i(19583),a=e.i(200722),r=e.i(389959);function n(){let{filters:e,setParams:n}=(0,a.useTableEditorFiltersSort)(),i=(0,t.formatFilterURLParams)(e);return{filters:i,urlFilters:e,onApplyFilters:(0,r.useCallback)(e=>{let a=(0,t.filtersToUrlParams)(e);n(e=>({...e,filter:a}))},[n]),clearFilters:(0,r.useCallback)(()=>{n(e=>({...e,filter:[]}))},[n])}}e.s(["useTableFilter",()=>n])},437893,e=>{"use strict";e.i(967533);var t=e.i(721490),a=e.i(899850),r=e.i(242882),n=e.i(356003),i=e.i(19583),s=e.i(415190),l=e.i(908937),o=e.i(201461),c=e.i(714403),d=e.i(790819),u=e.i(46974);async function m({queryClient:e,projectRef:r,connectionString:n,tableId:d,filters:m,roleImpersonationState:h,enforceExactCount:p},g){let f=await (0,s.prefetchTableEditor)(e,{projectRef:r,connectionString:n,id:d});if(!f)throw Error("Table not found");let x=(0,i.parseSupaTable)(f),y=(0,l.wrapWithRoleImpersonation)((({table:e,filters:r=[],enforceExactCount:n=!1})=>{if(!e)return"";if(n){let a=new t.Query().from(e.name,e.schema??void 0).count();return r.filter(e=>e.value&&""!==e.value).forEach(t=>{let r=(0,u.formatFilterValue)(e,t);a=a.filter(t.column,t.operator,r)}),`select (${a.toSql().slice(0,-1)}), false as is_estimate;`}{let n=new t.Query().from(e.name,e.schema??void 0).select("*");r.filter(e=>e.value&&""!=e.value).forEach(t=>{let a=(0,u.formatFilterValue)(e,t);n=n.filter(t.column,t.operator,a)});let i=n.toSql(),s=new t.Query().from(e.name,e.schema??void 0).count();r.filter(e=>e.value&&""!=e.value).forEach(t=>{let a=(0,u.formatFilterValue)(e,t);s=s.filter(t.column,t.operator,a)});let l=s.toSql().slice(0,-1);return`
${a.COUNT_ESTIMATE_SQL}

with approximation as (
    select reltuples as estimate
    from pg_class
    where oid = ${e.id}
)
select 
  case 
    when estimate = -1 then (select pg_temp.count_estimate('${i.replaceAll("'","''")}'))
    when estimate > ${a.THRESHOLD_COUNT} then ${r.length>0?`pg_temp.count_estimate('${i.replaceAll("'","''")}')`:"estimate"}
    else (${l})
  end as count,
  estimate = -1 or estimate > ${a.THRESHOLD_COUNT} as is_estimate
from approximation;
`.trim()}})({table:x,filters:m,enforceExactCount:p}),h),{result:b}=await (0,c.executeSql)({projectRef:r,connectionString:n,sql:y,queryKey:["table-rows-count",x.id],isRoleImpersonationEnabled:(0,o.isRoleImpersonationEnabled)(h?.role)},g);return{count:b?.[0]?.count,is_estimate:b?.[0]?.is_estimate??!1}}e.s(["useTableRowsCountQuery",0,({projectRef:e,connectionString:t,tableId:a,...i},{enabled:s=!0,...l}={})=>{let o=(0,n.useQueryClient)();return(0,r.useQuery)({queryKey:d.tableRowKeys.tableRowsCount(e,{table:{id:a},...i}),queryFn:({signal:r})=>m({queryClient:o,projectRef:e,connectionString:t,tableId:a,...i},r),enabled:s&&void 0!==e&&void 0!==a,...l})}])},626915,e=>{"use strict";var t=e.i(478902),a=e.i(310959),r=e.i(201844);e.i(128328);var n=e.i(158639),i=e.i(632459),s=e.i(937942),l=e.i(437893),o=e.i(635494),c=e.i(822574),d=e.i(88816),u=e.i(738225),m=e.i(389959),h=e.i(201461),p=e.i(70255),g=e.i(837710),f=e.i(793912),x=e.i(162530),y=e.i(135144),b=e.i(689805),v=e.i(466472),j=e.i(205311),S=e.i(799034),N=e.i(975924),C=e.i(242533),w=e.i(736404),T=e.i(290811);let E=(0,m.memo)(({index:e,columnName:a,sort:r,onDelete:n,onToggle:i,onDrag:s})=>{let l=(0,p.useTableEditorTableStateSnapshot)().table.columns.find(e=>e.name===a),o=(0,m.useRef)(null),[{isDragging:c},d]=(0,C.useDrag)({type:"sort-row",item:()=>({key:a,index:e}),collect:e=>({isDragging:e.isDragging()})}),[{handlerId:u},h]=(0,w.useDrop)({accept:"sort-row",collect:e=>({handlerId:e.getHandlerId()}),hover(t,a){if(!o.current)return;let r=t.index;if(r===e)return;let n=o.current?.getBoundingClientRect(),i=(n.bottom-n.top)/2,s=a.getClientOffset().y-n.top;r<e&&s<i||r>e&&s>i||(f(r,e),t.index=e)}}),f=(e,t)=>{e!=t&&s(e,t)};return(d(h(o)),l)?(0,t.jsxs)("div",{className:"flex items-center gap-3 px-3",ref:o,style:{opacity:+!c},"data-handler-id":u,children:[(0,t.jsx)("span",{className:"transition-color text-foreground-lighter hover:text-foreground-light",children:(0,t.jsx)(S.Menu,{strokeWidth:2,size:16})}),(0,t.jsx)("div",{className:"grow",children:(0,t.jsxs)("span",{className:"flex grow items-center gap-1 truncate text-sm text-foreground",children:[(0,t.jsx)("span",{className:"text-xs text-foreground-lighter",children:e>0?"then by":"sort by"}),(0,t.jsx)("span",{className:"text-xs",children:l.name})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,t.jsx)("label",{className:"text-xs text-foreground-lighter",children:"ascending:"}),(0,t.jsx)(T.Switch,{defaultChecked:r.ascending,onCheckedChange:e=>i(a,e)})]}),(0,t.jsx)(g.Button,{icon:(0,t.jsx)(N.X,{strokeWidth:1.5}),size:"tiny",type:"text",className:"w-7",onClick:()=>n(a)})]}):null});e.s(["SortPopoverPrimitive",0,({buttonText:e,sorts:S,onApplySorts:N,defaultOpen:C=!1,tableQueriesEnabled:w=!0})=>{let{ref:T}=(0,n.useParams)(),{filters:_}=(0,i.useTableFilter)(),{data:D}=(0,o.useSelectedProjectQuery)(),P=(0,h.useRoleImpersonationStateSnapshot)(),I=(0,p.useTableEditorTableStateSnapshot)(),O=I.table?.name||"",R=I.table.schema||"",[A,k]=(0,m.useState)(C),[L,F]=(0,m.useState)(!1),[M,$]=(0,m.useState)(S),K=(0,m.useRef)(S),U=(0,m.useRef)(!1),{data:q}=(0,l.useTableRowsCountQuery)({projectRef:D?.ref,connectionString:D?.connectionString,tableId:I.table.id,filters:_,enforceExactCount:I.enforceExactCount,roleImpersonationState:P},{placeholderData:r.keepPreviousData,enabled:w}),z=(q?.count??0)>a.THRESHOLD_COUNT,Y=e??(M.length>0?`Sorted by ${M.length} rule${M.length>1?"s":""}`:"Sort"),H=(0,m.useMemo)(()=>I?.table?.columns?I.table.columns.filter(e=>!M.find(t=>t.column==e.name)):[],[I?.table?.columns,M]),B=(0,m.useMemo)(()=>H?.map(e=>({value:e.name,label:e.name,postLabel:e.dataType,disabled:"json"===e.dataType||"jsonb"===e.dataType,tooltip:"json"===e.dataType||"jsonb"===e.dataType?"Sorting on JSON-based columns is currently not supported":""}))||[],[H]),Q=(0,m.useCallback)(e=>{$(t=>t.filter(t=>t.column!==e))},[]),V=(0,m.useCallback)((e,t)=>{$(a=>{let r=a.findIndex(t=>t.column===e);if(-1===r)return a;let n={...a[r],ascending:t};return[...a.slice(0,r),n,...a.slice(r+1)]})},[]),W=(0,m.useCallback)((e,t)=>{$(a=>{if(e<0||e>=a.length||t<0||t>=a.length)return a;let r=a[e],n=[...a.slice(0,e),...a.slice(e+1)];return[...n.slice(0,t),r,...n.slice(t)]})},[]),G=(0,m.useMemo)(()=>M.length!==S.length||M.some((e,t)=>{let a=S[t];return!a||e.column!==a.column||e.ascending!==a.ascending}),[M,S]),J=()=>{U.current=!0,K.current=[...M],N(M.map(e=>({...e})))};return(0,m.useEffect)(()=>{if(U.current){U.current=!1;return}(0,c.default)(S,K.current)||($(S),K.current=S)},[S]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(b.Popover_Shadcn_,{modal:!1,open:A,onOpenChange:k,children:[(0,t.jsx)(y.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(g.Button,{type:M.length>0?"link":"text",icon:(0,t.jsx)(u.List,{}),children:Y})}),(0,t.jsx)(f.PopoverContent_Shadcn_,{className:"p-0 w-96",side:"bottom",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2 py-2",children:[M.map((e,a)=>(0,t.jsx)(E,{index:a,columnName:e.column,sort:e,onDelete:Q,onToggle:V,onDrag:W},`sort-${e.table}-${e.column}-${a}`)),0===M.length&&(0,t.jsxs)("div",{className:"space-y-1 px-3",children:[(0,t.jsx)("h5",{className:"text-xs text-foreground-light",children:"No sorts applied to this view"}),(0,t.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to sort the view"})]}),(0,t.jsx)(x.PopoverSeparator_Shadcn_,{}),(0,t.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[B&&B.length>0?(0,t.jsx)(j.DropdownControl,{options:B,onSelect:e=>{let t=I.table?.name;t&&$([...M,{table:t,column:e,ascending:!0}])},side:"bottom",align:"start",children:(0,t.jsx)(g.Button,{asChild:!0,type:"dashed",iconRight:(0,t.jsx)(d.ChevronDown,{size:"14",className:"text-foreground-light"}),className:"sb-grid-dropdown__item-trigger","data-testid":"table-editor-pick-column-to-sort-button",children:(0,t.jsxs)("span",{children:["Pick ",M.length>1?"another":"a"," column to sort by"]})})}):(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"All columns have been added"}),(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)(g.Button,{disabled:!G,type:"default",onClick:()=>{if(z&&M.length>0&&M.some(e=>!I.table.columns.find(t=>e.column===t.name)?.isPrimaryKey))return F(!0);J()},children:"Apply sorting"})})]})]})})]}),(0,t.jsx)(v.default,{size:"medium",variant:"warning",visible:L,confirmLabel:"Confirm",title:"Sorting on a large table",onConfirm:()=>{J(),F(!1)},onCancel:()=>{$(S),F(!1)},alert:{base:{variant:"warning"},title:"Be careful with sorting on unindexed columns",description:"This may adversely impact your database, in particular if your table has a large number of rows - use with caution."},children:(0,t.jsxs)("p",{className:"text-foreground-light text-sm",children:["We highly recommend only sorting on columns which are"," ",(0,t.jsx)(s.InlineLink,{href:`/project/${T}/database/indexes?search=${O}&schema=${R}`,children:"indexed"}),", such as your primary key columns."]})})]})}],626915)},33883,825613,831536,888970,608971,e=>{"use strict";var t=e.i(478902),a=e.i(774803),r=e.i(975924),n=e.i(389959),i=e.i(595519),s=e.i(276423),l=e.i(201844);e.i(128328);var o=e.i(158639),c=e.i(19583),d=e.i(847948),u=e.i(816232),m=e.i(626915),h=e.i(415190),p=e.i(70756),g=e.i(635494),f=e.i(201461),x=e.i(70255),y=e.i(837710),b=e.i(539013),v=e.i(328675),j=e.i(585915),S=e.i(3036),N=e.i(710377);let C=({page:e,setPage:a,rowsPerPage:r,currentPageRowsCount:n=0,isLoading:i=!1})=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[i&&(0,t.jsx)(j.Loader,{size:14,className:"animate-spin"}),(0,t.jsx)(y.Button,{icon:(0,t.jsx)(S.ArrowLeft,{}),type:"outline",disabled:e<=1||i,onClick:()=>{a(e=>e-1)},title:"Previous Page",style:{padding:"3px 10px"}}),(0,t.jsx)(y.Button,{icon:(0,t.jsx)(N.ArrowRight,{}),type:"outline",disabled:n<r||i,onClick:()=>{a(e=>e+1)},title:"Next Page",style:{padding:"3px 10px"}})]});var w=e.i(546024),T=e.i(591385),E=e.i(163989),_=e.i(701275),D=e.i(680418),P=e.i(613580);let I=({rows:e,onRowSelect:a})=>{let r=(0,x.useTableEditorTableStateSnapshot)().table.columns.map(e=>{let a=(0,D.getColumnDefaultWidth)(e),r=(e.name.length+e.format.length)*D.ESTIMATED_CHARACTER_PIXEL_WIDTH;return{key:e.name,name:e.name,renderCell:a=>(({column:e,format:a,row:r})=>{let n="bytea"===a?(0,v.convertByteaToHex)(r[e]):null===r[e]?null:"object"==typeof r[e]?JSON.stringify(r[e]):r[e];return(0,t.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden",children:null===n?(0,t.jsx)(E.NullValue,{}):(0,t.jsx)("span",{className:"text-sm truncate",children:n})})})({column:e.name,format:e.format,row:a.row}),renderHeaderCell:()=>((e,a=!1)=>(0,t.jsxs)("div",{className:"flex h-full items-center justify-center gap-2",children:[a&&(0,t.jsxs)(P.Tooltip,{children:[(0,t.jsx)(P.TooltipTrigger,{children:(0,t.jsx)("div",{className:"text-brand",children:(0,t.jsx)(w.Key,{size:14,strokeWidth:2})})}),(0,t.jsx)(P.TooltipContent,{side:"bottom",children:"Primary key"})]}),(0,t.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]}))(e.name,e.isPrimaryKey),resizable:!0,width:a<r?r:a,minWidth:_.COLUMN_MIN_WIDTH}});return(0,t.jsx)(T.default,{columns:r,rows:e,style:{height:"100%"},onCellClick:e=>a(e.row),rowClass:()=>"cursor-pointer"})},O=({visible:e,foreignKey:j,isSaving:S,onSelect:N,closePanel:w})=>{let{id:T}=(0,o.useParams)(),{data:E}=(0,g.useSelectedProjectQuery)(),{data:_}=(0,h.useTableEditorQuery)({projectRef:E?.ref,connectionString:E?.connectionString,id:T?Number(T):void 0}),{tableId:D,schema:P,table:O,columns:R}=j??{},A=D?Number(D):void 0,k=(_?.columns??[]).find(e=>e.name===R?.[0].source),L=1===(R??[]).length&&k?.is_nullable,{data:F}=(0,h.useTableEditorQuery)({projectRef:E?.ref,connectionString:E?.connectionString,id:A}),[{sort:M,filter:$},K]=(0,n.useState)({filter:[],sort:[]}),[U,q]=(0,n.useState)(1),z=(0,f.useRoleImpersonationStateSnapshot)(),{data:Y,isPending:H,isSuccess:B,isError:Q,isRefetching:V}=(0,p.useTableRowsQuery)({projectRef:E?.ref,connectionString:E?.connectionString,tableId:F?.id,sorts:M,filters:$,page:U,limit:100,roleImpersonationState:z},{placeholderData:l.keepPreviousData}),[W,G]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(E?.ref&&F?.name&&F?.schema)try{let e=(0,c.loadTableEditorStateFromLocalStorage)(E.ref,F.id),t=e?.sorts??[],a=(0,c.formatSortURLParams)(F.name,t);a.length>0&&K(e=>({...e,sort:a}))}catch(e){console.error(e)}finally{G(!0)}},[E?.ref,F?.schema,F?.name,F?.id]),(0,n.useEffect)(()=>{if(E?.ref&&F?.id&&W)try{let e=(0,c.sortsToUrlParams)(M);(0,c.saveTableEditorStateToLocalStorage)({projectRef:E.ref,tableId:F.id,sorts:e})}catch(e){console.error(e)}},[W,M,E?.ref,F?.id]),(0,t.jsx)(b.SidePanel,{hideFooter:!0,visible:e,size:"large",header:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{children:["Select a record to reference from"," ",(0,t.jsxs)("code",{className:"text-code-inline !text-sm",children:[P,".",O]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-4",children:[S&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(a.Loader2,{className:"animate-spin",size:12}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Saving"})]}),(0,t.jsx)(y.Button,{type:"text",icon:(0,t.jsx)(r.X,{}),className:"w-7",onClick:w})]})]}),onCancel:w,children:(0,t.jsx)(b.SidePanel.Content,{className:"h-full !px-0",children:(0,t.jsxs)("div",{className:"h-full",children:[H&&(0,t.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,t.jsx)(a.Loader2,{size:14,className:"animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading rows"})]}),Q&&(0,t.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:["Unable to load rows from"," ",(0,t.jsxs)("code",{children:[P,".",O]}),". Please try again or contact support."]})}),E?.ref&&F&&B&&(0,t.jsx)(x.TableEditorTableStateContextProvider,{projectRef:E.ref,table:F,editable:!1,children:(0,t.jsxs)("div",{className:"h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(d.RefreshButton,{tableId:F?.id,isRefetching:V}),(0,t.jsx)(u.FilterPopoverPrimitive,{filters:$,onApplyFilters:e=>{U>1&&q(1),K(t=>({...t,filter:e}))}}),(0,t.jsx)(i.DndProvider,{backend:s.HTML5Backend,context:window,children:(0,t.jsx)(m.SortPopoverPrimitive,{sorts:M,onApplySorts:e=>{K(t=>({...t,sort:e}))}})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-3 divide-x",children:[(0,t.jsx)(C,{page:U,setPage:q,rowsPerPage:100,currentPageRowsCount:Y?.rows.length??0,isLoading:V}),L&&(0,t.jsx)("div",{className:"pl-3",children:(0,t.jsx)(y.Button,{type:"default",onClick:()=>{R?.length===1&&N({[R[0].source]:null})},children:"Set NULL"})})]})]}),Y.rows.length>0?(0,t.jsx)(I,{rows:Y.rows,onRowSelect:e=>{S||N(R?.reduce((t,a)=>{let r=_?.columns.find(e=>e.name===a.target),n=r?.format==="bytea"?(0,v.convertByteaToHex)(e[a.target]):e[a.target];return{...t,[a.source]:n}},{}))}}):(0,t.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-default",children:(0,t.jsx)("span",{className:"text-foreground-light text-sm",children:"No Rows Found"})})]})})]})})})};e.s(["ForeignRowSelector",0,O],33883);var R=e.i(310959),A=e.i(419524),k=e.i(355901),L=e.i(215312),F=e.i(425861),M=e.i(962217),$=e.i(605283),K=e.i(48189),U=e.i(843778),q=e.i(973512),z=e.i(666050),Y=e.i(721255),H=e.i(199327),B=e.i(416050);let Q=({breadcrumbs:e=[],resetBreadcrumbs:a,onSelectBreadcrumb:r})=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(H.Home,{size:16,strokeWidth:2,onClick:()=>a(),className:"cursor-pointer"}),e.length>0&&e.map(a=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(B.ChevronRight,{size:16,strokeWidth:2}),a===(0,Y.default)(e)?(0,t.jsx)("p",{className:"font-mono text-xs",children:a}):(0,t.jsx)("p",{className:"font-mono text-xs",children:(0,t.jsx)("div",{className:"cursor-pointer",onClick:()=>r(e.slice(0,e.indexOf(a)+1)),children:a})})]},a))]});var V=e.i(721329),W=e.i(964727);let G=({pane:e,jsonData:a,activeKey:r,onSelectKey:n=W.default})=>{if(!a)return(0,t.jsx)("div",{className:`flex-1 ${2===e?"border-l border-default":""}`,children:(0,t.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,t.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(a).length)return(0,t.jsx)("div",{className:`max-w-[50%] flex-1 ${2===e?"border-l border-default":""}`,children:(0,t.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,t.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});let i=Object.keys(a).filter(e=>"object"==typeof a[e]&&!(0,V.default)(a[e])),s=Object.keys(a).filter(e=>(0,V.default)(a[e])||"object"!=typeof a[e]);return(0,t.jsxs)("div",{className:`max-w-[50%] flex-1 ${2===e?"border-l border-default":""}`,children:[i.map(a=>(0,t.jsxs)("div",{className:`
              ${a===r?"bg-surface-300":""}
              group flex cursor-pointer items-center transition
              justify-between py-2 px-5 hover:bg-surface-200
            `,onClick:()=>n(a,e),children:[(0,t.jsx)("p",{className:"font-mono text-xs !text-blue-900",children:a}),(0,t.jsx)("div",{className:`${a===r?"opacity-100":"opacity-50"} group-hover:opacity-100 transition`,children:(0,t.jsx)(B.ChevronRight,{strokeWidth:2,size:16})})]},a)),s.map(e=>(0,t.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,t.jsxs)("p",{className:"font-mono text-xs !text-blue-900",children:[e,":"]}),(0,t.jsx)("p",{className:`break-all font-mono text-xs ${"string"!=typeof a[e]?"!text-green-900":"!text-yellow-900"}`,children:(0,V.default)(a[e])?"null":"string"==typeof a[e]?`"${a[e]}"`:a[e].toString()})]},e))]})},J=({jsonData:e={}})=>{let[a,r]=(0,n.useState)(),[i,s]=(0,n.useState)([]),[l,o]=(0,n.useState)(e),[c,d]=(0,n.useState)({}),u=(e,t)=>{r(e);let a=i.slice();1===t&&(d(l[e]),(0,z.default)(c)||a.pop(),a.push(e),s(a)),2===t&&(o(c),d(c[e]),a.push(e),s(a))};return(0,t.jsxs)("div",{className:"border border-x-0 border-t-0 border-muted",children:[(0,t.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,t.jsx)(Q,{breadcrumbs:i,onSelectBreadcrumb:t=>{let a=(0,Y.default)(t)||"";r(a);let n={...e};if(s(i.slice(0,i.indexOf(a)+1)),null===t)o(n),d({});else if(1===t.length)o(n),d(e[i[0]]);else{for(let e of t)n=n[e],t.indexOf(e)===t.length-2&&o(n);d(n)}},resetBreadcrumbs:()=>{r(void 0),s([]),o(e),d({})}})}),(0,t.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-muted",children:[(0,t.jsx)(G,{pane:1,jsonData:l,onSelectKey:u,activeKey:a}),(0,t.jsx)(G,{pane:2,jsonData:c,onSelectKey:u})]})]})};var X=e.i(156054),Z=W;let ee=({value:e="",readOnly:a=!1,onInputChange:r=Z.default})=>(0,t.jsx)(X.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:"json",value:e,loading:(0,t.jsx)("h4",{children:"Loading"}),options:{readOnly:a,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:r}),et=({row:e,column:a,visible:r,backButtonLabel:i,applyButtonLabel:s,readOnly:l=!1,closePanel:c,onSaveJSON:d})=>{let{id:u}=(0,o.useParams)(),m=u?Number(u):void 0,{data:p}=(0,g.useSelectedProjectQuery)(),{data:f}=(0,h.useTableEditorQuery)({projectRef:p?.ref,connectionString:p?.connectionString,id:m}),[x,j]=(0,n.useState)("edit"),[S,N]=(0,n.useState)(""),C=e?.[a],w="object"==typeof C?JSON.stringify(C):C,T=(0,v.isValueTruncated)(w),{mutate:E,isPending:_,isSuccess:D,reset:P}=(0,$.useGetCellValueMutation)(),I=async e=>{try{let t=(0,K.removeJSONTrailingComma)(S),a=(0,K.minifyJSON)(t);d&&d(a,e)}catch(t){e(),k.toast.error("JSON seems to have an invalid structure.")}};(0,n.useEffect)(()=>{r&&N((0,K.prettifyJSON)(w))},[r]);let O=(0,n.useCallback)(()=>{P(),c()},[P]);return(0,t.jsx)(b.SidePanel,{size:"large",header:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===x?(0,t.jsxs)("p",{children:[l?"Viewing":"Editing"," value of: ",(0,t.jsx)("code",{children:a})]}):(0,t.jsxs)("p",{children:["Viewing value of: ",(0,t.jsx)("code",{children:a})]}),(!T||T&&D)&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:["edit"===x&&(0,t.jsx)(L.ButtonTooltip,{type:"default",icon:(0,t.jsx)(A.AlignLeft,{}),className:"px-1",onClick:()=>void N((0,K.prettifyJSON)(S)),tooltip:{content:{side:"bottom",text:"Prettify JSON"}}}),(0,t.jsx)(F.default,{options:["view","edit"],activeOption:x,borderOverride:"border-muted",onClickOption:j})]})]}),visible:r,onCancel:O,customFooter:(0,t.jsx)(q.ActionBar,{hideApply:l,closePanel:O,backButtonLabel:i,applyButtonLabel:s,applyFunction:l?void 0:I}),children:(0,t.jsxs)("div",{className:"flex flex-auto h-full flex-col gap-y-4 relative",children:["edit"===x?(0,t.jsx)("div",{className:"w-full h-full flex-grow",children:(0,t.jsx)(ee,{readOnly:l,onInputChange:e=>N(e??""),value:S.toString()},w)}):(0,t.jsx)(J,{jsonData:(0,K.tryParseJson)(S)}),T&&!D&&(0,t.jsxs)("div",{className:(0,U.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,t.jsxs)("p",{children:["JSON value is larger than ",R.MAX_CHARACTERS.toLocaleString()," characters"]}),(0,t.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire JSON value, but your browser may run into performance issues"})]}),(0,t.jsx)(y.Button,{type:"default",loading:_,onClick:()=>{if(void 0===f||void 0===p||void 0===e||!(0,M.isTableLike)(f))return;if(0===f.primary_keys.length)return(0,k.toast)("Unable to load value as table has no primary keys");let t=f.primary_keys.reduce((t,a)=>({...t,[a.name]:e[a.name]}),{});E({table:{schema:f.schema,name:f.name},column:a,pkMatch:t,projectRef:p?.ref,connectionString:p?.connectionString},{onSuccess:e=>{void 0!==e&&N(JSON.stringify(e))}})},children:"Load full JSON data"})]})]})})};e.s(["JsonEditor",0,et],825613);var ea=e.i(471994),er=W,en=e.i(667852),ei=e.i(687256);let es=({isNewRecord:e,tableName:a})=>{let r=`${e?"Add new":"Update"} row ${e?"to":"from"} `;return(0,t.jsxs)(t.Fragment,{children:[r,a&&(0,t.jsx)("span",{className:"text-code font-mono",children:a})]})};var el=e.i(702454),eo=W,ec=e.i(53071),ed=e.i(543851),eu=e.i(874311),em=e.i(171997),eh=e.i(384429),ep=e.i(449123),eg=e.i(451031),ef=e.i(57492),ex=e.i(831927),ey=e.i(156722),eb=e.i(719754),ev=e.i(538482),ej=e.i(707409),eS=e.i(55956);let eN=({value:e,onChange:a,name:r,isNullable:n,format:i,description:s,disabled:l=!1})=>{let o=function(e){var t,a,r;if(t=e,ej.DATE_TYPES.indexOf(t.toLowerCase())>-1)return"date";if(a=e,ej.TIME_TYPES.indexOf(a.toLowerCase())>-1)return"time";return(r=e,ej.TIMESTAMP_TYPES.indexOf(r.toLowerCase())>-1)?"datetime-local":"text"}(i);return(0,t.jsx)(em.Input,{layout:"horizontal",className:(0,U.cn)("w-full [&>div>div>div>input]:pr-10"),label:r,descriptionText:(0,t.jsxs)("div",{className:"space-y-1",children:[s,i.includes("tz")&&(0,t.jsxs)("p",{children:["Your local timezone will be automatically applied (",(0,eS.default)().format("ZZ"),")"]})]}),labelOptional:i,size:"small",value:e,type:o,step:"datetime-local"==o||"time"==o?"1":void 0,actions:!l&&(0,t.jsxs)(eu.DropdownMenu,{children:[(0,t.jsx)(eu.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(y.Button,{type:"default",icon:(0,t.jsx)(ec.Edit,{}),className:"px-1.5"})}),(0,t.jsxs)(eu.DropdownMenuContent,{align:"end",className:"w-28 pointer-events-auto",children:[n&&(0,t.jsx)(eu.DropdownMenuItem,{onClick:()=>a(""),children:"Set to NULL"}),(0,t.jsx)(eu.DropdownMenuItem,{onClick:()=>a((0,eS.default)().format("date"===i?"YYYY-MM-DD":["time","timetz"].includes(i)?"HH:mm:ss":"YYYY-MM-DDTHH:mm:ss")),children:"Set to now"})]})]}),onChange:e=>a(e.target.value),disabled:l})},eC="Note: Value is too large to be rendered in the dashboard. Please expand the editor to edit the value",ew=({field:e,errors:a,isEditable:r=!0,onUpdateField:n=eo.default,onEditJson:i=eo.default,onEditText:s=eo.default,onSelectForeignKey:l=eo.default})=>{if(e.enums.length>0)return"_"===e.format[0]?(0,t.jsx)("div",{className:"text-area-text-sm",children:(0,t.jsx)(em.Input.TextArea,{"data-testid":`${e.name}-input`,layout:"horizontal",label:e.name,className:"text-sm",descriptionText:e.comment,labelOptional:e.format,disabled:!r,error:a[e.name],rows:5,value:e.value??"",placeholder:null===e.defaultValue?"":"string"==typeof e.defaultValue&&0===e.defaultValue.length?"EMPTY":`Default: ${e.defaultValue}`,onChange:t=>n({[e.name]:t.target.value})})}):(0,t.jsxs)(eh.Select,{size:"medium",layout:"horizontal",value:e.value??"",label:e.name,labelOptional:e.format,descriptionText:e.comment,disabled:!r,error:a[e.name],onChange:t=>n({[e.name]:t.target.value}),children:[(0,t.jsx)(eh.Select.Option,{value:"",children:"---"}),e.enums.map(e=>(0,t.jsx)(eh.Select.Option,{value:e,children:e},e))]});if(void 0!==e.foreignKey)return(0,t.jsx)(em.Input,{"data-testid":`${e.name}-input`,layout:"horizontal",placeholder:null!==e.defaultValue?`Default: ${e.defaultValue}`:"NULL",label:e.name,value:e.value??"",descriptionText:(0,t.jsxs)(t.Fragment,{children:[e.comment&&(0,t.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[e.comment," "]}),(0,t.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[e.comment&&"(","Has a foreign key relation to"]}),(0,t.jsxs)("span",{className:"text-code font-mono text-xs text-foreground-lighter",children:[e.foreignKey.target_table_schema,".",e.foreignKey.target_table_name,".",e.foreignKey.target_column_name]}),e.comment&&(0,t.jsx)("span",{className:"text-sm text-foreground-lighter",children:")"})]}),labelOptional:e.format,disabled:!r,error:a[e.name],onChange:t=>n({[e.name]:t.target.value}),actions:r&&(0,t.jsxs)(eu.DropdownMenu,{children:[(0,t.jsx)(eu.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(y.Button,{type:"default",icon:(0,t.jsx)(ec.Edit,{}),className:"px-1.5"})}),(0,t.jsxs)(eu.DropdownMenuContent,{align:"end",className:"w-28",children:[e.isNullable&&(0,t.jsx)(eu.DropdownMenuItem,{onClick:()=>n({[e.name]:null}),children:"Set to NULL"}),(0,t.jsx)(eu.DropdownMenuItem,{onClick:l,children:"Select record"})]})]})});if((0,el.default)(ej.TEXT_TYPES,e.format)){let i=(0,v.isValueTruncated)(e.value);return(0,t.jsx)("div",{className:"text-area-text-sm",children:(0,t.jsx)(em.Input.TextArea,{"data-testid":`${e.name}-input`,layout:"horizontal",label:e.name,className:"input-sm",descriptionText:(0,t.jsxs)(t.Fragment,{children:[e.comment&&(0,t.jsx)("p",{children:e.comment}),i&&(0,t.jsx)("p",{children:eC})]}),textAreaClassName:"pr-8",labelOptional:e.format,disabled:!r||i,error:a[e.name],rows:5,value:e.value??"",placeholder:null===e.value&&null===e.defaultValue?"NULL":""===e.value||"string"==typeof e.defaultValue&&0===e.defaultValue.length?"EMPTY":`Default: ${e.defaultValue}`,actions:(0,t.jsxs)(eu.DropdownMenu,{children:[(0,t.jsx)(eu.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(y.Button,{type:"default",icon:(0,t.jsx)(ec.Edit,{}),className:"px-1.5"})}),(0,t.jsxs)(eu.DropdownMenuContent,{align:"end",className:"w-28",children:[r&&(0,t.jsx)(eu.DropdownMenuItem,{onClick:()=>n({[e.name]:null}),children:"Set to NULL"}),(0,t.jsx)(eu.DropdownMenuItem,{onClick:()=>s({column:e.name,value:e.value||""}),children:"Expand editor"})]})]}),onChange:t=>n({[e.name]:t.target.value})})})}if((0,el.default)(ej.JSON_TYPES,e.format)){let s=(0,v.isValueTruncated)(e.value);return(0,t.jsx)(em.Input,{"data-testid":`${e.name}-input`,layout:"horizontal",value:e.value??"",label:e.name,descriptionText:(0,t.jsxs)(t.Fragment,{children:[e.comment&&(0,t.jsx)("p",{children:e.comment}),s&&(0,t.jsx)("p",{children:eC})]}),labelOptional:e.format,disabled:!r||s,placeholder:e?.defaultValue?`Default: ${e.defaultValue}`:"NULL",error:a[e.name],onChange:t=>n({[e.name]:t.target.value}),actions:(0,t.jsx)(y.Button,{type:"default",htmlType:"button",onClick:()=>i({column:e.name,value:e.value}),icon:r?(0,t.jsx)(ec.Edit,{}):(0,t.jsx)(ed.Eye,{}),children:r?"Edit":"View JSON"})})}if((0,el.default)(ej.DATETIME_TYPES,e.format))return(0,t.jsx)(eN,{name:e.name,format:e.format,value:e.value??"",isNullable:e.isNullable,description:(0,t.jsxs)(t.Fragment,{children:[e.defaultValue&&(0,t.jsxs)("p",{children:["Default: ",e.defaultValue]}),e.comment&&(0,t.jsx)("p",{children:e.comment})]}),onChange:t=>n({[e.name]:t}),disabled:!r});if("bool"===e.format){let a=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"},...e.isNullable?[{value:"null",label:"NULL"}]:[]],i=null===e.value?void 0:e.value;return(0,t.jsx)(ev.FormItemLayout,{isReactForm:!1,layout:"horizontal",label:e.name,labelOptional:e.format,description:e.comment,className:"[&>div:first-child>span]:text-foreground-lighter",children:(0,t.jsxs)(ep.Select_Shadcn_,{value:null===i?"null":i,onValueChange:t=>n({[e.name]:t}),disabled:!r,children:[(0,t.jsx)(ey.SelectTrigger_Shadcn_,{children:(0,t.jsx)(eb.SelectValue_Shadcn_,{placeholder:"Select a value"})}),(0,t.jsx)(eg.SelectContent_Shadcn_,{children:(0,t.jsx)(ef.SelectGroup_Shadcn_,{children:a.map(e=>(0,t.jsx)(ex.SelectItem_Shadcn_,{value:e.value,children:e.label},e.value))})})]})})}if("bytea"===e.format)return(0,t.jsx)(em.Input,{"data-testid":`${e.name}-input`,layout:"horizontal",label:e.name,descriptionText:(0,t.jsxs)(t.Fragment,{children:[e.comment&&(0,t.jsx)("p",{children:e.comment}),(0,t.jsx)("p",{children:"Bytea columns are edited and displayed as hex in the dashboard"})]}),labelOptional:e.format,error:a[e.name],value:e.value??"",placeholder:`\\x`,disabled:!r,onChange:t=>n({[e.name]:t.target.value})});let o=(0,v.isValueTruncated)(e.value);return(0,t.jsx)(em.Input,{"data-testid":`${e.name}-input`,layout:"horizontal",label:e.name,descriptionText:(0,t.jsxs)(t.Fragment,{children:[e.comment&&(0,t.jsx)("p",{children:e.comment}),o&&(0,t.jsx)("p",{children:eC})]}),labelOptional:e.format,error:a[e.name],value:e.value??"",placeholder:e.isIdentity?"Automatically generated as identity":null!==e.defaultValue?`Default: ${e.defaultValue}`:"NULL",disabled:!r||o,onChange:t=>n({[e.name]:t.target.value}),actions:o?(0,t.jsx)(y.Button,{type:"default",htmlType:"button",onClick:()=>i({column:e.name,value:e.value}),icon:r?(0,t.jsx)(ec.Edit,{}):(0,t.jsx)(ed.Eye,{}),children:r?"Edit":"View"}):void 0})};var eT=e.i(610472),eE=e.i(592383);let e_=({visible:e,readOnly:a=!1,row:r,column:i,closePanel:s,onSaveField:l})=>{let{id:c}=(0,o.useParams)(),d=c?Number(c):void 0,{data:u}=(0,g.useSelectedProjectQuery)(),{data:m}=(0,h.useTableEditorQuery)({projectRef:u?.ref,connectionString:u?.connectionString,id:d}),[p,f]=(0,n.useState)(""),[x,S]=(0,n.useState)("edit"),N=r?.[i],C=(0,v.isValueTruncated)(N),{mutate:w,isPending:T,isSuccess:E,reset:_}=(0,$.useGetCellValueMutation)();(0,n.useEffect)(()=>{e&&(S("edit"),f(N))},[e]);let D=(0,n.useCallback)(()=>{_(),s()},[_]);return(0,t.jsx)(b.SidePanel,{size:"large",visible:e,onCancel:D,header:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{children:[a?"Viewing":"Editing"," value of: ",(0,t.jsx)("code",{children:i})]}),(!C||C&&E)&&(0,t.jsx)(F.default,{options:["view","edit"],activeOption:x,borderOverride:"border-muted",onClickOption:S})]}),customFooter:(0,t.jsx)(q.ActionBar,{hideApply:a,closePanel:D,backButtonLabel:"Cancel",applyButtonLabel:"Save value",applyFunction:a?void 0:e=>{l&&l(p,e)}}),children:(0,t.jsxs)("div",{className:"relative flex flex-auto h-full flex-col gap-y-4",children:["edit"===x?(0,t.jsx)("div",{className:"w-full h-full flex-grow",children:(0,t.jsx)(X.Editor,{theme:"supabase",className:"monaco-editor",defaultLanguage:"markdown",value:p,loading:(0,t.jsx)(j.Loader,{className:"animate-spin",strokeWidth:2,size:20}),options:{readOnly:a,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:e=>f(e??"")},N)}):(0,t.jsx)(b.SidePanel.Content,{className:"py-4 bg-default flex-grow",children:(0,t.jsx)(eE.Markdown,{remarkPlugins:[eT.default],className:"bg-default markdown-body",content:p})}),C&&!E&&(0,t.jsxs)("div",{className:(0,U.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,t.jsxs)("p",{children:["Text value is larger than ",R.MAX_CHARACTERS.toLocaleString()," characters"]}),(0,t.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire text value, but your browser may run into performance issues"})]}),(0,t.jsx)(y.Button,{type:"default",loading:T,onClick:()=>{if(void 0===m||void 0===u||void 0===r||!(0,M.isTableLike)(m))return;if(0===m.primary_keys.length)return(0,k.toast)("Unable to load value as table has no primary keys");let e=m.primary_keys.reduce((e,t)=>({...e,[t.name]:r[t.name]}),{});w({table:{schema:m.schema,name:m.name},column:i,pkMatch:e,projectRef:u?.ref,connectionString:u?.connectionString},{onSuccess:e=>f(e)})},children:"Load full text data"})]})]})})};e.s(["TextEditor",0,e_],831536);let eD="row-editor-panel";e.s(["RowEditor",0,({row:e,selectedTable:a,visible:r=!1,editable:i=!0,closePanel:s=er.default,saveChanges:l=er.default,updateEditorDirty:o=er.default})=>{let[c,d]=(0,n.useState)({}),[u,m]=(0,n.useState)([]),[h,p]=(0,n.useState)(),[f,x]=(0,n.useState)(),[y,j]=(0,n.useState)(!1),[S,N]=(0,n.useState)(),C=void 0===e,w=void 0!==h,T=void 0!==f,[E,_]=(0,n.useState)(!1),[D,P]=(0,en.default)(u,e=>!e.isNullable),{data:I}=(0,g.useSelectedProjectQuery)(),{data:R}=(0,ea.useForeignKeyConstraintsQuery)({projectRef:I?.ref,connectionString:I?.connectionString,schema:a.schema}),A=(0,ei.formatForeignKeys)((R??[]).filter(e=>e.source_schema===a?.schema&&e.source_table===a?.name)),k=(0,n.useMemo)(()=>A&&S?.foreignKey?.id?A.find(e=>e.id===S.foreignKey?.id):void 0,[A,S?.foreignKey?.id]);(0,n.useEffect)(()=>{r&&(d({}),m((0,v.generateRowFields)(e,a,A)))},[r]);let L=e=>{let t=Object.keys(e);m(u.map(a=>t.includes(a.name)?{...a,value:e[a.name]}:a)),o()},F=async e=>{j(!0),N(e)},M=(0,n.useMemo)(()=>u.reduce((e,t)=>(e[t.name]=t.value,e),{}),[u]);return(0,t.jsxs)(b.SidePanel,{"data-testid":"side-panel-row-editor",size:"large",visible:r,header:(0,t.jsx)(es,{isNewRecord:C,tableName:a.name}),className:`transition-all duration-100 ease-in ${w||T||y?" mr-32":""}`,onCancel:s,customFooter:(0,t.jsx)(q.ActionBar,{loading:E,formId:eD,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:s,hideApply:!i,visible:r}),children:[(0,t.jsx)("form",{id:eD,onSubmit:t=>(t=>{t.preventDefault();let a=(0,v.validateFields)(u);if(d(a),_(!0),(0,z.default)(a)){o();let t=C?(0,v.generateRowObjectFromFields)(u):(0,v.generateUpdateRowPayload)(e,u),a={identifiers:{},rowIdx:-1};if(!C){let t=u.filter(e=>e.isPrimaryKey),r={};t.forEach(t=>{r[t.name]="bytea"===t.format?(0,v.convertByteaToHex)(e[t.name]):e[t.name]}),a.identifiers=r,a.rowIdx=e.idx}l(t,C,a,()=>_(!1))}else _(!1)})(t),className:"h-full",children:(0,t.jsx)("div",{className:"flex h-full flex-col",children:(0,t.jsxs)("div",{className:"flex flex-grow flex-col",children:[D.length>0&&(0,t.jsx)(b.SidePanel.Content,{children:(0,t.jsx)("div",{className:"space-y-10 py-6",children:D.map(e=>(0,t.jsx)(ew,{field:e,errors:c,onUpdateField:L,onEditJson:x,onEditText:p,onSelectForeignKey:()=>F(e),isEditable:i},e.id))})}),P.length>0&&(0,t.jsxs)(t.Fragment,{children:[D.length>0&&(0,t.jsx)(b.SidePanel.Separator,{}),(0,t.jsx)(b.SidePanel.Content,{children:(0,t.jsxs)("div",{className:"space-y-10 py-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-base text-foreground",children:"Optional Fields"}),(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:"These are columns that do not need any value"})]}),P.map(e=>(0,t.jsx)(ew,{field:e,errors:c,onUpdateField:L,onEditText:p,onEditJson:x,onSelectForeignKey:()=>F(e),isEditable:i},e.id))]})})]}),(0,t.jsx)(e_,{visible:w,row:M,column:h?.column??"",closePanel:()=>p(void 0),onSaveField:e=>{L({[h?.column??""]:e}),p(void 0)},readOnly:!i}),(0,t.jsx)(et,{visible:T,row:M,column:f?.column??"",closePanel:()=>x(void 0),onSaveJSON:e=>{L({[f?.column??""]:e}),x(void 0)},readOnly:!i})]})})}),(0,t.jsx)(O,{visible:y,foreignKey:k,onSelect:e=>{void 0!==S&&void 0!==e&&L(e),j(!1),N(void 0)},closePanel:()=>{j(!1),N(void 0)}},`foreign-row-selector-${k?.id??"null"}`)]},"RowEditor")}],888970);var eP=e.i(755216);e.i(38429);var eI=e.i(714403);async function eO({projectRef:e,connectionString:t,payload:a}){let{sql:r}=eP.default.columns.create({schema:a.schema,table:a.table,name:a.name,type:a.type,default_value:a.defaultValue,default_value_format:a.defaultValueFormat,is_identity:a.isIdentity,identity_generation:a.identityGeneration,is_nullable:a.isNullable,is_primary_key:a.isPrimaryKey,is_unique:a.isUnique,comment:a.comment,check:a.check}),{result:n}=await (0,eI.executeSql)({projectRef:e,connectionString:t,sql:r,queryKey:["column","create"]});return n}e.s(["createDatabaseColumn",()=>eO],608971)},435916,e=>{"use strict";let t={list:e=>["projects",e,"views"],listBySchema:(e,a)=>[...t.list(e),a]};e.s(["viewKeys",0,t])},576117,e=>{"use strict";var t=e.i(755216),a=e.i(38429),r=e.i(356003),n=e.i(355901),i=e.i(246230),s=e.i(497761),l=e.i(714403),o=e.i(938343),c=e.i(790819),d=e.i(435916);async function u({projectRef:e,connectionString:a,column:r,cascade:n=!1}){let{sql:i}=t.default.columns.remove(r,{cascade:n}),{result:s}=await (0,l.executeSql)({projectRef:e,connectionString:a,sql:i,queryKey:["column","delete",r.id]});return s}e.s(["deleteDatabaseColumn",()=>u,"useDatabaseColumnDeleteMutation",0,({onSuccess:e,onError:t,...l}={})=>{let m=(0,r.useQueryClient)();return(0,a.useMutation)({mutationFn:e=>u(e),async onSuccess(t,a,r){let{projectRef:n,column:l}=a;await Promise.all([m.invalidateQueries({queryKey:s.entityTypeKeys.list(n)}),m.invalidateQueries({queryKey:i.databaseKeys.foreignKeyConstraints(n,l.schema)}),m.invalidateQueries({queryKey:o.tableEditorKeys.tableEditor(n,l.table_id)}),m.invalidateQueries({queryKey:i.databaseKeys.tableDefinition(n,l.table_id)}),m.invalidateQueries({queryKey:d.viewKeys.listBySchema(n,l.schema)})]),await m.invalidateQueries({queryKey:c.tableRowKeys.tableRowsAndCount(n,l.table_id)}),await e?.(t,a,r)},async onError(e,a,r){void 0===t?n.toast.error(`Failed to delete database column: ${e.message}`):t(e,a,r)},...l})}])},653581,316588,370228,753085,e=>{"use strict";var t=e.i(478902),a=e.i(755216);e.i(967533);var r=e.i(721490),n=e.i(101369),i=e.i(608971),s=e.i(576117);e.i(38429);var l=e.i(355901),o=e.i(714403);async function c({projectRef:e,connectionString:t,originalColumn:r,payload:n}){let{sql:i}=a.default.columns.update(r,{name:n.name,type:n.type,drop_default:n.dropDefault,default_value:n.defaultValue,default_value_format:n.defaultValueFormat,is_identity:n.isIdentity,identity_generation:n.identityGeneration,is_nullable:n.isNullable,is_unique:n.isUnique,comment:n.comment,check:n.check}),{result:s}=await (0,o.executeSql)({projectRef:e,connectionString:t,sql:i,queryKey:["column","update",r.id]});return s}var d=e.i(691337),u=e.i(947300),m=e.i(246230),h=e.i(497761),p=e.i(915993),g=e.i(941381),f=e.i(741391),x=e.i(938343),y=e.i(415190),b=e.i(790819),v=e.i(70756),j=e.i(138658),S=e.i(159876),N=e.i(847278),C=e.i(738196),w=e.i(162082),T=e.i(48189),E=e.i(255109),_=e.i(824861),D=e.i(666050),P=e.i(822574),I=e.i(586468),O=e.i(390974),R=e.i(956592);function A(e){if(e)switch(e.type){case"json":return e.jsonValue.row;case"cell":return e.value?.row;case"row":return e.row;case"foreign-row-selector":return e.foreignKey.row;default:return}}let k=({schema:e,table:t,columns:a})=>{let r=a.map(e=>`"${e}"`).join(", ");return`ALTER TABLE "${e}"."${t}" ADD PRIMARY KEY (${r})`},L=async(e,t,a,r,n)=>{let i=k({schema:a,table:r,columns:n});return await (0,o.executeSql)({projectRef:e,connectionString:t,sql:i,queryKey:["primary-keys"]})},F=async(e,t,a,r,n)=>{let i=`ALTER TABLE "${a}"."${r}" DROP CONSTRAINT "${n}"`;return await (0,o.executeSql)({projectRef:e,connectionString:t,sql:i,queryKey:["drop-constraint"]})},M=({table:e,foreignKeys:t})=>t.map(t=>{let{deletionAction:a,updateAction:r}=t,n=a===u.FOREIGN_KEY_CASCADE_ACTION.CASCADE?"ON DELETE CASCADE":a===u.FOREIGN_KEY_CASCADE_ACTION.RESTRICT?"ON DELETE RESTRICT":a===u.FOREIGN_KEY_CASCADE_ACTION.SET_DEFAULT?"ON DELETE SET DEFAULT":a===u.FOREIGN_KEY_CASCADE_ACTION.SET_NULL?"ON DELETE SET NULL":"",i=r===u.FOREIGN_KEY_CASCADE_ACTION.CASCADE?"ON UPDATE CASCADE":r===u.FOREIGN_KEY_CASCADE_ACTION.RESTRICT?"ON UPDATE RESTRICT":"";return`
      ALTER TABLE "${e.schema}"."${e.name}"
      ADD FOREIGN KEY (${t.columns.map(e=>`"${e.source}"`).join(",")})
      REFERENCES "${t.schema}"."${t.table}" (${t.columns.map(e=>`"${e.target}"`).join(",")})
      ${i}
      ${n}
    `.replace(/\s+/g," ").trim()}).join(";")+";",$=async({projectRef:e,connectionString:t,table:a,foreignKeys:r})=>{let n=M({table:a,foreignKeys:r});return await (0,o.executeSql)({projectRef:e,connectionString:t,sql:n,queryKey:["foreign-keys"]})},K=({table:e,foreignKeys:t})=>t.map(t=>`
ALTER TABLE IF EXISTS "${e.schema}"."${e.name}"
DROP CONSTRAINT IF EXISTS "${t.name}"
`.replace(/\s+/g," ").trim()).join(";")+";",U=async({projectRef:e,connectionString:t,table:a,foreignKeys:r})=>{let n=K({table:a,foreignKeys:r});return await (0,o.executeSql)({projectRef:e,connectionString:t,sql:n,queryKey:["foreign-keys"]})},q=async({projectRef:e,connectionString:t,table:a,foreignKeys:r})=>{let n=`
  ${K({table:a,foreignKeys:r})}
  ${M({table:a,foreignKeys:r})}
  `.replace(/\s+/g," ").trim();return await (0,o.executeSql)({projectRef:e,connectionString:t,sql:n,queryKey:["foreign-keys"]})},z=async({projectRef:e,connectionString:t,payload:a,selectedTable:r,primaryKey:n,foreignKeyRelations:s=[],skipSuccessMessage:o=!1,toastId:c})=>{let d=c??l.toast.loading(`Creating column "${a.name}"...`);try{let{isPrimaryKey:c,...u}=a;if(await (0,i.createDatabaseColumn)({projectRef:e,connectionString:t,payload:u}),c){l.toast.loading("Assigning primary key to column...",{id:d});let i=r.primary_keys.map(e=>e.name);i.length>0&&void 0!==n&&await F(e,t,a.schema,a.table,n.name);let s=i.concat([u.name]);await L(e,t,a.schema,a.table,s)}return s.length>0&&await $({projectRef:e,connectionString:t,table:{schema:a.schema,name:a.table},foreignKeys:s}),o||l.toast.success(`Successfully created column "${u.name}"`,{id:d}),{error:void 0}}catch(e){return l.toast.error(`An error occurred while creating the column "${a.name}"`,{id:d}),{error:e}}},Y=async({projectRef:e,connectionString:t,originalColumn:a,payload:r,selectedTable:n,primaryKey:i,foreignKeyRelations:s=[],existingForeignKeyRelations:o=[],skipPKCreation:d,skipSuccessMessage:u=!1})=>{try{let{isPrimaryKey:m,...h}=r;if(await c({projectRef:e,connectionString:t,originalColumn:a,payload:h}),!d&&void 0!==m){let r=n.primary_keys.map(e=>e.name);r.length>0&&void 0!==i&&await F(e,t,a.schema,a.table,i.name);let s=h.name??a.name,l=m?r.concat([s]):r.filter(e=>e!==s);l.length&&await L(e,t,a.schema,a.table,l)}s.length>0&&await J({projectRef:e,connectionString:t,table:{schema:a.schema,name:a.table},foreignKeys:s,existingForeignKeyRelations:o}),u||l.toast.success(`Successfully updated column "${a.name}"`)}catch(e){return{error:e}}},H=async(e,t,a,r)=>{let n=(0,f.getQueryClient)(),{duplicateTable:i,isRLSEnabled:s,isDuplicateRows:l,foreignKeyRelations:c}=r,{name:d,schema:u}=i,m=a.name;await (0,o.executeSql)({projectRef:e,connectionString:t,sql:[`CREATE TABLE "${u}"."${m}" (LIKE "${u}"."${d}" INCLUDING ALL);`,void 0!=a.comment?`comment on table "${u}"."${m}" is '${a.comment}';`:""].join("\n")}),await n.invalidateQueries({queryKey:j.tableKeys.list(e,u)}),c.length>0&&await $({projectRef:e,connectionString:t,table:{...i,name:a.name},foreignKeys:c}),l&&(await (0,o.executeSql)({projectRef:e,connectionString:t,sql:`INSERT INTO "${u}"."${m}" SELECT * FROM "${u}"."${d}";`}),(i.columns??[]).filter(e=>null!==e.identity_generation).map(async a=>{await (0,o.executeSql)({projectRef:e,connectionString:t,sql:`SELECT setval('"${u}"."${m}_${a.name}_seq"', (SELECT MAX("${a.name}") FROM "${u}"."${d}"));`})}));let h=await n.fetchQuery({queryKey:j.tableKeys.list(e,u),queryFn:({signal:a})=>(0,C.getTables)({projectRef:e,connectionString:t,schema:u},a)}),p=(0,_.default)(h,{schema:u,name:m});return s&&await (0,N.updateTable)({projectRef:e,connectionString:t,id:p?.id,name:p?.name,schema:p?.schema,payload:{rls_enabled:s}}),p},B=async({projectRef:e,connectionString:r,toastId:i,payload:s,columns:c=[],foreignKeyRelations:u,isRLSEnabled:m,importContent:h,organizationSlug:p,generatedPolicies:x=[],onCreatePoliciesSuccess:y})=>{let b=(0,f.getQueryClient)(),v=[],{sql:j}=a.default.tables.create(s);if(v.push(j),m){let e=(({schema:e,table:t})=>`ALTER TABLE "${e}"."${t}" ENABLE ROW LEVEL SECURITY`)({schema:s.schema,table:s.name});v.push(e)}for(let e of c){let t=(0,O.generateCreateColumnPayload)({schema:s.schema,name:s.name},{...e,isPrimaryKey:!1}),{sql:r}=a.default.columns.create({schema:t.schema,table:t.table,name:t.name,type:t.type,default_value:t.defaultValue,default_value_format:t.defaultValueFormat,is_identity:t.isIdentity,is_nullable:t.isNullable,is_primary_key:t.isPrimaryKey,is_unique:t.isUnique,comment:t.comment,check:t.check});v.push(r)}let N=c.filter(e=>e.isPrimaryKey).map(e=>e.name);if(N.length>0){let e=k({schema:s.schema,table:s.name,columns:N});v.push(e)}if(u.length>0){let e=M({table:{schema:s.schema,name:s.name},foreignKeys:u});v.push(e.replace(/;+$/,""))}l.toast.loading(`Creating table ${s.name}...`,{id:i}),await (0,o.executeSql)({projectRef:e,connectionString:r,sql:v.join(";\n"),queryKey:["table","create-with-columns"]});let C=[];x.length>0&&m&&(l.toast.loading(`Creating ${x.length} policies for table...`,{id:i}),await Promise.all(x.map(async t=>{try{return await (0,d.createDatabasePolicy)({projectRef:e,connectionString:r,payload:{name:t.name,table:t.table,schema:t.schema,definition:t.definition,check:t.check,action:t.action,command:t.command,roles:t.roles}})}catch(e){console.error("Failed to generate policy",e.message),C.push(t)}})),y?.()),(0,w.sendEvent)({event:{action:"table_created",properties:{method:"table_editor",schema_name:s.schema,table_name:s.name,has_generated_policies:x.length>0&&m},groups:{project:e,...p&&{organization:p}}}}).catch(e=>{console.error("Failed to track table creation event:",e)}),m&&(0,w.sendEvent)({event:{action:"table_rls_enabled",properties:{method:"table_editor",schema_name:s.schema,table_name:s.name},groups:{project:e,...p&&{organization:p}}}}).catch(e=>{console.error("Failed to track RLS enablement event:",e)});let T=await (0,S.getTableQuery)({projectRef:e,connectionString:r,name:s.name,schema:s.schema});if(void 0!==h){if(h.file&&h.rowCount>0){let{error:a}=await W(e,r,h.file,T,h.selectedHeaders,e=>{l.toast.loading((0,t.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,t.jsx)(n.default,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:`Adding ${h.rowCount.toLocaleString()} rows to ${T.name}`,labelBottomClass:"",labelTop:`${e.toFixed(2)}%`,labelTopClass:"tabular-nums"})}),{id:i})});if(void 0!==a){l.toast.error("Do check your spreadsheet if there are any discrepancies.");let e=`Table ${T.name} has been created but we ran into an error while inserting rows: ${a.message}`;l.toast.error(e),console.error("Error:",{error:a,message:e})}}else await G(e,r,T,h.rows,h.selectedHeaders,e=>{l.toast.loading((0,t.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,t.jsx)(n.default,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:`Adding ${h.rows.length.toLocaleString()} rows to ${T.name}`,labelTop:`${e.toFixed(2)}%`,labelTopClass:"tabular-nums"})}),{id:i})});let a=c.filter(e=>e.isIdentity);if(a.length>0){let t=a.map(e=>(({schema:e,table:t,column:a})=>`SELECT setval('"${e}"."${t}_${a}_seq"', (SELECT COALESCE(MAX("${a}"), 1) FROM "${e}"."${t}"))`)({schema:T.schema,table:T.name,column:e.name})).join(";\n");await (0,o.executeSql)({projectRef:e,connectionString:r,sql:t,queryKey:["sequences","update-batch"]})}}return await (0,g.prefetchEditorTablePage)({queryClient:b,projectRef:e,connectionString:r,id:T.id}),{table:T,failedPolicies:C}},Q=async({projectRef:e,connectionString:t,toastId:a,table:r,payload:n,columns:i,foreignKeyRelations:o,existingForeignKeyRelations:c,primaryKey:d,organizationSlug:u})=>{let g=(0,f.getQueryClient)(),v=i.filter(e=>e.isPrimaryKey).map(e=>e.name),C=r.primary_keys.map(e=>e.name),T=!(0,P.default)(v,C);if(T&&void 0!==d&&await F(e,t,r.schema,r.name,d.name),Object.keys(n).length>0&&await (0,N.updateTable)({projectRef:e,connectionString:t,id:r.id,name:r.name,schema:r.schema,payload:n}),!0===n.rls_enabled)try{await (0,w.sendEvent)({event:{action:"table_rls_enabled",properties:{method:"table_editor",schema_name:r.schema,table_name:n.name??r.name},groups:{project:e,...u&&{organization:u}}}})}catch(e){console.error("Failed to track RLS enablement event:",e)}let E=await g.fetchQuery({queryKey:j.tableKeys.retrieve(e,n.name??r.name,n.schema??r.schema),queryFn:({signal:a})=>(0,S.getTable)({projectRef:e,connectionString:t,name:n.name??r.name,schema:n.schema??r.schema},a)}),I=E.columns??[],R=i.map(e=>e.id);for(let r of I.filter(e=>!R.includes(e.id)))l.toast.loading(`Removing column ${r.name} from ${E.name}`,{id:a}),await (0,s.deleteDatabaseColumn)({projectRef:e,connectionString:t,column:r});let A=!1;for(let n of i)if(n.id.includes(r.id.toString())){let i=(0,_.default)(r.columns,{id:n.id});if(i){let r=(0,O.generateUpdateColumnPayload)(i,E,n);if(!(0,D.default)(r)){l.toast.loading(`Updating column ${n.name} from ${E.name}`,{id:a});let s=await Y({projectRef:e,connectionString:t,originalColumn:{...i,table:E.name,schema:E.schema},payload:r,selectedTable:E,skipPKCreation:!0,skipSuccessMessage:!0});s?.error&&(A=!0,l.toast.error(`Failed to update column "${n.name}": ${s.error.message}`))}}}else{l.toast.loading(`Adding column ${n.name} to ${E.name}`,{id:a});let r=(0,O.generateCreateColumnPayload)(E,{...n,isPrimaryKey:!1}),{error:i}=await z({projectRef:e,connectionString:t,payload:r,selectedTable:E,skipSuccessMessage:!0,toastId:a});i&&(A=!0)}return T&&v.length>0&&await L(e,t,E.schema,E.name,v),await J({projectRef:e,connectionString:t,table:E,foreignKeys:o,existingForeignKeyRelations:c}),await Promise.all([g.invalidateQueries({queryKey:x.tableEditorKeys.tableEditor(e,r.id)}),g.invalidateQueries({queryKey:m.databaseKeys.foreignKeyConstraints(e,r.schema)}),g.invalidateQueries({queryKey:m.databaseKeys.tableDefinition(e,r.id)}),g.invalidateQueries({queryKey:h.entityTypeKeys.list(e)}),g.invalidateQueries({queryKey:j.tableKeys.list(e,r.schema,!0)}),g.invalidateQueries({queryKey:p.lintKeys.lint(e)})]),await g.invalidateQueries({queryKey:b.tableRowKeys.tableRowsAndCount(e,r.id)}),{table:await (0,y.prefetchTableEditor)(g,{projectRef:e,connectionString:t,id:r.id}),hasError:A}},V=({rows:e,headers:t,columns:a=[]})=>e.map(e=>{let r={};return t.forEach(t=>{let n=a?.find(e=>e.name===t),i=e[t];if((n?.format??"").includes("json"))r[t]=(0,T.tryParseJson)(i);else if((n?.data_type??"")==="ARRAY")if("string"==typeof i&&i.startsWith("{")&&i.endsWith("}")){let e=`[${i.slice(1,i.length-1)}]`;r[t]=(0,T.tryParseJson)(e)}else r[t]=(0,T.tryParseJson)(i);else""===i?r[t]=n?.is_nullable?null:"":r[t]=i}),r}),W=async(e,t,a,n,i,s)=>{let l,c=0,d=new Date;return new Promise(u=>{I.default.parse(a,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,chunkSize:104857.6,quoteChar:"text/tab-separated-values"===a.type?"":'"',chunk:async(d,u)=>{u.pause();let m=V({rows:d.data,headers:i,columns:n.columns}),h=new r.Query().from(n.name,n.schema).insert(m).toSql();try{await (0,v.executeWithRetry)(()=>(0,o.executeSql)({projectRef:e,connectionString:t,sql:h}))}catch(e){console.warn(e),l=e,u.abort()}let p=104857.6*(c+=1)/a.size;s(p>1?100:100*p),u.resume()},complete:()=>{let e=new Date;console.log(`Total time taken for importing spreadsheet: ${(e-d)/1e3} seconds`),u({error:l})}})})},G=async(e,t,a,n,i,s)=>{let l,c=0,d=V({rows:n,headers:i,columns:a.columns}),u=(0,E.default)(d,1e3).map(i=>()=>Promise.race([new Promise(async(s,d)=>{let u=new r.Query().from(a.name,a.schema).insert(i).toSql();try{await (0,o.executeSql)({projectRef:e,connectionString:t,sql:u})}catch(e){l=e,d(e)}c+=i.length/n.length,s({})}),(0,T.timeout)(3e4)]));for(let e of(0,E.default)(u,10)){let t=await Promise.allSettled(e.map(e=>e()));if((0,_.default)(t,{status:"rejected"}))break;s(100*c)}return{error:l}},J=async({projectRef:e,connectionString:t,table:a,foreignKeys:r,existingForeignKeyRelations:n})=>{let i=r.filter(e=>"string"==typeof e.id);i.length>0&&await $({projectRef:e,connectionString:t,table:a,foreignKeys:i});let s=r.filter(e=>e.toRemove);s.length>0&&await U({projectRef:e,connectionString:t,table:a,foreignKeys:s});let l=r.filter(e=>"number"==typeof e.id&&!e.toRemove).filter(e=>{let t=n.find(t=>e.id===t.id);return void 0!==t&&(0,R.checkIfRelationChanged)(t,e)});l.length>0&&await q({projectRef:e,connectionString:t,table:a,foreignKeys:l})};e.s(["createColumn",0,z,"createTable",0,B,"duplicateTable",0,H,"getRowFromSidePanel",()=>A,"insertRowsViaSpreadsheet",0,W,"insertTableRows",0,G,"updateColumn",0,Y,"updateTable",0,Q],653581);var X=e.i(291969),Z=e.i(585915),ee=e.i(389959),et=e.i(837710);e.s(["default",0,({parseProgress:e,uploadedFile:a,onFileUpload:r,removeUploadedFile:i})=>{let[s,l]=(0,ee.useState)(!1),o=(0,ee.useRef)(null),c=e=>{"dragover"!==e.type||s?("dragleave"===e.type||"drop"===e.type)&&l(!1):l(!0),e.stopPropagation(),e.preventDefault()};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,t.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,t.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),a?(0,t.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed border-strong",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(X.FileText,{size:14,strokeWidth:1.5}),(0,t.jsx)("p",{className:"text-sm text-foreground",children:a.name})]}),100===e?(0,t.jsx)(et.Button,{type:"outline",onClick:i,children:"Remove File"}):(0,t.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,t.jsx)(Z.Loader,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)(n.default,{value:e,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:`${e}%`})]})]}):(0,t.jsx)("div",{className:`flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed border-strong ${s?"bg-gray-500":""}`,onDragOver:c,onDragLeave:c,onDrop:e=>{c(e),r(e)},onClick:()=>o.current?.click(),children:(0,t.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,t.jsx)("span",{className:"text-brand",children:"browse"})," your files"]})}),(0,t.jsx)("input",{ref:o,className:"hidden",type:"file",onChange:r})]})}],316588);var ea=e.i(88816),er=e.i(843778),en=e.i(58359),ei=e.i(539013);e.s(["default",0,({spreadsheetData:e,selectedHeaders:a,onToggleHeader:r})=>{let[n,i]=(0,ee.useState)(!1);return(0,t.jsxs)(en.Collapsible,{open:n,onOpenChange:i,className:"",children:[(0,t.jsx)(en.Collapsible.Trigger,{asChild:!0,children:(0,t.jsx)(ei.SidePanel.Content,{children:(0,t.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,t.jsx)(et.Button,{type:"text",icon:(0,t.jsx)(ea.ChevronDown,{size:18,strokeWidth:2,className:(0,er.cn)("text-foreground-light",n&&"rotate-180")}),className:"px-1",onClick:()=>i(!n)})]})})}),(0,t.jsx)(en.Collapsible.Content,{children:(0,t.jsx)(ei.SidePanel.Content,{children:(0,t.jsxs)("div",{className:"py-2 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which columns to import"}),(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,t.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:e.headers.map(e=>{let n=a.includes(e);return(0,t.jsx)(et.Button,{type:n?"primary":"default",className:(0,er.cn)("transition",n?"opacity-100":"opacity-75"),onClick:()=>r(e),children:e},e)})})]})})})]})}],370228);var es=e.i(171997);e.s(["default",0,({input:e,onInputChange:a})=>(0,t.jsxs)("div",{className:"space-y-10",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,t.jsx)("code",{children:"-"}),") or underscores (",(0,t.jsx)("code",{children:"_"}),")."]}),(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,t.jsx)(es.Input.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:e,onChange:a})]})],753085)},323150,914877,e=>{"use strict";var t=e.i(478902),a=e.i(55956),r=e.i(762510),n=e.i(702454),i=e.i(17203),s=e.i(210419),l=e.i(586468),o=e.i(355901),c=e.i(10429),d=e.i(48189),u=e.i(837710);let m=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],h=["csv","tsv"];e.s(["EMPTY_SPREADSHEET_DATA",0,{headers:[],rows:[],rowCount:0,columnTypeMap:{}},"MAX_TABLE_EDITOR_IMPORT_CSV_SIZE",0,0x6400000,"UPLOAD_FILE_EXTENSIONS",0,h,"UPLOAD_FILE_TYPES",0,m],914877);let p=(e,t)=>{if(0===t.length)return"text";let r=t[0][e],i=t.map(t=>t[e]);if(null==r)return"text";if(Number(r)){let a=t.map(t=>Number(t[e]));return a.includes(NaN)?"text":a.map(e=>e%1).every(e=>0===e)?"int8":"float8"}return(0,n.default)(["true","false"],r.toString().toLowerCase())&&i.every(e=>null==e||(0,n.default)(["true","false"],e.toString().toLowerCase()))?"bool":(0,d.tryParseJson)(r)&&i.every(e=>(0,d.tryParseJson)(r))?"jsonb":Date.parse(r)&&i.every(e=>(0,a.default)(e,"YYYY-MM-DD hh:mm:ss").isValid())?"timestamptz":"text"};function g(e){let a;return e&&m.includes(e.type)&&(a=e?.name.split(".").pop().toLowerCase(),h.includes(a))?e.size>0x6400000&&(o.toast.error((0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{children:"The dashboard currently only supports importing of CSVs below 100MB."}),(0,t.jsx)("p",{children:"For bulk data loading, we recommend doing so directly through the database."}),(0,t.jsx)(u.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(i.ExternalLink,{}),className:"!mt-2",children:(0,t.jsx)(s.default,{href:`${c.DOCS_URL}/guides/database/tables#bulk-data-loading`,target:"_blank",rel:"noreferrer",children:"Learn more"})})]}),{duration:1/0}),!0):(o.toast.error("Couldn't import file: only CSV files are accepted"),!0)}e.s(["flagInvalidFileImport",()=>g,"parseSpreadsheet",0,(e,t)=>{let a=[],n=0,i=0,s=[],o={},c=[];return new Promise(d=>{l.default.parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:262144,chunk:l=>{if((a=l.meta.fields).forEach(e=>{let t=p(e,l.data);(0,r.default)(o,e)?o[e]!==t&&(o[e]="text"):o[e]=t}),i+=l.data.length,s=l.data.slice(0,20),l.errors.length>0){let e=l.errors.map(e=>{if(e)return{...e,data:l.data[e.row]}});c.push(...e)}let d=262144*(n+=1)/e.size;t(d>1?100:Number((100*d).toFixed(2)))},complete:()=>{d({headers:a,rowCount:i,previewRows:s,columnTypeMap:o,errors:c})}})})},"parseSpreadsheetText",0,e=>{let t={};return new Promise(a=>{l.default.parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:e=>{let n=e.meta.fields||[],i=e.data,s=e.errors;n.forEach(a=>{let n=p(a,e.data);(0,r.default)(t,a)?t[a]!==n&&(t[a]="text"):t[a]=n}),a({headers:n,rows:i,previewRows:e.data.slice(0,20),columnTypeMap:t,errors:s})}})})}],323150)},294459,954707,258032,355150,e=>{"use strict";var t=e.i(478902),a=e.i(91763),r=e.i(964727),n=e.i(389959),i=e.i(355901);e.i(128328);var s=e.i(158639),l=e.i(162082),o=e.i(867467),c=e.i(265735),d=e.i(636047),u=e.i(539013),m=e.i(200409),h=e.i(973512),p=e.i(316588),g=e.i(370228),f=e.i(753085),x=e.i(914877),y=e.i(323150),b=e.i(867637),v=e.i(710377),j=e.i(88816),S=e.i(416050),N=e.i(178527),C=e.i(206413),w=e.i(592360),T=e.i(587433),E=e.i(837710),_=e.i(843778),D=e.i(58359),P=e.i(877555),I=e.i(591385);let O=({headers:e=[],rows:a=[],height:r})=>{let n=e.slice(0,20),i=a.slice(0,20);return(0,t.jsx)(I.default,{columns:n.map(e=>{let a=Math.max(Math.max(...i.map(t=>t[e]?.toString()??"").map(e=>e.length)),e.length);return{key:e,name:e,width:a>20?200:10*a,resizable:!0,renderHeaderCell:()=>(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("p",{className:"text-xs",children:e})}),renderCell:({row:a})=>{let r=!a[e];return(0,t.jsx)("span",{className:(0,_.cn)("text-sm flex items-center",r&&"text-foreground-light"),children:r?"NULL":a[e]})}}}),rows:i,className:"!border-l !border-r",style:{height:r||`${34+34*(i.length||1)}px`}})},R=({selectedTable:e,spreadsheetData:a,errors:r=[],selectedHeaders:i,incompatibleHeaders:s})=>{let[l,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)([]),{headers:m,rows:h}=a,p=m.filter(e=>i.includes(e)).slice(0,20),g=h.slice(0,20),f=void 0===e||0===s.length;(0,n.useEffect)(()=>{o(!0)},[a]);let x=r.filter((e,t,a)=>t===a.findIndex(t=>t.row===e.row&&t.code===e.code));return(0,t.jsxs)(D.Collapsible,{open:l,onOpenChange:o,className:"",children:[(0,t.jsx)(D.Collapsible.Trigger,{asChild:!0,children:(0,t.jsx)(u.SidePanel.Content,{children:(0,t.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!f&&(0,t.jsx)(T.Badge,{variant:"destructive",children:"Data incompatible"}),x.length>0&&(0,t.jsxs)(T.Badge,{variant:"warning",children:[x.length," ",1===x.length?"issue":"issues"," found"]})]}),(0,t.jsx)(E.Button,{type:"text",icon:(0,t.jsx)(j.ChevronDown,{size:18,strokeWidth:2,className:(0,_.cn)("text-foreground-light",l&&"rotate-180")}),className:"px-1",onClick:()=>o(!l)})]})})}),(0,t.jsx)(D.Collapsible.Content,{children:(0,t.jsxs)(u.SidePanel.Content,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:void 0===e?`Your table will have ${a.rowCount.toLocaleString()} rows and the
                        following ${a.headers.length} columns.`:`A total of ${a.rowCount.toLocaleString()} rows will be added to the table "${e.name}"`}),(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,t.jsx)("div",{className:"mb-4",children:p.length>0&&g.length>0?(0,t.jsx)(O,{height:350,headers:p,rows:g}):(0,t.jsxs)("div",{className:"flex items-center justify-center py-4 border border-control rounded-md space-x-2",children:[(0,t.jsx)(b.AlertCircle,{size:16,strokeWidth:1.5,className:"text-foreground-light"}),(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:0===p.length?"No headers have been selected":0===g.length?"Your CSV contains no data":""})]})}),(!f||x.length>0)&&(0,t.jsxs)(N.Alert_Shadcn_,{variant:"warning",className:"my-4",children:[(0,t.jsx)(P.WarningIcon,{}),(0,t.jsx)(w.AlertTitle_Shadcn_,{children:"Issues found in spreadsheet"}),(0,t.jsx)(C.AlertDescription_Shadcn_,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[f?(0,t.jsx)("p",{className:"text-sm",children:void 0!==e?`This CSV can still be imported, but we found ${1===x.length?"an issue":"issues"}:`:`You can still create the table, but we found ${1===x.length?"an issue":"issues"}:`}):(0,t.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,t.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers."]}),!f&&(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)("div",{className:"size-[14px] flex items-center justify-center translate-y-[3px]",children:(0,t.jsx)("div",{className:"size-[6px] rounded-full bg-foreground-lighter"})}),(0,t.jsxs)("p",{className:"text-sm",children:["The column",s.length>1?"s":""," ",s.map(e=>`"${e}"`).join(", ")," ",s.length>1?"are":"is"," not present in your table"]})]})}),(0,t.jsx)("ul",{className:"space-y-2 list-none",children:x.map((e,r)=>{let n=`import-error-${r}`,i=c.includes(n),s=e.data;return(0,t.jsxs)("li",{className:"space-y-2",children:[void 0!==s?(0,t.jsxs)("button",{type:"button",className:"flex items-center space-x-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary",onClick:()=>{c.includes(n)?d(c.filter(e=>e!==n)):d(c.concat([n]))},"aria-expanded":i,"aria-controls":`${n}-panel`,"aria-labelledby":`${n}-summary`,children:[(0,t.jsx)(S.ChevronRight,{size:14,className:(0,_.cn)("transform transition-transform",{"rotate-90":i}),"aria-hidden":"true"}),(0,t.jsx)("span",{id:`${n}-summary`,className:"sr-only",children:`Toggle details for row ${e.row}`}),(0,t.jsxs)("p",{className:"text-sm",children:["Row ",e.row,":"]}),(0,t.jsx)("p",{className:"text-sm",children:e.message}),s?.__parsed_extra&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.ArrowRight,{size:14,"aria-hidden":"true"}),(0,t.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),(0,t.jsx)("ul",{className:"ml-2 list-disc",children:s.__parsed_extra.map((e,a)=>(0,t.jsx)("li",{children:(0,t.jsx)("code",{className:"text-code-inline",children:e})},a))})]})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"size-[14px] flex items-center justify-center","aria-hidden":"true",children:(0,t.jsx)("div",{className:"size-[6px] rounded-full bg-foreground-lighter"})}),(0,t.jsxs)("p",{className:"text-sm",children:["Row ",e.row,":"]}),(0,t.jsx)("p",{className:"text-sm",children:e.message})]}),void 0!==s&&i&&(0,t.jsx)(O,{headers:a.headers,rows:[s]})]},n)})})]})})]})]})})]})},A="Some issues have been detected. More details below the content preview.",k=({visible:e=!1,debounceDuration:b=250,headers:v=[],rows:j=[],selectedTable:S,saveContent:N,closePanel:C,updateEditorDirty:w=r.default})=>{let{ref:T}=(0,s.useParams)(),{data:E}=(0,c.useSelectedOrganizationQuery)(),_=(0,d.useTableEditorStateSnapshot)(),D=_.sidePanel?.type==="csv-import"?_.sidePanel.file:void 0,P=(0,o.useChanged)(e),[I,O]=(0,n.useState)("fileUpload"),[k,L]=(0,n.useState)(""),[F,M]=(0,n.useState)(),[$,K]=(0,n.useState)(0),[U,q]=(0,n.useState)({headers:v,rows:j,rowCount:0,columnTypeMap:{}}),[z,Y]=(0,n.useState)([]),[H,B]=(0,n.useState)([]),{mutate:Q}=(0,l.useSendEventMutation)(),V=(S?.columns??[]).map(e=>e.name),W=H.filter(e=>!V.includes(e)),G=void 0===S||0===W.length,J=e=>{K(e)},X=(0,n.useCallback)(async e=>{w(!0),M(e),K(0);let{headers:t,rowCount:a,columnTypeMap:r,errors:n,previewRows:s}=await (0,y.parseSpreadsheet)(e,J);n.length>0&&i.toast.error(A),Y(n),B(t),q({headers:t,rows:s,rowCount:a,columnTypeMap:r})},[w]),Z=(0,n.useCallback)(async e=>{e.persist();let[t]=e.target.files||e.dataTransfer.files;t&&!(0,y.flagInvalidFileImport)(t)&&await X(t),e.target.value=""},[X]),ee=(0,n.useCallback)(()=>{L(""),q(x.EMPTY_SPREADSHEET_DATA),M(void 0),Y([]),w(!1)},[w]),et=async e=>{if(e.length>0){let{headers:t,rows:a,columnTypeMap:r,errors:n}=await (0,y.parseSpreadsheetText)(e);n.length>0&&i.toast.error(A),Y(n),B(t),q({headers:t,rows:a,rowCount:a.length,columnTypeMap:r})}else q(x.EMPTY_SPREADSHEET_DATA)},ea=(0,n.useCallback)((0,a.default)(et,b),[]);return(0,n.useEffect)(()=>{P&&e&&(D?X(D):0===v.length&&ee())},[P,e,D,X,v.length,ee]),(0,t.jsxs)(u.SidePanel,{size:"large",visible:e,align:"right",header:void 0!==S?(0,t.jsxs)(t.Fragment,{children:["Add data to"," ",(0,t.jsxs)("code",{className:"text-sm",children:[S.schema,".",S.name]})]}):"Add content to new table",onCancel:()=>C(),customFooter:(0,t.jsx)(h.ActionBar,{backButtonLabel:"Cancel",applyButtonLabel:void 0===S?"Save":"Import data",closePanel:C,applyFunction:e=>{"fileUpload"===I&&void 0===F?(i.toast.error("Please upload a file to import your data with"),e()):0===H.length?(i.toast.error("Please select at least one header from your CSV"),e()):G?(N({file:F,...U,selectedHeaders:H,resolve:e}),Q({action:"import_data_added",groups:{project:T??"Unknown",organization:E?.slug??"Unknown"}})):(i.toast.error("The data that you are trying to import is incompatible with your table structure"),e())}}),children:[(0,t.jsx)(u.SidePanel.Content,{children:(0,t.jsx)("div",{className:"pt-6",children:(0,t.jsxs)(m.Tabs,{block:!0,type:"pills",onChange:O,children:[(0,t.jsx)(m.Tabs.Panel,{id:"fileUpload",label:"Upload CSV",children:(0,t.jsx)(p.default,{parseProgress:$,uploadedFile:F,onFileUpload:Z,removeUploadedFile:ee})}),(0,t.jsx)(m.Tabs.Panel,{id:"pasteText",label:"Paste text",children:(0,t.jsx)(f.default,{input:k,onInputChange:e=>{L(e.target.value),ea(e.target.value)}})})]})})}),U.headers.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"pt-4",children:(0,t.jsx)(u.SidePanel.Separator,{})}),(0,t.jsx)(g.default,{spreadsheetData:U,selectedHeaders:H,onToggleHeader:e=>{B(H.includes(e)?H.filter(t=>t!==e):H.concat([e]))}}),(0,t.jsx)(u.SidePanel.Separator,{}),(0,t.jsx)(R,{selectedTable:S,spreadsheetData:U,errors:z,selectedHeaders:H,incompatibleHeaders:W}),(0,t.jsx)(u.SidePanel.Separator,{})]})]})};e.s(["SpreadsheetImport",0,k],294459);var L=e.i(655605),F=e.i(210419),M=function(e,t){return e===t},$=e.i(462142);let K=({projectRef:e,schemaName:t},{enabled:a=!0}={})=>{let r=a&&!!e&&!!t,{data:i,isPending:s,isError:l}=(0,$.useProjectPostgrestConfigQuery)({projectRef:e},{enabled:r,select:({db_schema:e})=>e}),o=(0,n.useMemo)(()=>i?(0,$.parseDbSchemaString)(i):[],[i]);return!r||s?{status:"pending",data:void 0,isPending:!0,isError:!1,isSuccess:!1}:l?{status:"error",data:void 0,isPending:!1,isError:!0,isSuccess:!1}:{status:"success",data:o.includes(t),isPending:!1,isError:!1,isSuccess:!0}};var U=e.i(84001),q=e.i(972089);let z=[],Y={},H=({projectRef:e,connectionString:t,schemaName:a,tableNames:r=z},{enabled:i=!0,...s}={})=>{let l=(0,n.useMemo)(()=>new Set(r.filter(e=>"string"==typeof e&&e.length>0)),[r]),o=l.size>0,c=K({projectRef:e,schemaName:a},{enabled:i}),d=c.isSuccess&&!0===c.data,u=i&&o,m=(0,q.useTablePrivilegesQuery)({projectRef:e,connectionString:t},{enabled:u,...s});return(0,n.useMemo)(()=>{if(!i||"pending"===c.status||u&&m.isPending)return{data:void 0,status:"pending",isSuccess:!1,isPending:!0,isError:!1};if("error"===c.status||u&&m.isError)return{data:void 0,status:"error",isSuccess:!1,isPending:!1,isError:!0};if(!o)return{data:Y,status:"success",isSuccess:!0,isPending:!1,isError:!1};let e={},t=d?((e,t,a)=>{if(!e)return{};let r={};return e.forEach(e=>{if(e.schema===t&&a.has(e.name)){var n;let t;r[e.name]=(n=e.privileges,t={anon:[],authenticated:[]},n.forEach(e=>{let{grantee:a,privilege_type:r}=e;(0,U.isApiAccessRole)(a)&&(0,U.isApiPrivilegeType)(r)&&t[a].push(r)}),t)}}),r})(m.data,a,l):{};return l.forEach(a=>{if(!d){e[a]={apiAccessType:"none"};return}let r=t[a]??{anon:[],authenticated:[]},n=r.anon.length>0||r.authenticated.length>0;e[a]=n?{apiAccessType:"access",privileges:r}:{apiAccessType:"exposed-schema-no-grants"}}),{data:e,status:"success",isSuccess:!0,isPending:!1,isError:!1}},[i,u,o,c.status,d,m.isPending,m.isError,m.data,a,l])};e.s(["useTableApiAccessQuery",0,H],954707);var B=e.i(804222),Q=e.i(189329),V=e.i(71005),W=e.i(330287),G=e.i(150671),J=e.i(983783),X=e.i(635494),Z=e.i(689805),ee=e.i(793912),et=e.i(135144),ea=e.i(290811),er=e.i(710483),en=e.i(746301),ei=e.i(252387),es=e.i(884860);let el={anon:"Anonymous (anon)",authenticated:"Authenticated"},eo=({projectRef:e,schemaName:a,tableName:r,handler:i})=>{let[s,l]=(0,n.useState)(!1),o=i.isPending,c=i.isError,d=i.data?.schemaExposed,u=o||c||!d,m=i.isSuccess&&i.data.schemaExposed?i.data.privileges:void 0,h=(0,U.checkDataApiPrivilegesNonEmpty)(m),p=U.API_ACCESS_ROLES.length*U.API_PRIVILEGE_TYPES.length,g=Object.values(m??{}).reduce((e,t)=>e+t.length,0);return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"space-y-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm text-foreground flex items-center gap-1.5",children:["Data API Access",(0,t.jsxs)(ei.InfoTooltip,{side:"top",className:"max-w-80",children:["This controls which operations the ",(0,t.jsx)("code",{className:"text-code-inline",children:"anon"})," ","and ",(0,t.jsx)("code",{className:"text-code-inline whitespace-nowrap",children:"authenticated"})," roles can perform on this table via the Data API. Unselected privileges are revoked from these roles."]})]}),(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Allow this table to be queried via Supabase client libraries or the API directly"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(Z.Popover_Shadcn_,{open:s,onOpenChange:l,children:[(0,t.jsx)(et.PopoverTrigger_Shadcn_,{asChild:!0,disabled:u||!h,children:(0,t.jsxs)(E.Button,{type:"text",className:"w-6 h-6 p-0 text-foreground-light","aria-label":"Configure API privileges",children:[(0,t.jsx)(L.Settings,{strokeWidth:1.5,size:16}),g>0&&g<p&&(0,t.jsx)("span",{className:"absolute right-0 top-0 h-1.5 w-1.5 rounded-full bg-foreground shadow-sm"})]})}),(0,t.jsx)(ee.PopoverContent_Shadcn_,{align:"end",className:"w-[420px] space-y-3",children:!u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-foreground",children:"Adjust API privileges per role"}),(0,t.jsx)("div",{className:"space-y-2",children:U.API_ACCESS_ROLES.map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-foreground flex items-center gap-1.5",children:el[e]}),(0,t.jsxs)(es.MultiSelector,{values:m?.[e]??[],onValuesChange:t=>{i.isSuccess&&d&&m&&i.data?.setPrivileges(a=>({...a,[e]:t.filter(U.isApiPrivilegeType)}))},children:[(0,t.jsx)(es.MultiSelectorTrigger,{label:"Select privileges",badgeLimit:4,deletableBadge:!0}),(0,t.jsx)(es.MultiSelectorContent,{children:(0,t.jsx)(es.MultiSelectorList,{children:U.API_PRIVILEGE_TYPES.map(e=>(0,t.jsx)(es.MultiSelectorItem,{value:e,children:e},e))})})]})]},e))})]})})]}),(0,t.jsx)(ea.Switch,{checked:h,onCheckedChange:e=>{!i.isSuccess||d&&(e?i.data?.restorePreviousPrivileges():i.data?.clearAllPrivileges())},disabled:u})]})]})}),(0,t.jsx)(ec,{projectRef:e,schemaName:a,tableName:r,isPending:o,isError:c,isSchemaExposed:d,hasNonEmptyPrivileges:m?h:void 0})]})},ec=({projectRef:e,schemaName:a,tableName:r,isPending:i,isError:s,isSchemaExposed:l,hasNonEmptyPrivileges:o})=>{let{selectedDatabaseId:c}=(0,Q.useDatabaseSelectorStateSnapshot)(),{data:d}=(0,V.useCustomDomainsQuery)({projectRef:e}),{data:u}=(0,W.useLoadBalancersQuery)({projectRef:e}),{data:m}=(0,G.useReadReplicasQuery)({projectRef:e}),h=(0,n.useMemo)(()=>{if(d?.customDomain?.status==="active"&&c===e)return`https://${d.customDomain.hostname}`;if("load-balancer"===c)return u?.[0]?.endpoint;let t=m?.find(e=>e.identifier===c);return t?.restUrl},[e,m,c,d?.customDomain?.status,d?.customDomain?.hostname,u]),p=(0,n.useMemo)(()=>{if(h)return h.endsWith("/")?h.slice(0,-1):h},[h]),g=a&&r?"public"===a?r:`${a}.${r}`:void 0,f=p&&g?`${p}/${g}`:void 0;return(0,t.jsxs)(t.Fragment,{children:[s&&(0,t.jsx)(er.Admonition,{type:"warning",title:"An error occurred while fetching Data API settings."}),l&&f&&o&&(0,t.jsx)(en.Input,{copy:!0,readOnly:!0,className:"font-mono text-xs p-3 text-foreground-lighter",value:f}),!i&&!s&&!l&&(0,t.jsx)(er.Admonition,{type:"default",title:`The "${a}" schema is not exposed via the Data API`,description:(0,t.jsxs)(t.Fragment,{children:["To enable API access for this table, you need to first expose the"," ",(0,t.jsx)("code",{className:"text-xs",children:a})," schema in your"," ",(0,t.jsx)(F.default,{href:`/project/${e}/settings/api`,className:"text-foreground hover:underline",children:"API settings"}),"."]})})]})};e.s(["ApiAccessToggle",0,eo,"useTableApiAccessHandlerWithHistory",0,(e,{enabled:t=!0}={})=>{var a,r,i,s,l;let o=((e,{enabled:t=!0}={})=>{let a="new"===e.type,r="duplicate"===e.type,i="edit"===e.type,{selectedSchema:s}=(0,J.useQuerySchemaState)(),l=a?s:r?e.templateSchemaName:e.schemaName,{data:o}=(0,X.useSelectedProjectQuery)({enabled:t}),c=K({projectRef:o?.ref,schemaName:l},{enabled:t}),d=r||i,u=d?r?e.templateSchemaName:e.schemaName:void 0,m=d?r?e.templateTableName:e.tableName:void 0,h=!!(d&&o?.ref&&u&&m),p=t&&h,g=H({projectRef:o?.ref,connectionString:o?.connectionString??void 0,schemaName:u??"",tableNames:m?[m]:[]},{enabled:p}),f=m?g.data?.[m]:void 0,[x,y]=(0,n.useState)(U.DEFAULT_DATA_API_PRIVILEGES),b=(0,n.useRef)(!1),v=(0,B.useStaticEffectEvent)(()=>{b.current=!d,y(U.DEFAULT_DATA_API_PRIVILEGES)});(0,n.useEffect)(()=>{v()},[e.type,s,u,m,v]);let j=(0,B.useStaticEffectEvent)(()=>{b.current||!g.isSuccess||f&&(b.current=!0,"access"===f.apiAccessType?y(f.privileges):"exposed-schema-no-grants"===f.apiAccessType?y(U.EMPTY_DATA_API_PRIVILEGES):y(U.DEFAULT_DATA_API_PRIVILEGES))});return((0,n.useEffect)(()=>{j()},[g.status,j]),!t||"pending"===c.status||d&&g.isPending)?{isError:!1,isPending:!0,isSuccess:!1,data:void 0}:c.isError||d&&g.isError?{isError:!0,isPending:!1,isSuccess:!1,data:void 0}:!0!==c.data?{isError:!1,isPending:!1,isSuccess:!0,data:{schemaExposed:!1}}:{isError:!1,isPending:!1,isSuccess:!0,data:{schemaExposed:!0,privileges:x,setPrivileges:y}}})(e,{enabled:t}),c=(a=o.data?.schemaExposed?o.data.privileges:void 0,void 0===r&&(r=M),i=(0,n.useRef)(),s=(0,n.useRef)(a),((l=(0,n.useRef)(!0)).current?(l.current=!1,!0):l.current)||r(s.current,a)||(i.current=s.current,s.current=a),i.current),d=(0,B.useStaticEffectEvent)(()=>{!o.isSuccess||o.data.schemaExposed&&o.data?.setPrivileges(U.EMPTY_DATA_API_PRIVILEGES)}),u=(0,B.useStaticEffectEvent)(()=>{!o.isSuccess||o.data.schemaExposed&&o.data?.setPrivileges(c??U.DEFAULT_DATA_API_PRIVILEGES)});return o.isSuccess?{...o,data:{...o.data,clearAllPrivileges:d,restorePreviousPrivileges:u}}:o}],258032);var ed=e.i(513826),eu=e.i(321605),em=e.i(78071),eh=e.i(471994),ep=e.i(155482),eg=e.i(276093),ef=e.i(912793),ex=e.i(627487),ey=e.i(238944),eb=e.i(392491),ev=e.i(10429),ej=e.i(967052),eS=e.i(666050),eN=r,eC=e.i(815545),ew=e.i(171997),eT=e.i(466472),eE=e.i(687256),e_=r,eD=e.i(667852),eP=e.i(53071),eI=e.i(17203),eO=e.i(382490),eR=e.i(546024),eA=e.i(211570),ek=e.i(828945),eL=e.i(102703),eF=e.i(613580),eM=e.i(390974),e$=e.i(502653),eK=e.i(707409),eU=e.i(819993),eq=e.i(799034),ez=e.i(479232),eY=e.i(975924),eH=e.i(917007),eB=e.i(549815),eQ=e.i(911509),eV=e.i(996960),eW=e.i(866205),eG=e.i(681328),eJ=e.i(36380),eX=e.i(832237),eZ=e.i(231766),e0=e.i(956592);let e1=({column:e=eG.EMPTY_OBJ,relations:a=eG.EMPTY_ARR,enumTypes:r=eG.EMPTY_ARR,isNewRecord:i=!1,hasForeignKeys:s=!1,hasImportContent:l=!1,dragHandleProps:o=eG.EMPTY_OBJ,onUpdateColumn:c,onRemoveColumn:d,onEditForeignKey:u})=>{let{data:m}=(0,X.useSelectedProjectQuery)(),[h,p]=(0,n.useState)(!1),g=eJ.typeExpressionSuggestions?.[e.format]??[],f=[+!!e.isNullable,+!!e.isIdentity,+!!e.isUnique,+!!e.isArray].reduce((e,t)=>e+t,0),{data:x}=(0,eh.useForeignKeyConstraintsQuery)({projectRef:m?.ref,connectionString:m?.connectionString,schema:e.schema}),y=e=>{let t=(x??[]).find(t=>t.id===e.id),r=a.find(t=>t.id===e.id);return r?.toRemove?"REMOVE":void 0===t&&void 0!==r?"ADD":void 0!==t&&void 0!==r?(0,e0.checkIfRelationChanged)(t,r)?"UPDATE":void 0:void 0},b=a.map(e=>y(e)).some(e=>void 0!==e);return(0,t.jsxs)("div",{className:"flex w-full items-center",children:[(0,t.jsx)("div",{className:`w-[5%] ${!i?"hidden":""}`,children:(0,t.jsx)("div",{className:"cursor-drag",...o,children:(0,t.jsx)(eq.Menu,{strokeWidth:1,size:16})})}),(0,t.jsx)("div",{className:"w-[25%]",children:(0,t.jsxs)("div",{className:"flex w-[95%] items-center justify-between",children:[(0,t.jsx)(ew.Input,{size:"small",value:e.name,title:e.name,disabled:l,placeholder:"column_name",className:(0,_.cn)("[&>div>div>div>input]:py-1.5 [&>div>div>div>input]:border-r-transparent [&>div>div>div>input]:rounded-r-none",l?"opacity-50":""),onChange:e=>c({name:e.target.value})}),0===a.filter(e=>!e.toRemove).length?(0,t.jsx)(E.Button,{type:"dashed",className:"rounded-l-none h-[30px] py-0 px-2",onClick:()=>u(),children:(0,t.jsx)(eU.Link,{size:12})}):(0,t.jsxs)(Z.Popover_Shadcn_,{open:h,onOpenChange:p,modal:!1,children:[(0,t.jsx)(et.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(E.Button,{type:"default",className:"rounded-l-none h-[30px] py-0 px-2",children:(0,t.jsx)(eU.Link,{size:12})})}),(0,t.jsxs)(ee.PopoverContent_Shadcn_,{className:(0,_.cn)("p-0",b?"w-96":"w-72"),side:"bottom",align:"center",children:[(0,t.jsxs)("div",{className:"text-xs px-2 pt-2",children:["Involved in ",a.length," foreign key",a.length>1?"s":""]}),(0,t.jsx)(eW.Command_Shadcn_,{children:(0,t.jsxs)(eQ.CommandList_Shadcn_,{children:[(0,t.jsx)(eH.CommandGroup_Shadcn_,{children:a.map((a,r)=>{let n=String(a?.id??`${e.id}-relation-${r}`),i=y(a);return"REMOVE"===i?null:(0,t.jsx)(eB.CommandItem_Shadcn_,{value:n,className:"cursor-pointer w-full",onSelect:()=>u(a),onClick:()=>u(a),children:void 0===i?(0,t.jsx)("div",{className:"w-full flex items-center justify-between truncate",children:a.name}):(0,t.jsxs)("div",{className:"flex items-center gap-x-2 truncate",children:[(0,t.jsx)(T.Badge,{variant:"ADD"===i?"success":"warning",children:i}),(0,t.jsx)("p",{className:"truncate",children:a.name||(0,t.jsxs)(t.Fragment,{children:["To"," ",a.columns.filter(t=>t.source===e.name).map(e=>(0,t.jsxs)("code",{children:[a.schema,".",a.table,".",e.target]},`${e.source}-${e.target}`)),a.columns.length>1&&(0,t.jsxs)(t.Fragment,{children:["and ",a.columns.length-1," other column",a.columns.length>2?"s":""]})]})})]})},n)})}),(0,t.jsx)(eV.CommandSeparator_Shadcn_,{}),(0,t.jsx)(eH.CommandGroup_Shadcn_,{children:(0,t.jsxs)(eB.CommandItem_Shadcn_,{className:"cursor-pointer w-full gap-x-2",onSelect:()=>u(),onClick:()=>u(),children:[(0,t.jsx)(ez.Plus,{size:14,strokeWidth:1.5}),(0,t.jsx)("p",{children:"Add foreign key relation"})]})})]})})]})]})]})}),(0,t.jsx)("div",{className:"w-[25%]",children:(0,t.jsx)("div",{className:"w-[95%]",children:(0,t.jsx)(eX.default,{value:e.format,enumTypes:r,showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:s,description:s?"Column type cannot be changed as it has a foreign key relation":"",onOptionSelect:e=>{c({format:e,defaultValue:"uuid"===e?"gen_random_uuid()":null})}})})}),(0,t.jsx)("div",{className:`${i?"w-[25%]":"w-[30%]"}`,children:(0,t.jsx)("div",{className:"w-[95%]",children:(0,t.jsx)(eZ.default,{"data-testid":`${e.name}-default-value`,placeholder:"string"==typeof e.defaultValue&&0===e.defaultValue.length?"EMPTY":"NULL",size:"small",value:e.defaultValue??"",disabled:e.format.includes("int")&&e.isIdentity,className:`rounded bg-surface-100 lg:gap-0 ${e.format.includes("int")&&e.isIdentity?"opacity-50":""}`,suggestions:g,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>c({defaultValue:e.target.value}),onSelectSuggestion:e=>c({defaultValue:e.value})})})}),(0,t.jsx)("div",{className:"w-[10%]",children:(0,t.jsx)(eC.Checkbox,{label:"",checked:e.isPrimaryKey,onChange:()=>{let t=!e.isPrimaryKey;c({isPrimaryKey:t,isNullable:!t&&e.isNullable})}})}),(0,t.jsx)("div",{className:`${l?"w-[10%]":"w-[0%]"}`}),(0,t.jsx)("div",{className:"flex w-[5%] justify-end",children:(!e.isPrimaryKey||e.format.includes("int"))&&(0,t.jsxs)(Z.Popover_Shadcn_,{children:[(0,t.jsxs)(et.PopoverTrigger_Shadcn_,{"data-testid":`${e.name}-extra-options`,className:"group flex items-center -space-x-1",children:[f>0&&(0,t.jsx)("div",{className:"rounded-full bg-foreground h-4 w-4 flex items-center justify-center text-xs text-background",children:f}),(0,t.jsx)("div",{className:"text-foreground-light transition-colors group-hover:text-foreground",children:(0,t.jsx)(L.Settings,{size:16,strokeWidth:1})})]}),(0,t.jsxs)(ee.PopoverContent_Shadcn_,{align:"end",className:"w-96 p-0",children:[(0,t.jsx)("div",{className:"flex items-center justify-center bg-surface-200 space-y-1 py-1.5 px-3 border-b border-overlay",children:(0,t.jsx)("h5",{className:"text-foreground",children:"Extra options"})}),(0,t.jsxs)("div",{className:"flex flex-col space-y-1",children:[!e.isPrimaryKey&&(0,t.jsx)(eC.Checkbox,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:e.isNullable,className:"p-4",onChange:()=>c({isNullable:!e.isNullable})}),(0,t.jsx)(eC.Checkbox,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:e.isUnique,className:"p-4",onChange:()=>c({isUnique:!e.isUnique})}),e.format.includes("int")&&(0,t.jsx)(eC.Checkbox,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:e.isIdentity,className:"p-4",onChange:()=>{let t=!e.isIdentity,a=!t&&e.isArray;c({isIdentity:t,isArray:a})}}),!e.isPrimaryKey&&(0,t.jsx)(eC.Checkbox,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:e.isArray,className:"p-4",onChange:()=>{let t=!e.isArray,a=!t&&e.isIdentity;c({isArray:t,isIdentity:a})}})]},`${e.id}_configuration`)]})]})}),!l&&(0,t.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,t.jsx)("button",{className:"cursor-pointer",onClick:()=>d(),children:(0,t.jsx)(eY.X,{size:16,strokeWidth:1})})})]})},e2=({table:e,columns:a=[],relations:r,enumTypes:i=[],importContent:o,isNewRecord:d,onColumnsUpdated:u=e_.default,onSelectImportData:m=e_.default,onClearImportContent:h=e_.default,onUpdateFkRelations:p})=>{let{ref:g}=(0,s.useParams)(),{data:f}=(0,c.useSelectedOrganizationQuery)(),[x,y]=(0,n.useState)(!1),[b,v]=(0,n.useState)(),[j,S]=(0,n.useState)(),{mutate:T}=(0,l.useSendEventMutation)(),_=!(0,eS.default)(o),[D,I]=(0,eD.default)(a,e=>e.isPrimaryKey),O=e=>void 0!==r.find(t=>t.columns.find(t=>t.source===e.name)),R=(e,t)=>{u(a.map(a=>{if(a.id!==e.id)return a;if(eK.TEXT_TYPES.includes(e.format)||""!==t.defaultValue||(t.defaultValue=null),"name"in t&&void 0!==a.foreignKey){let e={...a.foreignKey,source_column_name:t?.name??""};return{...a,...t,foreignKey:e}}return{...a,...t}}))},A=e=>{u(a.filter(t=>t.id!==e.id))},k=(e,t)=>{if(e.destination){if("pks"===t){let t=D.slice(),[a]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,a),u(t.concat(I))}if("others"===t){let t=I.slice(),[a]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,a),u(D.concat(t))}}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsx)("h5",{children:"Columns"}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(E.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(eI.ExternalLink,{size:12,strokeWidth:2}),children:(0,t.jsx)("a",{href:`${ev.DOCS_URL}/guides/database/tables#data-types`,target:"_blank",rel:"noreferrer",children:"About data types"})}),d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"py-3 border-r"}),_?(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(E.Button,{type:"default",icon:(0,t.jsx)(eP.Edit,{}),onClick:m,children:"Edit content"}),(0,t.jsx)(E.Button,{type:"danger",icon:(0,t.jsx)(eA.Trash,{}),onClick:h,children:"Remove content"})]}):(0,t.jsx)(E.Button,{type:"default",onClick:()=>{m(),T({action:"import_data_button_clicked",properties:{tableType:"New Table"},groups:{project:g??"Unknown",organization:f?.slug??"Unknown"}})},children:"Import data from CSV"})]})]})]}),_&&(0,t.jsxs)("p",{className:"text-sm text-foreground-light my-2",children:["Your table will be created with ",o?.rowCount?.toLocaleString()," rows and the following ",a.length," columns."]}),0===D.length&&(0,t.jsxs)(N.Alert_Shadcn_,{variant:"warning",children:[(0,t.jsx)(P.WarningIcon,{}),(0,t.jsx)(w.AlertTitle_Shadcn_,{children:"Warning: No primary keys selected"}),(0,t.jsx)(C.AlertDescription_Shadcn_,{children:"Tables should have at least one column as the primary key to identify each row. Without a primary key, you will not be able to update or delete rows from the table."})]}),D.length>1&&(0,t.jsx)(eL.default,{block:!0,icon:(0,t.jsx)(eR.Key,{size:16}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex w-full px-3",children:[d&&(0,t.jsx)("div",{className:"w-[5%]"}),(0,t.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,t.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Name"}),(0,t.jsxs)(eF.Tooltip,{children:[(0,t.jsx)(eF.TooltipTrigger,{children:(0,t.jsx)(eO.HelpCircle,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"})}),(0,t.jsx)(eF.TooltipContent,{side:"bottom",className:"w-[300px]",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})]})]}),(0,t.jsx)("div",{className:"w-[25%]",children:(0,t.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Type"})}),(0,t.jsxs)("div",{className:`${d?"w-[25%]":"w-[30%]"} flex items-center space-x-2`,children:[(0,t.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Default Value"}),(0,t.jsxs)(eF.Tooltip,{children:[(0,t.jsx)(eF.TooltipTrigger,{children:(0,t.jsx)(eO.HelpCircle,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"})}),(0,t.jsx)(eF.TooltipContent,{side:"bottom",className:"w-[300px]",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})]})]}),(0,t.jsx)("div",{className:"w-[10%]",children:(0,t.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Primary"})}),(0,t.jsx)("div",{className:`${_?"w-[10%]":"w-0"}`}),(0,t.jsx)("div",{className:"w-[5%]"}),!_&&(0,t.jsx)("div",{className:"w-[5%]"})]}),D.length>0&&(0,t.jsx)(ek.DragDropContext,{onDragEnd:e=>k(e,"pks"),children:(0,t.jsx)(ek.Droppable,{droppableId:"pk_columns_droppable",children:e=>(0,t.jsxs)("div",{ref:e.innerRef,className:`space-y-2 rounded-md bg-surface-200 px-3 py-2 ${d?"":"-mx-3"}`,children:[D.map((e,a)=>(0,t.jsx)(ek.Draggable,{draggableId:e.id,index:a,children:a=>(0,t.jsx)("div",{ref:a.innerRef,...a.draggableProps,children:(0,t.jsx)(e1,{column:e,relations:r.filter(t=>t.columns.some(t=>t.source===e.name)),enumTypes:i,hasForeignKeys:O(e),isNewRecord:d,hasImportContent:_,dragHandleProps:a.dragHandleProps,onUpdateColumn:t=>R(e,t),onRemoveColumn:()=>A(e),onEditForeignKey:t=>{y(!0),v(e),t&&S(t)}})})},e.id)),e.placeholder]})})}),(0,t.jsx)(ek.DragDropContext,{onDragEnd:e=>k(e,"others"),children:(0,t.jsx)(ek.Droppable,{droppableId:"other_columns_droppable",children:e=>(0,t.jsxs)("div",{ref:e.innerRef,className:`space-y-2 py-2 ${d?"px-3 ":""}`,children:[I.map((e,a)=>(0,t.jsx)(ek.Draggable,{draggableId:e.id,index:a,children:a=>(0,t.jsx)("div",{ref:a.innerRef,...a.draggableProps,children:(0,t.jsx)(e1,{column:e,relations:r.filter(t=>t.columns.some(t=>t.source===e.name)),enumTypes:i,isNewRecord:d,hasForeignKeys:O(e),hasImportContent:_,dragHandleProps:a.dragHandleProps,onUpdateColumn:t=>R(e,t),onRemoveColumn:()=>A(e),onEditForeignKey:t=>{y(!0),v(e),t&&S(t)}})})},e.id)),e.placeholder]})})})]}),!_&&(0,t.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,t.jsx)(E.Button,{type:"default",onClick:()=>{let e;return e=(0,eM.generateColumnField)(),void u(a.concat(e))},children:"Add column"})})]}),(0,t.jsx)(e$.ForeignKeySelector,{visible:x,column:b,table:{id:e.id,name:e.name,columns:e.columns},foreignKey:j,onClose:()=>{y(!1),S(void 0),v(void 0)},onSaveRelation:e=>{let t=r.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?p(r.map(t=>t.id===e.id?e:t)):p(r.concat([e]))}})]})};var e5=e.i(567558),e3=e.i(108151),e4=e.i(72313);let e9=({table:e,relations:a,closePanel:r,setEditorDirty:i,onUpdateFkRelations:s})=>{let{data:l}=(0,X.useSelectedProjectQuery)(),{selectedSchema:o}=(0,J.useQuerySchemaState)(),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(),{data:h,error:p,isPending:g,isSuccess:f,isError:x}=(0,eh.useForeignKeyConstraintsQuery)({projectRef:l?.ref,connectionString:l?.connectionString,schema:o});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"w-full space-y-4 ",children:[(0,t.jsx)("h5",{children:"Foreign keys"}),g&&(0,t.jsx)(e3.GenericSkeletonLoader,{}),x&&(0,t.jsx)(e5.default,{error:p,subject:"Failed to retrieve foreign key relationships"}),f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:a.map(e=>{var n;let l,o,c=(n=e,l=(h??[]).find(e=>e.id===n.id),o=a.find(e=>e.id===n.id),o?.toRemove?"REMOVE":void 0===l&&void 0!==o?"ADD":void 0!==l&&void 0!==o?(0,e0.checkIfRelationChanged)(l,o)?"UPDATE":void 0:void 0);return(0,t.jsx)(e4.ForeignKeyRow,{status:c,foreignKey:e,closePanel:r,onSelectEdit:()=>{d(!0),m(e)},onSelectRemove:()=>{i(),"ADD"===c?s(a.filter(t=>t.id!==e.id)):s(a.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{i(),s(a.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,t.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,t.jsx)(E.Button,{type:"default",onClick:()=>d(!0),children:"Add foreign key relation"})})]})]}),(0,t.jsx)(e$.ForeignKeySelector,{visible:c,table:{id:e.id,name:e.name,columns:e.columns},foreignKey:u,onClose:()=>{d(!1),m(void 0)},onSaveRelation:e=>{i();let t=a.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?s(a.map(t=>t.id===e.id?e:t)):s(a.concat([e]))}})]})},e7=({schema:e,table:a,isDuplicating:r})=>a?r?(0,t.jsxs)(t.Fragment,{children:["Duplicate table ",(0,t.jsx)("code",{className:"text-code-inline !text-sm",children:a?.name})]}):(0,t.jsxs)(t.Fragment,{children:["Update table ",(0,t.jsx)("code",{className:"text-code-inline !text-sm",children:a?.name})]}):(0,t.jsxs)(t.Fragment,{children:["Create a new table under ",(0,t.jsx)("code",{className:"text-code-inline !text-sm",children:e})]});var e8=e.i(165610),e6=e.i(250503),te=e.i(999918),tt=e.i(93472);function ta(){let{docsRowLevelSecurityGuidePath:e}=(0,eg.useCustomContent)(["docs:row_level_security_guide_path"]);return(0,t.jsxs)("div",{className:"text-sm text-foreground-light grid gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-1",children:[(0,t.jsx)(tt.Alert,{variant:"warning",className:"!px-4 !py-3",title:"This table will be publicly readable and writable",withIcon:!0,children:(0,t.jsx)("p",{children:"Anyone can edit or delete data in this table."})}),(0,t.jsxs)("ul",{className:"mt-4 space-y-5",children:[(0,t.jsxs)("li",{className:"flex gap-3",children:[(0,t.jsx)(e8.AlertOctagon,{size:14}),(0,t.jsx)("span",{children:"All requests to this table will be accepted."})]}),(0,t.jsxs)("li",{className:"flex gap-3",children:[(0,t.jsx)(te.ShieldOff,{size:14}),(0,t.jsx)("span",{children:"Auth policies will not be enforced."})]}),(0,t.jsxs)("li",{className:"flex gap-3",children:[(0,t.jsx)(e6.Lock,{size:14,className:"flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Before you turn off Row Level Security, consider:"}),(0,t.jsxs)("ul",{className:"space-y-2 mt-2",children:[(0,t.jsx)("li",{className:"list-disc ml-4",children:"Any personal information in this table will be publicly accessible."}),(0,t.jsx)("li",{className:"list-disc ml-4",children:"Anyone will be able to modify, add or delete any row in this table."})]})]})]})]})]}),(0,t.jsx)(ed.DocsButton,{abbrev:!1,className:"w-min mt-3",href:`${ev.DOCS_URL}${e}`})]})}var tr=e.i(102631),tn=e.i(302372),ti=e.i(627069),ts=e.i(138618),tl=e.i(7038),to=e.i(351844),tc=e.i(200243);let td=({policy:e,onRemove:a})=>(0,t.jsxs)(ts.HoverCard_Shadcn_,{openDelay:200,closeDelay:100,children:[(0,t.jsx)(to.HoverCardTrigger_Shadcn_,{asChild:!0,children:(0,t.jsxs)("div",{className:(0,_.cn)("flex items-center justify-between text-sm text-foreground py-2 px-3 hover:bg-surface-100 transition-colors","border-b border-default last:border-b-0"),children:[(0,t.jsx)("code",{className:"text-xs truncate flex-1",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.command&&(0,t.jsx)(T.Badge,{variant:"default",children:e.command}),e.isNew&&(0,t.jsx)(T.Badge,{variant:"success",children:"New"}),!!a&&e.isNew&&(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),a()},className:"flex items-center justify-center hover:bg-surface-200 rounded p-0.5 transition-colors","aria-label":"Remove policy",children:(0,t.jsx)(eY.X,{size:16,strokeWidth:1.5,className:"text-foreground-lighter"})})]})]})}),(0,t.jsx)(tl.HoverCardContent_Shadcn_,{className:"w-96",side:"left",children:e.sql?(0,t.jsx)(tc.SimpleCodeBlock,{className:"language-sql",showCopy:!1,children:e.sql}):(0,t.jsx)("p",{className:"text-xs text-foreground-lighter",children:"No definition available."})})]}),tu=({disabled:e=!1,policies:a,className:r,onRemove:n})=>(0,t.jsx)(ti.Card,{"aria-disabled":e,className:(0,_.cn)(e&&"opacity-50 pointer-events-none"),children:(0,t.jsx)("div",{className:`rounded border border-default overflow-hidden bg-surface-100 ${r??""}`,children:a.map((e,a)=>(0,t.jsx)(td,{policy:e,onRemove:n?()=>n(a):void 0},`${e.name}-${a}`))})});var tm=e.i(41921),th=e.i(626259),tp=e.i(215312),tg=e.i(552423);let tf=({schema:e,tableName:a,columns:r,foreignKeyRelations:s,isNewRecord:l,isRLSEnabled:o,isDuplicating:c,onGeneratedPoliciesChange:d})=>{let u=(0,ej.useTrack)(),{data:m}=(0,X.useSelectedProjectQuery)(),{includeSchemaMetadata:h}=(0,tg.useOrgAiOptInLevel)(),[p,g]=(0,n.useState)(!1),[f,x]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),{data:v}=(0,eh.useForeignKeyConstraintsQuery)({projectRef:m?.ref,connectionString:m?.connectionString,schema:e},{enabled:l&&!c&&!!e}),{title:j,description:S}=(0,n.useMemo)(()=>f?h?{title:"We could not generate policies for this table",description:"Automatic policy generation wasn't possible for this table. Update the schema and try again, or add policies manually after creating the table."}:{title:"Unable to generate policies",description:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"We couldn't detect any relationships to auth.users to suggest policies."}),(0,t.jsx)("p",{children:"Enable schema metadata sharing to use our AI-assisted policy generator."})]})}:{title:"Generate starting policies",description:(0,t.jsxs)(t.Fragment,{children:["Starter policies are generated from your table relationships to"," ",(0,t.jsx)("code",{className:"text-code-inline",children:"auth.users"})," or, if none exist, using AI."]})},[f,h]),N=f&&!h,C=async()=>{if(!m?.ref||!a||0===r.length)return i.toast.error("Unable to generate policies. Please ensure table name and columns are set.");u("rls_generate_policies_clicked"),g(!0);try{let t=a.trim(),n=e.trim(),i=[...a&&e?s.filter(e=>e.columns&&e.columns.length>0).map(t=>({id:"number"==typeof t.id?t.id:0,constraint_name:t.name||"",source_id:"number"==typeof t.tableId?t.tableId:0,source_schema:e.trim(),source_table:a.trim(),source_columns:t.columns.map(e=>e.source.trim()),target_id:0,target_schema:t.schema.trim(),target_table:t.table.trim(),target_columns:t.columns.map(e=>e.target.trim()),deletion_action:t.deletionAction||"NO ACTION",update_action:t.updateAction||"NO ACTION"})):[],...(v??[]).filter(e=>e.source_schema!==n||e.source_table!==t)],l=r.map(e=>({name:e.name.trim()})),o=await (0,tm.generateStartingPoliciesForTable)({table:{name:t,schema:n},foreignKeyConstraints:i,columns:l,projectRef:m.ref,connectionString:m.connectionString,enableAi:h});0===o.length?x(!0):(x(!1),d?.(o))}catch(e){console.error("Failed to generate policies:",e),i.toast.error(e.message||"Failed to generate policies")}finally{g(!1)}};return l&&!c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ti.Card,{children:(0,t.jsx)(ti.CardContent,{className:"flex flex-col items-center justify-center py-8",children:(0,t.jsxs)("div",{className:(0,_.cn)("flex flex-col items-center gap-4 text-center",!f&&"max-w-sm"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("h4",{className:"text-sm text-foreground",children:j}),(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:S})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(tp.ButtonTooltip,{type:"default",size:"tiny",onClick:C,loading:p,disabled:p||!o||!a||0===r.length,tooltip:{content:{side:"bottom",text:a?0===r.length?"Create at least one column first before generating policies":void 0:"Provide a name for your table first before generating policies"}},children:p?"Generating policies...":f?"Try generating again":"Generate policies"}),N&&(0,t.jsx)(E.Button,{type:"default",size:"tiny",onClick:()=>b(!0),disabled:p,children:"Permission settings"})]})]})})}),(0,t.jsx)(th.AIOptInModal,{visible:y,onCancel:()=>b(!1)})]}):(0,t.jsx)(ti.Card,{children:(0,t.jsx)(ti.CardContent,{children:(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:"No policies exist for this table"})})})};var tx=e.i(847278);let ty=({table:e,isRLSEnabled:a=!1,onSuccess:r})=>{let{data:s}=(0,X.useSelectedProjectQuery)(),[l,o]=(0,n.useState)(!1),c=a?"Disable":"Enable",{mutate:d,isPending:u}=(0,tx.useTableUpdateMutation)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(E.Button,{type:"default",className:"w-min",onClick:()=>o(!0),children:[c," RLS"]}),(0,t.jsx)(eT.default,{visible:l,loading:u,title:`Confirm to ${c.toLowerCase()} Row Level Security`,description:`Are you sure you want to ${c.toLowerCase()} Row Level Security for this table?`,confirmLabel:`${c} RLS`,onCancel:()=>o(!1),onConfirm:()=>s?e?void d({id:e.id,projectRef:s?.ref,connectionString:s?.connectionString,schema:e.schema,name:e.name,payload:{rls_enabled:!a}},{onSuccess:()=>{i.toast.success(`Row Level Security has been ${c.toLowerCase()} for this table.`),r?.(!a),o(!1)},onError:e=>{i.toast.error(`Failed to ${c.toLowerCase()} RLS: ${e.message}`)}}):console.error("Table is missing"):console.error("Project is required")})]})},tb=({table:e,tableFields:a,foreignKeyRelations:r=[],isNewRecord:i,isDuplicating:s,isExposed:l,generatedPolicies:o=[],onRLSUpdate:c,onGeneratedPoliciesChange:d})=>{let u=(0,ej.useTrack)(),{data:m}=(0,X.useSelectedProjectQuery)(),{selectedSchema:h}=(0,J.useQuerySchemaState)(),{name:p,columns:g,isRLSEnabled:f}=a,x=e?.schema??h,y=!!e&&!i&&!s,b=o[0]?.table,v=i&&p!==b,j=y&&!f||v,{data:S}=(0,tn.useDatabasePoliciesQuery)({projectRef:m?.ref,connectionString:m?.connectionString},{enabled:!i&&!s}),N=(S??[]).filter(t=>t.schema===e?.schema&&t.table===e?.name),C=(0,n.useMemo)(()=>(N??[]).map(e=>({name:e.name,command:e.action??e.command,sql:(0,tr.generatePolicyUpdateSQL)(e),isNew:!1})),[N]),w=(0,n.useMemo)(()=>o.map(e=>({name:e.name,command:e.command,sql:e.sql,isNew:!0})),[o]),T=(0,n.useMemo)(()=>[...C,...w],[C,w]),D=T.length>0;return(0,t.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{children:"Policies"}),(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Set rules around who can read and write data to this table"})]}),!i&&(0,t.jsx)(E.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(eI.ExternalLink,{}),children:(0,t.jsx)(F.default,{target:"_blank",rel:"noopener noreferrer",href:`/project/${m?.ref}/auth/policies`,children:"Manage policies"})})]}),o.length>0&&v&&(0,t.jsx)(er.Admonition,{type:"warning",title:"Update generated policies with new table name",description:`These policies were previously generated for the table name "${b}"`,actions:(0,t.jsx)(E.Button,{type:"default",className:"w-min mt-3",onClick:()=>{let e=o.map(e=>({...e,table:p,name:e.name.replaceAll(b,p),sql:e.sql.replaceAll(b,p)}));d?.(e)},children:"Update policies"})}),(0,t.jsx)(er.Admonition,{className:(0,_.cn)("mb-0",i||f||!1===l?"hidden":"block"),type:"warning",title:"Row Level Security is currently disabled",description:"Your table is currently accessible by anyone on the internet. We recommend enabling RLS to restrict access.",actions:(0,t.jsxs)("div",{className:"flex items-center gap-x-2 mt-3",children:[(0,t.jsx)(ty,{table:e,isRLSEnabled:f,onSuccess:c}),(0,t.jsx)(ed.DocsButton,{href:`${ev.DOCS_URL}/guides/database/postgres/row-level-security`})]})}),D?(0,t.jsx)(tu,{policies:T,disabled:j,className:"border-0 rounded-none",onRemove:i&&!s?e=>{let t=e-C.length;if(t>=0&&t<o.length){let e=o.filter((e,a)=>a!==t);d?.(e),m?.ref&&u("rls_generated_policy_removed")}}:void 0}):(0,t.jsx)(tf,{schema:x,tableName:p,columns:g,foreignKeyRelations:r,isNewRecord:i,isDuplicating:s,isRLSEnabled:f,onGeneratedPoliciesChange:e=>{d?.(e)}})]})};var tv=e.i(48189);let tj=[{id:(0,tv.uuidv4)(),name:"id",schema:"",table:"",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,tv.uuidv4)(),name:"created_at",schema:"",table:"",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];var tS=e.i(186516);let tN=(e,t,a=!1,r=!1)=>({id:e.id,name:a?`${e.name}_duplicate`:e.name,comment:a?`This is a duplicate of ${e.name}`:e?.comment,columns:(e.columns??[]).map(a=>(0,eM.generateColumnFieldFromPostgresColumn)(a,e,t)),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:r});var tC=e.i(580984);e.s(["TableEditor",0,({table:e,isDuplicating:a,templateData:r,visible:s=!1,closePanel:l=eN.default,saveChanges:c=eN.default,updateEditorDirty:m=eN.default,apiAccessToggleHandler:p})=>{let g=(0,ej.useTrack)(),f=(0,d.useTableEditorStateSnapshot)(),x=(0,n.useContext)(d.TableEditorStateContext),{realtimeAll:y}=(0,ef.useIsFeatureEnabled)(["realtime:all"]),{docsRowLevelSecurityGuidePath:b}=(0,eg.useCustomContent)(["docs:row_level_security_guide_path"]),v=(0,tC.useDataApiGrantTogglesEnabled)(),[j,S]=(0,ey.useUrlState)(),{data:N}=(0,X.useSelectedProjectQuery)(),{selectedSchema:C}=(0,J.useQuerySchemaState)(),w=void 0===e,E=(0,o.useChanged)(s),[_,D]=(0,n.useState)({}),[P,I]=(0,n.useState)(),[O,R]=(0,n.useState)([]),[A,L]=(0,n.useState)(!1),[F,M]=(0,n.useState)(),[$,K]=(0,n.useState)(!1),[q,z]=(0,n.useState)(!1),[Y,H]=(0,n.useState)([]),{enabled:B}=(0,ex.useTableCreateGeneratePolicies)({isNewRecord:w,projectInsertedAt:N?.inserted_at}),{data:Q}=(0,ep.useEnumeratedTypesQuery)({projectRef:N?.ref,connectionString:N?.connectionString}),{data:V}=(0,eb.useProtectedSchemas)({excludeSchemas:["extensions"]}),W=(Q??[]).filter(e=>!V.find(t=>t.name===e.schema)),{data:G}=(0,eu.useDatabasePublicationsQuery)({projectRef:N?.ref,connectionString:N?.connectionString}),Z=(G??[]).find(e=>"supabase_realtime"===e.name),ee=Z?.tables??[],et=!w&&ee.some(t=>t.id===e?.id),{data:ea}=(0,em.useTableConstraintsQuery)({projectRef:N?.ref,connectionString:N?.connectionString,id:e?.id}),en=(ea??[]).find(e=>e.type===em.CONSTRAINT_TYPE.PRIMARY_KEY_CONSTRAINT),{data:ei,isSuccess:es}=(0,eh.useForeignKeyConstraintsQuery)({projectRef:N?.ref,connectionString:N?.connectionString,schema:e?.schema},{enabled:!w&&!!e?.schema}),el=(0,n.useMemo)(()=>(ei??[]).filter(t=>t.source_schema===e?.schema&&t.source_table===e?.name),[ei,e]),ec=e=>{I({...P,...e}),m();let t={..._};for(let a of Object.keys(e))delete t[a];D(t)},e_=e=>{if(void 0===P)return;let t=[];e.forEach(e=>{e.columns.forEach(e=>{let a=P.columns.find(t=>t.name===e.source);a?.isNewColumn&&e.targetType&&t.push({...a,format:e.targetType})})}),t.length>0&&I({...P,columns:P.columns.map(e=>{let a=t.find(t=>t.id===e.id);return a||e})}),R(e)},eD=async t=>{if(P){let r,n=(r={},0===P.name.length&&(r.name="Please assign a name for your table"),(0,tS.default)(P.columns,e=>0===e.format.length)&&(r.columns="Ensure that all your columns are assigned a type"),(0,tS.default)(P.columns,e=>0===e.name.length)&&(r.columns="Ensure that all your columns are named"),r);n.name&&i.toast.error(n.name),n.columns&&i.toast.error(n.columns),D(n);let s=P.name.trim()!==e?.name,l=P.comment!==e?.comment,o=P.isRLSEnabled!==(e?.rls_enabled??!1);if((0,eS.default)(n)){let r={tableId:e?.id,importContent:F,isRLSEnabled:P.isRLSEnabled,isRealtimeEnabled:P.isRealtimeEnabled,isDuplicateRows:A,existingForeignKeyRelations:el,primaryKey:en},n=P.columns.map(e=>({...e,name:e.name.trim()}));w?c({action:"create",payload:{name:P.name.trim(),schema:C,comment:P.comment?.trim()},configuration:r,columns:n,foreignKeyRelations:O,resolve:t,generatedPolicies:Y}):a?c({action:"duplicate",payload:{name:P.name.trim(),comment:P.comment?.trim()},configuration:r,columns:n,foreignKeyRelations:O,resolve:t,generatedPolicies:[]}):c({action:"update",payload:{...s&&{name:P.name.trim()},...l&&{comment:P.comment?.trim()??""},...o&&{rls_enabled:P.isRLSEnabled}},configuration:r,columns:n,foreignKeyRelations:O,resolve:t,generatedPolicies:[]})}else t()}};if((0,n.useEffect)(()=>{"table"===j.create&&"none"===f.ui.open&&(x.onAddTable(),S({...j,create:void 0}))},[x,S,f.ui.open,j]),(0,n.useEffect)(()=>{if(E&&s)if(D({}),M(void 0),L(!1),H([]),w){let e={id:0,name:"",comment:"",columns:tj,isRLSEnabled:!0,isRealtimeEnabled:!1};r?I({...e,...r}):I(e),R([])}else I(tN(e,ei??[],a,et))},[s,r,ei,et,w,a,e,E]),(0,n.useEffect)(()=>{w||I(tN(e,ei??[],a,et))},[w,e,ei,a,et]),(0,n.useEffect)(()=>{es&&R((0,eE.formatForeignKeys)(el))},[es,el]),(0,n.useEffect)(()=>{F&&!(0,eS.default)(F)&&ec({columns:(e=>{let{headers:t,selectedHeaders:a,columnTypeMap:r}=e;return t.filter(e=>a.includes(e)).map(e=>{let t=r[e];return(0,eM.generateColumnField)({name:e,format:t})})})(F)})},[F]),!P)return null;let eP=v||B,eI=v?!!p.data?.schemaExposed&&(0,U.checkDataApiPrivilegesNonEmpty)(p.data.privileges):void 0;return(0,t.jsxs)(u.SidePanel,{"data-testid":"table-editor-side-panel",size:"large",visible:s,header:(0,t.jsx)(e7,{schema:C,table:e,isDuplicating:a}),className:`transition-all duration-100 ease-in ${$?" mr-32":""}`,onCancel:l,onConfirm:()=>e=>eD(e),customFooter:(0,t.jsx)(h.ActionBar,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:l,applyFunction:e=>eD(e),visible:s}),children:[(0,t.jsxs)(u.SidePanel.Content,{className:"space-y-10 py-6",children:[(0,t.jsx)(ew.Input,{"data-testid":"table-name-input",label:"Name",layout:"horizontal",type:"text",error:_.name?String(_.name):void 0,value:P?.name,onChange:e=>ec({name:e.target.value})}),(0,t.jsx)(ew.Input,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:P?.comment??"",onChange:e=>ec({comment:e.target.value})})]}),(0,t.jsx)(u.SidePanel.Separator,{}),!B&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.SidePanel.Content,{className:"space-y-10 py-6",children:[(0,t.jsx)(eC.Checkbox,{id:"enable-rls",label:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,t.jsx)(T.Badge,{children:"Recommended"})]}),description:"Restrict access to your table by enabling RLS and writing Postgres policies.",checked:P.isRLSEnabled,onChange:()=>{P.isRLSEnabled?z(!0):ec({isRLSEnabled:!P.isRLSEnabled})},size:"medium"}),P.isRLSEnabled?(0,t.jsx)(er.Admonition,{type:"default",className:"!mt-3",title:"Policies are required to query data",description:(0,t.jsxs)(t.Fragment,{children:["You need to create an access policy before you can query data from this table. Without a policy, querying this table will return an"," ",(0,t.jsx)("u",{className:"text-foreground",children:"empty array"})," of results."," ",w?"You can create policies after saving this table.":""]}),children:(0,t.jsx)(ed.DocsButton,{abbrev:!1,className:"mt-2",href:`${ev.DOCS_URL}${b}`})}):(0,t.jsx)(er.Admonition,{type:"warning",className:"!mt-3",title:"You are allowing anonymous access to your table",description:(0,t.jsxs)(t.Fragment,{children:[P.name?`The table ${P.name}`:"Your table"," will be publicly writable and readable"]}),children:(0,t.jsx)(ed.DocsButton,{abbrev:!1,className:"mt-2",href:`${ev.DOCS_URL}${b}`})}),y&&(0,t.jsx)(eC.Checkbox,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:P.isRealtimeEnabled,onChange:()=>{g("realtime_toggle_table_clicked",{newState:P.isRealtimeEnabled?"disabled":"enabled",origin:"tableSidePanel"}),ec({isRealtimeEnabled:!P.isRealtimeEnabled})},size:"medium"})]}),(0,t.jsx)(u.SidePanel.Separator,{})]}),(0,t.jsxs)(u.SidePanel.Content,{className:"space-y-10 py-6",children:[!a&&(0,t.jsx)(e2,{table:P,columns:P?.columns,relations:O,enumTypes:W,isNewRecord:w,importContent:F,onColumnsUpdated:e=>ec({columns:e}),onSelectImportData:()=>K(!0),onClearImportContent:()=>{ec({columns:tj}),M(void 0)},onUpdateFkRelations:e_}),a&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(eC.Checkbox,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:A,onChange:()=>L(!A),size:"medium"})}),(0,t.jsx)(k,{visible:$,headers:F?.headers,rows:F?.rows,saveContent:e=>{M(e),K(!1)},closePanel:()=>K(!1)}),!B&&(0,t.jsx)(eT.ConfirmationModal,{visible:q,title:"Turn off Row Level Security",confirmLabel:"Confirm",size:"medium",onCancel:()=>z(!1),onConfirm:()=>{ec({isRLSEnabled:!P.isRLSEnabled}),z(!1)},children:(0,t.jsx)(ta,{})})]}),!a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.SidePanel.Separator,{}),(0,t.jsx)(u.SidePanel.Content,{className:"py-6",children:(0,t.jsx)(e9,{table:P,relations:O,closePanel:l,setEditorDirty:()=>m(),onUpdateFkRelations:e_})})]}),eP&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.SidePanel.Separator,{}),(0,t.jsxs)(u.SidePanel.Content,{className:"py-6 space-y-6",children:[v&&(0,t.jsx)(eo,{projectRef:N?.ref,schemaName:w?C:e?.schema,tableName:w||a?P.name:P.name||e?.name,handler:p}),B&&!a&&(0,t.jsx)(tb,{table:e,tableFields:P,foreignKeyRelations:w?O:void 0,isNewRecord:w,isDuplicating:a,isExposed:eI,generatedPolicies:Y,onGeneratedPoliciesChange:H,onRLSUpdate:e=>ec({isRLSEnabled:e})})]})]})]},"TableEditor")}],355150)},152992,e=>{"use strict";var t=e.i(478902),a=e.i(38429),r=e.i(356003),n=e.i(355901);e.i(967533);var i=e.i(721490),s=e.i(592383),l=e.i(513826),o=e.i(714403),c=e.i(10429),d=e.i(908937),u=e.i(201461),m=e.i(790819),h=e.i(46974);function p({table:e,rows:t}){let{primaryKeys:a,error:r}=(0,h.getPrimaryKeys)({table:e});if(r)throw r;let n=new i.Query().from(e.name,e.schema??void 0).delete();return a?.forEach(e=>{let a=t.map(t=>t[e]);n=n.filter(e,"in",a)}),n.toSql()}async function g({projectRef:e,connectionString:t,table:a,rows:r,roleImpersonationState:n}){let i=(0,d.wrapWithRoleImpersonation)(p({table:a,rows:r}),n),{result:s}=await (0,o.executeSql)({projectRef:e,connectionString:t,sql:i,isRoleImpersonationEnabled:(0,u.isRoleImpersonationEnabled)(n?.role)});return s}e.s(["getTableRowDeleteSql",()=>p,"useTableRowDeleteMutation",0,({onSuccess:e,onError:i,...o}={})=>{let d=(0,r.useQueryClient)();return(0,a.useMutation)({mutationFn:e=>g(e),async onSuccess(t,a,r){let{projectRef:n,table:i}=a;await d.invalidateQueries({queryKey:m.tableRowKeys.tableRowsAndCount(n,i.id)}),await e?.(t,a,r)},async onError(e,a,r){if(void 0===i){let{table:r,rows:i}=a,o=e.message.includes("Please add a primary key column"),d=e.message.includes("violates foreign key constraint"),u=i.length>1;if(d){let a=r.name,i=e.message.split("on table ")[2].replaceAll('"',""),o=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),d=u?`Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table \`${i}\`.`:`Unable to delete row as it is currently referenced by a foreign key constraint from the table \`${i}\`.`,m=`Set an on delete behavior on the foreign key relation \`${o}\` in the \`${i}\` table to automatically respond when row(s) are being deleted in the \`${a}\` table.`;(0,n.toast)(d,{description:(0,t.jsx)(s.Markdown,{content:m,className:"[&>p]:m-0"}),action:(0,t.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,t.jsx)(l.DocsButton,{href:`${c.DOCS_URL}/guides/database/postgres/cascade-deletes`})})})}else o?(0,n.toast)("Unable to delete row(s) as table has no primary keys",{description:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(l.DocsButton,{href:`${c.DOCS_URL}/guides/database/tables#primary-keys`})})]})}):n.toast.error(`Failed to delete table row: ${e.message}`)}else i(e,a,r)},...o})}])},565066,847498,e=>{"use strict";var t=e.i(478902),a=e.i(356003),r=e.i(666050),n=e.i(674765),i=e.i(964727),s=e.i(389959),l=e.i(355901),o=e.i(623705),c=e.i(463333),d=e.i(270629),u=e.i(580984);e.i(128328);var m=e.i(158639),h=e.i(509847),p=e.i(518152),g=e.i(321605),f=e.i(587768),x=e.i(246230),y=e.i(311827),b=e.i(497761),v=e.i(915993),j=e.i(818135),S=e.i(938343),N=e.i(962217),C=e.i(790819),w=e.i(811419),T=e.i(478145),E=e.i(138658),_=e.i(738196),D=e.i(265735),P=e.i(635494),I=e.i(627487),O=e.i(412385),R=e.i(761755),A=e.i(238944),k=e.i(967052),L=e.i(201461),F=e.i(636047),M=e.i(63519),$=e.i(474325),K=e.i(466472),U=e.i(274418),q=e.i(33883),z=e.i(825613),Y=e.i(888970),H=e.i(328675),B=e.i(831536),Q=e.i(554222),V=e.i(653581),W=e.i(294459),G=e.i(258032),J=e.i(355150),X=e.i(38429),Z=e.i(714403),ee=e.i(774184),et=e.i(908937),ea=e.i(3694),er=e.i(152992);async function en({projectRef:e,connectionString:t,operations:a,roleImpersonationState:r}){let n;if(0===a.length)return{result:[]};let i=(n={[ea.QueuedOperationType.DELETE_ROW]:0,[ea.QueuedOperationType.ADD_ROW]:1,[ea.QueuedOperationType.EDIT_CELL_CONTENT]:2},[...a].sort((e,t)=>n[e.type]-n[t.type])).map(e=>{let t=function(e){switch(e.type){case ea.QueuedOperationType.EDIT_CELL_CONTENT:{let{payload:t}=e;return(0,T.getTableRowUpdateSql)({table:{id:t.table.id,name:t.table.name,schema:t.table.schema},configuration:{identifiers:t.rowIdentifiers},payload:{[t.columnName]:t.newValue},enumArrayColumns:t.enumArrayColumns??[],returning:!1})}case ea.QueuedOperationType.ADD_ROW:{let{payload:t}=e,{__tempId:a,idx:r,...n}=t.rowData;return(0,w.getTableRowCreateSql)({table:{id:t.table.id,name:t.table.name,schema:t.table.schema},payload:n,enumArrayColumns:t.enumArrayColumns??[],returning:!1})}case ea.QueuedOperationType.DELETE_ROW:{let{payload:t}=e,a={idx:0,...t.rowIdentifiers};return(0,er.getTableRowDeleteSql)({table:t.table,rows:[a]})}default:throw Error(`Unknown operation: ${e.type}`)}}(e);return t.endsWith(";")?t.slice(0,-1):t}),s=(0,ee.wrapWithTransaction)(i.join(";\n")+";"),l=(0,et.wrapWithRoleImpersonation)(s,r),{result:o}=await (0,Z.executeSql)({projectRef:e,connectionString:t,sql:l,isRoleImpersonationEnabled:(0,L.isRoleImpersonationEnabled)(r?.role),queryKey:["operation-queue-save"]});return{result:o}}function ei(e={}){let{onSaveSuccess:t,onCancelSuccess:r}=e,n=(0,a.useQueryClient)(),{data:i}=(0,P.useSelectedProjectQuery)(),o=(0,F.useTableEditorStateSnapshot)(),c=(0,L.useGetImpersonatedRoleState)(),{mutate:d,isPending:u}=(({onSuccess:e,onError:t,...r}={})=>{let n=(0,a.useQueryClient)();return(0,X.useMutation)({mutationFn:e=>en(e),async onSuccess(t,a,r){let{projectRef:i,operations:s}=a,l=[...new Set(s.map(e=>e.tableId))];await Promise.all(l.map(e=>n.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(i,e)}))),await e?.(t,a,r)},async onError(e,a,r){void 0===t?l.toast.error(`Failed to save changes: ${e.message}`):t(e,a,r)},...r})})({onSuccess:()=>{o.clearQueue(),o.closeSidePanel(),l.toast.success("Changes saved successfully"),t?.()},onError:e=>{o.setQueueStatus("idle"),l.toast.error(`Failed to save changes: ${e.message}`)}}),m="saving"===o.operationQueue.status||u,h=o.operationQueue.operations;return{handleSave:(0,s.useCallback)(()=>{i&&0!==h.length&&(o.setQueueStatus("saving"),d({projectRef:i.ref,connectionString:i.connectionString,operations:h,roleImpersonationState:c()}))},[o,i,h,d,c]),handleCancel:(0,s.useCallback)(()=>{let e=[...new Set(o.operationQueue.operations.map(e=>e.tableId))];o.clearQueue(),i&&e.forEach(e=>{n.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(i.ref,e)})}),r?.()},[o,i,n,r]),isSaving:m}}e.s(["useOperationQueueActions",()=>ei],847498);var es=e.i(837710),el=e.i(539013),eo=e.i(479232),ec=e.i(975924);let ed=e=>null===e?"NULL":void 0===e?"UNDEFINED":"object"==typeof e?JSON.stringify(e):String(e),eu=({operationId:e,tableId:r,content:n})=>{let{table:i,rowData:s}=n,l=i.schema,o=i.name,c=(0,a.useQueryClient)(),{data:d}=(0,P.useSelectedProjectQuery)(),u=(0,F.useTableEditorStateSnapshot)(),m=`${l}.${o}`,h=Object.entries(s).filter(([e])=>!e.startsWith("__")&&"idx"!==e),p=h.slice(0,3),g=h.length-p.length;return(0,t.jsxs)("div",{className:"border rounded-md overflow-hidden bg-surface-100 border-l-4 border-l-brand-500",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-default bg-surface-200 flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1 flex items-start gap-2",children:[(0,t.jsx)(eo.Plus,{size:14,className:"text-brand-500 mt-0.5 shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-foreground font-mono",children:m}),(0,t.jsx)("div",{className:"text-sm text-foreground-muted mt-0.5",children:(0,t.jsx)("span",{className:"font-medium text-foreground",children:"New row"})})]})]}),(0,t.jsx)(es.Button,{type:"text",size:"tiny",icon:(0,t.jsx)(ec.X,{size:14}),onClick:()=>{u.removeOperation(e),d&&c.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(d.ref,r)})},className:"shrink-0","aria-label":"Remove operation"})]}),(0,t.jsxs)("div",{className:"px-3 py-2 text-xs font-mono space-y-1 bg-brand-100/30",children:[p.map(([e,a])=>(0,t.jsxs)("div",{className:"flex items-start gap-2 text-foreground",children:[(0,t.jsxs)("span",{className:"text-foreground-light",children:[e,":"]}),(0,t.jsx)("span",{className:"truncate",title:ed(a),children:ed(a)})]},e)),g>0&&(0,t.jsxs)("div",{className:"text-foreground-light",children:["+",g," more column(s)"]})]})]})};var em=e.i(432946);let eh=({operationId:e,tableId:r,content:n})=>{let{table:i,rowIdentifiers:s}=n,l=i.schema,o=i.name,c=(0,a.useQueryClient)(),{data:d}=(0,P.useSelectedProjectQuery)(),u=(0,F.useTableEditorStateSnapshot)(),m=`${l}.${o}`,h=Object.entries(s).map(([e,t])=>`${e} = ${ed(t)}`).join(", ");return(0,t.jsxs)("div",{className:"border rounded-md overflow-hidden bg-surface-100 border-l-4 border-l-destructive-500",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-default bg-surface-200 flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1 flex items-start gap-2",children:[(0,t.jsx)(em.Trash2,{size:14,className:"text-destructive-500 mt-0.5 shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-foreground font-mono",children:m}),(0,t.jsxs)("div",{className:"text-sm text-foreground-muted mt-0.5",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Delete row"}),(0,t.jsx)("span",{className:"text-foreground-muted mx-2",children:""}),(0,t.jsxs)("span",{className:"text-foreground text-xs",children:["where ",h]})]})]})]}),(0,t.jsx)(es.Button,{type:"text",size:"tiny",icon:(0,t.jsx)(ec.X,{size:14}),onClick:()=>{u.removeOperation(e),d&&c.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(d.ref,r)})},className:"shrink-0","aria-label":"Remove operation"})]}),(0,t.jsx)("div",{className:"px-3 py-2 text-xs font-mono bg-destructive-100/30",children:(0,t.jsx)("div",{className:"text-destructive-500 line-through opacity-70",children:"Row will be deleted"})})]})};var ep=e.i(215312);let eg=({operationId:e,tableId:r,content:n})=>{let{table:i,columnName:s,oldValue:l,newValue:o,rowIdentifiers:c}=n,d=i.schema,u=i.name,m=(0,a.useQueryClient)(),{data:h}=(0,P.useSelectedProjectQuery)(),p=(0,F.useTableEditorStateSnapshot)(),g=`${d}.${u}`,f=Object.entries(c).map(([e,t])=>`${e} = ${ed(t)}`).join(", "),x=ed(l),y=ed(o);return(0,t.jsxs)("div",{className:"border rounded-md overflow-hidden bg-surface-100",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-default bg-surface-200 flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"text-xs text-foreground font-mono",children:g}),(0,t.jsxs)("div",{className:"text-sm text-foreground-muted mt-0.5",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:s}),(0,t.jsx)("span",{className:"text-foreground-muted mx-2",children:""}),(0,t.jsxs)("span",{className:"text-foreground text-xs",children:["where ",f]})]})]}),(0,t.jsx)(ep.ButtonTooltip,{type:"text",size:"tiny",icon:(0,t.jsx)(ec.X,{size:14}),onClick:()=>{p.removeOperation(e),h&&m.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(h.ref,r)})},className:"shrink-0 w-7","aria-label":"Remove operation",tooltip:{content:{side:"bottom",text:"Remove operation"}}})]}),(0,t.jsxs)("div",{className:"font-mono text-xs",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2 px-3 py-0.5 bg-red-400/20",children:[(0,t.jsx)("span",{className:"text-red-900 select-none font-bold",children:"-"}),(0,t.jsx)("span",{className:"text-red-900 truncate max-w-full",title:x,children:x})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2 px-3 py-0.5 bg-green-400/20",children:[(0,t.jsx)("span",{className:"text-green-900 select-none font-bold",children:"+"}),(0,t.jsx)("span",{className:"text-green-900 truncate max-w-full",title:y,children:y})]})]})]})},ef=({operations:e})=>{if(0===e.length)return(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"No pending changes"});let a=e.filter(ea.isAddRowOperation),r=e.filter(ea.isDeleteRowOperation),n=e.filter(ea.isEditCellContentOperation);return(0,t.jsxs)("div",{className:"space-y-6",children:[r.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-foreground-light",children:["Rows to Delete (",r.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:r.map(e=>(0,t.jsx)(eh,{operationId:e.id,tableId:e.tableId,content:e.payload},e.id))})]}),a.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-foreground-light",children:["Rows to Add (",a.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:a.map(e=>(0,t.jsx)(eu,{operationId:e.id,tableId:e.tableId,content:e.payload},e.id))})]}),n.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-foreground-light",children:["Cell Edits (",n.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,t.jsx)(eg,{operationId:e.id,tableId:e.tableId,content:e.payload},e.id))})]})]})};var ex=e.i(48189);let ey=({visible:e,closePanel:a})=>{let r=(0,ex.getModKeyLabel)(),n=(0,F.useTableEditorStateSnapshot)().operationQueue.operations,{handleSave:i,handleCancel:s,isSaving:l}=ei({onSaveSuccess:a,onCancelSuccess:a});return(0,t.jsx)(el.SidePanel,{size:"large",visible:e,onCancel:a,header:(0,t.jsx)("div",{className:"flex items-center justify-between w-full",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{children:"Pending changes"}),(0,t.jsxs)("span",{className:"text-xs text-foreground-light",children:[n.length," operation",1!==n.length?"s":""]})]})}),customFooter:(0,t.jsxs)("div",{className:"flex w-full justify-between border-t border-default px-3 py-4",children:[(0,t.jsxs)(es.Button,{type:"default",onClick:a,children:["Close",(0,t.jsxs)("span",{className:"text-foreground-lighter text-xs ml-1.5",children:[r,"."]})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(es.Button,{type:"default",onClick:s,disabled:l,children:"Cancel All"}),(0,t.jsxs)(es.Button,{onClick:i,disabled:l||0===n.length,loading:l,children:["Save All",(0,t.jsxs)("span",{className:"text-foreground-lighter text-xs ml-1.5",children:[r,"S"]})]})]})]}),children:(0,t.jsx)(el.SidePanel.Content,{className:"py-4",children:(0,t.jsx)(ef,{operations:n})})})},eb={type:"new"},ev=({visible:e,onClose:a,onCancel:r})=>(0,t.jsx)(K.ConfirmationModal,{visible:e,title:"Discard changes",confirmLabel:"Discard",onCancel:r,onConfirm:a,children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})});e.s(["SidePanelEditor",0,({editable:e=!0,selectedTable:K,includeColumns:X=!1,onTableCreated:Z=i.default})=>{let{ref:ee}=(0,m.useParams)(),et=(0,F.useTableEditorStateSnapshot)(),ea=(0,M.useTabsStateSnapshot)(),[er,en]=(0,A.useUrlState)({arrayKeys:["filter","sort"]}),ei=(0,k.useTrack)(),es=(0,a.useQueryClient)(),{data:el}=(0,P.useSelectedProjectQuery)(),{data:eo}=(0,D.useSelectedOrganizationQuery)(),ec=(0,L.useGetImpersonatedRoleState)(),ed=(0,u.useDataApiGrantTogglesEnabled)(),eu=(0,R.usePHFlag)("tableCreateGeneratePolicies"),em=(0,c.useIsQueueOperationsEnabled)(),[eh,ep]=(0,s.useState)(!1),{data:eg}=(0,g.useDatabasePublicationsQuery)({projectRef:el?.ref,connectionString:el?.connectionString}),ef=(({enabled:e,snap:t,selectedTable:a})=>{if(!e)return;let r=t.sidePanel?.type==="table"?t.sidePanel:void 0;if(r){if("new"===r.mode)return{type:"new"};if(a)return"duplicate"===r.mode?{type:"duplicate",templateSchemaName:a.schema,templateTableName:a.name}:{type:"edit",schemaName:a.schema,tableName:a.name}}})({enabled:ed,snap:et,selectedTable:K}),ex=(0,G.useTableApiAccessHandlerWithHistory)(ef??eb,{enabled:void 0!==ef}),{confirmOnClose:ej,modalProps:eS}=(0,O.useConfirmOnClose)({checkIsDirty:()=>eh,onClose:()=>{ep(!1),et.closeSidePanel()}}),eN=(K?.columns??[]).filter(e=>(e?.enums??[]).length>0&&"array"===e.data_type.toLowerCase()).map(e=>e.name),{mutateAsync:eC}=(0,w.useTableRowCreateMutation)({onSuccess(){l.toast.success("Successfully created row")}}),{mutateAsync:ew,isPending:eT}=(0,T.useTableRowUpdateMutation)({onSuccess(){l.toast.success("Successfully updated row")}}),{mutateAsync:eE}=(0,p.useDatabasePublicationCreateMutation)(),{mutateAsync:e_}=(0,f.useDatabasePublicationUpdateMutation)({onError:()=>{}}),{mutateAsync:eD}=(0,d.useTableApiAccessPrivilegesMutation)({onError:()=>{}}),eP=et.sidePanel?.type==="table"&&"duplicate"===et.sidePanel.mode,eI=async(e,t,a,n)=>{let i;if(!el||void 0===K)return console.error("no project or table selected");if(t){if(em&&K.primary_keys.length>0){(0,o.queueRowAddWithOptimisticUpdate)({queryClient:es,queueOperation:et.queueOperation,projectRef:el.ref,tableId:K.id,table:K,rowData:e,enumArrayColumns:eN}),n(),ep(!1),et.closeSidePanel();return}try{await eC({projectRef:el.ref,connectionString:el.connectionString,table:K,payload:e,enumArrayColumns:eN,roleImpersonationState:ec()})}catch(e){i=e}}else if(!(0,r.default)(e))if(K.primary_keys.length>0){if(em){let t=Object.keys(e)[0];if(!t){i=Error("No changed column"),l.toast.error("No changed column"),n(i);return}let r=(0,V.getRowFromSidePanel)(et.sidePanel);if(!r){i=Error("No row found"),l.toast.error("No row found"),n(i);return}let s=r[t];(0,o.queueCellEditWithOptimisticUpdate)({queryClient:es,queueOperation:et.queueOperation,projectRef:el.ref,tableId:K.id,table:K,row:r,rowIdentifiers:a.identifiers,columnName:t,oldValue:s,newValue:e[t],enumArrayColumns:eN}),n(),ep(!1),et.closeSidePanel();return}try{await ew({projectRef:el.ref,connectionString:el.connectionString,table:K,configuration:a,payload:e,enumArrayColumns:eN,roleImpersonationState:ec()})}catch(e){i=e}}else i=Error("No primary key"),l.toast.error("We can't make changes to this table because there is no primary key. Please create a primary key and try again.");n(i),i||(ep(!1),et.closeSidePanel())},eO=async(e,t)=>{let a,r;if(void 0===K)return;let n={};if(et.sidePanel?.type==="json"){let{row:t,column:i}=et.sidePanel.jsonValue;a={[i]:null===e?null:JSON.parse(e)},K.primary_keys.forEach(e=>n[e.name]=t[e.name]),r={identifiers:n,rowIdx:t.idx}}else if(et.sidePanel?.type==="cell"){let t=et.sidePanel.value?.column,i=et.sidePanel.value?.row;if(!t||!i)return;a={[t]:null===e?null:e},K.primary_keys.forEach(e=>n[e.name]=i[e.name]),r={identifiers:n,rowIdx:i.idx}}if(void 0!==a&&void 0!==r)try{await eI(a,!1,r,()=>{})}catch(e){}finally{t()}},eR=async e=>{if(void 0===K||et.sidePanel?.type!=="foreign-row-selector")return;let t=et.sidePanel.foreignKey;try{let{row:a}=t,r={};K.primary_keys.forEach(e=>{let t=K.columns?.find(t=>t.name===e.name);r[e.name]=t?.format==="bytea"?(0,H.convertByteaToHex)(a[e.name]):a[e.name]});let n={identifiers:r,rowIdx:a.idx};eI(e,!1,n,()=>{})}catch(e){}},eA=async(e,t,a,r)=>{let n=et.sidePanel?.type==="column"&&et.sidePanel.column,{primaryKey:i,foreignKeyRelations:s,existingForeignKeyRelations:o}=a;if(!el||void 0===K)return console.error("no project or table selected");let c=t?await (0,V.createColumn)({projectRef:el?.ref,connectionString:el?.connectionString,payload:e,selectedTable:K,primaryKey:i,foreignKeyRelations:s}):await (0,V.updateColumn)({projectRef:el?.ref,connectionString:el?.connectionString,originalColumn:n,payload:e,selectedTable:K,primaryKey:i,foreignKeyRelations:s,existingForeignKeyRelations:o});c?.error?l.toast.error(c.error.message):(!t&&e.name&&n&&n.name!==e.name&&ek(n.name,e.name),await Promise.all([es.invalidateQueries({queryKey:S.tableEditorKeys.tableEditor(el?.ref,K?.id)}),es.invalidateQueries({queryKey:x.databaseKeys.foreignKeyConstraints(el?.ref,K?.schema)}),es.invalidateQueries({queryKey:x.databaseKeys.tableDefinition(el?.ref,K?.id)}),es.invalidateQueries({queryKey:b.entityTypeKeys.list(el?.ref)})]),await es.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(el?.ref,K?.id)}),ep(!1),et.closeSidePanel()),r()},ek=(e,t)=>{en(a=>{let r=a?.filter??[],n=a?.sort??[];return{...a,filter:r.map(a=>{let[r]=a.split(":");return r===e?a.replace(r,t):a}),sort:n.map(a=>{let[r]=a.split(":");return r===e?a.replace(r,t):a})}})},eL=async(e,t)=>{if(!el)return console.error("Project is required");let a=eg?.find(e=>"supabase_realtime"===e.name);try{if(void 0===a){let a=t?[`${e.schema}.${e.name}`]:[];await eE({projectRef:el.ref,connectionString:el.connectionString,name:"supabase_realtime",publish_insert:!0,publish_update:!0,publish_delete:!0,tables:a}),ei(t?"table_realtime_enabled":"table_realtime_disabled",{method:"ui",schema_name:e.schema,table_name:e.name});return}if(null===a.tables){let r=await es.fetchQuery({queryKey:E.tableKeys.list(el.ref,"public",X),queryFn:({signal:e})=>(0,_.getTables)({projectRef:el.ref,connectionString:el.connectionString,schema:"public"},e)}),n=t?r.map(e=>`${e.schema}.${e.name}`):r.filter(t=>t.id!==e.id).map(e=>`${e.schema}.${e.name}`);await e_({id:a.id,projectRef:el.ref,connectionString:el.connectionString,tables:n}),ei(t?"table_realtime_enabled":"table_realtime_disabled",{method:"ui",schema_name:e.schema,table_name:e.name});return}let r=a.tables.some(t=>t.id==e.id),n=r&&!t?a.tables.filter(t=>t.id!==e.id).map(e=>`${e.schema}.${e.name}`):!r&&t?a.tables.map(e=>`${e.schema}.${e.name}`).concat([`${e.schema}.${e.name}`]):null;if(null===n)return;await e_({id:a.id,projectRef:el.ref,connectionString:el.connectionString,tables:n}),ei(t?"table_realtime_enabled":"table_realtime_disabled",{method:"ui",schema_name:e.schema,table_name:e.name})}catch(t){l.toast.error(`Failed to update realtime for ${e.name}: ${t.message}`)}},eF=async(e,t)=>{if(!el)return console.error("Project is required");try{await eD({projectRef:el.ref,connectionString:el.connectionString??void 0,relationId:e.id,privileges:t})}catch(r){let t=r instanceof Error?r.message:void 0,a=t?`: ${t}`:"";l.toast.error(`Failed to update API access privileges for ${e.name}${a}`)}},eM=async({action:e,payload:a,configuration:r,columns:n,foreignKeyRelations:i,generatedPolicies:s=[],resolve:o})=>{let c,d=!1;if(ed&&!ex.isSuccess)return void(ex.isPending?l.toast.info("Cannot save table yet because Data API settings are still loading. Please try again in a moment."):l.toast.error("Cannot save table because there was an error loading Data API settings. Please refresh the page and try again."));let{importContent:u,isRLSEnabled:m,isRealtimeEnabled:p,isDuplicateRows:g,existingForeignKeyRelations:f,primaryKey:x}=r;try{if("create"===e){c=l.toast.loading(`Creating new table: ${a.name}...`);let{table:e,failedPolicies:r}=await (0,V.createTable)({projectRef:el?.ref,connectionString:el?.connectionString,toastId:c,payload:a,columns:n,foreignKeyRelations:i,isRLSEnabled:m,importContent:u,organizationSlug:eo?.slug,generatedPolicies:s,onCreatePoliciesSuccess:()=>ei("rls_generated_policies_created")});if(p&&await eL(e,!0),ed){let t=ex.data?.schemaExposed?ex.data.privileges:void 0;t&&await eF(e,t)}await Promise.all([es.invalidateQueries({queryKey:E.tableKeys.list(el?.ref,e.schema,X)}),es.invalidateQueries({queryKey:b.entityTypeKeys.list(el?.ref)}),es.invalidateQueries({queryKey:h.databasePoliciesKeys.list(el?.ref)}),es.invalidateQueries({queryKey:j.privilegeKeys.tablePrivilegesList(el?.ref)}),es.invalidateQueries({queryKey:v.lintKeys.lint(el?.ref)})]),r.length>0?l.toast.success(`Table ${e.name} is created successfully, but we ran into issues creating ${r.length} policie${r.length>1?"s":""}`,{id:c,description:(0,t.jsx)("ul",{className:"list-disc pl-6",children:r.map(e=>(0,t.jsx)("li",{children:e.name},e.name))})}):l.toast.success(`Table ${e.name} is good to go!`,{id:c}),(0,I.isValidExperimentVariant)(eu)&&ei("table_create_generate_policies_experiment_converted",{experiment_id:"tableCreateGeneratePolicies",variant:eu,has_rls_enabled:m,has_rls_policies:s.length>0,has_generated_policies:s.length>0}),Z(e)}else if("duplicate"===e&&K){c=l.toast.loading(`Duplicating table: ${K.name}...`);let e=await (0,V.duplicateTable)(el?.ref,el?.connectionString,a,{isRLSEnabled:m,isDuplicateRows:g,duplicateTable:K,foreignKeyRelations:i});if(p&&await eL(e,p),ed){let t=ex.data?.schemaExposed?ex.data.privileges:void 0;t&&await eF(e,t)}await Promise.all([es.invalidateQueries({queryKey:E.tableKeys.list(el?.ref,e.schema,X)}),es.invalidateQueries({queryKey:b.entityTypeKeys.list(el?.ref)}),es.invalidateQueries({queryKey:j.privilegeKeys.tablePrivilegesList(el?.ref)}),es.invalidateQueries({queryKey:v.lintKeys.lint(el?.ref)})]),l.toast.success(`Table ${K.name} has been successfully duplicated into ${e.name}!`,{id:c}),Z(e)}else if("update"===e&&K){c=l.toast.loading(`Updating table: ${K.name}...`);let{table:e,hasError:t}=await (0,V.updateTable)({projectRef:el?.ref,connectionString:el?.connectionString,toastId:c,table:K,payload:a,columns:n,foreignKeyRelations:i,existingForeignKeyRelations:f,primaryKey:x,organizationSlug:eo?.slug});if(void 0===e)return l.toast.error("Failed to update table");if((0,N.isTableLike)(e)&&(await eL(e,p),ed)){let t=ex.data?.schemaExposed?ex.data.privileges:void 0;t&&await eF(e,t)}if(t)l.toast.warning(`Table ${e.name} has been updated but there were some errors. Please check these errors separately.`);else{if(ee&&a.name){let e=(0,M.createTabId)(y.ENTITY_TYPE.TABLE,{id:K.id});ea.updateTab(e,{label:a.name})}l.toast.success(`Successfully updated ${e.name}!`,{id:c})}}}catch(e){d=!0,l.toast.error(e.message,{id:c})}d||(ep(!1),et.closeSidePanel()),o()},e$=async e=>{if(!el||void 0===K)return console.error("no project or table selected");let{file:a,rowCount:r,selectedHeaders:n,resolve:i}=e,s=l.toast.loading(`Adding ${r.toLocaleString()} rows to ${K.name}`);if(a&&r>0){let e=await (0,V.insertRowsViaSpreadsheet)(el.ref,el.connectionString,a,K,n,e=>{l.toast.loading((0,t.jsx)($.SonnerProgress,{progress:e,message:`Adding ${r.toLocaleString()} rows to ${K.name}`}),{id:s})});if(e.error)return l.toast.error(`Failed to import data: ${e.error.message}`,{id:s}),i()}else{let a=await (0,V.insertTableRows)(el.ref,el.connectionString,K,e.rows,n,a=>{l.toast.loading((0,t.jsx)($.SonnerProgress,{progress:a,message:`Adding ${e.rows.length.toLocaleString()} rows to ${K.name}`}),{id:s})});if(a.error)return l.toast.error(`Failed to import data: ${a.error.message}`,{id:s}),i()}await es.invalidateQueries({queryKey:C.tableRowKeys.tableRowsAndCount(el?.ref,K?.id)}),l.toast.success(`Successfully imported ${r} rows of data into ${K.name}`,{id:s}),i(),et.closeSidePanel()};return(0,t.jsxs)(t.Fragment,{children:[!(0,n.default)(K)&&(0,t.jsx)(Y.RowEditor,{row:et.sidePanel?.type==="row"?et.sidePanel.row:void 0,selectedTable:K,visible:et.sidePanel?.type==="row",editable:e,closePanel:ej,saveChanges:eI,updateEditorDirty:()=>ep(!0)}),!(0,n.default)(K)&&(0,t.jsx)(U.ColumnEditor,{column:et.sidePanel?.type==="column"?et.sidePanel.column:void 0,selectedTable:K,visible:et.sidePanel?.type==="column",closePanel:ej,saveChanges:eA,updateEditorDirty:()=>ep(!0)}),(0,t.jsx)(J.TableEditor,{table:et.sidePanel?.type==="table"&&("edit"===et.sidePanel.mode||"duplicate"===et.sidePanel.mode)?K:void 0,isDuplicating:eP,templateData:et.sidePanel?.type==="table"&&et.sidePanel.templateData?{...et.sidePanel.templateData,columns:et.sidePanel.templateData.columns?[...et.sidePanel.templateData.columns]:void 0}:void 0,visible:et.sidePanel?.type==="table",closePanel:ej,saveChanges:eM,updateEditorDirty:()=>ep(!0),apiAccessToggleHandler:ex}),(0,t.jsx)(Q.SchemaEditor,{visible:et.sidePanel?.type==="schema",onSuccess:ej,closePanel:ej}),(0,t.jsx)(z.JsonEditor,{visible:et.sidePanel?.type==="json",row:et.sidePanel?.type==="json"&&et.sidePanel.jsonValue.row||{},column:et.sidePanel?.type==="json"&&et.sidePanel.jsonValue.column||"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",readOnly:!e,closePanel:ej,onSaveJSON:eO}),(0,t.jsx)(B.TextEditor,{visible:et.sidePanel?.type==="cell",column:et.sidePanel?.type==="cell"&&et.sidePanel.value?.column||"",row:et.sidePanel?.type==="cell"&&et.sidePanel.value?.row||{},closePanel:ej,onSaveField:eO}),(0,t.jsx)(q.ForeignRowSelector,{visible:et.sidePanel?.type==="foreign-row-selector",foreignKey:et.sidePanel?.type==="foreign-row-selector"?et.sidePanel.foreignKey.foreignKey:void 0,isSaving:eT,closePanel:ej,onSelect:eR}),(0,t.jsx)(W.SpreadsheetImport,{visible:et.sidePanel?.type==="csv-import",selectedTable:K,saveContent:e$,closePanel:ej,updateEditorDirty:ep}),(0,t.jsx)(ey,{visible:et.sidePanel?.type==="operation-queue",closePanel:et.closeSidePanel}),(0,t.jsx)(ev,{...eS})]})}],565066)}]);

//# debugId=2f2a2e03-62aa-4d6d-0271-157e230791de
//# sourceMappingURL=3b25aead8b109907.js.map