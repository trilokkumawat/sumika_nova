;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="0025117c-f744-ee80-cc7b-8d94366ebca3")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,189108,e=>{"use strict";var t=e.i(755216),s=e.i(38429),a=e.i(356003),i=e.i(355901),n=e.i(714403),l=e.i(509847);async function o({projectRef:e,connectionString:s,originalPolicy:a}){let i=new Headers;s&&i.set("x-connection-encrypted",s);let{sql:l}=t.default.policies.remove(a),{result:o}=await (0,n.executeSql)({projectRef:e,connectionString:s,sql:l,queryKey:["policy","delete",a.id]});return o}e.s(["useDatabasePolicyDeleteMutation",0,({onSuccess:e,onError:t,...n}={})=>{let r=(0,a.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>o(e),async onSuccess(t,s,a){let{projectRef:i}=s;await r.invalidateQueries({queryKey:l.databasePoliciesKeys.list(i)}),await e?.(t,s,a)},async onError(e,s,a){void 0===t?i.toast.error(`Failed to delete database policy: ${e.message}`):t(e,s,a)},...n})}])},341205,e=>{"use strict";var t=e.i(478902),s=e.i(902858),a=e.i(964727),i=e.i(53071),n=e.i(471998),l=e.i(211570),o=e.i(423782),r=e.i(14703),c=e.i(2579),d=e.i(635494),m=e.i(317040),u=e.i(215618),h=e.i(441081),p=e.i(837710),x=e.i(874311),_=e.i(492418),f=e.i(613580),g=e.i(102631);e.s(["PolicyRow",0,({policy:e,isLocked:y=!1,onSelectEditPolicy:b=a.default,onSelectDeletePolicy:j=a.default})=>{let S=(0,m.useAiAssistantStateSnapshot)(),{openSidebar:N}=(0,h.useSidebarManagerSnapshot)(),{can:v}=(0,c.useAsyncCheckPermissions)(s.PermissionAction.TENANT_SQL_ADMIN_WRITE,"policies"),{data:w}=(0,d.useSelectedProjectQuery)(),{data:C}=(0,r.useAuthConfigQuery)({projectRef:w?.ref}),k=("realtime"!==e.schema||"messages"!==e.table)&&y,L=C?.EXTERNAL_ANONYMOUS_USERS_ENABLED&&(e.roles.includes("authenticated")||e.roles.includes("public"))?[...e.roles,"anonymous sign-ins"]:e.roles;return(0,t.jsxs)(_.TableRow,{children:[(0,t.jsx)(_.TableCell,{className:"w-[40%] truncate",children:(0,t.jsx)("div",{className:"flex items-center gap-x-2 min-w-0",children:(0,t.jsx)(p.Button,{type:"text",className:"text-foreground text-sm p-0 hover:bg-transparent w-full truncate justify-start",onClick:()=>b(e),children:e.name})})}),(0,t.jsx)(_.TableCell,{className:"w-[20%] truncate",children:(0,t.jsx)("code",{className:"text-foreground-light text-xs",children:e.command})}),(0,t.jsx)(_.TableCell,{className:"w-[30%] truncate",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("div",{className:"text-foreground-lighter text-sm truncate",children:L.slice(0,2).map((e,s)=>(0,t.jsxs)("span",{children:[(0,t.jsx)("code",{className:"text-foreground-light text-xs",children:e}),s<Math.min(L.length,2)-1?", ":" "]},`policy-${e}-${s}`))}),L.length>2&&(0,t.jsxs)(f.Tooltip,{children:[(0,t.jsx)(f.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsxs)("code",{className:"text-foreground-light text-xs",children:["+ ",L.length-2," more"]},"policy-etc")})}),(0,t.jsx)(f.TooltipContent,{side:"bottom",align:"center",children:L.join(", ")})]})]})}),(0,t.jsx)(_.TableCell,{className:"w-0 text-right whitespace-nowrap",children:!k&&(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(p.Button,{type:"default",className:"px-1.5",icon:(0,t.jsx)(n.MoreVertical,{}),"data-testid":`policy-${e.name}-actions-button`})}),(0,t.jsxs)(x.DropdownMenuContent,{side:"bottom",align:"end",className:"w-52",children:[(0,t.jsxs)(x.DropdownMenuItem,{className:"gap-x-2",onClick:()=>b(e),children:[(0,t.jsx)(i.Edit,{size:14}),(0,t.jsx)("p",{children:"Edit policy"})]}),(0,t.jsxs)(x.DropdownMenuItem,{className:"space-x-2",onClick:()=>{let t=(0,g.generatePolicyUpdateSQL)(e);N(u.SIDEBAR_KEYS.AI_ASSISTANT),S.newChat({name:`Update policy ${e.name}`,sqlSnippets:[t],initialInput:`Update the policy with name "${e.name}" in the ${e.schema} schema on the ${e.table} table. It should...`,suggestions:{title:`I can help you make a change to the policy "${e.name}" in the ${e.schema} schema on the ${e.table} table, here are a few example prompts to get you started:`,prompts:[{label:"Improve Policy",description:"Tell me how I can improve this policy..."},{label:"Duplicate Policy",description:"Duplicate this policy for another table..."},{label:"Add Conditions",description:"Add extra conditions to this policy..."}]}})},children:[(0,t.jsx)(i.Edit,{size:14}),(0,t.jsx)("p",{children:"Edit policy with Assistant"})]}),(0,t.jsx)(x.DropdownMenuSeparator,{}),(0,t.jsxs)(o.DropdownMenuItemTooltip,{className:"gap-x-2",disabled:!v,onClick:()=>j(e),tooltip:{content:{side:"left",text:"You need additional permissions to delete policies"}},children:[(0,t.jsx)(l.Trash,{size:14}),(0,t.jsx)("p",{children:"Delete policy"})]})]})]})})]})}])},211761,e=>{"use strict";e.s(["getGeneralPolicyTemplates",0,(e,t)=>[{id:"policy-1",preview:!1,templateName:"Enable read access to everyone",description:"This policy gives read access to your table for all users via the SELECT operation.",statement:`
create policy "Enable read access for all users"
on "${e}"."${t}"
for select using (true);`.trim(),name:"Enable read access for all users",definition:"true",check:"",command:"SELECT",roles:[]},{id:"policy-2",preview:!1,templateName:"Enable insert access for authenticated users only",description:"This policy gives insert access to your table for all authenticated users only.",statement:`
create policy "Enable insert for authenticated users only"
on "${e}"."${t}"
for insert to authenticated
with check (true);`.trim(),name:"Enable insert for authenticated users only",definition:"",check:"true",command:"INSERT",roles:["authenticated"]},{id:"policy-3",preview:!1,templateName:"Enable delete access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to delete rows which the "user_id" column matches their ID',statement:`
create policy "Enable delete for users based on user_id"
on "${e}"."${t}"
for delete using (
  (select auth.uid()) = user_id
);`.trim(),name:"Enable delete for users based on user_id",definition:"(select auth.uid()) = user_id",check:"",command:"DELETE",roles:[]},{id:"policy-4",preview:!1,templateName:"Enable insert access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to insert rows which the "user_id" column matches their ID',statement:`
create policy "Enable insert for users based on user_id"
on "${e}"."${t}"
for insert with check (
  (select auth.uid()) = user_id
);`.trim(),name:"Enable insert for users based on user_id",definition:"",check:"(select auth.uid()) = user_id",command:"INSERT",roles:[]},{id:"policy-5",preview:!0,name:"Policy with table joins",templateName:"Policy with table joins",description:`
Query across tables to build more advanced RLS rules

Assuming 2 tables called \`teams\` and \`members\`, you can query both tables in the policy to control access to the members table.`,statement:`
create policy "Members can update team details if they belong to the team"
on teams for update using (
  (select auth.uid()) in (
    select user_id from members where team_id = id
  )
);
`.trim(),definition:"(select auth.uid()) in (select user_id from members where team_id = id)",check:"",command:"UPDATE",roles:[]},{id:"policy-6",preview:!0,templateName:"Policy with security definer functions",description:`
Useful in a many-to-many relationship where you want to restrict access to the linking table.

Assuming 2 tables called \`teams\` and \`members\`, you can use a security definer function in combination with a policy to control access to the members table.`.trim(),statement:`
create or replace function get_teams_for_user(user_id uuid)
returns setof bigint as $$
  select team_id from members where user_id = $1
$$ stable language sql security definer;

create policy "Team members can update team members if they belong to the team"
on members
for all using (
  team_id in (select get_teams_for_user(auth.uid()))
);
`.trim(),name:"Policy with security definer functions",definition:"team_id in (select get_teams_for_user(auth.uid()))",check:"",command:"ALL",roles:[]},{id:"policy-7",preview:!0,name:"Policy to implement Time To Live (TTL)",templateName:"Policy to implement Time To Live (TTL)",description:`
Implement a TTL-like feature that you see in Instagram stories or Snapchat where messages expire after a day.

Rows under the table are available only if they have been created within the last 24 hours.`,statement:`
create policy "Stories are live for a day"
on "${e}"."${t}"
for select using (
  created_at > (current_timestamp - interval '1 day')
);
`.trim(),definition:"created_at > (current_timestamp - interval '1 day')",check:"",command:"SELECT",roles:[]},{id:"policy-8",preview:!1,templateName:"Allow users to only view their own data",description:"Restrict users to reading only their own data.",statement:`
create policy "Enable users to view their own data only"
on "${e}"."${t}"
for select
to authenticated
using (
  (select auth.uid()) = user_id
);`.trim(),name:"Enable users to view their own data only",definition:"(select auth.uid()) = user_id",check:"",command:"SELECT",roles:["authenticated"]}],"getQueuePolicyTemplates",0,()=>[{id:"policy-queues-1",preview:!1,templateName:"Allow access to queue",statement:"".trim(),name:"Allow anon and authenticated to access messages from queue",description:"Base policy to ensure that anon and authenticated can only access appropriate rows. USING and CHECK statements will need to be adjusted accordingly",definition:"true",check:"true",command:"ALL",roles:["anon","authenticated"]}],"getRealtimePolicyTemplates",0,()=>[{id:"policy-broadcast-1",preview:!1,templateName:"Allow listening for broadcasts for authenticated users only",description:"This policy allows listening for broadcasts for authenticated users only.",statement:`
create policy  "Allow listening for broadcasts for authenticated users only"
on realtime.messages for select
to authenticated
using ( realtime.messages.extension = 'broadcast' );`.trim(),name:"Allow listening for broadcasts for authenticated users only",definition:"realtime.messages.extension = 'broadcast'",check:"",command:"SELECT",roles:["authenticated"]},{id:"policy-broadcast-2",preview:!1,templateName:"Allow pushing broadcasts for authenticated users only",description:"This policy allows pushing broadcasts for authenticated users only.",statement:`
create policy "Allow pushing broadcasts for authenticated users only"
ON realtime.messages for insert
TO authenticated
with check ( realtime.messages.extension = 'broadcast' );`.trim(),name:"Allow pushing broadcasts for authenticated users only",definition:"realtime.messages.extension = 'broadcast'",check:"realtime.messages.extension = 'broadcast'",command:"INSERT",roles:["authenticated"]},{id:"policy-broadcast-3",preview:!1,templateName:"Allow listening for broadcasts from a specific channel",description:"This policy allows listening for broadcasts from a specific channel.",statement:`
create policy "Allow listening for broadcasts from a specific channel"
on realtime.messages for select
using ( realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name' );`.trim(),name:"Allow listening for broadcasts from a specific channel",definition:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",check:"",command:"SELECT",roles:[]},{id:"policy-broadcast-4",preview:!1,templateName:"Allow pushing broadcasts to specific channel",description:"This policy allow pushing broadcasts to specific channel.",statement:`
create policy "Allow pushing broadcasts to specific channel"
ON realtime.messages for insert
with check ( realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name' );`.trim(),name:"Allow pushing broadcasts to specific channel",definition:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",check:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",command:"INSERT",roles:[]},{id:"policy-presences-1",preview:!1,templateName:"Allow listening for presences on all channels for authenticated users only",description:"This policy enables listening for presences on all channels for all authenticated users only.",statement:`
create policy "Allow listening for presences on all channels for authenticated users only"
on realtime.messages for select
to authenticated
using ( realtime.messages.extension = 'presence' );`.trim(),name:"Allow listening for presences on all channels for authenticated users only",definition:"realtime.messages.extension = 'presence'",check:"",command:"SELECT",roles:["authenticated"]},{id:"policy-presences-2",preview:!1,templateName:"Allow broadcasting presences on all channels for authenticated users only",description:"This policy enables broadcasting presences on all channels for all authenticated users only.",statement:`
create policy "Allow broadcasting presences on all channels for authenticated users only"
ON realtime.messages for insert
TO authenticated
with check ( realtime.messages.extension = 'presence' );
  ;`.trim(),name:"Allow broadcasting presences on all channels for authenticated users only",definition:"realtime.messages.extension = 'presence'",check:"realtime.messages.extension = 'presence'",command:"INSERT",roles:["authenticated"]},{id:"policy-presences-3",preview:!1,templateName:"Allow listening for presences from a specific channel",description:"This policy enables listening for presences from a specific channel.",statement:`
create policy "Allow listening for presences from a specific channel"
on realtime.messages for select
using ( realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name' );`.trim(),name:"Allow listening for presences from a specific channel",definition:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",check:"",command:"SELECT",roles:[]},{id:"policy-presences-4",preview:!1,templateName:"Publish presence to a specific channel",description:"This policy allows publishing presence to a specific channel.",statement:`
create policy "Publish presence to a specific channel"
ON realtime.messages for insert
with check ( realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name' );
  ;`.trim(),name:"Publish presence to a specific channel",definition:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",check:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",command:"INSERT",roles:[]}]])},578269,e=>{"use strict";var t=e.i(755216),s=e.i(38429),a=e.i(356003),i=e.i(355901),n=e.i(714403),l=e.i(509847);async function o({projectRef:e,connectionString:s,originalPolicy:a,payload:i}){let l=new Headers;s&&l.set("x-connection-encrypted",s);let{sql:o}=t.default.policies.update(a,i),{result:r}=await (0,n.executeSql)({projectRef:e,connectionString:s,sql:o,queryKey:["policy","update",a.id]});return r}e.s(["useDatabasePolicyUpdateMutation",0,({onSuccess:e,onError:t,...n}={})=>{let r=(0,a.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>o(e),async onSuccess(t,s,a){let{projectRef:i}=s;await r.invalidateQueries({queryKey:l.databasePoliciesKeys.list(i)}),await e?.(t,s,a)},async onError(e,s,a){void 0===t?i.toast.error(`Failed to update database policy: ${e.message}`):t(e,s,a)},...n})}])},800957,e=>{"use strict";var t=e.i(192451);e.s(["RadioGroupLargeItem_Shadcn_",()=>t.RadioGroupLargeItem])},148118,(e,t,s)=>{var a=e.r(612989);t.exports=function(e){return(null==e?0:e.length)?a(e,0,-1):[]}},772900,e=>{e.v({"ai-icon__container":"ai-icon-animation-style-module__IkLSQa__ai-icon__container","ai-icon__container--allow-hover-effect":"ai-icon-animation-style-module__IkLSQa__ai-icon__container--allow-hover-effect","ai-icon__grid":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid","ai-icon__grid__square":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square","ai-icon__grid__square--exiting--step-1":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--exiting--step-1","ai-icon__grid__square--exiting--step-2":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--exiting--step-2","ai-icon__grid__square--exiting--step-3":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--exiting--step-3","ai-icon__grid__square--exiting--step-4":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--exiting--step-4","ai-icon__grid__square--exiting--step-5":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--exiting--step-5","ai-icon__grid__square--static":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--static","ai-icon__grid__square--step-1":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--step-1","ai-icon__grid__square--step-2":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--step-2","ai-icon__grid__square--step-3":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--step-3","ai-icon__grid__square--step-4":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--step-4","ai-icon__grid__square--step-5":"ai-icon-animation-style-module__IkLSQa__ai-icon__grid__square--step-5",exit_step1_square1:"ai-icon-animation-style-module__IkLSQa__exit_step1_square1",exit_step1_square2:"ai-icon-animation-style-module__IkLSQa__exit_step1_square2",exit_step1_square3:"ai-icon-animation-style-module__IkLSQa__exit_step1_square3",exit_step1_square4:"ai-icon-animation-style-module__IkLSQa__exit_step1_square4",exit_step2_square1:"ai-icon-animation-style-module__IkLSQa__exit_step2_square1",exit_step2_square2:"ai-icon-animation-style-module__IkLSQa__exit_step2_square2",exit_step2_square3:"ai-icon-animation-style-module__IkLSQa__exit_step2_square3",exit_step2_square4:"ai-icon-animation-style-module__IkLSQa__exit_step2_square4",exit_step3_square1:"ai-icon-animation-style-module__IkLSQa__exit_step3_square1",exit_step3_square2:"ai-icon-animation-style-module__IkLSQa__exit_step3_square2",exit_step3_square3:"ai-icon-animation-style-module__IkLSQa__exit_step3_square3",exit_step3_square4:"ai-icon-animation-style-module__IkLSQa__exit_step3_square4",exit_step4_square1:"ai-icon-animation-style-module__IkLSQa__exit_step4_square1",exit_step4_square2:"ai-icon-animation-style-module__IkLSQa__exit_step4_square2",exit_step4_square3:"ai-icon-animation-style-module__IkLSQa__exit_step4_square3",exit_step4_square4:"ai-icon-animation-style-module__IkLSQa__exit_step4_square4",exit_step5_square1:"ai-icon-animation-style-module__IkLSQa__exit_step5_square1",exit_step5_square2:"ai-icon-animation-style-module__IkLSQa__exit_step5_square2",exit_step5_square3:"ai-icon-animation-style-module__IkLSQa__exit_step5_square3",exit_step5_square4:"ai-icon-animation-style-module__IkLSQa__exit_step5_square4","spin-ai-icon-container":"ai-icon-animation-style-module__IkLSQa__spin-ai-icon-container",spinAiIconContainer:"ai-icon-animation-style-module__IkLSQa__spinAiIconContainer",step1_square1:"ai-icon-animation-style-module__IkLSQa__step1_square1",step1_square2:"ai-icon-animation-style-module__IkLSQa__step1_square2",step1_square3:"ai-icon-animation-style-module__IkLSQa__step1_square3",step1_square4:"ai-icon-animation-style-module__IkLSQa__step1_square4",step2_square1:"ai-icon-animation-style-module__IkLSQa__step2_square1",step2_square2:"ai-icon-animation-style-module__IkLSQa__step2_square2",step2_square3:"ai-icon-animation-style-module__IkLSQa__step2_square3",step2_square4:"ai-icon-animation-style-module__IkLSQa__step2_square4",step3_square1:"ai-icon-animation-style-module__IkLSQa__step3_square1",step3_square2:"ai-icon-animation-style-module__IkLSQa__step3_square2",step3_square3:"ai-icon-animation-style-module__IkLSQa__step3_square3",step3_square4:"ai-icon-animation-style-module__IkLSQa__step3_square4",step4_square1:"ai-icon-animation-style-module__IkLSQa__step4_square1",step4_square2:"ai-icon-animation-style-module__IkLSQa__step4_square2",step4_square3:"ai-icon-animation-style-module__IkLSQa__step4_square3",step4_square4:"ai-icon-animation-style-module__IkLSQa__step4_square4",step5_square1:"ai-icon-animation-style-module__IkLSQa__step5_square1",step5_square2:"ai-icon-animation-style-module__IkLSQa__step5_square2",step5_square3:"ai-icon-animation-style-module__IkLSQa__step5_square3",step5_square4:"ai-icon-animation-style-module__IkLSQa__step5_square4"})},458084,931244,376841,e=>{"use strict";var t=e.i(478902),s=e.i(666050),a=e.i(210419),i=e.i(389959),n=e.i(355901);e.i(128328);var l=e.i(158639),o=e.i(964727),r=e.i(567558),c=e.i(937942),d=e.i(242882),m=e.i(714403),u=e.i(138658);async function h({schema:e,projectRef:t,connectionString:s},a){if(!e)throw Error("schema is required");let i=(({schema:e})=>`
SELECT c.relname AS table_name
FROM pg_catalog.pg_class AS c
JOIN pg_catalog.pg_namespace AS n ON n.oid = c.relnamespace
WHERE n.nspname = '${e}'
  AND c.relkind IN ('r','p')  -- table, partitioned table
  AND EXISTS (
    SELECT 1
    FROM pg_catalog.aclexplode(COALESCE(c.relacl, '{}'::aclitem[])) AS a
    JOIN pg_catalog.pg_roles r ON r.oid = a.grantee
    WHERE r.rolname IN ('anon','authenticated')
  )
;
`.trim())({schema:e}),{result:n}=await (0,m.executeSql)({projectRef:t,connectionString:s,sql:i,queryKey:["TablesRolesAccess",e]},a);return new Set(n.map(e=>e.table_name))}var p=e.i(635494),x=e.i(627069),_=e.i(843778),f=e.i(492418),g=e.i(710483),y=e.i(108151);let b=(0,i.createContext)(null),j=()=>{let e=(0,i.useContext)(b);if(!e)throw Error("usePoliciesData must be used within PoliciesDataProvider");return e};e.s(["PoliciesDataProvider",0,({children:e,policies:s,isPoliciesLoading:a,isPoliciesError:n,policiesError:l,exposedSchemas:o})=>{let r=(0,i.useMemo)(()=>{let e=new Map;for(let t of s){let s=`${t.schema}.${t.table}`,a=e.get(s);a?a.push(t):e.set(s,[t])}for(let t of e.values())t.sort((e,t)=>e.name.localeCompare(t.name));return e},[s]),c=(0,i.useCallback)((e,t)=>r.get(`${e}.${t}`)??[],[r]),d=(0,i.useMemo)(()=>new Set(o),[o]),m=(0,i.useMemo)(()=>({getPoliciesForTable:c,isPoliciesLoading:a,isPoliciesError:n,policiesError:l,exposedSchemas:d}),[c,a,n,l,d]);return(0,t.jsx)(b.Provider,{value:m,children:e})},"usePoliciesData",0,j],931244);var S=e.i(341205),N=e.i(902858),v=o,w=e.i(250503),C=e.i(495486),k=e.i(215312),L=e.i(941381),T=e.i(2579),I=e.i(317040),q=e.i(602089),A=e.i(587433),E=e.i(215618),P=e.i(441081);let R=({table:e,isLocked:s,hasApiAccess:a,onSelectToggleRLS:i=v.default,onSelectCreatePolicy:n})=>{let{ref:o}=(0,l.useParams)(),r=(0,I.useAiAssistantStateSnapshot)(),{openSidebar:c}=(0,P.useSidebarManagerSnapshot)(),{can:d}=(0,T.useAsyncCheckPermissions)(N.PermissionAction.TENANT_SQL_ADMIN_WRITE,"policies"),{can:m}=(0,T.useAsyncCheckPermissions)(N.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),u="realtime"===e.schema,h=u&&"messages"===e.name,p=u?!h:s;return(0,t.jsxs)("div",{id:e.id.toString(),className:"flex w-full items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex gap-x-4 text-left flex-wrap",children:[(0,t.jsxs)(L.EditorTablePageLink,{projectRef:o,id:String(e.id),className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsx)(C.Table,{strokeWidth:1.5,size:16,className:"text-foreground-muted"}),(0,t.jsx)(x.CardTitle,{className:"m-0 normal-case",children:e.name}),!e.rls_enabled&&(0,t.jsx)(A.Badge,{variant:"warning",className:"shrink-0",children:"RLS Disabled"}),!a&&(0,t.jsx)(A.Badge,{variant:"default",className:"shrink-0",children:"API Disabled"})]}),p&&(0,t.jsx)(A.Badge,{children:(0,t.jsxs)("span",{className:"flex gap-2 items-center text-xs uppercase text-foreground-lighter",children:[(0,t.jsx)(w.Lock,{size:12})," Locked"]})})]}),!p&&(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex flex-row justify-end gap-x-2",children:[!h&&(0,t.jsx)(k.ButtonTooltip,{type:"default",disabled:!m,onClick:()=>i(e),"data-testid":`${e.name}-toggle-rls`,tooltip:{content:{side:"bottom",text:m?void 0:"You need additional permissions to toggle RLS"}},children:e.rls_enabled?"Disable RLS":"Enable RLS"}),(0,t.jsx)(k.ButtonTooltip,{type:"default",disabled:!m||!d,onClick:()=>n(e),"data-testid":`${e.name}-create-policy`,tooltip:{content:{side:"bottom",text:m||m&&d?void 0:"You need additional permissions to create RLS policies"}},children:"Create policy"}),(0,t.jsx)(k.ButtonTooltip,{type:"default",className:"px-1",onClick:()=>{c(E.SIDEBAR_KEYS.AI_ASSISTANT),r.newChat({name:"Create new policy",initialInput:`Create and name a new policy for the ${e.schema} schema on the ${e.name} table that ...`})},tooltip:{content:{side:"bottom",text:m&&d?"Create with Supabase Assistant":"You need additional permissions to create RLS policies"}},children:(0,t.jsx)(q.AiIconAnimation,{size:16})})]})})]})},Q=(0,i.memo)(({table:e,isLocked:s,onSelectToggleRLS:a=o.default,onSelectCreatePolicy:n=o.default,onSelectEditPolicy:m=o.default,onSelectDeletePolicy:b=o.default})=>{let{ref:N}=(0,l.useParams)(),{data:v}=(0,p.useSelectedProjectQuery)(),{getPoliciesForTable:w,isPoliciesLoading:C,isPoliciesError:k,policiesError:L,exposedSchemas:T}=j(),I=(0,i.useMemo)(()=>w(e.schema,e.name),[w,e.schema,e.name]),q=e.rls_enabled,A=(0,i.useMemo)(()=>T.has(e.schema),[T,e.schema]),{data:E=new Set}=(({projectRef:e,connectionString:t,schema:s},{enabled:a=!0,...i}={})=>(0,d.useQuery)({queryKey:u.tableKeys.rolesAccess(e,s),queryFn:({signal:a})=>h({projectRef:e,connectionString:t,schema:s},a),enabled:a&&void 0!==e&&void 0!==s&&!!t,...i}))({projectRef:v?.ref,connectionString:v?.connectionString,schema:e.schema}),P=E.has(e.name),Q=A&&P,D=!q&&Q,$=q&&Q&&0===I.length,F=A&&!P,M="realtime"===e.schema,z=M&&"messages"===e.name,B=M?!z:s,O=D||$||!A||F,V=(0,i.useMemo)(()=>D?"This table can be accessed by anyone via the Data API as RLS is disabled.":F?"This table cannot be accessed via the Data API as no permissions exist for the anon or authenticated roles.":"This table can be accessed via the Data API but no RLS policies exist so no data will be returned.",[D,F]);return(0,t.jsxs)(x.Card,{className:(0,_.cn)(D&&"border-warning-500"),children:[(0,t.jsx)(x.CardHeader,{className:(0,_.cn)("py-3 px-4",O&&"border-b-0"),children:(0,t.jsx)(R,{table:e,isLocked:s,hasApiAccess:Q,onSelectToggleRLS:a,onSelectCreatePolicy:n})}),!A&&(0,t.jsx)(g.Admonition,{showIcon:!1,type:"warning",className:"border-0 border-y rounded-none min-h-12 flex items-center",children:(0,t.jsxs)("p",{className:"text-foreground-light",children:["No data will be selectable via Supabase APIs as this schema is not exposed. You may configure this in your project’s"," ",(0,t.jsx)(c.InlineLink,{href:`/project/${N}/settings/api`,children:"API settings"}),"."]})}),(D||$||F)&&A&&(0,t.jsx)(g.Admonition,{showIcon:!1,type:D?"warning":"default",className:"border-0 border-y rounded-none min-h-12 flex items-center",children:(0,t.jsx)("p",{children:V})}),C&&(0,t.jsx)(x.CardContent,{children:(0,t.jsx)(y.ShimmeringLoader,{})}),k&&(0,t.jsx)(x.CardContent,{children:(0,t.jsx)(r.default,{className:"border-0 rounded-none",error:L,subject:"Failed to retrieve policies"})}),!C&&!k&&(0,t.jsx)(x.CardContent,{className:"p-0",children:0===I.length?(0,t.jsx)("p",{className:"text-foreground-lighter text-sm p-4",children:"No policies created yet"}):(0,t.jsxs)(f.Table,{className:"table-fixed",children:[(0,t.jsx)(f.TableHeader,{children:(0,t.jsxs)(f.TableRow,{children:[(0,t.jsx)(f.TableHead,{className:"w-[40%]",children:"Name"}),(0,t.jsx)(f.TableHead,{className:"w-[20%]",children:"Command"}),(0,t.jsx)(f.TableHead,{className:"w-[30%]",children:"Applied to"}),(0,t.jsx)(f.TableHead,{className:"text-right",children:(0,t.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,t.jsx)(f.TableBody,{children:I.map(e=>(0,t.jsx)(S.PolicyRow,{policy:e,isLocked:B,onSelectEditPolicy:m,onSelectDeletePolicy:b},e.id))})]})})]})});Q.displayName="PolicyTableRow";var D=e.i(892277),$=e.i(418029),F=e.i(189108),M=e.i(847278),z=e.i(837710),B=e.i(466472);e.s(["Policies",0,({search:e,schema:o,tables:r,hasTables:c,isLocked:d,visibleTableIds:m,onSelectCreatePolicy:u,onSelectEditPolicy:h,onResetSearch:_})=>{let{ref:f}=(0,l.useParams)(),{data:g}=(0,p.useSelectedProjectQuery)(),[y,b]=(0,i.useState)(),[j,S]=(0,i.useState)({}),{mutate:N,isPending:v}=(0,M.useTableUpdateMutation)({onError:e=>{n.toast.error(`Failed to toggle RLS: ${e.message}`)},onSettled:()=>{k()}}),{mutate:w,isPending:C}=(0,F.useDatabasePolicyDeleteMutation)({onSuccess:()=>{n.toast.success("Successfully deleted policy!")},onSettled:()=>{k()}}),k=(0,i.useCallback)(()=>{S({}),b(void 0)},[]),L=(0,i.useCallback)(e=>{b(e)},[]),T=(0,i.useCallback)(e=>{h(e)},[h]),I=(0,i.useCallback)(e=>{S(e)},[]),q=async()=>{if(!y)return console.error("Table is required");let e={id:y.id,rls_enabled:!y.rls_enabled};N({projectRef:g?.ref,connectionString:g?.connectionString,id:y.id,name:y.name,schema:y.schema,payload:e})},A=async()=>{if(!g)return console.error("Project is required");w({projectRef:g.ref,connectionString:g.connectionString,originalPolicy:j})},E=(0,i.useCallback)(e=>{u(e.name)},[u]);return c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-4 pb-4",children:[d&&(0,t.jsx)(D.ProtectedSchemaWarning,{schema:o,entity:"policies"}),r.length>0?(0,t.jsxs)(t.Fragment,{children:[r.map(e=>{let s=m.has(e.id);return(0,t.jsx)("section",{hidden:!s,"aria-hidden":!s,"data-testid":`policy-table-${e.name}`,children:(0,t.jsx)(Q,{table:e,isLocked:"realtime"===o||d,onSelectToggleRLS:L,onSelectCreatePolicy:E,onSelectEditPolicy:T,onSelectDeletePolicy:I})},e.id)}),!!e&&0===m.size&&(0,t.jsx)($.NoSearchResults,{searchString:e??"",onResetFilter:_})]}):c?(0,t.jsx)($.NoSearchResults,{searchString:e??"",onResetFilter:_}):null]}),(0,t.jsx)(B.default,{visible:!(0,s.default)(j),variant:"destructive",title:"Delete policy",description:`Are you sure you want to delete the policy “${j.name}”? This action cannot be undone.`,confirmLabel:"Delete",confirmLabelLoading:"Deleting",loading:C,onCancel:k,onConfirm:A}),(0,t.jsx)(B.default,{visible:void 0!==y,variant:y?.rls_enabled?"destructive":"default",title:`${y?.rls_enabled?"Disable":"Enable"} Row Level Security`,description:`Are you sure you want to ${y?.rls_enabled?"disable":"enable"} Row Level Security (RLS) for the table “${y?.name}”?`,confirmLabel:`${y?.rls_enabled?"Disable":"Enable"} RLS`,confirmLabelLoading:`${y?.rls_enabled?"Disabling":"Enabling"} RLS`,loading:v,onCancel:k,onConfirm:q})]}):(0,t.jsx)(x.Card,{className:"w-full bg-transparent",children:(0,t.jsxs)(x.CardContent,{className:"flex flex-col items-center justify-center p-8",children:[(0,t.jsx)("h2",{className:"heading-default",children:"No tables to create policies for"}),(0,t.jsx)("p",{className:"text-sm text-foreground-light text-center mb-4",children:"RLS Policies control per-user access to table rows. Create a table in this schema first before creating a policy."}),(0,t.jsx)(z.Button,{asChild:!0,type:"default",children:(0,t.jsx)(a.default,{href:`/project/${f}/editor`,children:"Create a table"})})]})})}],458084);var O=e.i(532728),V=e.i(356003),U=e.i(822574),H=e.i(408891),K=e.i(531837),W=e.i(578269),G=e.i(509847),Y=e.i(617361),X=e.i(412385),J=e.i(34411),Z=e.i(428353),ee=e.i(9679),et=e.i(396831),es=e.i(725137),ea=e.i(283606),ei=e.i(314805),en=e.i(408279),el=e.i(500850);let eo=({schema:e,selectedPolicy:s,formFields:a})=>{let i=void 0!==s,{name:n,table:l,behavior:o,command:r,roles:c}=a;return(0,t.jsxs)("div",{className:"bg-surface-300 pt-2 pb-1",children:[(0,t.jsx)("div",{className:"flex items-center justify-between px-5 mb-1",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"pl-0.5 pr-5 flex items-center justify-center",children:(0,t.jsx)(w.Lock,{size:14,className:"text-foreground-lighter"})}),(0,t.jsx)("p",{className:"text-xs text-foreground-lighter font-mono uppercase",children:"Use options above to edit"})]})}),(0,t.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,t.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"1"}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:i?"alter":"create"}),' policy "',0===n.length?"policy_name":n,'"']})]}),(0,t.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,t.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"2"}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"on"}),' "',e,'"."',l,'"']})]}),!i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,t.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"3"}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"as"})," ",o.toLocaleUpperCase()]})]}),(0,t.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,t.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"4"}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"for"})," ",r.toLocaleUpperCase()]})]})]}),(0,t.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,t.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"5"}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"to"})," ",0===c.length?"public":c]})]}),(0,t.jsxs)("div",{className:"flex items-start",style:{fontSize:"14px"},children:[(0,t.jsx)("p",{className:"px-6 font-mono text-sm text-foreground-light select-none",children:"6"}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"insert"===r?"with check":"using"})," ",(0,t.jsx)("span",{className:"text-[#ffd700]",children:"("})]})]})]})},er=({oldName:e,newName:s,schema:a,table:i,lineNumber:n})=>(0,t.jsxs)("div",{className:"bg-surface-300 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,t.jsx)("div",{className:"w-[57px]",children:(0,t.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:n})}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"alter"}),' policy "',e,'"']})]}),(0,t.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,t.jsx)("div",{className:"w-[57px]",children:(0,t.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:n+1})}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"on"}),' "',a,'"."',i,'"']})]}),(0,t.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,t.jsx)("div",{className:"w-[57px]",children:(0,t.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:n+2})}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#569cd6]",children:"rename"}),' to "',s,'";']})]})]});var ec=e.i(370410),ed=e.i(365257),em=e.i(974900),eu=e.i(738196),eh=e.i(703526),ep=e.i(917007),ex=e.i(920432),e_=e.i(549815),ef=e.i(911509),eg=e.i(866205),ey=e.i(24315),eb=e.i(61863),ej=e.i(191209),eS=e.i(837243),eN=e.i(846887),ev=e.i(378277),ew=e.i(793912),eC=e.i(135144),ek=e.i(689805),eL=e.i(800957),eT=e.i(751824),eI=e.i(451031),eq=e.i(57492),eA=e.i(831927),eE=e.i(156722),eP=e.i(449123),eR=e.i(297396);let eQ=({schema:e,searchString:s,selectedTable:a,isEditing:n,form:l,onUpdateCommand:o,authContext:r})=>{let{data:c}=(0,p.useSelectedProjectQuery)(),[d,m]=(0,i.useState)(!1),{can:u}=(0,T.useAsyncCheckPermissions)(N.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),{data:h,isSuccess:x}=(0,eu.useTablesQuery)({projectRef:c?.ref,connectionString:c?.connectionString,schema:e,sortByProperty:"name",includeColumns:!0}),{data:_}=(0,em.useDatabaseRolesQuery)({projectRef:c?.ref,connectionString:c?.connectionString}),f=(_??[]).map(e=>({id:e.id,name:e.name,value:e.name,disabled:!1})).sort((e,t)=>e.name.localeCompare(t.name));return(0,i.useEffect)(()=>{if(!n&&void 0===a){let t=h?.find(t=>t.schema===e&&(t.id.toString()===s||t.name===s));t?l.setValue("table",t.name):x&&h.length>0&&l.setValue("table",h[0].name)}},[n,l,s,h,x,a]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{className:"px-5 py-5 flex flex-col gap-y-4 border-b",children:(0,t.jsxs)("div",{className:"items-start justify-between gap-4 grid grid-cols-12",children:[(0,t.jsx)(eb.FormField_Shadcn_,{control:l.control,name:"name",render:({field:e})=>(0,t.jsxs)(ej.FormItem_Shadcn_,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,t.jsx)(eS.FormLabel_Shadcn_,{children:"Policy Name"}),(0,t.jsx)(ey.FormControl_Shadcn_,{children:(0,t.jsx)(ev.Input_Shadcn_,{...e,disabled:!u,className:"bg-control border-control",placeholder:"Provide a name for your policy"})}),(0,t.jsx)(eN.FormMessage_Shadcn_,{})]})}),(0,t.jsx)(eb.FormField_Shadcn_,{control:l.control,name:"table",render:({field:s})=>(0,t.jsxs)(ej.FormItem_Shadcn_,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,t.jsxs)(eS.FormLabel_Shadcn_,{children:["Table",(0,t.jsx)("code",{className:"text-code-inline",children:"on"})," clause"]}),"database"===r&&(0,t.jsx)(ey.FormControl_Shadcn_,{children:(0,t.jsxs)(ek.Popover_Shadcn_,{open:d,onOpenChange:m,modal:!1,children:[(0,t.jsx)(eC.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(z.Button,{type:"default",disabled:!u,className:"w-full [&>span]:w-full h-[38px] text-sm",iconRight:(0,t.jsx)(ed.ChevronsUpDown,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:(0,t.jsx)("div",{className:"w-full flex gap-1",children:(0,t.jsxs)("span",{className:"text-foreground",children:[e,".",s.value]})})})}),(0,t.jsx)(ew.PopoverContent_Shadcn_,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,t.jsxs)(eg.Command_Shadcn_,{children:[(0,t.jsx)(ex.CommandInput_Shadcn_,{placeholder:"Find a table..."}),(0,t.jsxs)(ef.CommandList_Shadcn_,{children:[(0,t.jsx)(eh.CommandEmpty_Shadcn_,{children:"No tables found"}),(0,t.jsx)(ep.CommandGroup_Shadcn_,{children:(0,t.jsx)(et.ScrollArea,{className:(h??[]).length>7?"h-[200px]":"",children:(h??[]).map(e=>(0,t.jsx)(e_.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{l.setValue("table",e.name),m(!1)},onClick:()=>{l.setValue("table",e.name),m(!1)},children:(0,t.jsxs)("span",{className:"flex items-center gap-1.5",children:[s.value===e.name?(0,t.jsx)(ec.Check,{size:13}):"",e.name]})},e.id))})})]})]})})]})}),"realtime"===r&&(0,t.jsx)(ey.FormControl_Shadcn_,{children:(0,t.jsx)(ev.Input_Shadcn_,{disabled:!0,value:"messages.realtime",className:"bg-control border-control"})}),(0,t.jsx)(eN.FormMessage_Shadcn_,{})]})}),(0,t.jsx)(eb.FormField_Shadcn_,{control:l.control,name:"behavior",render:({field:e})=>(0,t.jsxs)(ej.FormItem_Shadcn_,{className:"col-span-6 flex flex-col gap-y-1",children:[(0,t.jsxs)(eS.FormLabel_Shadcn_,{children:["Policy Behavior ",(0,t.jsx)("code",{className:"text-code-inline",children:"as"})," clause"]}),(0,t.jsx)(ey.FormControl_Shadcn_,{children:(0,t.jsxs)(eP.Select_Shadcn_,{disabled:n,value:e.value,onValueChange:e=>l.setValue("behavior",e),children:[(0,t.jsx)(eE.SelectTrigger_Shadcn_,{className:"text-sm h-10 capitalize",children:e.value}),(0,t.jsx)(eI.SelectContent_Shadcn_,{children:(0,t.jsxs)(eq.SelectGroup_Shadcn_,{children:[(0,t.jsxs)(eA.SelectItem_Shadcn_,{value:"permissive",className:"text-sm",children:[(0,t.jsx)("p",{children:"Permissive"}),(0,t.jsx)("p",{className:"text-foreground-light text-xs",children:'Policies are combined using the "OR" Boolean operator'})]}),(0,t.jsxs)(eA.SelectItem_Shadcn_,{value:"restrictive",className:"text-sm",children:[(0,t.jsx)("p",{children:"Restrictive"}),(0,t.jsx)("p",{className:"text-foreground-light text-xs",children:'Policies are combined using the "AND" Boolean operator'})]})]})})]})}),(0,t.jsx)(eN.FormMessage_Shadcn_,{})]})}),(0,t.jsx)(eb.FormField_Shadcn_,{control:l.control,name:"command",render:({field:e})=>(0,t.jsxs)(ej.FormItem_Shadcn_,{className:"col-span-12 flex flex-col gap-y-1",children:[(0,t.jsxs)(eS.FormLabel_Shadcn_,{children:["Policy Command ",(0,t.jsx)("code",{className:"text-code-inline",children:"for"})," clause"]}),(0,t.jsx)(ey.FormControl_Shadcn_,{children:(0,t.jsx)(eT.RadioGroup_Shadcn_,{disabled:n,value:e.value,defaultValue:e.value,onValueChange:e=>{l.setValue("command",e),o(e)},className:`grid grid-cols-10 gap-3 ${n?"opacity-50":""}`,children:["select","insert",..."database"===r?["update","delete","all"]:[]].map(e=>(0,t.jsx)(eL.RadioGroupLargeItem_Shadcn_,{value:e,disabled:n,label:e.toLocaleUpperCase(),className:`col-span-2 w-auto ${n?"cursor-not-allowed":""}`},e))})}),(0,t.jsx)(eN.FormMessage_Shadcn_,{})]})}),(0,t.jsx)(eb.FormField_Shadcn_,{control:l.control,name:"roles",render:({field:e})=>(0,t.jsxs)(ej.FormItem_Shadcn_,{className:"col-span-12 flex flex-col gap-y-1",children:[(0,t.jsxs)(eS.FormLabel_Shadcn_,{children:["Target Roles ",(0,t.jsx)("code",{className:"text-code-inline",children:"to"})," clause"]}),(0,t.jsx)(ey.FormControl_Shadcn_,{children:(0,t.jsx)(eR.MultiSelectV2,{disabled:!u,options:f,value:0===e.value.length?[]:e.value?.split(", "),placeholder:"Defaults to all (public) roles if none selected",searchPlaceholder:"Search for a role",onChange:e=>l.setValue("roles",e.join(", "))})}),(0,t.jsx)(eN.FormMessage_Shadcn_,{})]})})]})})})};var eD=e.i(88816),e$=e.i(839360);let eF=(0,e.i(388019).default)("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);var eM=e.i(975924),ez=e.i(774234),eB=e.i(554855),eO=e.i(925282),eV=e.i(613580);let eU=({selectedPolicy:e,showTools:s,setShowTools:a})=>{let[n,l]=(0,i.useState)(!1);return(0,t.jsxs)(es.SheetHeader,{className:(0,_.cn)("py-3 flex flex-row justify-between items-start border-b"),children:[(0,t.jsxs)("div",{className:"flex flex-row gap-3 max-w-[75%] items-start",children:[(0,t.jsxs)(es.SheetClose,{className:(0,_.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","transition disabled:pointer-events-none data-[state=open]:bg-secondary","mt-1.5"),children:[(0,t.jsx)(eM.X,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,t.jsx)("div",{className:"h-[24px] w-[1px] bg-border-overlay"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(es.SheetTitle,{className:"truncate",children:void 0!==e?`Update policy: ${e.name}`:"Create a new Row Level Security policy"}),void 0!==e&&(0,t.jsxs)(eO.Collapsible_Shadcn_,{className:"-mt-1.5 pb-1.5",open:n,onOpenChange:l,children:[(0,t.jsx)(eB.CollapsibleTrigger_Shadcn_,{className:"group  font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,t.jsxs)("div",{className:"flex items-center gap-x-2 w-full",children:[(0,t.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"View policy details"}),(0,t.jsx)(eD.ChevronDown,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,t.jsx)(ez.CollapsibleContent_Shadcn_,{className:"grid gap-1.5",children:(0,t.jsx)("div",{className:"flex my-2",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,t.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Name:"}),(0,t.jsx)("p",{className:"pr-4",children:e?.name})]}),(0,t.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,t.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Action:"}),(0,t.jsx)("p",{className:"font-mono pr-4",children:e?.action})]}),(0,t.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,t.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Command:"}),(0,t.jsx)("p",{className:"font-mono pr-4",children:e?.command})]}),(0,t.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,t.jsx)("p",{className:"w-[110px] text-foreground-light",children:"Target roles:"}),(0,t.jsx)("p",{className:"font-mono pr-4",children:e?.roles.join(", ")})]}),(0,t.jsxs)("div",{className:"text-xs flex items-start space-x-2 border-b py-1.5",children:[(0,t.jsx)("p",{className:"w-[110px] text-foreground-light",children:"USING expression:"}),(0,t.jsx)("p",{className:"font-mono pr-4",children:e?.definition})]}),(0,t.jsxs)("div",{className:"text-xs flex items-start space-x-2 pt-1.5",children:[(0,t.jsx)("p",{className:"w-[110px] text-foreground-light",children:"CHECK expression:"}),(0,t.jsx)("p",{className:`${e?.check?"":"text-foreground-light"} font-mono pr-4`,children:e?.check??"None"})]})]})})})]})]})]}),(0,t.jsxs)(eV.Tooltip,{children:[(0,t.jsx)(eV.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{"aria-expanded":s,"aria-controls":"ai-chat-assistant",className:(0,_.cn)(s?"text-light":"text-foreground-lighter","mt-1 hover:text-foreground transition"),onClick:()=>a(!s),children:s?(0,t.jsx)(eF,{size:19,strokeWidth:1}):(0,t.jsx)(e$.PanelLeftClose,{size:19,strokeWidth:1})})}),(0,t.jsxs)(eV.TooltipContent,{side:"left",children:[s?"Hide":"Show"," tools"]})]})]})};var eH=e.i(366652),eK=e.i(71049),eW=e.i(171997),eG=e.i(592383),eY=e.i(728975),eX=e.i(223600),eJ=e.i(200243),eZ=e.i(211761);let e0=({schema:e,table:s,selectedPolicy:a,selectedTemplate:n,onSelectTemplate:l})=>{let[o,r]=(0,i.useState)(""),c="realtime"===e?(0,eZ.getRealtimePolicyTemplates)():"pgmq"===e?(0,eZ.getQueuePolicyTemplates)():(0,eZ.getGeneralPolicyTemplates)(e,s.length>0?s:"table_name"),d=void 0!==a?c.filter(e=>e.command===a.command):c,m=o.length>0?d.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.command.toLowerCase().includes(o.toLowerCase())):d;return(0,t.jsxs)("div",{className:"h-full px-content py-content flex flex-col gap-3",children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:"template-search",children:"Search templates"}),(0,t.jsx)(eW.Input,{size:"small",id:"template-search",icon:(0,t.jsx)(eH.Search,{className:"text-foreground-muted"}),placeholder:"Search templates",value:o,onChange:e=>r(e.target.value)}),o.length>0&&0===m.length&&(0,t.jsx)($.NoSearchResults,{searchString:o,className:"min-w-full"}),(0,t.jsx)("div",{className:"flex flex-col gap-1.5",children:m.map(e=>(0,t.jsxs)(eK.HoverCard,{openDelay:100,closeDelay:100,children:[(0,t.jsx)(eK.HoverCardTrigger,{children:(0,t.jsx)(eY.default,{title:e.name,titleClass:"text-sm",className:(0,_.cn)("transition w-full",e.id===n?"!border-stronger bg-surface-200 hover:!border-stronger":""),onClick:()=>l(e),hideChevron:!0,fixedHeight:!1,icon:(0,t.jsx)("div",{className:"min-w-16 flex items-start",children:(0,t.jsx)(A.Badge,{className:(0,_.cn)("!rounded font-mono","UPDATE"===e.command?"bg-blue-400 text-blue-900 border border-blue-800":""),variant:"ALL"===e.command?"default":"SELECT"===e.command?"success":"UPDATE"===e.command?"default":"DELETE"===e.command?"destructive":"warning",children:e.command})}),children:(0,t.jsx)(eG.Markdown,{content:e.description,className:"[&>p]:m-0 space-y-2"})},e.id)}),(0,t.jsxs)(eK.HoverCardContent,{hideWhenDetached:!0,side:"left",align:"center",className:"w-[500px] flex",animate:"slide-in",children:[(0,t.jsx)(eJ.SimpleCodeBlock,{showCopy:!1,className:"sql",parentClassName:"!p-0 [&>div>span]:text-xs",children:e.statement}),(0,t.jsx)(eX.default,{iconOnly:!0,type:"default",className:"px-1 absolute top-1.5 right-1.5",text:e.statement})]})]},e.id))})]})};var e1=e.i(148118),e2=e.i(721255),e4=e.i(772900),e5=e.i(592360),e3=e.i(178527);let e8=({error:e,open:s,setOpen:a})=>{let i=(e?.message?.split("\n")??[])?.filter(e=>e.length>0)??[];return(0,t.jsxs)("div",{className:"flex flex-col gap-y-3 px-5",children:[(0,t.jsxs)(e3.Alert_Shadcn_,{variant:"destructive",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z"})}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)(e5.AlertTitle_Shadcn_,{className:"m-0",children:"Error running SQL query"}),(0,t.jsxs)(eO.Collapsible_Shadcn_,{defaultOpen:!0,className:"flex flex-col gap-3",open:s,onOpenChange:()=>a(!s),children:[(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(eB.CollapsibleTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(z.Button,{size:"tiny",type:"outline",className:(0,_.cn)("group",e4.default["ai-icon__container--allow-hover-effect"]),children:s?"Hide error details":"Show error details"})})}),(0,t.jsx)(ez.CollapsibleContent_Shadcn_,{className:"overflow-auto",children:i.length>0?i.map((e,s)=>(0,t.jsx)("pre",{className:"font-mono text-xs whitespace-pre-wrap",children:e.split(" ").reduce((e,t)=>{let s=(0,e2.default)(e);return s&&"ERROR:"!==s?(0,e1.default)(e).concat([[s,t].join(" ")]):""===s?e.concat([" "]):e.concat([t])},[]).map((e,s,a)=>(0,t.jsx)("span",{className:(0,_.cn)("break-all","ERROR:"===e&&"text-destructive"),children:e},s))},`error-${s}`)):(0,t.jsx)("p",{className:"font-mono text-xs",children:e.error})})]})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto"})]})};var e7=e.i(156054),e6=o,e9=e.i(887093);let te=({id:e,defaultValue:s,wrapperClassName:a,className:n,value:l,placeholder:o,readOnly:r=!1,disableTabToUsePlaceholder:c=!1,lineNumberStart:d,onChange:m=e6.default,onMount:u=e6.default,editorRef:h,monacoRef:p})=>{let x=(0,i.useRef)(),f=(0,e7.useMonaco)(),g=`monaco-placeholder-${e}`,y=async(e,t)=>{h.current=e,void 0!==p&&(p.current=t),x.current=e.createContextKey("hasValue",!1);let s=document.getElementById(g);s&&void 0!==o&&0===(l??"").trim().length&&(s.style.display="block"),c||e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(o??"").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue"),e.focus(),u()};return(0,i.useEffect)(()=>{m()},[l]),(0,i.useEffect)(()=>{if(f){let e=f.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),s=(0,e9.formatSql)(t);return[{range:e.getFullModelRange(),text:s.trim()}]}});return()=>{e.dispose()}}},[f]),(0,i.useEffect)(()=>{if(void 0!==l&&l.trim().length>0){let e=document.getElementById(g);e&&(e.style.display="none")}},[l]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e7.default,{path:e,theme:"supabase",wrapperProps:{className:(0,_.cn)(a)},className:(0,_.cn)(n,"monaco-editor"),value:l??void 0,defaultLanguage:"pgsql",defaultValue:s??void 0,options:{tabSize:2,fontSize:13,readOnly:r,minimap:{enabled:!1},wordWrap:"on",contextmenu:!0,lineNumbers:void 0!==d?e=>(e+d).toString():void 0,glyphMargin:void 0,lineNumbersMinChars:4,folding:void 0,scrollBeyondLastLine:!1},onMount:y,onChange:e=>{x.current.set((e??"").length>0);let t=document.getElementById(g);t&&(e?t.style.display="none":t.style.display="block"),m()}}),void 0!==o&&(0,t.jsx)("div",{id:g,className:(0,_.cn)("monaco-placeholder absolute top-[0px] left-[57px] text-sm pointer-events-none font-mono tracking-tighter","[&>div>p]:text-foreground-lighter [&>div>p]:!m-0"),style:{display:"none"},children:(0,t.jsx)(eG.Markdown,{content:o})})]})},tt="rls-editor",ts=K.object({name:K.string().min(1,"Please provide a name"),table:K.string(),behavior:K.string(),command:K.string(),roles:K.string()}),ta={name:"",table:"",behavior:"permissive",command:"select",roles:""},ti=(0,i.memo)(function({visible:e,schema:s,searchString:a,selectedTable:o,selectedPolicy:r,onSelectCancel:c,authContext:d}){let{ref:m}=(0,l.useParams)(),u=(0,V.useQueryClient)(),{data:h}=(0,p.useSelectedProjectQuery)(),{can:x}=(0,T.useAsyncCheckPermissions)(N.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),[f,g]=(0,i.useState)(""),[y,b]=(0,i.useState)(""),[j,S]=(0,i.useState)(),[v,w]=(0,i.useState)(!0),C=(0,i.useRef)(null),L=(0,i.useRef)(null),[I,q]=(0,i.useState)(1),[A,E]=(0,i.useState)(0),P=(0,i.useRef)(null),R=(0,i.useRef)(null),[Q,D]=(0,i.useState)(1),[$,F]=(0,i.useState)(0),[M,B]=(0,i.useState)(),[K,ec]=(0,i.useState)(!0),[ed,em]=(0,i.useState)(!1),[eu,eh]=(0,i.useState)(),[ep,ex]=(0,i.useState)(!1),e_=(0,H.useForm)({mode:"onBlur",reValidateMode:"onBlur",resolver:(0,O.zodResolver)(ts),defaultValues:ta}),{name:ef,table:eg,behavior:ey,command:eb,roles:ej}=e_.watch(),eS=["update","all"].includes(eb),eN=void 0!==r&&ef!==r.name,{mutate:ev,isPending:ew}=(0,Y.useExecuteSqlMutation)({onSuccess:async()=>{await u.invalidateQueries({queryKey:G.databasePoliciesKeys.list(m)}),n.toast.success("Successfully created new policy"),c()},onError:e=>B(e)}),{mutate:eC,isPending:ek}=(0,W.useDatabasePolicyUpdateMutation)({onSuccess:()=>{n.toast.success("Successfully updated policy"),c()}}),eL=(0,i.useCallback)(()=>{var e;let t=(L.current?.getValue().trim()??null)||null,s=(R.current?.getValue().trim()??null)||null,a=void 0===r&&(ef.length>0||ej.length>0||!!t||!!s),i=void 0!==r&&(e={name:ef,roles:0===ej.length?["public"]:ej.split(", "),definition:t,check:"INSERT"===eb?t:s},!(("INSERT"!==r.command||r.check===e.check)&&("INSERT"===r.command||r.definition===e.definition&&r.check===e.check)&&r.name===e.name&&(0,U.default)(r.roles,e.roles)));return a||i},[eb,ef,ej,r]),{confirmOnClose:eT,modalProps:eI}=(0,X.useConfirmOnClose)({checkIsDirty:eL,onClose:c});return(0,i.useEffect)(()=>{if(e)if(x&&ex(!0),void 0!==r){let{name:e,action:t,table:s,command:a,roles:i}=r;e_.reset({name:e,table:s,behavior:t.toLowerCase(),command:a.toLowerCase(),roles:1===i.length&&"public"===i[0]?"":i.join(", ")}),r.definition&&g(`  ${r.definition}`),r.check&&b(`  ${r.check}`),r.check&&"INSERT"!==r.command&&w(!0)}else void 0!==o&&e_.reset({...ta,table:o});else L.current?.setValue(""),R.current?.setValue(""),ex(!1),B(void 0),em(!1),eh(void 0),g(""),b(""),w(!1),S(void 0),e_.reset(ta)},[e]),(0,i.useEffect)(()=>{L.current?.layout({width:0,height:0}),window.requestAnimationFrame(()=>{L.current?.layout()})},[ed,M,K]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Z.Form_Shadcn_,{...e_,children:(0,t.jsx)("form",{id:tt,onSubmit:e_.handleSubmit(e=>{let{name:t,table:a,behavior:i,command:n,roles:l}=e,o=L.current?.getValue().trim()??void 0,d=R.current?.getValue().trim();if("insert"===n&&(d=o),"insert"===n&&(void 0===d||0===d.length))return S("Please provide a SQL expression for the WITH CHECK statement");if("insert"!==n&&(void 0===o||0===o.length))return S("Please provide a SQL expression for the USING statement");if(S(void 0),void 0===r){let e=(({name:e,schema:t,table:s,behavior:a,command:i,roles:n,using:l,check:o})=>{let r=`create policy "${e}" on "${t}"."${s}" as ${a} for ${i} to ${n}`;return"insert"===i?`${r} with check (${o});`:`${r} using (${l})${(o??"").length>0?`with check (${o});`:";"}`})({name:t,schema:s,table:a,behavior:i,command:n,roles:0===l.length?"public":l,using:o??"",check:"insert"===n?o??"":d??""});B(void 0),ev({sql:e,projectRef:h?.ref,connectionString:h?.connectionString,handleError:e=>{throw e}})}else if(void 0!==h){let e={},s=0===l.length?["public"]:l.split(", ");if(t!==r.name&&(e.name=t),(0,U.default)(r.roles,s)||(e.roles=s),null!==r.definition&&r.definition!==o&&(e.definition=o),"INSERT"===r.command?r.check!==o&&(e.check=o):r.check!==d&&(e.check=d),0===Object.keys(e).length)return c();eC({projectRef:h.ref,connectionString:h?.connectionString,originalPolicy:r,payload:e})}}),children:(0,t.jsx)(es.Sheet,{open:e,onOpenChange:eT,children:(0,t.jsxs)(es.SheetContent,{showClose:!1,size:ep?"lg":"default",className:(0,_.cn)("bg-surface-200 p-0 flex flex-row gap-0",ep?"!min-w-[100vw] lg:!min-w-[1000px]":"!min-w-[100vw] lg:!min-w-[600px]"),children:[(0,t.jsxs)("div",{className:(0,_.cn)("flex flex-col grow w-full",ep&&"w-[60%]"),children:[(0,t.jsx)(eU,{selectedPolicy:r,showTools:ep,setShowTools:ex}),(0,t.jsxs)("div",{className:"flex flex-col h-full w-full justify-between overflow-y-auto",children:[(0,t.jsx)(eQ,{schema:s,searchString:a,selectedTable:o,isEditing:void 0!==r,form:e_,onUpdateCommand:e=>{S(void 0),["update","all"].includes(e)?w(!0):w(!1)},authContext:d}),(0,t.jsxs)("div",{className:"h-full",children:[(0,t.jsx)(eo,{schema:s,selectedPolicy:r,formFields:{name:ef,table:eg,behavior:ey,command:eb,roles:ej}}),(0,t.jsx)("div",{className:"mt-1 relative block",style:{height:A<=100?`${8+A}px`:"108px"},children:(0,t.jsx)(te,{disableTabToUsePlaceholder:!0,readOnly:!x,id:"rls-exp-one-editor",placeholder:"insert"===eb?"-- Provide a SQL expression for the with check statement":"-- Provide a SQL expression for the using statement",defaultValue:"insert"===eb?y:f,value:"insert"===eb?y:f,editorRef:L,monacoRef:C,lineNumberStart:6,onChange:()=>{E(L.current?.getContentHeight()??0),q(L.current?.getModel()?.getLineCount()??1)},onMount:()=>{setTimeout(()=>{E(L.current?.getContentHeight()??0),q(L.current?.getModel()?.getLineCount()??1)},200)}})}),(0,t.jsx)("div",{className:"bg-surface-300 py-1",children:(0,t.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,t.jsx)("div",{className:"w-[57px]",children:(0,t.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:7+I})}),(0,t.jsx)("p",{className:"font-mono tracking-tighter",children:v?(0,t.jsxs)(t.Fragment,{children:[eS&&v&&(0,t.jsx)("span",{className:"text-[#ffd700]",children:") "}),(0,t.jsx)("span",{className:"text-[#569cd6]",children:"with check"})," ",(0,t.jsx)("span",{className:"text-[#ffd700]",children:"("})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-[#ffd700]",children:")"}),";"]})})]})}),v&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mt-1 min-h-[28px] relative block",style:{height:$<=100?`${8+$}px`:"108px"},children:(0,t.jsx)(te,{disableTabToUsePlaceholder:!0,readOnly:!x,id:"rls-exp-two-editor",placeholder:"-- Provide a SQL expression for the with check statement",defaultValue:y,value:y,editorRef:R,monacoRef:P,lineNumberStart:7+I,onChange:()=>{F(R.current?.getContentHeight()??0),D(R.current?.getModel()?.getLineCount()??1)},onMount:()=>{setTimeout(()=>{F(R.current?.getContentHeight()??0),D(R.current?.getModel()?.getLineCount()??1)},200)}})}),(0,t.jsx)("div",{className:"bg-surface-300 py-1",children:(0,t.jsxs)("div",{className:"flex items-center",style:{fontSize:"14px"},children:[(0,t.jsx)("div",{className:"w-[57px]",children:(0,t.jsx)("p",{className:"w-[31px] flex justify-end font-mono text-sm text-foreground-light select-none",children:8+I+Q})}),(0,t.jsxs)("p",{className:"font-mono tracking-tighter",children:[(0,t.jsx)("span",{className:"text-[#ffd700]",children:")"}),";"]})]})})]}),eN&&(0,t.jsx)(er,{oldName:r.name,newName:ef,schema:s,table:eg,lineNumber:8+I+(v?Q:0)}),void 0!==j&&(0,t.jsx)("p",{className:"px-5 py-2 pb-0 text-sm text-red-900",children:j}),eS&&(0,t.jsxs)("div",{className:"px-5 py-3 flex items-center gap-x-2",children:[(0,t.jsx)(J.Checkbox_Shadcn_,{id:"use-check",name:"use-check",checked:v,onCheckedChange:()=>{S(void 0),w(!v)}}),(0,t.jsx)(ee.Label_Shadcn_,{className:"text-xs cursor-pointer",htmlFor:"use-check",children:"Use check expression"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[void 0!==M&&(0,t.jsx)(e8,{error:M,open:K,setOpen:ec}),(0,t.jsxs)(es.SheetFooter,{className:"flex items-center !justify-end px-5 py-4 w-full border-t",children:[(0,t.jsx)(z.Button,{type:"default",disabled:ew||ek,onClick:eT,children:"Cancel"}),(0,t.jsx)(k.ButtonTooltip,{form:tt,htmlType:"submit",loading:ew||ek,disabled:!x||ew||ek,tooltip:{content:{side:"top",text:x?void 0:"You need additional permissions to update policies"}},children:"Save policy"})]})]})]})]}),ep&&(0,t.jsx)("div",{className:(0,_.cn)("border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10",ep&&"w-[50%]","bg-studio overflow-auto"),children:(0,t.jsxs)(el.Tabs_Shadcn_,{defaultValue:"templates",className:"flex flex-col h-full w-full",children:[(0,t.jsx)(ei.TabsList_Shadcn_,{className:"flex gap-4 px-content pt-2",children:(0,t.jsx)(en.TabsTrigger_Shadcn_,{value:"templates",className:"px-0 data-[state=active]:bg-transparent",children:"Templates"},"templates")}),(0,t.jsx)(ea.TabsContent_Shadcn_,{value:"templates",className:(0,_.cn)("!mt-0 overflow-y-auto","data-[state=active]:flex data-[state=active]:grow"),children:(0,t.jsx)(et.ScrollArea,{className:"h-full w-full",children:(0,t.jsx)(e0,{schema:s,table:eg,selectedPolicy:r,selectedTemplate:eu,onSelectTemplate:e=>{e_.setValue("name",e.name),e_.setValue("behavior","permissive"),e_.setValue("command",e.command.toLowerCase()),e_.setValue("roles",e.roles.join(", ")??""),g(`  ${e.definition}`),b(`  ${e.check}`),q(1),D(1),S(void 0),["update","all"].includes(e.command.toLowerCase())&&e.check.length>0?w(!0):w(!1)}})})})]})})]})})})}),(0,t.jsx)(tn,{...eI})]})});ti.displayName="PolicyEditorPanel";let tn=({visible:e,onClose:s,onCancel:a})=>(0,t.jsx)(B.default,{visible:e,title:"Discard changes",confirmLabel:"Discard",onCancel:a,onConfirm:s,children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to close the editor? Any unsaved changes on your policy and conversations with the Assistant will be lost."})});e.s(["PolicyEditorPanel",0,ti],376841)}]);

//# debugId=0025117c-f744-ee80-cc7b-8d94366ebca3
//# sourceMappingURL=f4f15d44a4db0b03.js.map