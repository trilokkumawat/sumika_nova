;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="97cb4c06-a3ff-ac34-756a-3508c9e9f07e")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,155494,e=>{"use strict";e.i(869176);var a=e.i(478902),s=e.i(532728),t=e.i(902858);e.i(128328);var r=e.i(947748),n=e.i(657588),i=e.i(158639),l=e.i(763013),o=e.i(513826),d=e.i(368315),c=e.i(10429),u=e.i(416050),h=e.i(587433),m=e.i(774234),g=e.i(554855),p=e.i(925282),x=e.i(24315),j=e.i(61863),f=e.i(191209),S=e.i(418348),b=e.i(613580),_=e.i(843778),v=e.i(710483),y=e.i(538482);let N=({form:e,layout:s="horizontal",collapsible:t=!0})=>{let r=(0,n.useFlag)("disableOrioleProjectCreation"),i=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.FormField_Shadcn_,{name:"useOrioleDb",control:e.control,render:({field:t})=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(y.FormItemLayout,{layout:s,label:"Postgres Type",className:"[&>div>label]:!break-normal",children:[(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsxs)(S.RadioGroupStacked,{onValueChange:e=>t.onChange("true"===e),defaultValue:t.value.toString(),children:[(0,a.jsx)(f.FormItem_Shadcn_,{asChild:!0,children:(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsx)(S.RadioGroupStackedItem,{value:"false",label:(0,a.jsxs)(a.Fragment,{children:["Postgres",(0,a.jsx)(h.Badge,{children:"Default"})]}),description:"Recommended for production workloads",className:"[&>div>div>p]:text-left [&>div>div>p]:text-xs [&>div>div>label]:flex [&>div>div>label]:items-center [&>div>div>label]:gap-x-2"})})}),(0,a.jsx)(f.FormItem_Shadcn_,{asChild:!0,children:(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsxs)(b.Tooltip,{children:[(0,a.jsx)(b.TooltipTrigger,{asChild:!0,children:(0,a.jsx)(S.RadioGroupStackedItem,{value:"true",label:(0,a.jsxs)(a.Fragment,{children:["Postgres with OrioleDB",(0,a.jsx)(h.Badge,{variant:"warning",children:"Alpha"})]}),description:"Not recommended for production workloads",className:(0,_.cn)("[&>div>div>p]:text-left [&>div>div>p]:text-xs [&>div>div>label]:flex [&>div>div>label]:items-center [&>div>div>label]:gap-x-2",e.getValues("useOrioleDb")?"!rounded-b-none":""),disabled:r})}),r&&(0,a.jsx)(b.TooltipContent,{side:"right",className:"w-60 text-center",children:"OrioleDB is temporarily disabled for new projects. Please try again later."})]})})})]})}),e.getValues("useOrioleDb")&&(0,a.jsx)(v.Admonition,{type:"warning",className:"rounded-t-none [&>div]:text-xs",title:"OrioleDB is not production ready",description:"Postgres with OrioleDB extension is currently in Public Alpha and not recommended for production usage yet.",children:(0,a.jsx)(o.DocsButton,{className:"mt-2",href:`${c.DOCS_URL}/guides/database/orioledb`})})]})})}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter mt-3",children:"These settings cannot be changed after the project is created"})]}),l=(0,a.jsxs)(p.Collapsible_Shadcn_,{children:[(0,a.jsxs)(g.CollapsibleTrigger_Shadcn_,{className:"group/advanced-trigger font-mono uppercase tracking-widest text-xs flex items-center gap-1 text-foreground-lighter/75 hover:text-foreground-light transition data-[state=open]:text-foreground-light",children:["Advanced Configuration",(0,a.jsx)(u.ChevronRight,{size:16,strokeWidth:1,className:"mr-2 group-data-[state=open]/advanced-trigger:rotate-90 group-hover/advanced-trigger:text-foreground-light transition"})]}),(0,a.jsx)(m.CollapsibleContent_Shadcn_,{className:(0,_.cn)("pt-5 data-[state=closed]:animate-collapsible-up data-[state=open]:animate-collapsible-down"),children:i})]});return(0,a.jsx)(d.default.Content,{children:t?l:i})};var w=e.i(276093),C=e.i(837508),P=e.i(449123),z=e.i(451031),T=e.i(57492),R=e.i(831927),A=e.i(156722),F=e.i(719754),E=e.i(937942),I=e.i(295057),O=e.i(965371),V=e.i(871895),L=e.i(171096);let D=({form:e})=>(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(j.FormField_Shadcn_,{control:e.control,name:"instanceSize",render:({field:s})=>(0,a.jsx)(y.FormItemLayout,{layout:"horizontal",label:"Compute size",description:(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("p",{children:["The size for your dedicated database. You can change this later. Learn more about"," ",(0,a.jsx)(E.InlineLink,{href:`${c.DOCS_URL}/guides/platform/compute-add-ons`,children:"compute add-ons"})," ","and"," ",(0,a.jsx)(E.InlineLink,{href:`${c.DOCS_URL}/guides/platform/manage-your-usage/compute`,children:"compute billing"}),"."]})}),children:(0,a.jsxs)(P.Select_Shadcn_,{value:s.value,onValueChange:e=>s.onChange(e),children:[(0,a.jsx)(A.SelectTrigger_Shadcn_,{className:"[&>span>div>div>[data-field=instance-details]]:hidden",children:(0,a.jsx)(F.SelectValue_Shadcn_,{placeholder:"Select a compute size"})}),(0,a.jsx)(z.SelectContent_Shadcn_,{children:(0,a.jsxs)(T.SelectGroup_Shadcn_,{children:[L.sizes.filter(a=>I.instanceSizeSpecs[a].cloud_providers.includes(e.getValues("cloudProvider"))).map(s=>(0,a.jsx)(R.SelectItem_Shadcn_,{value:s,children:(0,a.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,a.jsx)("div",{className:"w-14 flex items-center",children:(0,a.jsx)(V.ComputeBadge,{infraComputeSize:s})}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"text-foreground",children:[I.instanceSizeSpecs[s].ram," RAM /"," ",I.instanceSizeSpecs[s].cpu," ",(0,O.getCloudProviderArchitecture)(e.getValues("cloudProvider"))," ","CPU"]}),(0,a.jsxs)("p",{translate:"no",className:"text-xs text-foreground-light","data-field":"instance-details",children:["$",I.instanceSizeSpecs[s].priceHourly,"/hour (~$",I.instanceSizeSpecs[s].priceMonthly,"/month)"]})]})]})},s)),(0,a.jsx)(R.SelectItem_Shadcn_,{value:"disabled",disabled:!0,children:(0,a.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,a.jsx)("span",{children:"Larger instance sizes available after creation"})})},"disabled")]})})]})})})});var k=e.i(378277),B=e.i(900943),$=e.i(727060),G=e.i(379606),M=e.i(746301);let U=()=>(0,a.jsxs)("p",{className:"mb-2",children:["Note: If using the Postgres connection string, you will need to"," ",(0,a.jsx)(E.InlineLink,{href:`${c.DOCS_URL}/guides/database/postgres/roles#special-symbols-in-passwords`,children:"percent-encode"})," ","the password"]}),W=async(e,a)=>{try{let{warning:s,message:t,strength:r}=await (0,$.passwordStrength)(a);e.setValue("dbPassStrength",r,{shouldValidate:!1,shouldDirty:!1}),e.setValue("dbPassStrengthMessage",t??"",{shouldValidate:!1,shouldDirty:!1}),e.setValue("dbPassStrengthWarning",s??"",{shouldValidate:!1,shouldDirty:!1}),e.trigger("dbPass")}catch(e){console.error(e)}},q=({form:e})=>{async function s(){let a=(0,G.generateStrongPassword)();e.setValue("dbPass",a),W(e,a)}return(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(j.FormField_Shadcn_,{control:e.control,name:"dbPass",render:({field:t})=>{let r=t.value.length>0&&!t.value.match(L.DATABASE_PASSWORD_REGEX);return(0,a.jsx)(y.FormItemLayout,{label:"Database password",layout:"horizontal",description:(0,a.jsxs)(a.Fragment,{children:[r&&(0,a.jsx)(U,{}),(0,a.jsx)(B.PasswordStrengthBar,{passwordStrengthScore:e.getValues("dbPassStrength"),password:t.value,passwordStrengthMessage:e.getValues("dbPassStrengthMessage"),generateStrongPassword:s})]}),children:(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsx)(M.Input,{copy:t.value.length>0,type:"password",placeholder:"Type in a strong password",...t,autoComplete:"off",onChange:async a=>{let s=a.target.value;t.onChange(a),W(e,s)}})})})}})})};var H=e.i(867637),Q=e.i(102703);let Y=({title:e})=>(0,a.jsx)(d.default.Content,{className:"pb-8",children:(0,a.jsx)(Q.default,{icon:(0,a.jsx)(H.AlertCircle,{size:20,strokeWidth:1.5}),defaultVisibility:!0,hideCollapse:!0,title:e,description:(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsxs)("p",{className:"text-sm leading-normal",children:["Our engineers are currently working on a fix. You can follow updates on"," ",(0,a.jsx)("a",{className:"text-brand",href:"https://status.supabase.com/",children:"https://status.supabase.com/"})]})})})});var K=e.i(794231);let X=({membersExceededLimit:e})=>(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(v.Admonition,{type:"default",title:"The organization has members who have exceeded their free project limits",description:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-sm leading-normal",children:"The following members have reached their maximum limits for the number of active free plan projects within organizations where they are an administrator or owner:"}),(0,a.jsx)("ul",{className:"pl-5 list-disc",children:e.map((e,s)=>(0,a.jsxs)("li",{children:[e.username||e.primary_email," (Limit: ",e.free_project_limit," free projects)"]},`member-${s}`))}),(0,a.jsx)("p",{className:"text-sm leading-normal",children:"These members will need to either delete, pause, or upgrade one or more of these projects before you're able to create a free project within this organization."}),(0,a.jsx)(K.UpgradePlanButton,{source:"freeProjectLimitWarning",featureProposition:"create more projects"})]})})});var Z=e.i(271226),J=e.i(693241),ee=e.i(811025),ea=e.i(2579),es=e.i(265735),et=e.i(903248),er=e.i(504194);let en=({slug:e})=>{let{data:s,isSuccess:t,isPending:r,isError:n,error:i}=(0,ee.useOrganizationsQuery)();return(0,a.jsxs)(a.Fragment,{children:["_"!==e&&(0,a.jsx)(v.Admonition,{type:"destructive",title:"Organization not found",description:(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsxs)(a.Fragment,{children:["The organization ",(0,a.jsx)("code",{className:"text-code-inline",children:e})," "]}):(0,a.jsx)(a.Fragment,{children:"This organization "}),"does not exist or you do not have permission to access to it. Contact the the owner if you believe this is a mistake."]})}),(0,a.jsx)("h3",{className:"text-sm",children:"Select a different organization to create your new project in"}),(0,a.jsxs)("div",{className:"grid gap-2 grid-cols-2",children:[r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(et.Skeleton,{className:"h-[62px] rounded-md"}),(0,a.jsx)(et.Skeleton,{className:"h-[62px] rounded-md"}),(0,a.jsx)(et.Skeleton,{className:"h-[62px] rounded-md"})]}),n&&(0,a.jsx)(v.Admonition,{type:"destructive",title:"Failed to load organizations",description:i?.message}),t&&s?.map(e=>(0,a.jsx)(er.OrganizationCard,{organization:e,href:`/new/${e.slug}`},e.slug))]})]})},ei=({form:e})=>{let s=(0,Z.useRouter)(),{slug:r}=(0,i.useParams)(),{data:n}=(0,es.useSelectedOrganizationQuery)(),{can:l}=(0,ea.useAsyncCheckPermissions)(t.PermissionAction.CREATE,"projects"),{data:o,isSuccess:c}=(0,ee.useOrganizationsQuery)(),u=(o?.length??0)>0&&c&&void 0===n;return(0,a.jsxs)(d.default.Content,{className:"space-y-4",children:[(0,a.jsx)(j.FormField_Shadcn_,{control:e.control,name:"organization",render:({field:e})=>(0,a.jsx)(y.FormItemLayout,{label:"Organization",layout:"horizontal",children:(o?.length??0)>0&&(0,a.jsxs)(P.Select_Shadcn_,{onValueChange:a=>{e.onChange(a),s.push(`/new/${a}`)},value:e.value,defaultValue:e.value,children:[(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsx)(A.SelectTrigger_Shadcn_,{children:(0,a.jsx)(F.SelectValue_Shadcn_,{placeholder:"Select an organization"})})}),(0,a.jsx)(z.SelectContent_Shadcn_,{children:(0,a.jsx)(T.SelectGroup_Shadcn_,{children:o?.map(e=>(0,a.jsx)(R.SelectItem_Shadcn_,{value:e.slug,children:(0,a.jsxs)("div",{className:"flex justify-between items-center gap-2 w-full",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)(h.Badge,{className:"mt-[1px]",children:e.plan.name})]})},e.id))})})]})})}),c&&!l&&!u&&(0,a.jsx)(J.NoPermission,{resourceText:"create a project"}),u&&(0,a.jsx)(en,{slug:r})]})};var el=e.i(372598),eo=e.i(97429);let ed=eo.z.object({organization:eo.z.string({required_error:"Please select an organization"}),projectName:eo.z.string().trim().min(1,"Please enter a project name.").min(3,"Project name must be at least 3 characters long.").max(64,"Project name must be no longer than 64 characters."),postgresVersion:eo.z.string({required_error:"Please enter a Postgres version."}),dbRegion:eo.z.string({required_error:"Please select a region."}),cloudProvider:eo.z.string({required_error:"Please select a cloud provider."}),dbPass:eo.z.string({required_error:"Please enter a database password."}).min(1,"Password is required."),dbPassStrength:eo.z.union([eo.z.literal(0),eo.z.literal(1),eo.z.literal(2),eo.z.literal(3),eo.z.literal(4)]).default(0),dbPassStrengthMessage:eo.z.string().default(""),dbPassStrengthWarning:eo.z.string().default(""),instanceSize:eo.z.string().optional(),dataApi:eo.z.boolean(),enableRlsEventTrigger:eo.z.boolean(),postgresVersionSelection:eo.z.string(),useOrioleDb:eo.z.boolean()}).superRefine(({dbPassStrength:e,dbPassStrengthWarning:a},s)=>{e<C.DEFAULT_MINIMUM_PASSWORD_STRENGTH&&s.addIssue({code:eo.z.ZodIssueCode.custom,path:["dbPass"],message:a||"Password not secure enough"})});var ec=e.i(715801),eu=e.i(124416),eh=e.i(837710),em=e.i(162530),eg=e.i(492418),ep=e.i(252387);let ex=({form:e,canCreateProject:s,instanceSize:t,organizationProjects:i,isCreatingNewProject:l,isSuccessNewProject:o})=>{let d=(0,Z.useRouter)(),{data:u}=(0,es.useSelectedOrganizationQuery)(),m=u?.plan?.id==="free",g=(0,n.useFlag)("disableProjectCreationAndUpdate"),[p]=(0,eu.useLocalStorageQuery)(r.LOCAL_STORAGE_KEYS.LAST_VISITED_ORGANIZATION,""),x=10*(0===i.length),j=m?0:I.instanceSizeSpecs[t].priceMonthly-x,f=i.reduce((e,a)=>{let s=a.databases.find(e=>e.identifier===a.ref);return e+(s?(0,ec.monthlyInstancePrice)(s.infra_compute_size):0)},0)+(0,ec.monthlyInstancePrice)(t)-10;return(0,a.jsxs)("div",{className:"grid grid-cols-12 w-full gap-4 items-center",children:[(0,a.jsx)("div",{className:"col-span-4",children:!m&&!g&&s&&j>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Additional costs"}),(0,a.jsxs)("div",{className:"text-brand flex gap-1 items-center font-mono font-medium",children:[(0,a.jsxs)("span",{children:["$",j,"/m"]}),(0,a.jsxs)(ep.InfoTooltip,{side:"top",className:"max-w-[450px] p-0",children:[(0,a.jsxs)("div",{className:"p-4 text-sm text-foreground-light space-y-1",children:[(0,a.jsxs)("p",{children:["Each project includes a dedicated Postgres instance running on its own server. You are charged for the"," ",(0,a.jsx)(E.InlineLink,{href:`${c.DOCS_URL}/guides/platform/billing-on-supabase`,children:"Compute resource"})," ","of that server, independent of your database usage."]}),f>0&&(0,a.jsx)("p",{children:"Compute costs are applied on top of your subscription plan costs."})]}),(0,a.jsxs)(eg.Table,{className:"mt-2",children:[(0,a.jsx)(eg.TableHeader,{className:"[&_th]:h-7",children:(0,a.jsxs)(eg.TableRow,{className:"py-2",children:[(0,a.jsx)(eg.TableHead,{className:"w-[170px]",children:"Project"}),(0,a.jsx)(eg.TableHead,{children:"Compute Size"}),(0,a.jsx)(eg.TableHead,{className:"text-right",children:"Monthly Costs"})]})}),(0,a.jsxs)(eg.TableBody,{className:"[&_td]:py-2",children:[i.map(e=>{let s=e.databases.find(a=>a.identifier===e.ref);return(0,a.jsxs)(eg.TableRow,{className:"text-foreground-light",children:[(0,a.jsx)(eg.TableCell,{className:"w-[170px] truncate",children:e.name}),(0,a.jsx)(eg.TableCell,{className:"text-center",children:(0,ec.instanceLabel)(s?.infra_compute_size)}),(0,a.jsxs)(eg.TableCell,{className:"text-right",children:["$",(0,ec.monthlyInstancePrice)(s?.infra_compute_size)]})]},e.ref)}),(0,a.jsxs)(eg.TableRow,{children:[(0,a.jsxs)(eg.TableCell,{className:"w-[170px] flex gap-2",children:[(0,a.jsx)("span",{className:"truncate",children:e.getValues("projectName")||"New project"}),(0,a.jsx)(h.Badge,{variant:"success",children:"New"})]}),(0,a.jsx)(eg.TableCell,{className:"text-center",children:(0,ec.instanceLabel)(t)}),(0,a.jsxs)(eg.TableCell,{className:"text-right",children:["$",(0,ec.monthlyInstancePrice)(t)]})]})]})]}),(0,a.jsx)(em.PopoverSeparator_Shadcn_,{}),(0,a.jsxs)(eg.Table,{children:[(0,a.jsx)(eg.TableHeader,{className:"[&_th]:h-7",children:(0,a.jsxs)(eg.TableRow,{children:[(0,a.jsx)(eg.TableHead,{colSpan:2,children:"Compute Credits"}),(0,a.jsx)(eg.TableHead,{colSpan:1,className:"text-right",children:"-$10"})]})}),(0,a.jsx)(eg.TableBody,{className:"[&_td]:py-2",children:(0,a.jsxs)(eg.TableRow,{className:"text-foreground",children:[(0,a.jsxs)(eg.TableCell,{colSpan:2,children:["Total Monthly Compute Costs",i.length>0&&(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Excluding Read replicas"})]}),(0,a.jsxs)(eg.TableCell,{colSpan:1,className:"text-right",children:["$",f]})]})})]})]})]})]})}),(0,a.jsxs)("div",{className:"flex items-end col-span-8 space-x-2 ml-auto",children:[(0,a.jsx)(eh.Button,{type:"default",disabled:l||o,onClick:()=>{p?d.push(`/org/${p}`):d.push("/organizations")},children:"Cancel"}),(0,a.jsx)(eh.Button,{htmlType:"submit",loading:l||o,disabled:!s,children:"Create new project"})]})]},"panel-footer")},ej=({form:e})=>(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(j.FormField_Shadcn_,{control:e.control,name:"projectName",render:({field:e})=>(0,a.jsx)(y.FormItemLayout,{label:"Project name",layout:"horizontal",children:(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsx)(k.Input_Shadcn_,{...e,placeholder:"Project name"})})})})});var ef=e.i(567558),eS=e.i(242882),eb=e.i(72187),e_=e.i(234745),ev=e.i(48189);e.i(287509);var ey=e.i(434934),eN=e.i(142119);async function ew({cloudProvider:e,restrictedPool:a,useRestrictedPool:s=!0}){if(!e)throw Error("Cloud provider is required");try{let t=await (0,e_.fetchHandler)("https://www.cloudflare.com/cdn-cgi/trace").then(e=>e.text()),r=Object.fromEntries(t.split("\n").map(e=>e.split("="))).loc,n=L.COUNTRY_LAT_LON[r];if(void 0===n)return;let i=["AWS","AWS_K8S"].includes(e),l=i?eb.AWS_REGIONS_COORDINATES:eb.FLY_REGIONS_COORDINATES,o=s&&a?Object.entries(l).filter(e=>a.includes(e[0])).reduce((e,a)=>({...e,[a[0]]:a[1]}),{}):l,d=Object.keys(o).map(e=>{let a={lat:o[e][1],lon:o[e][0]};return(0,ev.getDistanceLatLonKM)(n.lat,n.lon,a.lat,a.lon)}),c=Math.min(...d),u=Object.keys(o)[d.indexOf(c)];return i?ey.AWS_REGIONS[u].displayName:ey.FLY_REGIONS[u].displayName}catch(e){throw e}}let eC=({cloudProvider:e,useRestrictedPool:a},{enabled:s=!0,...t}={})=>{let r=(0,n.useFlag)("defaultRegionRestrictedPool"),i=(0,ev.tryParseJson)(r);return(0,eS.useQuery)({queryKey:eN.miscKeys.defaultRegion(e,a??!0),queryFn:()=>ew({cloudProvider:e,restrictedPool:i,useRestrictedPool:a}),enabled:s&&void 0!==e&&void 0!==i,retry:e=>e<1,...t})};var eP=e.i(711950);async function ez({slug:e,cloudProvider:a,desiredInstanceSize:s},t){if(!e)throw Error("slug is required");let{data:r,error:n}=await (0,e_.get)("/platform/projects/available-regions",{params:{query:{cloud_provider:a,organization_slug:e,desired_instance_size:s}},signal:t});return n&&(0,e_.handleError)(n),r}let eT=({slug:e,cloudProvider:a,desiredInstanceSize:s},{enabled:t=!0,...r}={})=>(0,eS.useQuery)({queryKey:eP.organizationKeys.availableRegions(e,a,s),queryFn:({signal:t})=>ez({slug:e,cloudProvider:a,desiredInstanceSize:s},t),enabled:t&&void 0!==e,...r});var eR=e.i(822037),eA=e.i(843142);let eF=e=>"APAC"===e?"Asia-Pacific":e,eE=({form:e,instanceSize:s,layout:t="horizontal"})=>{let{slug:r}=(0,i.useParams)(),l=e.getValues("cloudProvider"),o=(0,n.useFlag)("enableSmartRegion"),{isPending:u}=eC({cloudProvider:l},{enabled:!o}),{data:m,isPending:g,isError:p,error:x}=eT({slug:r,cloudProvider:l,desiredInstanceSize:s},{enabled:o,staleTime:3e5}),f=m?.all.smartGroup??[],S=m?.all.specific??[],v=new Set([m?.recommendations.smartGroup.code].filter(Boolean)),N=new Set(m?.recommendations.specific.map(e=>e.code)),w=Object.entries((0,ec.getAvailableRegions)(C.PROVIDERS[l].id)).map(([e,a])=>({code:a.code,name:a.displayName,provider:l,status:void 0})),E=o?S:w,I=o?g:u,O=[...f,...E];return p?(0,a.jsx)(ef.default,{subject:"Error loading available regions",error:x}):(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(j.FormField_Shadcn_,{control:e.control,name:"dbRegion",render:({field:e})=>{let s=O.find(a=>!!a.name&&a.name===e.value);return(0,a.jsx)(y.FormItemLayout,{layout:t,label:"Region",description:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Select the region closest to your users for the best performance."}),!1]}),children:(0,a.jsxs)(P.Select_Shadcn_,{value:e.value,onValueChange:e.onChange,disabled:I,children:[(0,a.jsx)(A.SelectTrigger_Shadcn_,{className:"[&>:nth-child(1)]:w-full [&>:nth-child(1)]:flex [&>:nth-child(1)]:items-start",children:(0,a.jsx)(F.SelectValue_Shadcn_,{placeholder:I?"Loading available regions...":"Select a region for your project..",children:void 0!==e.value&&(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[s?.code&&(0,a.jsx)("img",{alt:"region icon",className:"w-5 rounded-sm",src:`${c.BASE_PATH}/img/regions/${s.code}.svg`}),(0,a.jsx)("span",{className:"text-foreground",children:s?.name?eF(s.name):e.value})]})})}),(0,a.jsxs)(z.SelectContent_Shadcn_,{children:[o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(T.SelectGroup_Shadcn_,{children:[(0,a.jsx)(eR.SelectLabel_Shadcn_,{children:"General regions"}),f.map(e=>(0,a.jsx)(R.SelectItem_Shadcn_,{value:e.name,className:"w-full [&>:nth-child(2)]:w-full",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,a.jsx)("img",{alt:"region icon",className:"w-5 rounded-sm",src:`${c.BASE_PATH}/img/regions/${e.code}.svg`}),(0,a.jsx)("span",{className:"text-foreground",children:eF(e.name)})]}),(0,a.jsx)("div",{children:v.has(e.code)&&(0,a.jsx)(h.Badge,{variant:"success",className:"mr-1",children:"Recommended"})})]})},e.code))]}),(0,a.jsx)(eA.SelectSeparator_Shadcn_,{})]}),(0,a.jsxs)(T.SelectGroup_Shadcn_,{children:[(0,a.jsx)(eR.SelectLabel_Shadcn_,{children:"Specific regions"}),E.map(e=>(0,a.jsx)(R.SelectItem_Shadcn_,{value:e.name,className:(0,_.cn)("w-full [&>:nth-child(2)]:w-full",void 0!==e.status&&"!pointer-events-auto"),disabled:void 0!==e.status,children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between w-full gap-x-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,a.jsx)("img",{alt:"region icon",className:"w-5 rounded-sm",src:`${c.BASE_PATH}/img/regions/${e.code}.svg`}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-foreground-lighter font-mono",children:e.code})]})]}),N.has(e.code)&&(0,a.jsx)(h.Badge,{variant:"success",className:"mr-1",children:"Recommended"}),void 0!==e.status&&"capacity"===e.status&&(0,a.jsxs)(b.Tooltip,{children:[(0,a.jsx)(b.TooltipTrigger,{children:(0,a.jsx)(h.Badge,{variant:"warning",className:"mr-1",children:"Unavailable"})}),(0,a.jsx)(b.TooltipContent,{children:"Temporarily unavailable due to this region being at capacity."})]})]})},e.code))]})]})]})})}})})};var eI=e.i(761755),eO=e.i(210419),eV=e.i(34411),eL=e.i(215317),eD=e.i(837243),ek=e.i(529440);let eB=({form:e,layout:s="horizontal"})=>{let t=(0,eI.usePHFlag)("projectCreationEnableRlsEventTrigger"),r=(0,ek.useWatch_Shadcn_)({control:e.control,name:"dataApi"});return(0,a.jsx)(d.default.Content,{className:"pb-8",children:(0,a.jsx)(y.FormItemLayout,{layout:s,label:"Security",isReactForm:!1,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(j.FormField_Shadcn_,{name:"dataApi",control:e.control,render:({field:e})=>(0,a.jsxs)(f.FormItem_Shadcn_,{className:"flex items-start gap-3",children:[(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsx)(eV.Checkbox_Shadcn_,{checked:e.value,disabled:e.disabled,onCheckedChange:a=>e.onChange(!0===a)})}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(eD.FormLabel_Shadcn_,{className:"text-sm text-foreground",children:"Enable Data API"}),(0,a.jsxs)(eL.FormDescription_Shadcn_,{className:"text-foreground-lighter",children:["Autogenerate a RESTful API for your public schema. Recommended if using a client library like"," ",(0,a.jsx)(eO.default,{href:"https://supabase.com/docs/reference/javascript/introduction",target:"_blank",className:"text-link",children:"supabase-js"}),"."]})]})]})}),"test"===t&&(0,a.jsx)(j.FormField_Shadcn_,{name:"enableRlsEventTrigger",control:e.control,render:({field:e})=>(0,a.jsxs)(f.FormItem_Shadcn_,{className:"flex items-start gap-3",children:[(0,a.jsx)(x.FormControl_Shadcn_,{children:(0,a.jsx)(eV.Checkbox_Shadcn_,{checked:e.value,disabled:e.disabled,onCheckedChange:a=>e.onChange(!0===a)})}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(eD.FormLabel_Shadcn_,{className:"text-sm text-foreground",children:"Enable automatic RLS"}),(0,a.jsx)(eL.FormDescription_Shadcn_,{className:"text-foreground-lighter",children:"Create an event trigger that automatically enables Row Level Security on all new tables in the public schema."})]})]})}),!r&&(0,a.jsx)(v.Admonition,{type:"warning",title:"Client libraries need Data API to query your database",children:"Disabling it means supabase-js and similar libraries can't query or mutate data."})]})})})};var e$=e.i(448710),eG=e.i(996372),eM=e.i(467619),eU=e.i(390473),eW=e.i(656429),eq=e.i(31563),eH=e.i(722740),eQ=e.i(853340),eY=e.i(912793),eK=e.i(125509),eX=e.i(951138),eZ=e.i(432478),eJ=e.i(967052),e0=e.i(389959),e1=e.i(408891),e2=e.i(355901),e4=e.i(428353),e3=e.i(466472);let e5=["micro","small"],e7=()=>{let e=(0,eJ.useTrack)(),o=(0,Z.useRouter)(),{slug:u,projectName:h}=(0,i.useParams)(),m=(0,C.useDefaultProvider)(),{profile:g}=(0,eZ.useProfile)(),{data:p}=(0,es.useSelectedOrganizationQuery)(),x=(0,eI.usePHFlag)("projectCreationEnableRlsEventTrigger"),f=p?.plan?.id==="free",S=!f,[b]=(0,eu.useLocalStorageQuery)(r.LOCAL_STORAGE_KEYS.LAST_VISITED_ORGANIZATION,""),{can:_}=(0,ea.useAsyncCheckPermissions)(t.PermissionAction.CREATE,"projects"),y=(0,eY.useIsFeatureEnabled)("project_creation:show_advanced_config"),w=(0,n.useFlag)("enableSmartRegion"),P=(0,n.useFlag)("disableProjectCreationAndUpdate"),z=(0,n.useFlag)("showPostgresVersionSelector"),T=(0,n.useFlag)("enableFlyCloudProvider"),R="new-home"===(0,eI.usePHFlag)("homeNew"),A=!["team","enterprise","platform"].includes(p?.plan.id??"");"last-visited-org"===u&&(b?o.replace(`/new/${b}`,void 0,{shallow:!0}):o.replace("/new/_",void 0,{shallow:!0}));let[F,E]=(0,e0.useState)(void 0),[O,V]=(0,e0.useState)(!1),k=(0,e1.useForm)({resolver:(0,s.zodResolver)(ed),mode:"onChange",defaultValues:{organization:u,projectName:h||"",postgresVersion:"",cloudProvider:C.PROVIDERS[m].id,dbPass:"",dbPassStrength:0,dbPassStrengthMessage:"",dbRegion:void 0,instanceSize:S?L.sizes[0]:void 0,dataApi:!0,enableRlsEventTrigger:!1,postgresVersionSelection:"",useOrioleDb:!1}}),{instanceSize:B,cloudProvider:$,dbRegion:G,organization:M}=(0,ek.useWatch_Shadcn_)({control:k.control}),U=S?B??L.sizes[0]:void 0,{data:W=[]}=(0,eq.useFreeProjectLimitCheckQuery)({slug:u},{enabled:f}),H=W.length>0,Q=f&&H,{data:K=[],isSuccess:J}=(0,ee.useOrganizationsQuery)(),et=J&&K.length<=0,{data:er=[]}=(0,eW.useAuthorizedAppsQuery)({slug:u},{enabled:!f&&"_"!==u}),en=er.length>0,{data:eo=[]}=(0,eU.useOverdueInvoicesQuery)({enabled:A}),em=eo.filter(e=>e.organization_id===p?.id),eg=A&&em.length>0,{data:ep}=(0,eH.useOrgProjectsInfiniteQuery)({slug:p?.slug}),ef=(0,e0.useMemo)(()=>ep?.pages.flatMap(e=>e.projects),[ep?.pages]),eS=F?.filter(e=>e.status!==C.PROJECT_STATUS.INACTIVE)??[],eb=10*(0===eS.length),e_=f?0:I.instanceSizeSpecs[U].priceMonthly-eb,{data:ev,error:eN}=eC({cloudProvider:C.PROVIDERS[m].id},{enabled:!w,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchInterval:!1,refetchOnReconnect:!1,retry:!1}),{data:ew,error:eP}=eT({slug:u,cloudProvider:C.PROVIDERS[$].id,desiredInstanceSize:U},{enabled:w,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchInterval:!1,refetchOnReconnect:!1}),ez=w?ew?.recommendations.smartGroup.name:void 0,eR=w&&"AWS_NIMBUS"!==m?eP:eN,eA="AWS_NIMBUS"===m?ey.AWS_REGIONS.EAST_US.displayName:w?ew?.recommendations.smartGroup.name:ev,eF=_&&!Q&&!eg,eV=(0,ec.smartRegionToExactRegion)(G??""),eL=(0,eM.useAvailableOrioleImageVersion)({cloudProvider:$,dbRegion:w?eV:G??"",organizationSlug:M},{enabled:null!==p}),eD=g?.primary_email?.toLowerCase(),e$=!!eD&&W.some(e=>e.primary_email?.toLowerCase()===eD),eG=!!p&&!f&&!e$,{mutate:eX,isPending:e7,isSuccess:e8}=(0,eQ.useProjectCreateMutation)({onSuccess:a=>{e("project_creation_simple_version_submitted",{instanceSize:k.getValues("instanceSize"),enableRlsEventTrigger:k.getValues("enableRlsEventTrigger"),...("control"===x||"test"===x)&&{rlsOptionVariant:x},dataApiEnabled:k.getValues("dataApi"),useOrioleDb:k.getValues("useOrioleDb")},{project:a.ref,organization:a.organization_slug}),o.push(R?`/project/${a.ref}`:`/project/${a.ref}/building`)}}),e9=async a=>{let s=a.instanceSize&&!e5.includes(a.instanceSize);e_>0&&(en||s)?(e("project_creation_simple_version_confirm_modal_opened",{instanceSize:a.instanceSize}),V(!0)):await e6(a)},e6=async e=>{if(!p)return console.error("Unable to retrieve current organization");let{cloudProvider:a,projectName:s,dbPass:t,dbRegion:r,postgresVersion:n,instanceSize:i,dataApi:o,enableRlsEventTrigger:d,postgresVersionSelection:c,useOrioleDb:u}=e;if(u&&!eL)return e2.toast.error("No available OrioleDB image found, only Postgres is available");let{postgresEngine:h,releaseChannel:m}=(0,el.extractPostgresVersionDetails)(c),{smartGroup:g=[],specific:x=[]}=ew?.all??{},j=w?g.find(e=>e.name===r)??x.find(e=>e.name===r):void 0,S={dbPass:t,cloudProvider:a,organizationSlug:p.slug,name:s,dbPricingTierId:"tier_free",dbInstanceSize:f?void 0:i,dataApiExposedSchemas:o?void 0:[],dataApiUseApiSchema:!1,postgresEngine:u?eL?.postgres_engine:h,releaseChannel:u?eL?.release_channel:m,...w?{regionSelection:j}:{dbRegion:r},...d?{dbSql:l.AUTO_ENABLE_RLS_EVENT_TRIGGER_SQL}:{}};n&&(n.match(/1[2-9]\..*/)||e2.toast.error("Invalid Postgres version, should start with a number between 12-19, a dot and additional characters, i.e. 15.2 or 15.2.0-3"),S.customSupabaseRequest={ami:{search_tags:{"tag:postgresVersion":n}}}),eX(S)};(0,e0.useEffect)(()=>{ef&&ef.length>0&&!F&&E(ef)},[ef,F,E]),(0,e0.useEffect)(()=>{et&&o.push("/new")},[et,o]),(0,e0.useEffect)(()=>{u&&"_"!==u&&k.setValue("organization",u),h&&k.setValue("projectName",h||"")},[u]),(0,e0.useEffect)(()=>{void 0===k.getValues("dbRegion")&&eA&&k.setValue("dbRegion",eA)},[eA]),(0,e0.useEffect)(()=>{eR&&k.setValue("dbRegion",C.PROVIDERS[m].default_region.displayName)},[eR]),(0,e0.useEffect)(()=>{ez&&k.setValue("dbRegion",ez)},[ez]),(0,e0.useEffect)(()=>{B!==U&&k.setValue("instanceSize",U,{shouldDirty:!1,shouldValidate:!1,shouldTouch:!1})},[U,B,k]);let ae=!!p?.slug&&("control"===x||"test"===x);return(0,eK.useTrackExperimentExposure)("project_creation_rls_option",ae?x:void 0),(0,a.jsx)(e4.Form_Shadcn_,{...k,children:(0,a.jsxs)("form",{onSubmit:k.handleSubmit(e9),children:[(0,a.jsx)(d.default,{loading:!J,title:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"Create a new project"}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter text-balance",children:"Your project will have its own dedicated instance and full Postgres database. An API will be set up so you can easily interact with your new database."})]},"panel-title"),footer:(0,a.jsx)(ex,{form:k,canCreateProject:eF,instanceSize:U,organizationProjects:eS,isCreatingNewProject:e7,isSuccessNewProject:e8}),children:(0,a.jsx)(a.Fragment,{children:P?(0,a.jsx)(Y,{title:"Project creation is currently disabled"}):(0,a.jsxs)("div",{className:"divide-y divide-border-muted",children:[(0,a.jsx)(ei,{form:k}),eF&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej,{form:k}),T&&!1,S&&(0,a.jsx)(D,{form:k}),(0,a.jsx)(q,{form:k}),(0,a.jsx)(eE,{form:k,instanceSize:U}),z&&(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(j.FormField_Shadcn_,{control:k.control,name:"postgresVersionSelection",render:({field:e})=>(0,a.jsx)(el.PostgresVersionSelector,{field:e,form:k,cloudProvider:k.getValues("cloudProvider"),organizationSlug:u,dbRegion:k.getValues("dbRegion")})})}),!1,(0,a.jsx)(eB,{form:k}),y&&!!eL&&(0,a.jsx)(N,{form:k}),eG?(0,a.jsx)(v.Admonition,{className:"rounded-none border-0 border-t",type:"note",title:"Need a free project?",description:(0,a.jsxs)("p",{children:["You can have up to 2 free projects across all organizations."," ",(0,a.jsx)(eO.default,{className:"underline text-foreground",href:"/new",children:"Create a free organization"})," ","to use them."]})}):null]}),Q?_&&u&&(0,a.jsx)(X,{membersExceededLimit:W||[]}):eg?(0,a.jsx)(d.default.Content,{children:(0,a.jsx)(v.Admonition,{type:"default",title:"Your organization has overdue invoices",description:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-sm leading-normal",children:"Please resolve all outstanding invoices first before creating a new project"}),(0,a.jsx)("div",{children:(0,a.jsx)(eh.Button,{asChild:!0,type:"default",children:(0,a.jsx)(eO.default,{href:`/org/${u}/billing#invoices`,children:"View invoices"})})})]})})}):null]})})}),(0,a.jsx)(e3.default,{size:"large",loading:!1,visible:O,title:"Confirm compute costs",confirmLabel:"I understand",onCancel:()=>V(!1),onConfirm:async()=>{let e=k.getValues();await e6(e),V(!1)},variant:"warning",children:(0,a.jsx)("div",{className:"text-sm text-foreground-light space-y-1",children:(0,a.jsxs)("p",{children:['Launching a project on compute size "',(0,ec.instanceLabel)(U),'" increases your monthly costs by $',e_,', independent of how actively you use it. By clicking "I understand", you agree to the additional costs.'," ",(0,a.jsx)(eO.default,{href:`${c.DOCS_URL}/guides/platform/manage-your-usage/compute`,target:"_blank",className:"underline",children:"Compute Costs"})," ","are non-refundable."]})})})]})})},e8=(0,eX.withAuth)(({children:e})=>(0,a.jsx)(eG.WizardLayoutWithoutAuth,{children:e}));e7.getLayout=e=>(0,a.jsx)(e$.default,{headerTitle:"New project",children:(0,a.jsx)(e8,{children:e})}),e.s(["default",0,e7],155494)},845290,(e,a,s)=>{let t="/new/[slug]";(window.__NEXT_P=window.__NEXT_P||[]).push([t,()=>e.r(155494)]),a.hot&&a.hot.dispose(function(){window.__NEXT_P.push([t])})}]);

//# debugId=97cb4c06-a3ff-ac34-756a-3508c9e9f07e
//# sourceMappingURL=f2ceffb0cb72feb0.js.map