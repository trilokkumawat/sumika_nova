;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6a452be2-0fe1-cd2f-9d7f-65eddf08f59d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,864504,e=>{"use strict";var s=e.i(478902);e.i(128328);var a=e.i(657588),t=e.i(158639),i=e.i(710377),n=e.i(852315),r=e.i(376577),l=e.i(667042),o=e.i(479232),c=e.i(896975),d=e.i(210419),u=e.i(389959),p=e.i(535487),m=e.i(351299),h=e.i(264903),x=e.i(10429),g=e.i(837710),j=e.i(627069),f=e.i(72187);let y=[{id:"1",type:"primary",data:{label:"Primary Database",region:"East US (Ohio)",provider:"AWS",regionIcon:"us-east-1"},position:{x:825,y:0}},{id:"2",type:"replica",data:{label:"Iceberg",details:"3 tables",regionIcon:"us-west-1"},position:{x:875,y:110}},{id:"3",type:"replica",data:{label:"BigQuery",details:"5 tables",regionIcon:"us-west-1"},position:{x:875,y:200}},{id:"4",type:"blank",position:{x:875,y:290},data:{}},{id:"5",type:"cta",position:{x:125,y:20},data:{}}],b=[{id:"e1-2",source:"1",target:"2",type:"smoothstep",animated:!0},{id:"e1-3",source:"1",target:"3",type:"smoothstep",animated:!0},{id:"e1-4",source:"1",target:"4",type:"smoothstep",animated:!0}],S=()=>(0,s.jsx)(h.ReactFlowProvider,{children:(0,s.jsx)(_,{})}),_=()=>{let{ref:e="_"}=(0,t.useParams)(),a=(0,u.useMemo)(()=>y,[]),i=(0,u.useMemo)(()=>b,[]),{resolvedTheme:n}=(0,c.useTheme)(),r="dark"===n&&"_"!==e?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.4)",l=(0,u.useMemo)(()=>({primary:N,replica:v,blank:w,cta:()=>I({projectRef:e})}),[e]);return(0,s.jsx)("div",{className:"relative border-t h-full w-full",children:(0,s.jsx)(p.default,{fitView:!0,fitViewOptions:{minZoom:.9,maxZoom:.9},className:"instance-configuration",zoomOnPinch:!1,zoomOnScroll:!1,nodesDraggable:!0,nodesConnectable:!1,zoomOnDoubleClick:!1,edgesFocusable:!1,edgesUpdatable:!1,nodes:a,edges:i,nodeTypes:l,proOptions:{hideAttribution:!0},children:(0,s.jsx)(m.Background,{color:r})})})},N=({data:e})=>(0,s.jsxs)("div",{className:"flex flex-col rounded bg-surface-100 border border-default",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between p-3",style:{width:f.NODE_WIDTH/2+55},children:[(0,s.jsxs)("div",{className:"flex gap-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-brand-500 border border-brand-600 rounded-md flex items-center justify-center",children:(0,s.jsx)(l.Database,{size:16})}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,s.jsx)("p",{className:"text-sm",children:e.label}),(0,s.jsx)("p",{className:"flex items-center gap-x-1",children:(0,s.jsx)("span",{className:"text-sm text-foreground-light",children:e.region})}),(0,s.jsx)("p",{className:"flex items-center gap-x-1",children:(0,s.jsx)("span",{className:"text-sm text-foreground-light",children:e.provider})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("img",{alt:"region icon",className:"w-6 rounded-sm mt-0.5",src:`${x.BASE_PATH}/img/regions/${e.regionIcon}.svg`}),(0,s.jsx)(r.Circle,{size:10,className:"bg-brand-500 stroke-none rounded-full"})]})]}),(0,s.jsx)(h.Handle,{type:"source",position:h.Position.Left,className:"opacity-25"})]}),v=({data:e})=>(0,s.jsxs)("div",{className:"flex flex-col rounded bg-surface-100 border border-default px-2",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between p-3",style:{width:f.NODE_WIDTH/2-10},children:[(0,s.jsx)("div",{className:"flex gap-x-3",children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,s.jsx)("p",{children:e.label}),(0,s.jsx)("p",{className:"flex items-center gap-x-1",children:(0,s.jsx)("span",{className:"text-sm text-foreground-light",children:e.details})})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("img",{alt:"region icon",className:"w-6 rounded-sm mt-0.5",src:`${x.BASE_PATH}/img/regions/${e.regionIcon}.svg`}),(0,s.jsx)(r.Circle,{size:10,className:"bg-brand-500 stroke-none rounded-full"})]})]}),(0,s.jsx)(h.Handle,{type:"target",position:h.Position.Left,className:"opacity-25"})]}),w=()=>(0,s.jsx)("div",{className:"flex flex-col rounded bg-surface-100 border border-default px-1",children:(0,s.jsxs)("div",{className:"flex items-start justify-between p-3",style:{width:f.NODE_WIDTH/2},children:[(0,s.jsx)("div",{className:"flex gap-x-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(o.Plus,{size:16}),(0,s.jsx)("span",{className:"text-sm",children:"Add new"})]})}),(0,s.jsx)(h.Handle,{type:"target",position:h.Position.Left,className:"opacity-25"})]})}),I=({projectRef:e})=>(0,s.jsx)(j.Card,{className:"w-[570px] p-6",children:(0,s.jsxs)(j.CardContent,{children:[(0,s.jsx)("h2",{className:"text-lg mb-2",children:"Stream database changes to external destinations"}),(0,s.jsx)("p",{className:"text-foreground-light mb-2",children:"Automatically replicate your data to external data warehouses and analytics platforms in real-time. No manual exports, no lag."}),(0,s.jsxs)("p",{className:"text-foreground-light",children:["We are currently in ",(0,s.jsx)("span",{className:"text-foreground",children:"private alpha"})," and slowly onboarding new customers to ensure stable data pipelines. Request access below to join the waitlist. Read replicas are available now."]}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2 mt-6",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"secondary",iconRight:(0,s.jsx)(n.ArrowUpRight,{size:16,strokeWidth:1.5}),children:(0,s.jsx)(d.default,{href:"https://forms.supabase.com/pg_replicate",target:"_blank",rel:"noreferrer",children:"Request alpha access"})}),(0,s.jsx)(g.Button,{asChild:!0,type:"default",iconRight:(0,s.jsx)(i.ArrowRight,{size:16,strokeWidth:1.5}),children:(0,s.jsx)(d.default,{href:`/project/${e}/settings/infrastructure?createReplica=true`,children:"Create a read replica"})})]})]})});var R=e.i(356003),P=e.i(567558),E=e.i(513826),C=e.i(347617),A=e.i(237664),T=e.i(695734),k=e.i(646759),D=e.i(344409),F=e.i(280590),L=e.i(366652),B=e.i(975924),M=e.i(533488),z=e.i(492418),O=e.i(843778),Q=e.i(108151),q=e.i(746301),K=e.i(355901),U=e.i(253214),$=e.i(725137),H=e.i(333092),W=e.i(710483),V=e.i(794231);let G=()=>{let{ref:e}=(0,t.useParams)(),[a,i]=(0,u.useState)(!1),{mutate:n,isPending:r}=(0,H.useCreateTenantSourceMutation)({onSuccess:()=>{K.toast.success("Replication has been successfully enabled!"),i(!1)},onError:e=>{K.toast.error(`Failed to enable replication: ${e.message}`)}}),l=async()=>{if(!e)return console.error("Project ref is required");n({projectRef:e})};return(0,s.jsxs)(U.Dialog,{open:a,onOpenChange:i,children:[(0,s.jsx)(U.DialogTrigger,{asChild:!0,children:(0,s.jsx)(g.Button,{type:"primary",className:"w-min",children:"Enable replication"})}),(0,s.jsxs)(U.DialogContent,{children:[(0,s.jsx)(U.DialogHeader,{children:(0,s.jsx)(U.DialogTitle,{children:"Enable Replication"})}),(0,s.jsx)(U.DialogSectionSeparator,{}),(0,s.jsx)(U.DialogSection,{className:"flex flex-col gap-y-2 !p-0",children:(0,s.jsxs)(W.Admonition,{type:"warning",className:"rounded-none border-0",title:"Replication is currently in Alpha",children:[(0,s.jsx)("p",{className:"text-sm !leading-normal",children:"This feature is in active development and may change as we gather feedback. Availability and behavior can evolve while in Alpha."}),(0,s.jsx)("p",{className:"text-sm !leading-normal",children:"Pricing has not been finalized yet. You can enable replication now; we'll announce pricing later and notify you before any charges apply."})]})}),(0,s.jsxs)(U.DialogFooter,{children:[(0,s.jsx)(g.Button,{type:"default",disabled:r,onClick:()=>i(!1),children:"Cancel"}),(0,s.jsx)(g.Button,{type:"primary",loading:r,onClick:l,children:"Enable replication"})]})]})]})},Y=({type:e,className:a,hasAccess:t})=>(0,s.jsxs)("div",{className:(0,O.cn)("border rounded-md p-4 md:p-12 flex flex-col gap-y-4",a),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("h4",{children:"Replicate data to external destinations in real-time"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[t?"Enable replication":"Upgrade to the Pro plan"," to start replicating your database changes to ",e??"data warehouses and analytics platforms"]})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[t?(0,s.jsx)(G,{}):(0,s.jsx)(V.UpgradePlanButton,{source:"replication",featureProposition:"use replication"}),(0,s.jsx)(E.DocsButton,{href:`${x.DOCS_URL}/guides/database/replication#replication`})]})]});var X=e.i(273144),Z=e.i(128678),J=e.i(242882),ee=e.i(234745);async function es({projectRef:e,destinationId:s},a){if(!e)throw Error("projectRef is required");if(!s)throw Error("destinationId is required");let{data:t,error:i}=await (0,ee.get)("/platform/replication/{ref}/destinations/{destination_id}",{params:{path:{ref:e,destination_id:s}},signal:a});return i&&(0,ee.handleError)(i),t}let ea=({projectRef:e,destinationId:s},{enabled:a=!0,...t}={})=>(0,J.useQuery)({queryKey:A.replicationKeys.destinationById(e,s),queryFn:({signal:a})=>es({projectRef:e,destinationId:s},a),enabled:a&&void 0!==e&&null!=s,...t});var et=e.i(898202);let ei=({id:e})=>{let{ref:s}=(0,t.useParams)(),{data:a,isSuccess:i}=(0,D.useReplicationSourcesQuery)({projectRef:s}),n=a?.sources.find(e=>e.name===s)?.id,{data:r,error:l,isPending:o,isError:c,isSuccess:d}=ea({projectRef:s,destinationId:e}),u=r?"big_query"in r.config?"BigQuery":"iceberg"in r.config?"Analytics Bucket":void 0:void 0,{data:p,error:m,isPending:h,isError:x,isSuccess:g}=(0,k.useReplicationPipelinesQuery)({projectRef:s}),j=p?.pipelines.find(s=>s.destination_id===e),{data:f}=(0,et.useReplicationPipelineStatusQuery)({projectRef:s,pipelineId:j?.id}),y=(0,Z.getStatusName)(f?.status);return{sourceId:n,destination:r,pipeline:j,pipelineStatus:f,statusName:y,type:u,replicationNotEnabled:i&&!n,pipelineFetcher:{error:m,isPending:h,isError:x,isSuccess:g},destinationFetcher:{error:l,isPending:o,isError:c,isSuccess:d}}};var en=e.i(737051),er=e.i(532728),el=e.i(902858),eo=e.i(890265),ec=e.i(256771);let ed=({open:e,onOpenChange:a})=>{let t=eo.BUCKET_TYPES.analytics;return(0,s.jsx)($.Sheet,{open:e,onOpenChange:a,children:(0,s.jsxs)($.SheetContent,{"aria-describedby":void 0,className:"flex flex-col gap-y-0",children:[(0,s.jsx)($.SheetHeader,{children:(0,s.jsxs)($.SheetTitle,{children:["Create ",t.singularName," bucket"]})}),(0,s.jsx)(ec.CreateAnalyticsBucketForm,{type:"sheet",onOpenChange:a})]})})};var eu=e.i(108892),ep=e.i(377451),em=e.i(711852),eh=e.i(474094),ex=e.i(595945),eg=e.i(101680),ej=e.i(678097),ef=e.i(38429);async function ey({destinationId:e,pipelineId:s,projectRef:a,destinationName:t,destinationConfig:i,pipelineConfig:{publicationName:n,batch:r,maxTableSyncWorkers:l},sourceId:o},c){let d;if(!a)throw Error("projectRef is required");if("bigQuery"in i){let{projectId:e,datasetId:s,serviceAccountKey:a,maxStalenessMins:t}=i.bigQuery;d={big_query:{project_id:e,dataset_id:s,service_account_key:a,...null!==t?{max_staleness_mins:t}:{}}}}else if("iceberg"in i){let{projectRef:e,warehouseName:s,namespace:a,catalogToken:t,s3AccessKeyId:n,s3SecretAccessKey:r,s3Region:l}=i.iceberg;d={iceberg:{supabase:{project_ref:e,warehouse_name:s,namespace:a,catalog_token:t,s3_access_key_id:n,s3_secret_access_key:r,s3_region:l}}}}else throw Error("Invalid destination config: must specify either bigQuery or iceberg");let{data:u,error:p}=await (0,ee.post)("/platform/replication/{ref}/destinations-pipelines/{destination_id}/{pipeline_id}",{params:{path:{ref:a,destination_id:e,pipeline_id:s}},body:{destination_config:d,source_id:o,destination_name:t,pipeline_config:{publication_name:n,...void 0!==l?{max_table_sync_workers:l}:{},...r?{batch:{...void 0!==r.maxFillMs?{max_fill_ms:r.maxFillMs}:{},...void 0!==r.maxSize?{max_size:r.maxSize}:{}}}:{}}},signal:c});return p&&(0,ee.handleError)(p),u}async function eb({projectRef:e,destinationConfig:s},a){let t;if(!e)throw Error("projectRef is required");if("bigQuery"in s){let{projectId:e,datasetId:a,serviceAccountKey:i,maxStalenessMins:n}=s.bigQuery;t={big_query:{project_id:e,dataset_id:a,service_account_key:i,...void 0!==n?{max_staleness_mins:n}:{}}}}else if("iceberg"in s){let{projectRef:e,namespace:a,warehouseName:i,catalogToken:n,s3AccessKeyId:r,s3SecretAccessKey:l,s3Region:o}=s.iceberg;t={iceberg:{supabase:{namespace:a,project_ref:e,warehouse_name:i,catalog_token:n,s3_access_key_id:r,s3_secret_access_key:l,s3_region:o}}}}else throw Error("Invalid destination config: must specify either bigQuery or iceberg");let{data:i,error:n}=await (0,ee.post)("/platform/replication/{ref}/destinations/validate",{params:{path:{ref:e}},body:{config:t},signal:a});return n&&(0,ee.handleError)(n),i}async function eS({projectRef:e,sourceId:s,publicationName:a,maxFillMs:t,maxSize:i,maxTableSyncWorkers:n},r){if(!e)throw Error("projectRef is required");if(!s)throw Error("sourceId is required");let{data:l,error:o}=await (0,ee.post)("/platform/replication/{ref}/pipelines/validate",{params:{path:{ref:e}},body:{source_id:s,config:{publication_name:a,max_table_sync_workers:n,batch:void 0!==t||void 0!==i?{max_fill_ms:t,max_size:i}:void 0}},signal:r});return o&&(0,ee.handleError)(o),l}var e_=e.i(249632),eN=e.i(895604),ev=e.i(809323),ew=e.i(265100),eI=e.i(2579),eR=e.i(621018),eP=e.i(774803),eE=e.i(408891),eC=e.i(421126),eA=e.i(428353),eT=e.i(249909),ek=e.i(350341),eD=e.i(31227),eF=e.i(154225),eL=e.i(66212),eB=e.i(587433),eM=e.i(24315),ez=e.i(61863),eO=e.i(378277),eQ=e.i(372378),eq=e.i(538482);let eK=({type:e,form:a})=>{let t=e=>s=>{let a=s.target.value;e.onChange(""===a?void 0:Number(a))};return(0,s.jsx)("div",{className:"px-5",children:(0,s.jsx)(ek.Accordion_Shadcn_,{type:"single",collapsible:!0,children:(0,s.jsxs)(eF.AccordionItem_Shadcn_,{value:"item-1",className:"border-none",children:[(0,s.jsx)(eL.AccordionTrigger_Shadcn_,{className:"font-normal gap-2 justify-between text-sm py-3 hover:no-underline",children:(0,s.jsxs)("div",{className:"flex flex-col items-start gap-0.5",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Advanced settings"}),(0,s.jsx)("span",{className:"text-sm text-foreground-lighter font-normal",children:"Optional performance tuning"})]})}),(0,s.jsxs)(eD.AccordionContent_Shadcn_,{className:"!pb-0 pt-3 [&>div]:flex [&>div]:flex-col [&>div]:gap-y-4",children:[(0,s.jsx)(ez.FormField_Shadcn_,{control:a.control,name:"maxFillMs",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{layout:"horizontal",label:"Batch wait time",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Time to wait for additional changes before sending."}),(0,s.jsx)("p",{children:"Shorter times imply faster updates, but higher overhead."})]}),children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eQ.PrePostTab,{postTab:"milliseconds",children:(0,s.jsx)(eO.Input_Shadcn_,{...e,type:"number",value:e.value??"",onChange:t(e),placeholder:"Default: 10000"})})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:a.control,name:"maxSize",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Batch size",layout:"horizontal",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Number of rows to send in a batch."}),(0,s.jsx)("p",{children:"Larger batches use more memory, with the risk of running out of memory."})]}),children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eQ.PrePostTab,{postTab:"rows",children:(0,s.jsx)(eO.Input_Shadcn_,{...e,type:"number",value:e.value??"",onChange:t(e),placeholder:"Default: 100000"})})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:a.control,name:"maxTableSyncWorkers",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Table sync workers",layout:"horizontal",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Number of tables to copy in parallel during the initial sync."}),(0,s.jsx)("p",{children:"Uses one replication slot per worker (N + 1 total when fully active)."})]}),children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eQ.PrePostTab,{postTab:"workers",children:(0,s.jsx)(eO.Input_Shadcn_,{...e,type:"number",value:e.value??"",onChange:t(e),placeholder:"Default: 4"})})})})}),"BigQuery"===e&&(0,s.jsx)(ez.FormField_Shadcn_,{control:a.control,name:"maxStalenessMins",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)("span",{children:"Maximum staleness"}),(0,s.jsx)(eB.Badge,{className:"w-min",children:"BigQuery only"})]}),layout:"horizontal",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Maximum age of cached data before BigQuery reads from base tables at query time."}),(0,s.jsx)("p",{children:"Lower values return fresher results, but may increase query costs."})]}),children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eQ.PrePostTab,{postTab:"minutes",children:(0,s.jsx)(eO.Input_Shadcn_,{...e,type:"number",value:e.value??"",onChange:t(e),placeholder:"Default: None (No staleness limit)"})})})})})]})]})})})},eU="create-new",e$="create-new-namespace";var eH=e.i(531837);let eW=eH.object({name:eH.string().min(1,"Name is required"),publicationName:eH.string().min(1,"Publication is required"),maxFillMs:eH.number().min(1,"Max Fill milliseconds should be greater than 0").int().optional(),maxSize:eH.number().min(1,"Max batch size should be greater than 0").int().optional(),maxTableSyncWorkers:eH.number().min(1,"Max table sync workers should be greater than 0").int().optional(),projectId:eH.string().optional(),datasetId:eH.string().optional(),serviceAccountKey:eH.string().optional(),maxStalenessMins:eH.number().nonnegative().optional(),warehouseName:eH.string().optional(),namespace:eH.string().optional(),newNamespaceName:eH.string().optional(),catalogToken:eH.string().optional(),s3AccessKeyId:eH.string().optional(),s3SecretAccessKey:eH.string().optional(),s3Region:eH.string().optional()}),eV=({form:e})=>(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"name",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Name",layout:"horizontal",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eO.Input_Shadcn_,{...e,placeholder:"My destination"})})})});var eG=e.i(543851),eY=e.i(890054),eX=e.i(937942),eZ=e.i(237311),eJ=e.i(545763),e0=e.i(750912),e1=e.i(449123),e2=e.i(451031),e5=e.i(57492),e3=e.i(831927),e4=e.i(843142),e8=e.i(156722),e7=e.i(398876),e9=e.i(877555);let e6=({form:e})=>(0,s.jsxs)("div",{className:"flex flex-col gap-y-6 p-5",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground",children:"BigQuery settings"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"projectId",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{layout:"horizontal",label:"Project ID",description:"The Google Cloud project ID where data will be sent",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eO.Input_Shadcn_,{...e,placeholder:"my-gcp-project"})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"datasetId",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Dataset ID",layout:"horizontal",description:"The BigQuery dataset where replicated tables will be created",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eO.Input_Shadcn_,{...e,placeholder:"my_dataset"})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"serviceAccountKey",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{layout:"horizontal",label:"Service Account Key",description:"Service account credentials JSON for authenticating with BigQuery",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(e7.TextArea_Shadcn_,{...e,rows:5,maxLength:5e3,placeholder:'{"type": "service_account", "project_id": "...", ...}',className:"font-mono text-xs"})})})})]})]}),se=({form:e,setIsFormInteracting:a,onSelectNewBucket:i})=>{let{warehouseName:n,s3AccessKeyId:r,namespace:l}=e.watch(),[o,c]=(0,u.useState)(!1),[d,p]=(0,u.useState)(!1),{ref:m}=(0,t.useParams)(),{can:h}=(0,eI.useAsyncCheckPermissions)(el.PermissionAction.SECRETS_READ,"*"),{data:x}=(0,eu.useAPIKeysQuery)({projectRef:m,reveal:!0},{enabled:h}),{serviceKey:j}=(0,eu.getKeys)(x),f=j?.api_key??"",{data:y,isSuccess:b,isPending:S,isError:_}=(0,e0.useStorageCredentialsQuery)({projectRef:m}),N=y?.data??[],v=(r??"").length>0&&r!==eU&&!N.find(e=>e.access_key===r),{data:w=[],isPending:I,isError:R}=(0,eZ.useAnalyticsBucketsQuery)({projectRef:m}),P=!!n&&!!f,{data:E=[],isPending:C,isError:A}=(0,eJ.useIcebergNamespacesQuery)({projectRef:m,warehouse:n},{enabled:!!f});return(0,s.jsxs)("div",{className:"flex flex-col gap-y-6 p-5",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Analytics Bucket settings"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"warehouseName",render:({field:t})=>(0,s.jsx)(eq.FormItemLayout,{label:"Bucket",layout:"horizontal",description:"The Analytics Bucket where data will be stored",children:I?(0,s.jsx)(g.Button,{disabled:!0,type:"default",className:"w-full justify-between",size:"small",iconRight:(0,s.jsx)(eP.Loader2,{className:"animate-spin"}),children:"Retrieving buckets"}):R?(0,s.jsx)(g.Button,{disabled:!0,type:"default",className:"w-full justify-start",size:"small",icon:(0,s.jsx)(e9.WarningIcon,{}),children:"Failed to retrieve buckets"}):(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsxs)(e1.Select_Shadcn_,{value:t.value,onValueChange:s=>{"new-bucket"===s?i():(a(!0),t.onChange(s),e.setValue("namespace",""))},children:[(0,s.jsx)(e8.SelectTrigger_Shadcn_,{children:t.value||"Select a bucket"}),(0,s.jsx)(e2.SelectContent_Shadcn_,{children:(0,s.jsxs)(e5.SelectGroup_Shadcn_,{children:[0===w.length?(0,s.jsx)(e3.SelectItem_Shadcn_,{value:"__no_buckets__",disabled:!0,children:"No buckets available"}):w.map(e=>(0,s.jsx)(e3.SelectItem_Shadcn_,{value:e.name,children:e.name},e.name)),(0,s.jsx)(e4.SelectSeparator_Shadcn_,{}),(0,s.jsx)(e3.SelectItem_Shadcn_,{value:"new-bucket",children:"Create a new bucket"})]})})]})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"namespace",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Namespace",layout:"horizontal",description:"The namespace within the bucket where tables will be organized",children:C&&P?(0,s.jsx)(g.Button,{disabled:!0,type:"default",className:"w-full justify-between",size:"small",iconRight:(0,s.jsx)(eP.Loader2,{className:"animate-spin"}),children:"Retrieving namespaces"}):A?(0,s.jsx)(g.Button,{disabled:!0,type:"default",className:"w-full justify-start",size:"small",icon:(0,s.jsx)(e9.WarningIcon,{}),children:"Failed to retrieve namespaces"}):(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsxs)(e1.Select_Shadcn_,{value:e.value,onValueChange:s=>{a(!0),e.onChange(s)},disabled:!P,children:[(0,s.jsx)(e8.SelectTrigger_Shadcn_,{children:P?e.value===e$?"Create a new namespace":e.value||"Select a namespace":"Select a warehouse first"}),(0,s.jsx)(e2.SelectContent_Shadcn_,{children:(0,s.jsxs)(e5.SelectGroup_Shadcn_,{children:[0===E.length?(0,s.jsx)(e3.SelectItem_Shadcn_,{value:"__no_namespaces__",disabled:!0,children:"No namespaces available"}):E.map(e=>(0,s.jsx)(e3.SelectItem_Shadcn_,{value:e,children:e},e)),(0,s.jsx)(e4.SelectSeparator_Shadcn_,{}),(0,s.jsx)(e3.SelectItem_Shadcn_,{value:e$,children:"Create a new namespace"},e$)]})})]})})})}),l===e$&&(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"newNamespaceName",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"New Namespace Name",layout:"horizontal",description:"A unique name for the new namespace",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eO.Input_Shadcn_,{...e,placeholder:"new_namespace",value:e.value||""})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"catalogToken",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{layout:"horizontal",label:"Catalog Token",description:(0,s.jsxs)(s.Fragment,{children:["Automatically retrieved from your project's"," ",(0,s.jsx)(eX.InlineLink,{href:`/project/${m}/settings/api-keys`,children:"service role key"})]}),children:(0,s.jsx)(q.Input,{disabled:!0,value:e.value,type:o?"text":"password",placeholder:"Auto-populated",actions:f?(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)(g.Button,{type:"default",className:"w-7",icon:o?(0,s.jsx)(eG.Eye,{}):(0,s.jsx)(eY.EyeOff,{}),onClick:()=>c(!o)})}):null})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"s3AccessKeyId",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{layout:"horizontal",label:"S3 Access Key ID",description:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsxs)("p",{children:["Access keys are managed in your Storage"," ",(0,s.jsx)(eX.InlineLink,{href:`/project/${m}/storage/s3`,children:"S3 settings"})]}),b&&v&&(0,s.jsx)(W.Admonition,{type:"warning",title:"Unable to find access key ID in project",children:(0,s.jsxs)("p",{className:"!leading-normal",children:["Please select another key or create a new set, as this destination will not work otherwise. S3 access keys can be managed in your"," ",(0,s.jsx)(eX.InlineLink,{href:`/project/${m}/storage/files/settings`,children:"storage settings"})]})}),r===eU&&(0,s.jsx)(W.Admonition,{type:"default",title:"A new set of S3 access keys will be created"})]}),children:S?(0,s.jsx)(g.Button,{disabled:!0,type:"default",className:"w-full justify-between",size:"small",iconRight:(0,s.jsx)(eP.Loader2,{className:"animate-spin"}),children:"Retrieving keys"}):_?(0,s.jsx)(g.Button,{disabled:!0,type:"default",className:"w-full justify-start",size:"small",icon:(0,s.jsx)(e9.WarningIcon,{}),children:"Failed to retrieve keys"}):(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsxs)(e1.Select_Shadcn_,{value:e.value,onValueChange:e.onChange,children:[(0,s.jsx)(e8.SelectTrigger_Shadcn_,{children:e.value===eU?"Create a new key":0===(e.value??"").length?"Select an access key ID":e.value}),(0,s.jsx)(e2.SelectContent_Shadcn_,{children:(0,s.jsxs)(e5.SelectGroup_Shadcn_,{children:[N.map(e=>(0,s.jsxs)(e3.SelectItem_Shadcn_,{value:e.access_key,children:[e.access_key,(0,s.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.id)),(0,s.jsx)(e4.SelectSeparator_Shadcn_,{}),(0,s.jsx)(e3.SelectItem_Shadcn_,{value:eU,children:"Create a new key"},eU)]})})]})})})}),r!==eU&&(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"s3SecretAccessKey",render:({field:e})=>(0,s.jsxs)(eq.FormItemLayout,{layout:"horizontal",label:"S3 Secret Access Key",className:"relative",description:"The secret key corresponding to your selected access key ID",children:[(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eO.Input_Shadcn_,{...e,type:d?"text":"password",value:e.value??"",placeholder:"Provide the secret access key"})}),(0,s.jsx)(g.Button,{type:"default",icon:d?(0,s.jsx)(eG.Eye,{}):(0,s.jsx)(eY.EyeOff,{}),className:"w-7 absolute right-6 top-[4px]",onClick:()=>p(!d)})]})})]})]})};var ss=e.i(97429),sa=e.i(117467),st=e.i(668638),si=e.i(884860);let sn=({visible:e,sourceId:a,onClose:i})=>{let{ref:n}=(0,t.useParams)(),{mutateAsync:r,isPending:l}=(0,sa.useCreatePublicationMutation)(),{data:o}=(0,st.useReplicationTablesQuery)({projectRef:n,sourceId:a}),c="publication-editor",d=ss.z.object({name:ss.z.string().min(1,"Name is required"),tables:ss.z.array(ss.z.string()).min(1,"At least one table is required")}),u={name:"",tables:[]},p=(0,eE.useForm)({mode:"onBlur",reValidateMode:"onBlur",resolver:(0,er.zodResolver)(d),defaultValues:u}),m=async e=>{if(!n)return console.error("Project ref is required");if(!a)return console.error("Source id is required");try{await r({projectRef:n,sourceId:a,name:e.name,tables:e.tables.map(e=>{let[s,a]=e.split(".");return{schema:s,name:a}})}),K.toast.success("Successfully created publication"),i()}catch(e){K.toast.error("Failed to create publication")}p.reset(u)};return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)($.Sheet,{open:e,onOpenChange:i,children:(0,s.jsx)($.SheetContent,{size:"default",children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)($.SheetHeader,{children:[(0,s.jsx)($.SheetTitle,{children:"Create a new Publication"}),(0,s.jsx)($.SheetDescription,{children:"Replicate table changes to destinations"})]}),(0,s.jsx)($.SheetSection,{className:"flex-grow overflow-auto",children:(0,s.jsx)(eA.Form_Shadcn_,{...p,children:(0,s.jsxs)("form",{id:c,onSubmit:p.handleSubmit(m),className:"flex flex-col gap-y-4",children:[(0,s.jsx)(ez.FormField_Shadcn_,{control:p.control,name:"name",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Name",layout:"vertical",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(eO.Input_Shadcn_,{...e,placeholder:"Name"})})})}),(0,s.jsx)(ez.FormField_Shadcn_,{control:p.control,name:"tables",render:({field:e})=>(0,s.jsx)(eq.FormItemLayout,{label:"Tables",description:"Which tables to replicate to destinations",children:(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsxs)(si.MultiSelector,{values:e.value,onValuesChange:e.onChange,disabled:l,children:[(0,s.jsx)(si.MultiSelector.Trigger,{badgeLimit:"wrap",label:"Select tables...",mode:"inline-combobox"}),(0,s.jsx)(si.MultiSelector.Content,{children:(0,s.jsx)(si.MultiSelector.List,{children:o?.map(e=>(0,s.jsx)(si.MultiSelector.Item,{value:`${e.schema}.${e.name}`,children:`${e.schema}.${e.name}`},`${e.schema}.${e.name}`))})})]})})})})]})})}),(0,s.jsxs)($.SheetFooter,{children:[(0,s.jsx)(g.Button,{type:"default",disabled:l,onClick:i,children:"Cancel"}),(0,s.jsx)(g.Button,{type:"primary",disabled:l,form:c,htmlType:"submit",children:"Create publication"})]})]})})})})};var sr=e.i(354354);let sl=()=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full px-8 py-16 text-center",children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-14 h-14 rounded-full bg-surface-300 mb-5",children:(0,s.jsx)(sr.DatabaseZap,{size:26,className:"text-foreground-light",strokeWidth:1.5})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No destinations available"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light max-w-lg",children:"Replication destinations are not currently enabled for this project. Contact support to enable real-time replication to external platforms."})]});var so=e.i(370410),sc=e.i(365257),sd=e.i(866205),su=e.i(703526),sp=e.i(917007),sm=e.i(920432),sh=e.i(549815),sx=e.i(911509),sg=e.i(996960),sj=e.i(689805),sf=e.i(793912),sy=e.i(135144),sb=e.i(396831);let sS=({publications:e,isLoadingPublications:a,onNewPublicationClick:t,field:i})=>{let[n,r]=(0,u.useState)(!1),[l,c]=(0,u.useState)(i?.value||""),[d,p]=(0,u.useState)("");function m(e){c(e),r(!1),i.onChange(e)}return(0,u.useEffect)(()=>{c(i?.value||"")},[i?.value]),(0,s.jsxs)(sj.Popover_Shadcn_,{modal:!1,open:n,onOpenChange:e=>{r(e),!e&&i?.onBlur&&i.onBlur()},children:[(0,s.jsx)(sy.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,s.jsx)(g.Button,{type:"default",size:"medium",className:(0,O.cn)("w-full [&>span]:w-full text-left",!l&&"text-foreground-muted"),iconRight:(0,s.jsx)(sc.ChevronsUpDown,{className:"text-foreground-muted",strokeWidth:2,size:14}),name:i.name,onBlur:i.onBlur,children:l||"Select publication"})}),(0,s.jsx)(sf.PopoverContent_Shadcn_,{sameWidthAsTrigger:!0,className:"p-0",align:"start",children:(0,s.jsxs)(sd.Command_Shadcn_,{children:[(0,s.jsx)(sm.CommandInput_Shadcn_,{placeholder:"Find publication...",className:"text-xs",value:d,onValueChange:p}),(0,s.jsx)("div",{className:"px-2 pt-2 pb-1",children:(0,s.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Publications with no tables are hidden"})}),(0,s.jsxs)(sx.CommandList_Shadcn_,{children:[(0,s.jsx)(su.CommandEmpty_Shadcn_,{children:a?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-center justify-center",children:[(0,s.jsx)(eP.Loader2,{size:12,className:"animate-spin"}),"Loading..."]}):"No publications found"}),(0,s.jsxs)(sp.CommandGroup_Shadcn_,{children:[0===e.length&&(0,s.jsx)("p",{className:"text-foreground-lighter text-xs py-3 px-2",children:"No publications available"}),(0,s.jsx)(sb.ScrollArea,{className:e.length>7?"h-[210px]":"",children:e.map(e=>(0,s.jsxs)(sh.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{m(e.name)},onClick:()=>{m(e.name)},children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(eB.Badge,{variant:"default",className:"rounded-full px-2 py-0.5 text-[10px] font-normal border border-border bg-surface-100",children:[e.tables.length," ",1===e.tables.length?"table":"tables"]}),l===e.name&&(0,s.jsx)(so.Check,{className:"text-brand",strokeWidth:2,size:13})]})]},e.name))})]}),(0,s.jsx)(sg.CommandSeparator_Shadcn_,{}),(0,s.jsx)(sp.CommandGroup_Shadcn_,{children:(0,s.jsxs)(sh.CommandItem_Shadcn_,{className:"cursor-pointer w-full",onSelect:t,onClick:t,children:[(0,s.jsx)(o.Plus,{size:14,strokeWidth:1.5,className:"mr-2"}),(0,s.jsx)("p",{children:"New publication"})]})})]})]})})]})},s_=({form:e,sourceId:a,visible:i,onSelectNewPublication:n})=>{let{ref:r}=(0,t.useParams)(),{publicationName:l}=e.watch(),{data:o=[],isPending:c,isSuccess:d}=(0,ex.useReplicationPublicationsQuery)({projectRef:r,sourceId:a}),p=(0,u.useMemo)(()=>o?.map(e=>e.name)??[],[o]),m=d&&!!l&&!p.includes(l);return(0,s.jsx)(ez.FormField_Shadcn_,{control:e.control,name:"publicationName",render:({field:e})=>(0,s.jsxs)(eq.FormItemLayout,{layout:"horizontal",label:"Publication",description:"Tables in the selected publication will be replicated to this destination",children:[(0,s.jsx)(eM.FormControl_Shadcn_,{children:(0,s.jsx)(sS,{publications:o,isLoadingPublications:c,field:e,onNewPublicationClick:()=>n()})}),m&&(0,s.jsx)(W.Admonition,{type:"warning",className:"mt-2",children:(0,s.jsxs)("p",{className:"!leading-normal",children:["The publication ",(0,s.jsx)("strong",{className:"text-foreground",children:l})," was not found, it may have been renamed or deleted, please select another one."]})})]})})},sN=({open:e,isLoading:a,onOpenChange:t,onConfirm:i})=>(0,s.jsx)(U.Dialog,{open:e,onOpenChange:t,children:(0,s.jsxs)(U.DialogContent,{className:"sm:max-w-lg",children:[(0,s.jsx)(U.DialogHeader,{children:(0,s.jsx)(U.DialogTitle,{children:"Replication limitations"})}),(0,s.jsx)(U.DialogSectionSeparator,{}),(0,s.jsxs)(U.DialogSection,{className:"space-y-4 text-sm",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Creating this replication pipeline will immediately start syncing data from your publication into the destination. Make sure you understand the limitations of the system before proceeding."}),(0,s.jsx)("div",{className:"text-foreground-light",children:(0,s.jsxs)("ul",{className:"list-disc flex flex-col gap-y-1.5 pl-5 text-sm leading-snug",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{className:"text-foreground",children:"Custom data types replicate as strings."})," ","Check that the destination can interpret those string values correctly."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{className:"text-foreground",children:"Generated columns are skipped."})," Replace them with triggers or materialized views if you need the derived values downstream."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{className:"text-foreground",children:"FULL replica identity is strongly recommended."})," ","With FULL replica identity deletes and updates include the payload that is needed to correctly apply those changes."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{className:"text-foreground",children:"Schema changes arenâ€™t supported yet."})," ","Plan for manual adjustments if you need to alter replicated tables."]})]})})]}),(0,s.jsx)(U.DialogSectionSeparator,{}),(0,s.jsxs)(U.DialogFooter,{children:[(0,s.jsx)(g.Button,{type:"default",disabled:a,onClick:()=>t(!1),children:"Cancel"}),(0,s.jsx)(g.Button,{loading:a,onClick:i,children:"Understood, start replication"})]})]})}),sv=({destinationFailures:e,pipelineFailures:a})=>{let t=[...e,...a].sort((e,s)=>"critical"===e.failure_type?-1:1),i=t.filter(e=>"critical"===e.failure_type),n=t.filter(e=>"warning"===e.failure_type),r=i.length>0,l=n.length>0;return 0===t.length?null:(0,s.jsxs)(W.Admonition,{type:r?"warning":"default",className:"px-5 rounded-none border-0",title:"Destination configuration issues",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light !mb-2",children:r?`Please fix all required issues below${l?" and review the others":""} before continuing.`:"The following issues were identified, although you may still proceed to create the destination."}),(0,s.jsx)(j.Card,{children:(0,s.jsx)(ek.Accordion_Shadcn_,{type:"multiple",children:t.map((e,a)=>(0,s.jsxs)(eF.AccordionItem_Shadcn_,{value:`${e.name}+${a}`,className:"last:border-b-0",children:[(0,s.jsx)(eL.AccordionTrigger_Shadcn_,{className:"text-sm px-3 text-foreground decoration-foreground-lighter",children:(0,s.jsxs)("p",{className:"flex items-center gap-x-2",children:[e.name,"critical"===e.failure_type&&(0,s.jsx)(eB.Badge,{variant:"warning",children:"Required"})]})}),(0,s.jsx)(eD.AccordionContent_Shadcn_,{className:"px-3",children:(0,s.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:e.reason.replaceAll("\n\n","\n")})})]},a))})})]})},sw="destination-editor",sI=({selectedType:e,visible:i,existingDestination:n,onClose:r})=>{let{ref:l}=(0,t.useParams)(),{setRequestStatus:o}=(0,eC.usePipelineRequestStatus)(),c=(0,a.useFlag)("etlEnableBigQuery"),d=(0,a.useFlag)("etlEnableIceberg"),{can:p}=(0,eI.useAsyncCheckPermissions)(el.PermissionAction.SECRETS_READ,"*"),[m,h]=(0,u.useState)(!1),[x,j]=(0,u.useState)(!1),[f,y]=(0,u.useState)(!1),[b,S]=(0,u.useState)(!1),[_,N]=(0,u.useState)(null),[v,w]=(0,u.useState)(!1),[I,P]=(0,u.useState)([]),[E,C]=(0,u.useState)([]),T=(0,u.useRef)(null),k=!!n,F=0===(0,u.useMemo)(()=>{let e=[];return c&&e.push({value:"BigQuery",label:"BigQuery"}),d&&e.push({value:"Analytics Bucket",label:"Analytics Bucket"}),e},[c,d]).length,{data:L}=(0,D.useReplicationSourcesQuery)({projectRef:l}),B=L?.sources.find(e=>e.name===l)?.id,{data:M=[],isSuccess:z,refetch:O}=(0,ex.useReplicationPublicationsQuery)({projectRef:l,sourceId:B}),{data:Q}=ea({projectRef:l,destinationId:n?.destinationId}),{data:q}=(0,eh.useReplicationPipelineByIdQuery)({projectRef:l,pipelineId:n?.pipelineId}),{data:H}=(0,eu.useAPIKeysQuery)({projectRef:l,reveal:!0},{enabled:p}),{serviceKey:W}=(0,eu.getKeys)(H),V=W?.api_key??"",{data:G}=(0,ep.useProjectSettingsV2Query)({projectRef:l}),{mutateAsync:Y,isPending:X}=(0,em.useCreateDestinationPipelineMutation)({onSuccess:()=>ez.reset(eM)}),{mutateAsync:Z,isPending:J}=(({onSuccess:e,onError:s,...a}={})=>{let t=(0,R.useQueryClient)();return(0,ef.useMutation)({mutationFn:e=>ey(e),async onSuccess(s,a,i){let{projectRef:n,destinationId:r,pipelineId:l}=a;await Promise.all([t.invalidateQueries({queryKey:A.replicationKeys.destinations(n)}),t.invalidateQueries({queryKey:A.replicationKeys.pipelines(n)}),t.invalidateQueries({queryKey:A.replicationKeys.destinationById(n,r)}),t.invalidateQueries({queryKey:A.replicationKeys.pipelineById(n,l)})]),await e?.(s,a,i)},async onError(e,a,t){void 0===s?K.toast.error(`Failed to update destination or pipeline: ${e.message}`):s(e,a,t)},...a})})({onSuccess:()=>ez.reset(eM)}),{mutateAsync:ee,isPending:es}=(0,ej.useStartPipelineMutation)(),{restartPipeline:et}=(0,eg.useRestartPipelineHelper)(),{mutateAsync:ei,isPending:en}=(0,eN.useS3AccessKeyCreateMutation)(),{mutateAsync:eo,isPending:ec}=(0,e_.useIcebergNamespaceCreateMutation)(),{mutateAsync:ek,isPending:eD}=(0,ef.useMutation)({mutationFn:e=>eb(e),...void 0}),{mutateAsync:eF,isPending:eL}=(0,ef.useMutation)({mutationFn:e=>eS(e),...void 0}),eB=eD||eL,eM=(0,u.useMemo)(()=>{let e=Q?.config,s=e&&"big_query"in e,a=e&&"iceberg"in e;return{name:Q?.name??"",publicationName:q?.config.publication_name??"",maxFillMs:q?.config?.batch?.max_fill_ms??void 0,maxSize:q?.config?.batch?.max_size??void 0,maxTableSyncWorkers:q?.config?.max_table_sync_workers??void 0,projectId:s?e.big_query.project_id:"",datasetId:s?e.big_query.dataset_id:"",serviceAccountKey:s?e.big_query.service_account_key:"",maxStalenessMins:s?e.big_query.max_staleness_mins:void 0,warehouseName:a?e.iceberg.supabase.warehouse_name:"",namespace:a?e.iceberg.supabase.namespace:"",newNamespaceName:"",catalogToken:a?e.iceberg.supabase.catalog_token:V,s3AccessKeyId:a?e.iceberg.supabase.s3_access_key_id:"",s3SecretAccessKey:a?e.iceberg.supabase.s3_secret_access_key:"",s3Region:G?.region??(a?e.iceberg.supabase.s3_region:"")}},[Q,q,V,G]),ez=(0,eE.useForm)({mode:"onChange",reValidateMode:"onChange",resolver:(0,er.zodResolver)(eW.superRefine((s,a)=>{let t=(e,s)=>{a.addIssue({code:eT.ZodIssueCode.custom,message:s,path:[e]})};if("BigQuery"===e)s.projectId?.length||t("projectId","Project ID is required"),s.datasetId?.length||t("datasetId","Dataset ID is required"),s.serviceAccountKey?.length||t("serviceAccountKey","Service Account Key is required");else if("Analytics Bucket"===e){if(s.warehouseName?.length||t("warehouseName","Bucket is required"),!(s.namespace?.length&&"create-new-namespace"!==s.namespace||"create-new-namespace"===s.namespace&&s.newNamespaceName?.length)){let e="create-new-namespace"===s.namespace;t(e?"newNamespaceName":"namespace",e?"Namespace name is required":"Namespace is required")}s.s3Region?.length||t("s3Region","S3 Region is required"),s.s3AccessKeyId?.length||t("s3AccessKeyId","S3 Access Key ID is required"),"create-new"===s.s3AccessKeyId||s.s3SecretAccessKey?.length||t("s3SecretAccessKey","S3 Secret Access Key is required")}})),defaultValues:eM}),{publicationName:eO,warehouseName:eQ}=ez.watch(),eq=(0,u.useMemo)(()=>M?.map(e=>e.name)??[],[M]),eH=z&&!!eO&&!eq.includes(eO),eG=[...I,...E].some(e=>"critical"===e.failure_type),eY=X||J||es||en||ec||eB,eX=eY||eH||!k&&F,eZ=async e=>{if(e.namespace===e$){if(!e.newNamespaceName)throw Error("New namespace name is required");return await eo({projectRef:l,warehouse:e.warehouseName,namespace:e.newNamespaceName}),e.newNamespaceName}return e.namespace},eJ=async s=>{if(!l||!B)return!1;w(!0);let a=await Promise.allSettled([ek({projectRef:l,destinationConfig:(({projectRef:e,selectedType:s,data:a})=>{if(!e)throw Error("Project ref is required");if("BigQuery"===s)return{bigQuery:{projectId:a.projectId??"",datasetId:a.datasetId??"",serviceAccountKey:a.serviceAccountKey??"",...void 0!==a.maxStalenessMins?{maxStalenessMins:a.maxStalenessMins}:{}}};if("Analytics Bucket"===s){let s=a.namespace===e$?a.newNamespaceName:a.namespace,t=a.s3AccessKeyId===eU?{accessKey:"placeholder",secretKey:"placeholder"}:{accessKey:a.s3AccessKeyId??"",secretKey:a.s3SecretAccessKey??""};return{iceberg:{projectRef:e,warehouseName:a.warehouseName??"",namespace:s,catalogToken:a.catalogToken??"",s3AccessKeyId:t.accessKey,s3SecretAccessKey:t.secretKey,s3Region:a.s3Region??""}}}throw Error("Invalid destination type")})({projectRef:l,selectedType:e,data:s})}),eF({projectRef:l,sourceId:B,publicationName:s.publicationName,maxFillMs:s.maxFillMs,maxSize:s.maxSize,maxTableSyncWorkers:s.maxTableSyncWorkers})]),t=a[0],i=a[1];if(a.some(e=>"rejected"===e.status))return K.toast.error("Failed to validate configuration. Please try again."),w(!1),!1;let n="fulfilled"===t.status?t.value:{validation_failures:[]},r="fulfilled"===i.status?i.value:{validation_failures:[]};P(n.validation_failures),C(r.validation_failures);let o=[...n.validation_failures,...r.validation_failures],c=o.some(e=>"critical"===e.failure_type);return o.length>0&&setTimeout(()=>{T.current?.scrollIntoView({behavior:"smooth",block:"start"})},100),!c},e0=async s=>{if(!l)return console.error("Project ref is required");if(!B)return console.error("Source id is required");if(eH)return K.toast.error("Please select another publication before continuing");try{if(k&&n){let a;if(!n.pipelineId)return console.error("Pipeline id is required");if("BigQuery"===e){let e={projectId:s.projectId??"",datasetId:s.datasetId??"",serviceAccountKey:s.serviceAccountKey??""};s.maxStalenessMins&&(e.maxStalenessMins=s.maxStalenessMins),a={bigQuery:e}}else if("Analytics Bucket"===e){let e={accessKey:s.s3AccessKeyId,secretKey:s.s3SecretAccessKey};if(s.s3AccessKeyId===eU){let s=await ei({projectRef:l,description:`Autogenerated key for replication to ${(0,eR.default)(eQ)}`});e={accessKey:s.access_key,secretKey:s.secret_key}}let t=await eZ(s);a={iceberg:{projectRef:l,warehouseName:s.warehouseName??"",namespace:t,catalogToken:s.catalogToken??"",s3AccessKeyId:e.accessKey??"",s3SecretAccessKey:e.secretKey??"",s3Region:s.s3Region??""}}}let t=void 0!==s.maxFillMs||void 0!==s.maxSize?{...void 0!==s.maxFillMs?{maxFillMs:s.maxFillMs}:{},...void 0!==s.maxSize?{maxSize:s.maxSize}:{}}:void 0,i=void 0!==t;if(!a)throw Error("Destination configuration is missing");await Z({destinationId:n.destinationId,pipelineId:n.pipelineId,projectRef:l,destinationName:s.name,destinationConfig:a,pipelineConfig:{publicationName:s.publicationName,maxTableSyncWorkers:s.maxTableSyncWorkers,...i?{batch:t}:{}},sourceId:B});let c=n.statusName??(n.enabled?"started":"stopped");n.enabled?(o(n.pipelineId,eC.PipelineStatusRequestStatus.RestartRequested,c),K.toast.success("Settings applied. Restarting the pipeline..."),et({projectRef:l,pipelineId:n.pipelineId})):(o(n.pipelineId,eC.PipelineStatusRequestStatus.StartRequested,c),K.toast.success("Settings applied. Starting the pipeline..."),ee({projectRef:l,pipelineId:n.pipelineId})),r()}else{let a;if("BigQuery"===e){let e={projectId:s.projectId??"",datasetId:s.datasetId??"",serviceAccountKey:s.serviceAccountKey??""};s.maxStalenessMins&&(e.maxStalenessMins=s.maxStalenessMins),a={bigQuery:e}}else if("Analytics Bucket"===e){let e={accessKey:s.s3AccessKeyId,secretKey:s.s3SecretAccessKey};if(s.s3AccessKeyId===eU){let s=await ei({projectRef:l,description:`Autogenerated key for replication to ${(0,eR.default)(eQ)}`});e={accessKey:s.access_key,secretKey:s.secret_key}}let t=await eZ(s);a={iceberg:{projectRef:l,warehouseName:s.warehouseName??"",namespace:t,catalogToken:s.catalogToken??"",s3AccessKeyId:e.accessKey??"",s3SecretAccessKey:e.secretKey??"",s3Region:s.s3Region??""}}}let t=void 0!==s.maxFillMs||void 0!==s.maxSize?{...void 0!==s.maxFillMs?{maxFillMs:s.maxFillMs}:{},...void 0!==s.maxSize?{maxSize:s.maxSize}:{}}:void 0,i=void 0!==t;if(!a)throw Error("Destination configuration is missing");let{pipeline_id:n}=await Y({projectRef:l,destinationName:s.name,destinationConfig:a,sourceId:B,pipelineConfig:{publicationName:s.publicationName,maxTableSyncWorkers:s.maxTableSyncWorkers,...i?{batch:t}:{}}});o(n,eC.PipelineStatusRequestStatus.StartRequested,void 0),K.toast.success("Destination created. Starting the pipeline..."),ee({projectRef:l,pipelineId:n}),r()}}catch(s){let e=k?"apply and run":"create and start";K.toast.error(`Failed to ${e} destination`)}},e1=async e=>{if(!k){if((!v||eB||eG)&&!await eJ(e))return;N(e),j(!0);return}await e0(e)},e2=async()=>{_&&(N(null),j(!1),await e0(_))};return(0,u.useEffect)(()=>{k&&Q&&q&&!m&&ez.reset(eM)},[Q,q,k,eM,ez,m]),(0,u.useEffect)(()=>{i&&(ez.reset(eM),h(!1),w(!1),P([]),C([]))},[i,eM,ez]),(0,u.useEffect)(()=>{i&&l&&B&&O()},[i,l,B,O]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)($.SheetSection,{className:"flex-grow overflow-auto px-0 py-0",children:F&&!k?(0,s.jsx)(sl,{}):(0,s.jsx)(eA.Form_Shadcn_,{...ez,children:(0,s.jsxs)("form",{id:sw,onSubmit:ez.handleSubmit(e1),children:[(0,s.jsxs)("div",{className:"p-5 flex flex-col gap-y-6",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Destination details"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(eV,{form:ez}),(0,s.jsx)(s_,{form:ez,sourceId:B,visible:i,onSelectNewPublication:()=>y(!0)})]})]}),(0,s.jsx)(U.DialogSectionSeparator,{}),"BigQuery"===e&&c?(0,s.jsx)(e6,{form:ez}):"Analytics Bucket"===e&&d?(0,s.jsx)(se,{form:ez,setIsFormInteracting:h,onSelectNewBucket:()=>S(!0)}):null,(0,s.jsx)(U.DialogSectionSeparator,{}),(0,s.jsx)(eK,{type:e,form:ez}),!k&&v&&!eB&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.DialogSectionSeparator,{}),(0,s.jsx)("div",{ref:T,children:(0,s.jsx)(sv,{destinationFailures:I,pipelineFailures:E})})]})]})})}),(0,s.jsxs)($.SheetFooter,{className:"!justify-between",children:[(0,s.jsx)(ev.AnimatePresence,{mode:"wait",children:eB||eY?(0,s.jsxs)(ew.motion.div,{className:"flex items-center gap-x-2",initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.2,ease:"easeOut"},children:[(0,s.jsx)(eP.Loader2,{className:"animate-spin",size:14}),(0,s.jsx)("p",{className:"text-foreground-light text-sm",children:eB?"Validating destination configuration...":`${k?"Updating":"Creating"} destination...`})]}):(0,s.jsx)("div",{})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(g.Button,{disabled:eY,type:"default",onClick:r,children:"Cancel"}),(0,s.jsx)(g.Button,{disabled:eX,loading:eY,form:sw,htmlType:"submit",children:k?n?.enabled?"Apply and restart":"Apply and start":"Create and start"})]})]}),(0,s.jsx)(sn,{sourceId:B,visible:f,onClose:()=>y(!1)}),(0,s.jsx)(ed,{open:b,onOpenChange:S}),(0,s.jsx)(sN,{open:x,onOpenChange:e=>{j(e),e||N(null)},isLoading:eY,onConfirm:e2})]})};e.i(481541);var sR=e.i(743116),sP=e.i(95297),sP=sP,sE=e.i(733957),sC=e.i(418348);let sA=()=>{let e=(0,en.useIsETLPrivateAlpha)(),t=(0,a.useFlag)("unifiedReplication"),i=(0,a.useFlag)("etlEnableBigQuery"),n=(0,a.useFlag)("etlEnableIceberg"),r=[t,i,n].filter(Boolean).length,[l,o]=(0,M.useQueryState)("type",(0,M.parseAsStringEnum)(["Read Replica","BigQuery","Analytics Bucket"]).withOptions({history:"push",clearOnDefault:!0})),[c]=(0,M.useQueryState)("edit",M.parseAsInteger.withOptions({history:"push",clearOnDefault:!0})),d=null!==c,{type:u}=ei({id:c}),p=u??l;return(0,s.jsxs)("div",{className:"px-5 py-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 mb-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Type"}),(0,s.jsx)("p",{className:"text-foreground-light text-sm",children:"The destination type cannot be changed after creation"})]}),(0,s.jsxs)(sC.RadioGroupStacked,{disabled:d,value:p,onValueChange:e=>o(e),className:(0,O.cn)("grid [&>button>div]:py-4",3===r?"grid-cols-3":2===r?"grid-cols-2":"grid-cols-1","[&>button:first-of-type]:rounded-none [&>button:last-of-type]:rounded-none","[&>button:first-of-type]:!rounded-l-lg [&>button:last-of-type]:!rounded-r-lg"),children:[(!d&&t||d&&"Read Replica"===p)&&(0,s.jsx)(sC.RadioGroupStackedItem,{label:"",showIndicator:!1,id:"Read Replica",value:"Read Replica",children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(sE.Database,{size:20}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5 text-sm text-left",children:[(0,s.jsx)("p",{children:"Read Replica"}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Deploy read-only databases across multiple regions for lower latency and better resource management"})]})]})}),(!d&&i||d&&"BigQuery"===p)&&(0,s.jsx)(sC.RadioGroupStackedItem,{label:"",showIndicator:!1,id:"BigQuery",value:"BigQuery",children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(sP.default,{size:20}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5 text-sm text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("p",{children:"BigQuery"}),t&&(0,s.jsx)(eB.Badge,{children:"Alpha"})]}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Send data to Google Cloud's data warehouse for analytics and business intelligence"})]})]})}),(!d&&n||d&&"Analytics Bucket"===p)&&(0,s.jsx)(sC.RadioGroupStackedItem,{label:"",showIndicator:!1,id:"Analytics Bucket",value:"Analytics Bucket",children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(sR.AnalyticsBucket,{size:20}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5 text-sm text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("p",{children:"Analytics Bucket"}),t&&(0,s.jsx)(eB.Badge,{children:"Alpha"})]}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Send data to Apache Iceberg tables in your Supabase Storage for flexible analytics workflows"})]})]})})]}),"Read Replica"!==p&&e&&(0,s.jsxs)("p",{className:"mt-3 text-sm text-foreground-light",children:["Replication is in alpha. Expect rapid changes and possible breaking updates."," ",(0,s.jsx)(eX.InlineLink,{href:"https://github.com/orgs/supabase/discussions/39416",children:"Leave feedback"})]})]})};e.i(869176);var sT=e.i(579499),sk=e.i(150671),sD=e.i(837508);e.i(287509);var sF=e.i(434934),sL=e.i(719754),sB=e.i(196621),sM=e.i(491726),sz=e.i(164045),sO=e.i(265735),sQ=e.i(635494),sq=e.i(390473),sK=e.i(144676);let sU=()=>{let{ref:e}=(0,t.useParams)(),s=(0,sQ.useIsAwsK8sCloudProvider)(),{data:a}=(0,sQ.useSelectedProjectQuery)(),{data:i}=(0,sO.useSelectedOrganizationQuery)(),{hasAccess:n}=(0,F.useCheckEntitlements)("instances.read_replicas"),r=a?.cloud_provider==="AWS",l=a?.is_physical_backups_enabled,o=(0,u.useMemo)(()=>!["team","enterprise","platform"].includes(i?.plan.id??""),[i]),c=i?.plan.id==="pro"&&!i.usage_billing_enabled,{data:d}=(0,sq.useOverdueInvoicesQuery)({enabled:o}),p=(d??[]).filter(e=>e.organization_id===a?.organization_id).length>0&&o,{data:m=[]}=(0,sk.useReadReplicasQuery)({projectRef:e}),{data:h}=(0,sK.useProjectAddonsQuery)({projectRef:e}),x=h?.selected_addons.find(e=>"compute_instance"===e.type)?.variant.identifier,g=void 0!==x&&"ci_micro"!==x,j=["ci_micro","ci_small","ci_medium","ci_large"].includes(x??"ci_micro")?sk.MAX_REPLICAS_BELOW_XL:sk.MAX_REPLICAS_ABOVE_XL,f=(m??[]).filter(s=>s.identifier!==e).length>=j,y=Number((a?.dbVersion??"").split("supabase-postgres-")[1]?.split(".")[0]);return{can:!f&&y>=15&&r&&n&&l&&void 0!==x&&!p&&!s&&!c&&g,hasOverdueInvoices:p,isAWSProvider:r,isAwsK8s:s,isPgVersionBelow15:y<15,isBelowSmallCompute:!g,isWalgNotEnabled:!l,isProWithSpendCapEnabled:c,isReachedMaxReplicas:f,maxNumberOfReplicas:j}},s$=()=>{let{ref:e}=(0,t.useParams)(),{data:a}=(0,sO.useSelectedOrganizationQuery)(),{data:i}=(0,sQ.useSelectedProjectQuery)(),[n,r]=(0,u.useState)(!1),{hasOverdueInvoices:l,isAWSProvider:o,isAwsK8s:c,isPgVersionBelow15:p,isBelowSmallCompute:m,isWalgNotEnabled:h,isProWithSpendCapEnabled:j,isReachedMaxReplicas:f,maxNumberOfReplicas:y}=sU(),{data:b,isSuccess:S}=(0,sz.useProjectDetailQuery)({ref:e},{refetchInterval:n,refetchOnWindowFocus:!1}),{mutate:_,isPending:N}=(0,sM.useEnablePhysicalBackupsMutation)({onSuccess:()=>{K.toast.success("Physical backups are currently being enabled, please check back in a few minutes!"),r(5e3)}});return((0,u.useEffect)(()=>{S&&b.is_physical_backups_enabled&&r(!1)},[b?.is_physical_backups_enabled,S]),l)?(0,s.jsxs)(W.Admonition,{type:"warning",title:"Your organization has overdue invoices",children:[(0,s.jsx)("p",{children:"Please resolve all outstanding invoices first before deploying a new read replica"}),(0,s.jsx)(g.Button,{asChild:!0,type:"default",className:"mt-2",children:(0,s.jsx)(d.default,{href:`/org/${a?.slug}/billing#invoices`,children:"View invoices"})})]}):o?c?(0,s.jsx)(W.Admonition,{type:"warning",title:"Read replicas are not supported for AWS (Revamped) projects",description:"Projects provisioned by other cloud providers currently will not be able to use read replicas"}):p?(0,s.jsxs)(W.Admonition,{type:"warning",title:"Read replicas can only be deployed with projects on Postgres version 15 and above",children:[(0,s.jsx)("p",{children:"If you'd like to use read replicas, please contact us via support"}),(0,s.jsx)(g.Button,{asChild:!0,type:"default",className:"mt-2",children:(0,s.jsx)(sB.SupportLink,{queryParams:{projectRef:e,category:el.SupportCategories.SALES_ENQUIRY,subject:"Enquiry on read replicas",message:`Project DB version: ${i?.dbVersion}`},children:"Contact support"})})]}):m?(0,s.jsxs)(W.Admonition,{type:"warning",title:"Project required to at least be on a Small compute",children:[(0,s.jsx)("p",{children:"This is to ensure that read replicas can keep up with the primary databases' activities."}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2 mt-2",children:[(0,s.jsx)(V.UpgradePlanButton,{variant:"default",plan:"Pro",addon:"computeSize",source:"read-replicas",featureProposition:"deploy Read Replicas",children:"Change compute size"}),(0,s.jsx)(E.DocsButton,{href:`${x.DOCS_URL}/guides/platform/read-replicas#prerequisites`})]})]}):h?(0,s.jsxs)(W.Admonition,{type:"warning",title:!1===n?"Physical backups are required to deploy replicas":"Physical backups are currently being enabled",children:[!1===n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Physical backups are used under the hood to spin up read replicas for your project."}),(0,s.jsx)("p",{children:"Enabling physical backups will take a few minutes, after which you will be able to deploy read replicas."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"This warning will go away once physical backups have been enabled - check back in a few minutes!"}),(0,s.jsx)("p",{children:"You may start deploying read replicas thereafter once this is completed."})]}),!1===n&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2 mt-2",children:[(0,s.jsx)(g.Button,{type:"default",loading:N,disabled:N,onClick:()=>{e&&_({ref:e})},children:"Enable physical backups"}),(0,s.jsx)(E.DocsButton,{abbrev:!1,href:`${x.DOCS_URL}/guides/platform/read-replicas#how-are-read-replicas-made`})]})]}):j?(0,s.jsxs)(W.Admonition,{type:"warning",title:"Spend cap needs to be disabled to deploy replicas",children:[(0,s.jsx)("p",{children:"Launching a replica incurs additional disk size that will exceed the plan's quota. Disable the spend cap first to allow overages before launching a replica."}),(0,s.jsx)(V.UpgradePlanButton,{variant:"default",source:"read-replicas",addon:"spendCap",className:"mt-2"})]}):f?(0,s.jsxs)(W.Admonition,{type:"warning",title:`You can only deploy up to ${y} read replicas at once`,children:[(0,s.jsx)("p",{children:"If you'd like to spin up another read replica, please drop an existing replica first."}),y===sk.MAX_REPLICAS_BELOW_XL&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["Alternatively, you may deploy up to"," ",(0,s.jsx)("span",{className:"text-foreground",children:sk.MAX_REPLICAS_ABOVE_XL})," replicas if your project is on an XL compute or higher."]}),(0,s.jsx)(V.UpgradePlanButton,{variant:"default",plan:"Pro",addon:"computeSize",source:"read-replicas",featureProposition:"deploy Read Replicas",className:"mt-2",children:"Change compute size"})]})]}):void 0:(0,s.jsxs)(W.Admonition,{type:"warning",title:"Read replicas are only supported for projects provisioned via AWS",children:[(0,s.jsx)("p",{children:"Projects provisioned by other cloud providers currently will not be able to use read replicas"}),(0,s.jsx)(E.DocsButton,{abbrev:!1,className:"mt-2",href:`${x.DOCS_URL}/guides/platform/read-replicas#prerequisites`})]})};var sH=e.i(961753),sW=e.i(819591),sV=e.i(605317),sG=e.i(48189);let sY=()=>{let{ref:e}=(0,t.useParams)(),{data:s}=(0,sK.useProjectAddonsQuery)({projectRef:e}),{data:a}=(0,sV.useDiskAttributesQuery)({projectRef:e}),i=s?.selected_addons.find(e=>"compute_instance"===e.type)?.variant.identifier,n=(s?.available_addons.find(e=>"compute_instance"===e.type)?.variants??[]).find(e=>e.identifier===i),r=Math.floor((n?.price??0)*730),{size_gb:l,type:o,throughput_mbps:c,iops:d}=a?.attributes??{},u=(l??0)*1.25*(sW.DISK_PRICING[o]?.storage??0),p=(0,sH.calculateIOPSPrice)({oldStorageType:o,newStorageType:o,oldProvisionedIOPS:0,newProvisionedIOPS:d??0,numReplicas:0}).newPrice,m="gp3"===o?(0,sH.calculateThroughputPrice)({storageType:o,newThroughput:c??0,oldThroughput:0,numReplicas:0}).newPrice:0;return{totalCost:(0,sG.formatCurrency)(r+u+Number(p)+Number(m)),compute:{label:n?.name,cost:(0,sG.formatCurrency)(r),priceDescription:n?.price_description},disk:{type:o,label:`${((l??0)*1.25).toLocaleString()} GB (${o})`,cost:(0,sG.formatCurrency)(u)},iops:{label:`${d?.toLocaleString()} IOPS`,cost:(0,sG.formatCurrency)(+p)},throughput:{label:`${c?.toLocaleString()} MB/s`,cost:(0,sG.formatCurrency)(+m)}}},sX=()=>{let{data:e}=(0,sQ.useSelectedProjectQuery)(),{compute:a,disk:t,iops:i,throughput:n}=sY(),r=e?.cloud_provider==="AWS";return(0,s.jsxs)(U.Dialog,{children:[(0,s.jsx)(U.DialogTrigger,{asChild:!0,children:(0,s.jsx)("button",{className:(0,O.cn)(eX.InlineLinkClassName,"text-sm text-foreground-light"),children:"Learn more"})}),(0,s.jsxs)(U.DialogContent,{size:r?"medium":"small","aria-describedby":void 0,children:[(0,s.jsx)(U.DialogHeader,{children:(0,s.jsx)(U.DialogTitle,{children:"Calculating costs for a new read replica"})}),(0,s.jsx)(U.DialogSectionSeparator,{}),(0,s.jsx)(U.DialogSection,{children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-foreground-light text-sm mb-2",children:"Read replicas will match the compute size of your primary database and will include 25% more disk size than the primary database to accommodate WAL files."}),(0,s.jsx)("p",{className:"text-foreground-light text-sm",children:"The additional cost for the replica breaks down to:"}),(0,s.jsxs)(z.Table,{children:[(0,s.jsx)(z.TableHeader,{className:"font-mono uppercase text-xs [&_th]:h-auto [&_th]:pb-2 [&_th]:pt-4",children:(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableHead,{className:"w-[140px] pl-0",children:"Item"}),(0,s.jsx)(z.TableHead,{children:"Description"}),(0,s.jsx)(z.TableHead,{className:"text-right pr-0",children:"Cost (/month)"})]})}),(0,s.jsxs)(z.TableBody,{className:"[&_td]:py-0 [&_tr]:h-[50px] [&_tr]:border-dotted",children:[(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableCell,{className:"pl-0",children:"Compute size"}),(0,s.jsx)(z.TableCell,{children:a.label}),(0,s.jsx)(z.TableCell,{className:"text-right font-mono pr-0",translate:"no",children:a.cost})]}),(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableCell,{className:"pl-0",children:"Disk size"}),(0,s.jsx)(z.TableCell,{children:t.label}),(0,s.jsx)(z.TableCell,{className:"text-right font-mono pr-0",translate:"no",children:t.cost})]}),(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableCell,{className:"pl-0",children:"IOPS"}),(0,s.jsx)(z.TableCell,{children:i.label}),(0,s.jsx)(z.TableCell,{className:"text-right font-mono pr-0",translate:"no",children:i.cost})]}),"gp3"===t.type&&(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableCell,{className:"pl-0",children:"Throughput"}),(0,s.jsx)(z.TableCell,{children:n.label}),(0,s.jsx)(z.TableCell,{className:"text-right font-mono pr-0",children:n.cost})]})]})]})]}):(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["Read replicas will be on the same compute size as your primary database. Deploying a read replica on the ",(0,s.jsx)("span",{className:"text-foreground",children:a.label})," size incurs additional"," ",(0,s.jsx)("span",{className:"text-foreground",translate:"no",children:a?.priceDescription}),"."]})}),(0,s.jsx)(U.DialogFooter,{children:(0,s.jsx)(E.DocsButton,{href:`${x.DOCS_URL}/guides/platform/manage-your-usage/read-replicas`})})]})]})},sZ=({onSuccess:e,onClose:a})=>{let{ref:i}=(0,t.useParams)(),{data:n}=(0,sk.useReadReplicasQuery)({projectRef:i}),[r]=Object.entries(sF.AWS_REGIONS).find(([e,s])=>s===sD.AWS_REGIONS_DEFAULT)??["ap-southeast-1"],{totalCost:l}=sY(),{can:o}=sU(),[c,d]=(0,u.useState)(r),{mutate:p,isPending:m}=(0,sT.useReadReplicaSetUpMutation)({onSuccess:()=>{let s=f.AVAILABLE_REPLICA_REGIONS.find(e=>e.key===c)?.name;K.toast.success(`Spinning up new replica in ${s??" Unknown"}...`),e?.(),a()}}),h=f.AVAILABLE_REPLICA_REGIONS,j=async()=>{let e=sF.AWS_REGIONS[c].code;if(!i)return console.error("Project is required");if(!e)return K.toast.error("Unable to deploy replica: Unsupported region selected");let s=n?.find(e=>e.identifier===i);p({projectRef:i,region:e,size:s?.size??"t4g.small"})};return(0,s.jsxs)(s.Fragment,{children:[!o&&(0,s.jsx)($.SheetSection,{children:(0,s.jsx)(s$,{})}),(0,s.jsx)($.SheetSection,{className:"flex-grow overflow-auto px-0 py-0",children:(0,s.jsx)(eq.FormItemLayout,{isReactForm:!1,layout:"horizontal",className:"p-5 [&>div]:gap-y-1 [&>div>span]:text-foreground-lighter",label:"Region",labelOptional:"Select a region to deploy your replica in",children:(0,s.jsxs)(e1.Select_Shadcn_,{value:c,onValueChange:d,disabled:!o,children:[(0,s.jsx)(e8.SelectTrigger_Shadcn_,{children:(0,s.jsx)(sL.SelectValue_Shadcn_,{placeholder:"Select a region"})}),(0,s.jsx)(e2.SelectContent_Shadcn_,{children:h.map(e=>(0,s.jsx)(e3.SelectItem_Shadcn_,{value:e.key,children:(0,s.jsxs)("div",{className:"flex gap-x-3 items-center",children:[(0,s.jsx)("img",{alt:"region icon",className:"w-5 rounded-sm",src:`${x.BASE_PATH}/img/regions/${e.region}.svg`}),(0,s.jsxs)("p",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)("span",{className:"text-xs text-foreground-lighter font-mono",children:e.region})]})]})},e.key))})]})})}),(0,s.jsxs)($.SheetFooter,{className:"!justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,s.jsx)(e9.InfoIcon,{className:"h-5 w-5"}),(0,s.jsxs)("p",{className:"text-sm",children:["New replica will cost an additional ",(0,s.jsxs)("span",{translate:"no",children:[l,"/month"]})]}),(0,s.jsx)(sX,{})]}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(g.Button,{disabled:m,type:"default",onClick:a,children:"Cancel"}),(0,s.jsx)(g.Button,{disabled:!o,loading:m,onClick:j,children:"Deploy replica"})]})]})]})},sJ=({onSuccessCreateReadReplica:e})=>{let t=(0,en.useIsETLPrivateAlpha)(),i=(0,a.useFlag)("unifiedReplication"),{hasAccess:r}=(0,F.useCheckEntitlements)("replication.etl"),[l,o]=(0,M.useQueryState)("type",(0,M.parseAsStringEnum)(["Read Replica","BigQuery","Analytics Bucket"]).withOptions({history:"push",clearOnDefault:!0})),[c,p]=(0,M.useQueryState)("edit",M.parseAsInteger.withOptions({history:"push",clearOnDefault:!0})),m=null!==l||null!==c,h=null!==c,{sourceId:j,pipeline:f,statusName:y,replicationNotEnabled:b,type:S,destinationFetcher:_}=ei({id:c}),N=S??l,v=_.error?.code===404,w=h?{sourceId:j,destinationId:c,pipelineId:f?.id,statusName:y,enabled:y===X.PipelineStatusName.STARTED||y===X.PipelineStatusName.FAILED}:void 0,I=()=>{o(null),p(null)};return(0,u.useEffect)(()=>{null!==c&&v&&((0,K.toast)(`Unable to find destination ID ${c}`),p(null))},[c,v,p]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)($.Sheet,{open:m,onOpenChange:I,children:(0,s.jsx)($.SheetContent,{size:"default",showClose:!1,className:(0,O.cn)(i?"md:!w-[850px]":"md:!w-[700px]"),children:(0,s.jsxs)("div",{className:"flex flex-col h-full",tabIndex:-1,children:[(0,s.jsxs)($.SheetHeader,{children:[(0,s.jsx)($.SheetTitle,{children:h?"Edit destination":"Create a new destination"}),(0,s.jsx)($.SheetDescription,{children:h?"Update the configuration for this destination":"A destination is an external platform that automatically receives your database changes in real time."})]}),(0,s.jsx)(sA,{}),(0,s.jsx)(U.DialogSectionSeparator,{}),"Read Replica"===N?(0,s.jsx)(sZ,{onClose:I,onSuccess:()=>e?.()}):i&&!t?(0,s.jsx)($.SheetSection,{children:(0,s.jsxs)("div",{className:(0,O.cn)("border rounded-md p-6 flex flex-col gap-y-4"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("h4",{children:"Replicate data to external destinations in real-time"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["We are currently in ",(0,s.jsx)("span",{className:"text-foreground",children:"private alpha"})," and slowly onboarding new customers to ensure stable data pipelines. Request access below to join the waitlist. Read replicas are available now."]})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"secondary",iconRight:(0,s.jsx)(n.ArrowUpRight,{size:16,strokeWidth:1.5}),children:(0,s.jsx)(d.default,{href:"https://forms.supabase.com/pg_replicate",target:"_blank",rel:"noreferrer",children:"Request alpha access"})}),(0,s.jsx)(E.DocsButton,{href:`${x.DOCS_URL}/guides/database/replication#replication`})]})]})}):i&&b?(0,s.jsx)($.SheetSection,{children:(0,s.jsx)(Y,{className:"!p-6",type:N,hasAccess:r})}):(0,s.jsx)(sI,{visible:m,selectedType:N??"Read Replica",existingDestination:w,onClose:I})]})})})})};var s0=e.i(573100),s1=e.i(572177),s2=e.i(167850),sP=sP,s5=e.i(725990),s3=e.i(613580),s4=e.i(170149);let s8=({visible:e,isLoading:a,name:t,setVisible:i,onDelete:n})=>(0,s.jsx)(s4.TextConfirmModal,{variant:"destructive",visible:e,loading:a,title:"Delete this destination",confirmLabel:a?"Deleting...":"Delete destination",confirmPlaceholder:"Type in name of destination",confirmString:t??"Unknown",text:`This will delete the destination "${t}"`,alert:{title:"You cannot recover this destination once deleted."},onCancel:()=>i(!e),onConfirm:n});var s7=e.i(405641),s9=e.i(573715),s6=e.i(53071),ae=e.i(471998),as=e.i(899929),aa=e.i(388298),at=e.i(809934),ai=e.i(211570),an=e.i(874311);let ar=({destinationId:e,pipeline:a,pipelineStatus:i,error:n,isLoading:r,isError:l,hasUpdate:o=!1,onDeleteClick:c,onUpdateClick:d})=>{let{ref:u}=(0,t.useParams)(),p=(0,Z.getStatusName)(i),[m,h]=(0,M.useQueryState)("edit",M.parseAsInteger.withOptions({history:"push",clearOnDefault:!0})),{mutateAsync:x}=(0,ej.useStartPipelineMutation)(),{mutateAsync:j}=(0,s2.useStopPipelineMutation)(),{restartPipeline:f}=(0,eg.useRestartPipelineHelper)(),{getRequestStatus:y,setRequestStatus:b}=(0,eC.usePipelineRequestStatus)(),S=(a?.id?y(a.id):eC.PipelineStatusRequestStatus.None)===eC.PipelineStatusRequestStatus.None&&p!==X.PipelineStatusName.STARTING&&[X.PipelineStatusName.STOPPED,X.PipelineStatusName.STARTED,X.PipelineStatusName.FAILED].includes(p),_=S&&(p===X.PipelineStatusName.STARTED||p===X.PipelineStatusName.FAILED),N=S&&p===X.PipelineStatusName.STOPPED,v=async()=>{if(!u)return console.error("Project ref is required");if(!a)return K.toast.error(Z.PIPELINE_ERROR_MESSAGES.NO_PIPELINE_FOUND);try{Z.PIPELINE_ENABLE_ALLOWED_FROM.includes(p)&&b(a.id,eC.PipelineStatusRequestStatus.StartRequested,p),await x({projectRef:u,pipelineId:a.id})}catch(e){b(a.id,eC.PipelineStatusRequestStatus.None),K.toast.error(Z.PIPELINE_ERROR_MESSAGES.ENABLE_DESTINATION)}},w=async()=>{if(!u)return console.error("Project ref is required");if(!a)return K.toast.error(Z.PIPELINE_ERROR_MESSAGES.NO_PIPELINE_FOUND);try{Z.PIPELINE_DISABLE_ALLOWED_FROM.includes(p)&&b(a.id,eC.PipelineStatusRequestStatus.StopRequested,p),await j({projectRef:u,pipelineId:a.id})}catch(e){b(a.id,eC.PipelineStatusRequestStatus.None),K.toast.error(Z.PIPELINE_ERROR_MESSAGES.DISABLE_DESTINATION)}},I=async()=>{if(!u)return console.error("Project ref is required");if(!a)return K.toast.error(Z.PIPELINE_ERROR_MESSAGES.NO_PIPELINE_FOUND);try{b(a.id,eC.PipelineStatusRequestStatus.RestartRequested,p),await f({projectRef:u,pipelineId:a.id})}catch(e){b(a.id,eC.PipelineStatusRequestStatus.None),K.toast.error(Z.PIPELINE_ERROR_MESSAGES.ENABLE_DESTINATION)}};return(0,s.jsxs)("div",{className:"flex justify-end items-center space-x-2",children:[r&&(0,s.jsx)(Q.ShimmeringLoader,{}),l&&(0,s.jsx)(P.default,{error:n,subject:Z.PIPELINE_ERROR_MESSAGES.RETRIEVE_PIPELINE_STATUS}),(0,s.jsxs)(an.DropdownMenu,{children:[(0,s.jsx)(an.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.Button,{type:"default",className:"px-1.5",icon:(0,s.jsx)(ae.MoreVertical,{})}),o&&(0,s.jsx)("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 bg-brand rounded-full"})]})}),(0,s.jsxs)(an.DropdownMenuContent,{side:"bottom",align:"end",className:"w-52",children:[o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(an.DropdownMenuItem,{className:"space-x-2",onClick:()=>d?.(),children:[(0,s.jsx)(s9.ArrowUpCircle,{size:14}),(0,s.jsx)("p",{children:"Update available"})]}),(0,s.jsx)(an.DropdownMenuSeparator,{})]}),N&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(an.DropdownMenuItem,{className:"space-x-2",onClick:v,children:[(0,s.jsx)(aa.Play,{size:14}),(0,s.jsx)("p",{children:"Start pipeline"})]}),(0,s.jsx)(an.DropdownMenuSeparator,{})]}),_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(an.DropdownMenuItem,{className:"space-x-2",onClick:I,children:[(0,s.jsx)(at.RotateCcw,{size:14}),(0,s.jsx)("p",{children:"Restart pipeline"})]}),(0,s.jsxs)(an.DropdownMenuItem,{className:"space-x-2",onClick:w,children:[(0,s.jsx)(as.Pause,{size:14}),(0,s.jsx)("p",{children:"Stop pipeline"})]}),(0,s.jsx)(an.DropdownMenuSeparator,{})]}),(0,s.jsxs)(an.DropdownMenuItem,{className:"space-x-2",onClick:()=>h(e),children:[(0,s.jsx)(s6.Edit,{size:14}),(0,s.jsx)("p",{children:"Edit destination"})]}),(0,s.jsxs)(an.DropdownMenuItem,{className:"space-x-2",onClick:c,children:[(0,s.jsx)(ai.Trash,{size:14}),(0,s.jsx)("p",{children:"Delete destination"})]})]})]})]})};var al=e.i(16324);let ao=({destinationId:e})=>{let{ref:a}=(0,t.useParams)(),[i,n]=(0,u.useState)(!1),[r,l]=(0,u.useState)(!1),[o,c]=(0,u.useState)(!1),{type:p,statusName:m,destination:h,pipeline:x,pipelineStatus:j,pipelineFetcher:f}=ei({id:e}),{error:y,isPending:b,isError:S,isSuccess:_}=f,N=h?.name??"",{error:v,isPending:w,isError:I,isSuccess:R}=(0,et.useReplicationPipelineStatusQuery)({projectRef:a,pipelineId:x?.id},{refetchInterval:X.STATUS_REFRESH_FREQUENCY_MS}),{getRequestStatus:E,updatePipelineStatus:C}=(0,eC.usePipelineRequestStatus)(),A=x?.id?E(x.id):eC.PipelineStatusRequestStatus.None,{mutateAsync:k}=(0,s2.useStopPipelineMutation)(),{mutateAsync:D}=(0,s0.useDeleteDestinationPipelineMutation)({}),{data:F}=(0,s1.useReplicationPipelineReplicationStatusQuery)({projectRef:a,pipelineId:x?.id},{refetchInterval:X.STATUS_REFRESH_FREQUENCY_MS}),L=(F?.table_statuses??[]).filter(e=>e.state?.name==="error").length,B=m===X.PipelineStatusName.STOPPED,M=A===eC.PipelineStatusRequestStatus.RestartRequested,{data:O}=(0,T.useReplicationPipelineVersionQuery)({projectRef:a,pipelineId:x?.id}),q=!!O?.new_version,U=async()=>{if(!a)return console.error("Project ref is required");if(!x)return K.toast.error(Z.PIPELINE_ERROR_MESSAGES.NO_PIPELINE_FOUND);try{l(!0),await k({projectRef:a,pipelineId:x.id}),await D({projectRef:a,destinationId:e,pipelineId:x.id}),n(!1),K.toast.success(`Deleted destination "${N}"`)}catch(e){K.toast.error(Z.PIPELINE_ERROR_MESSAGES.DELETE_DESTINATION)}finally{l(!1)}};return(0,u.useEffect)(()=>{x?.id&&C(x.id,m)},[x?.id,m,C]),(0,s.jsxs)(s.Fragment,{children:[S&&(0,s.jsx)(P.AlertError,{error:y,subject:Z.PIPELINE_ERROR_MESSAGES.RETRIEVE_PIPELINE}),_&&(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableCell,{children:"BigQuery"===p?(0,s.jsx)(sP.default,{size:18,className:"text-foreground-light"}):"Analytics Bucket"===p?(0,s.jsx)(sR.AnalyticsBucket,{size:18,className:"text-foreground-light"}):(0,s.jsx)(sE.Database,{size:18,className:"text-foreground-light"})}),(0,s.jsx)(z.TableCell,{className:"max-w-[180px]",children:b?(0,s.jsx)(Q.ShimmeringLoader,{}):(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{title:N,className:"truncate",children:N}),(0,s.jsxs)("p",{className:"text-foreground-lighter",children:[p," (ID: ",x?.id,")"]})]})}),(0,s.jsx)(z.TableCell,{children:b||!x?(0,s.jsx)(Q.ShimmeringLoader,{}):(0,s.jsx)(s7.PipelineStatus,{pipelineStatus:j?.status,error:v,isLoading:w,isError:I,isSuccess:R,requestStatus:A,pipelineId:x?.id})}),(0,s.jsx)(z.TableCell,{children:(0,s.jsx)(s5.Minus,{size:18,className:"text-foreground-lighter"})}),(0,s.jsx)(z.TableCell,{children:b||!x?(0,s.jsx)(Q.ShimmeringLoader,{}):x.config.publication_name}),(0,s.jsx)(z.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-x-2",children:[L>0&&!B&&!M&&(0,s.jsxs)(s3.Tooltip,{children:[(0,s.jsx)(s3.TooltipTrigger,{children:(0,s.jsx)(e9.WarningIcon,{})}),(0,s.jsxs)(s3.TooltipContent,{side:"bottom",children:[L," table",1===L?"":"s"," encountered replication errors"]})]}),(0,s.jsx)(g.Button,{asChild:!0,type:"default",className:"relative",children:(0,s.jsx)(d.default,{href:`/project/${a}/database/replication/${x?.id}`,children:"View replication"})}),(0,s.jsx)(ar,{destinationId:e,pipeline:x,pipelineStatus:j?.status,error:v,isLoading:w,isError:I,onDeleteClick:()=>n(!0),hasUpdate:q,onUpdateClick:()=>c(!0)})]})})]}),(0,s.jsx)(s8,{visible:i,setVisible:n,onDelete:U,isLoading:r,name:N}),(0,s.jsx)(al.UpdateVersionModal,{visible:o,pipeline:x,onClose:()=>c(!1),confirmLabel:m===X.PipelineStatusName.STARTED||m===X.PipelineStatusName.FAILED?"Update and restart":"Update version"})]})};var ac=e.i(555254),ad=e.i(128),au=e.i(805501),ap=e.i(940009),am=e.i(602364);let ah=({replica:e,onUpdateReplica:a})=>{let{ref:i}=(0,t.useParams)(),{identifier:n,region:r,status:l}=e,o=(0,ap.formatDatabaseID)(n??""),{data:c,isPending:p,isError:m}=(0,au.useReplicationLagQuery)({id:n,projectRef:i,connectionString:e.connectionString},{enabled:l===f.REPLICA_STATUS.ACTIVE_HEALTHY}),[h,x]=(0,u.useState)(!1),[j,y]=(0,u.useState)(!1),b=Object.values(sF.AWS_REGIONS).find(e=>e.code===r)?.displayName,S=(0,u.useMemo)(()=>(0,am.getIsInTransition)({status:l}),[l]),_=(0,u.useMemo)(()=>(0,am.getStatusLabel)({status:l}),[l]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableCell,{children:(0,s.jsx)(sE.Database,{size:18,className:"text-foreground-light"})}),(0,s.jsx)(z.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:b}),(0,s.jsxs)("p",{className:"text-foreground-lighter",children:["Read Replica (ID: ",o,")"]})]})}),(0,s.jsx)(z.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eB.Badge,{variant:"Healthy"===_?"success":"Failed"===_?"destructive":"default",children:_}),S&&(0,s.jsx)(eP.Loader2,{className:"animate-spin w-3 h-3"})]})}),(0,s.jsx)(z.TableCell,{children:m||l!==f.REPLICA_STATUS.ACTIVE_HEALTHY?(0,s.jsx)(s5.Minus,{size:18,className:"text-foreground-lighter"}):p?(0,s.jsx)(Q.ShimmeringLoader,{}):(0,s.jsxs)("p",{children:[c,"s"]})}),(0,s.jsx)(z.TableCell,{children:(0,s.jsx)(s5.Minus,{size:18,className:"text-foreground-lighter"})}),(0,s.jsx)(z.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-x-2",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"default",className:"relative",disabled:"GOING_DOWN"===l,children:(0,s.jsx)(d.default,{href:`/project/${i}/database/replication/replica/${e.identifier}`,children:"View replication"})}),(0,s.jsxs)(an.DropdownMenu,{children:[(0,s.jsx)(an.DropdownMenuTrigger,{children:(0,s.jsx)(g.Button,{type:"default",icon:(0,s.jsx)(ae.MoreVertical,{}),className:"w-7"})}),(0,s.jsxs)(an.DropdownMenuContent,{align:"end",className:"w-52",children:[(0,s.jsxs)(an.DropdownMenuItem,{className:"gap-x-2",disabled:"ACTIVE_HEALTHY"!==l,onClick:()=>x(!0),children:[(0,s.jsx)(at.RotateCcw,{size:14}),(0,s.jsx)("span",{children:"Restart replica"})]}),(0,s.jsx)(an.DropdownMenuSeparator,{}),(0,s.jsxs)(an.DropdownMenuItem,{className:"gap-x-2",disabled:"GOING_DOWN"===l,onClick:()=>y(!0),children:[(0,s.jsx)(ai.Trash,{size:14}),(0,s.jsx)("span",{children:"Drop replica"})]})]})]})]})})]}),(0,s.jsx)(ac.DropReplicaConfirmationModal,{selectedReplica:j?e:void 0,onSuccess:()=>a(),onCancel:()=>y(!1)}),(0,s.jsx)(ad.RestartReplicaConfirmationModal,{selectedReplica:h?e:void 0,onSuccess:()=>a(),onCancel:()=>x(!1)})]})},ax=()=>{let e=(0,R.useQueryClient)(),{ref:i}=(0,t.useParams)(),{hasAccess:n,isLoading:r}=(0,F.useCheckEntitlements)("replication.etl"),l=(0,a.useFlag)("unifiedReplication"),c=(0,u.useRef)(!1),[d,p]=(0,u.useState)(""),[m,h]=(0,u.useState)(5e3),[y,b]=(0,M.useQueryState)("type",(0,M.parseAsStringEnum)(["Read Replica","BigQuery","Analytics Bucket"]).withOptions({history:"push",clearOnDefault:!0})),{data:S=[],error:_,isPending:N,isError:v,isSuccess:w}=(0,sk.useReadReplicasQuery)({projectRef:i},{refetchInterval:m}),I=S.filter(e=>e.identifier!==i),K=w&&I.length>0,U=0===d.length?I:I.filter(e=>e.identifier.includes(d.toLowerCase())),{data:$,error:H,isPending:W,isError:V,isSuccess:G}=(0,D.useReplicationSourcesQuery)({projectRef:i}),X=$?.sources.find(e=>e.name===i)?.id,{data:J,error:ee,isPending:es,isError:ea,isSuccess:et}=(0,C.useReplicationDestinationsQuery)({projectRef:i}),ei=J?.destinations??[],en=et&&J?.destinations.length>0,er=0===d.length?ei??[]:(ei??[]).filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),{data:el,error:eo,isPending:ec,isError:ed,isSuccess:eu}=(0,k.useReplicationPipelinesQuery)({projectRef:i}),ep=W||es||N||r,em=V||ea||v;return(0,u.useEffect)(()=>{i&&!c.current&&el?.pipelines&&el.pipelines.length>0&&eu&&(c.current=!0,el.pipelines.forEach(s=>{s?.id&&e.prefetchQuery({queryKey:A.replicationKeys.pipelinesVersion(i,s.id),queryFn:({signal:e})=>(0,T.fetchReplicationPipelineVersion)({projectRef:i,pipelineId:s.id},e),staleTime:1/0})}))},[i,el?.pipelines,eu,e]),(0,u.useEffect)(()=>{w&&(async()=>{let e=[f.REPLICA_STATUS.ACTIVE_HEALTHY,f.REPLICA_STATUS.ACTIVE_UNHEALTHY,f.REPLICA_STATUS.INIT_READ_REPLICA_FAILED];I.filter(s=>!e.includes(s.status)).length>0||h(!1)})()},[w,I]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(q.Input,{placeholder:"Filter destinations",size:"tiny",icon:(0,s.jsx)(L.Search,{}),value:d,className:"w-full lg:w-52",onChange:e=>p(e.target.value),actions:d.length>0&&(0,s.jsx)(g.Button,{type:"text",icon:(0,s.jsx)(B.X,{}),className:"p-0 h-5 w-5",onClick:()=>p("")})})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(l||!!X)&&(0,s.jsx)(g.Button,{type:"default",icon:(0,s.jsx)(o.Plus,{}),onClick:()=>b("Read Replica"),children:"Add destination"}),(0,s.jsx)(E.DocsButton,{href:`${x.DOCS_URL}/guides/database/replication`})]})]})}),(0,s.jsxs)("div",{className:"w-full overflow-hidden overflow-x-auto flex flex-col gap-y-4",children:[em&&(0,s.jsx)(P.AlertError,{error:H||ee||_,subject:Z.PIPELINE_ERROR_MESSAGES.RETRIEVE_DESTINATIONS}),ep?(0,s.jsx)(Q.GenericSkeletonLoader,{}):l||!G||X?l&&K||en?(0,s.jsx)(j.Card,{children:(0,s.jsx)(j.CardContent,{className:"p-0",children:(0,s.jsxs)(z.Table,{children:[(0,s.jsx)(z.TableHeader,{children:(0,s.jsxs)(z.TableRow,{children:[(0,s.jsx)(z.TableHead,{className:"w-[20px]"},"type"),(0,s.jsx)(z.TableHead,{className:"w-[250px]",children:"Name"},"name"),(0,s.jsx)(z.TableHead,{className:"w-[150px]",children:"Status"},"status"),(0,s.jsx)(z.TableHead,{className:"w-[80px]",children:"Lag"},"lag"),(0,s.jsx)(z.TableHead,{children:"Publication"},"publication"),(0,s.jsx)(z.TableHead,{},"actions")]})}),(0,s.jsxs)(z.TableBody,{children:[l&&U.map(e=>(0,s.jsx)(ah,{replica:e,onUpdateReplica:()=>h(5e3)},e.identifier)),er.map(e=>(0,s.jsx)(ao,{destinationId:e.id},e.id)),!ep&&0===er.length&&0===U.length&&(l&&K||en)&&(0,s.jsx)(z.TableRow,{children:(0,s.jsxs)(z.TableCell,{colSpan:5,children:[(0,s.jsx)("p",{children:"No results found"}),(0,s.jsxs)("p",{className:"text-foreground-light",children:['Your search for "',d,'" did not return any results']})]})})]})]})})}):!ep&&!em&&(0,s.jsxs)("div",{className:(0,O.cn)("w-full","border border-dashed bg-surface-100 border-overlay","flex flex-col px-16 rounded-lg justify-center items-center py-8 mt-4"),children:[(0,s.jsx)("h4",{children:l?"Replication keeps your data in sync across systems":"Create your first destination"}),(0,s.jsx)("p",{className:"text-foreground-light text-sm text-balance text-center mt-1",children:l?"Deploy read replicas for lower latency and better resource management, or capture database changes to external platforms for real-time data pipelines.":"Destinations are external platforms where your database changes are automatically sent. Connect to various data warehouses and analytics platforms to enable real-time data pipelines."}),(0,s.jsx)(g.Button,{icon:(0,s.jsx)(o.Plus,{}),onClick:()=>b("Read Replica"),className:"mt-4",children:"Add destination"})]}):(0,s.jsx)(Y,{hasAccess:n})]}),(0,s.jsx)(sJ,{onSuccessCreateReadReplica:()=>h(5e3)})]})};var ag=e.i(812136),aj=e.i(448710),af=e.i(167892),ay=e.i(908027),ab=e.i(902780),aS=e.i(912793),sP=sP;let a_=({className:e,children:a})=>(0,s.jsx)("div",{style:{width:295},className:(0,O.cn)("flex items-start justify-between p-3 rounded bg-surface-100 border border-default",e),children:a});var aN=e.i(971104);let av=()=>(0,s.jsx)(h.ReactFlowProvider,{children:(0,s.jsx)(aI,{})}),aw={primary:()=>{let{ref:e}=(0,t.useParams)(),{data:a}=(0,sQ.useSelectedProjectQuery)(),{data:i=[]}=(0,sk.useReadReplicasQuery)({projectRef:e}),n=i.some(s=>s.identifier!==e),{data:r}=(0,C.useReplicationDestinationsQuery)({projectRef:e}),l=(r?.destinations??[]).length>0,o=Object.values(sF.AWS_REGIONS).find(e=>e.code===a?.region)?.displayName;return(0,s.jsxs)(a_,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,s.jsx)("p",{className:"text-sm",children:"Primary Database"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[a?.cloud_provider," â€¢ ",o]})]}),!!a&&(0,s.jsx)("img",{alt:"region icon",className:"w-8 rounded-sm mt-0.5",src:`${x.BASE_PATH}/img/regions/${a?.region}.svg`}),(n||l)&&(0,s.jsx)(h.Handle,{type:"source",position:h.Position.Right,className:"opacity-25"})]})},replication:({id:e})=>{let{ref:a}=(0,t.useParams)(),{data:i}=(0,C.useReplicationDestinationsQuery)({projectRef:a}),n=(i?.destinations??[]).find(s=>s.id.toString()===e),{data:r}=(0,k.useReplicationPipelinesQuery)({projectRef:a}),l=(r?.pipelines??[]).find(s=>s.destination_id.toString()===e),{data:o}=(0,et.useReplicationPipelineStatusQuery)({projectRef:a,pipelineId:l?.id},{refetchInterval:X.STATUS_REFRESH_FREQUENCY_MS}),c=(0,Z.getStatusName)(o?.status),d=n?.config??{},u="big_query"in d?"BigQuery":"iceberg"in d?"Analytics Bucket":void 0;return(0,s.jsxs)(a_,{className:"justify-start gap-x-3",children:["BigQuery"===u?(0,s.jsx)(sP.default,{size:20,className:"text-foreground-light"}):"Analytics Bucket"===u?(0,s.jsx)(sR.AnalyticsBucket,{size:20,className:"text-foreground-light"}):null,(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("p",{className:"text-sm",children:n?.name}),(0,s.jsxs)(s3.Tooltip,{children:[(0,s.jsx)(s3.TooltipTrigger,{children:(0,s.jsx)("div",{className:"w-6 h-full flex items-center justify-center",children:(0,s.jsx)("div",{className:(0,O.cn)("w-2 h-2 rounded-full","started"===c?"bg-brand":"failed"===c?"bg-destructive":"bg-selection")})})}),(0,s.jsx)(s3.TooltipContent,{side:"bottom",className:"capitalize",children:c})]})]}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[u," (ID: ",n?.id,")"]})]}),(0,s.jsx)(h.Handle,{type:"target",position:h.Position.Left,className:"opacity-25"})]})},readReplica:({id:e})=>{let{ref:a}=(0,t.useParams)(),{data:i=[]}=(0,sk.useReadReplicasQuery)({projectRef:a}),n=i.find(s=>s.identifier===e),r=Object.values(sF.AWS_REGIONS).find(e=>e.code===n?.region)?.displayName,l=(0,ap.formatDatabaseID)(n?.identifier??""),o=(0,u.useMemo)(()=>(0,am.getStatusLabel)({status:n?.status}),[n?.status]);return(0,s.jsxs)(a_,{className:"justify-start gap-x-3",children:[(0,s.jsx)(sE.Database,{size:20,className:"text-foreground-light"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("p",{className:"text-sm",children:r}),(0,s.jsxs)(s3.Tooltip,{children:[(0,s.jsx)(s3.TooltipTrigger,{children:(0,s.jsx)("div",{className:"w-6 h-full flex items-center justify-center",children:(0,s.jsx)("div",{className:(0,O.cn)("w-2 h-2 rounded-full",n?.status==="ACTIVE_HEALTHY"?"bg-brand":"bg-selection")})})}),(0,s.jsx)(s3.TooltipContent,{side:"bottom",children:o})]})]}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Read Replica (ID: ",l,")"]})]}),(0,s.jsx)(h.Handle,{type:"target",position:h.Position.Left,className:"opacity-25"})]})}},aI=()=>{let e=(0,h.useReactFlow)(),{resolvedTheme:a}=(0,c.useTheme)(),i=(0,R.useQueryClient)(),{ref:n="default"}=(0,t.useParams)(),{data:r=[],isSuccess:l}=(0,sk.useReadReplicasQuery)({projectRef:n}),o=r.filter(e=>e.identifier!==n),{data:d,isSuccess:x}=(0,C.useReplicationDestinationsQuery)({projectRef:n}),g=(0,u.useMemo)(()=>d?.destinations??[],[d]),{data:j}=(0,k.useReplicationPipelinesQuery)({projectRef:n}),f=(0,u.useMemo)(()=>[{id:n,type:"primary",data:{},position:{x:0,y:5}},...o.map(e=>({id:e.identifier,type:"readReplica",data:{},position:{x:0,y:0}})),...g.map(e=>({id:e.id.toString(),type:"replication",data:{},position:{x:0,y:0}}))],[g,n,o]),y=(0,u.useMemo)(()=>[...o.map(e=>{let s="ACTIVE_HEALTHY"===e.status;return{id:`${n}-${e.identifier}`,source:n,target:e.identifier,type:"smoothstep",className:"!cursor-default",animated:s,style:{opacity:s?1:.4,strokeDasharray:s?void 0:"5 5"}}}),...g.map(e=>{let s=(j?.pipelines??[]).find(s=>s.destination_id===e.id),a=i.getQueryData(A.replicationKeys.pipelinesStatus(n,s?.id)),t="started"===(0,Z.getStatusName)(a?.status);return{id:`${n}-${e.id}`,source:n,target:e.id.toString(),type:"smoothstep",className:"!cursor-default",animated:t,style:{opacity:t?1:.4,strokeDasharray:t?void 0:"5 5"}}})],[g,j?.pipelines,n,i,o]),b=async()=>{let s,a=((s=new aN.default.graphlib.Graph).setDefaultEdgeLabel(()=>({})),s.setGraph({rankdir:"LR",ranksep:200,nodesep:0,align:f.length<=2?"UL":void 0}),f.forEach(e=>{s.setNode(e.id,{width:240,height:80})}),y.forEach(e=>s.setEdge(e.source,e.target)),aN.default.layout(s),f.forEach(e=>{let a=s.node(e.id);return e.sourcePosition=h.Position.Right,e.targetPosition=h.Position.Left,e.position={x:a.x-a.width/2,y:a.y-a.height/2},e}),{nodes:f,edges:y});e.setNodes(a.nodes),e.setEdges(a.edges),await (0,sG.timeout)(1),e.fitView({maxZoom:.9,minZoom:.9})};return(0,u.useEffect)(()=>{f.length>0&&x&&l&&b()},[f,x,l]),(0,s.jsx)("div",{className:"nowheel relative min-h-[350px]",children:(0,s.jsx)(p.default,{fitView:!0,fitViewOptions:{minZoom:.9,maxZoom:.9},className:"bg",zoomOnPinch:!1,zoomOnScroll:!1,nodesDraggable:!1,nodesConnectable:!1,zoomOnDoubleClick:!1,edgesFocusable:!1,edgesUpdatable:!1,defaultNodes:[],defaultEdges:[],nodeTypes:aw,proOptions:{hideAttribution:!0},children:(0,s.jsx)(m.Background,{color:"dark"===a?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.4)"})})})},aR=()=>{let{ref:e}=(0,t.useParams)(),i=(0,en.useIsETLPrivateAlpha)(),n=(0,aS.useIsFeatureEnabled)("database:replication"),r=(0,a.useFlag)("unifiedReplication");return n?(0,s.jsx)(s.Fragment,{children:r||i?(0,s.jsxs)(eC.PipelineRequestStatusProvider,{children:[(0,s.jsx)(af.ScaffoldContainer,{children:(0,s.jsx)(af.ScaffoldSection,{isFullWidth:!0,children:(0,s.jsxs)("div",{className:"w-full mb-6",children:[(0,s.jsx)("div",{className:"flex items-center gap-x-2 mb-1",children:(0,s.jsx)("h3",{className:"text-foreground text-xl prose",children:"Replication"})}),(0,s.jsx)("p",{className:"prose text-sm max-w-full",children:r?"Deploy read replicas across multiple regions, or replicate database changes to external data warehouses and analytics platforms":"Automatically replicate your database changes to external data warehouses and analytics platforms in real-time"})]})})}),(0,s.jsx)(av,{}),(0,s.jsx)(af.ScaffoldContainer,{children:(0,s.jsx)(af.ScaffoldSection,{isFullWidth:!0,className:"!pt-6",children:(0,s.jsx)(ax,{})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(af.ScaffoldContainer,{children:(0,s.jsx)(af.ScaffoldSection,{isFullWidth:!0,children:(0,s.jsx)(ay.FormHeader,{className:"[&>div>p]:max-w-full",title:"Replication",description:" Automatically replicate your database changes to external data warehouses and analytics platforms in real-time"})})}),(0,s.jsx)(S,{})]})}):(0,s.jsx)(ab.UnknownInterface,{urlBack:`/project/${e}/database/schemas`})};aR.getLayout=e=>(0,s.jsx)(aj.DefaultLayout,{children:(0,s.jsx)(ag.default,{title:"Database Replication",children:e})}),e.s(["default",0,aR],864504)},288384,(e,s,a)=>{let t="/project/[ref]/database/replication";(window.__NEXT_P=window.__NEXT_P||[]).push([t,()=>e.r(864504)]),s.hot&&s.hot.dispose(function(){window.__NEXT_P.push([t])})}]);

//# debugId=6a452be2-0fe1-cd2f-9d7f-65eddf08f59d
//# sourceMappingURL=bf878f7dd68698ac.js.map