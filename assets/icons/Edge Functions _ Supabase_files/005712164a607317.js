;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="10174d80-9e03-f898-fab0-db5133b691f3")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,823058,e=>{"use strict";var n=e.i(242882),t=e.i(234745),a=e.i(224649);async function r({orgSlug:e},n){if(!e)throw Error("orgSlug is required");let{data:a,error:r}=await (0,t.get)("/platform/integrations/{slug}",{params:{path:{slug:e}}});return r&&(0,t.handleError)(r),a}e.s(["useOrgIntegrationsQuery",0,({orgSlug:e},{enabled:t=!0,...i}={})=>(0,n.useQuery)({queryKey:a.integrationKeys.integrationsListWithOrg(e),queryFn:({signal:n})=>r({orgSlug:e},n),enabled:t&&void 0!==e,staleTime:18e5,...i})])},658036,(e,n,t)=>{var a=e.r(851333);n.exports=e.r(961388)(function(e,n,t){a(e,t,n)})},646767,e=>{"use strict";var n=e.i(991435),t=e.i(416785);let a=(0,n.proxy)({loading:!1,setLoading:e=>{a.loading=e}});e.s(["useIntegrationInstallationSnapshot",0,e=>(0,t.useSnapshot)(a,e)])},692311,e=>{"use strict";var n=e.i(242882),t=e.i(234745),a=e.i(224649);async function r({organization_integration_id:e},n){if(!e)throw Error("organization_integration_id is required");let{data:a,error:r}=await (0,t.get)("/platform/integrations/vercel/projects/{organization_integration_id}",{params:{path:{organization_integration_id:e},query:{limit:1e3}},signal:n});return r&&(0,t.handleError)(r),a.projects}e.s(["useVercelProjectsQuery",0,({organization_integration_id:e},{enabled:t=!0,...i}={})=>(0,n.useQuery)({queryKey:a.integrationKeys.vercelProjectList(e),queryFn:({signal:n})=>r({organization_integration_id:e},n),enabled:t&&void 0!==e,...i})])},407230,e=>{"use strict";var n=e.i(38429),t=e.i(356003),a=e.i(355901),r=e.i(234745),i=e.i(646767),s=e.i(224649);async function o({organizationIntegrationId:e,connection:n}){let{data:t,error:a}=await (0,r.post)("/platform/integrations/vercel/connections",{body:{organization_integration_id:e,connection:{foreign_project_id:n.foreign_project_id,supabase_project_ref:n.supabase_project_ref,metadata:n.metadata}}});return a&&(0,r.handleError)(a),t}e.s(["useIntegrationVercelConnectionsCreateMutation",0,({onSuccess:e,onError:r,...c}={})=>{let l=(0,t.useQueryClient)(),d=(0,i.useIntegrationInstallationSnapshot)();return(0,n.useMutation)({mutationFn:e=>o(e),async onSuccess(n,t,a){await Promise.all([l.invalidateQueries({queryKey:s.integrationKeys.integrationsList()}),l.invalidateQueries({queryKey:s.integrationKeys.integrationsListWithOrg(t.orgSlug)}),l.invalidateQueries({queryKey:s.integrationKeys.vercelProjectList(t.organizationIntegrationId)}),l.invalidateQueries({queryKey:s.integrationKeys.vercelConnectionsList(t.organizationIntegrationId)})]),await e?.(n,t,a)},async onError(e,n,t){d.setLoading(!1),void 0===r?a.toast.error(`Failed to create connection: ${e.message}`):r(e,n,t)},...c})}])},82107,731401,761906,199602,e=>{"use strict";let n=Object.values({POSTGRES_URL:{key:"POSTGRES_URL",type:"encrypted"},POSTGRES_PRISMA_URL:{key:"POSTGRES_PRISMA_URL",type:"encrypted"},POSTGRES_URL_NON_POOLING:{key:"POSTGRES_URL_NON_POOLING",type:"encrypted"},POSTGRES_USER:{key:"POSTGRES_USER",type:"encrypted"},POSTGRES_HOST:{key:"POSTGRES_HOST",type:"encrypted"},POSTGRES_PASSWORD:{key:"POSTGRES_PASSWORD",type:"encrypted"},POSTGRES_DATABASE:{key:"POSTGRES_DATABASE",type:"encrypted"},SUPABASE_ANON_KEY:{key:"SUPABASE_ANON_KEY",type:"encrypted"},SUPABASE_URL:{key:"SUPABASE_URL",type:"encrypted"},SUPABASE_SERVICE_ROLE_KEY:{key:"SUPABASE_SERVICE_ROLE_KEY",type:"encrypted"},SUPABASE_JWT_SECRET:{key:"SUPABASE_JWT_SECRET",type:"encrypted"},NEXT_PUBLIC_SUPABASE_ANON_KEY:{key:"NEXT_PUBLIC_SUPABASE_ANON_KEY",type:"encrypted"},NEXT_PUBLIC_SUPABASE_URL:{key:"NEXT_PUBLIC_SUPABASE_URL",type:"encrypted"}}).map(e=>e.key);e.s(["ENV_VAR_RAW_KEYS",0,n],82107);var t=e.i(478902),a=e.i(370410),r=e.i(88816),i=e.i(479232),s=e.i(860990);e.s(["PlusIcon",()=>s.default],731401);var s=s,o=e.i(271226),c=e.i(389959),l=e.i(355901),d=e.i(726398),u=e.i(427432),m=e.i(722740),h=e.i(164045),p=e.i(912793),g=e.i(265735),x=e.i(10429),f=e.i(519835),j=e.i(681328),y=e.i(210419),b=e.i(587433),_=e.i(837710),S=e.i(703526),v=e.i(917007),w=e.i(920432),C=e.i(549815),N=e.i(911509),I=e.i(996960),A=e.i(866205),P=e.i(793912),E=e.i(135144),k=e.i(689805),R=e.i(843778);e.s(["default",0,({slug:e,organizationIntegrationId:n,foreignProjects:F,onCreateConnections:T,installedConnections:L=j.EMPTY_ARR,isLoading:O,integrationIcon:D,getForeignProjectIcon:V,choosePrompt:G="Choose a project",onSkip:B,loadingForeignProjects:z,showNoEntitiesState:$=!0,defaultSupabaseProjectRef:H,defaultForeignProjectId:M,mode:Q})=>{let U=(0,o.useRouter)(),W=(0,p.useIsFeatureEnabled)("projects:create"),[K,q]=(0,c.useState)(!1),[Y,X]=(0,c.useState)(!1),[Z,J]=(0,c.useState)(M),[ee,en]=(0,c.useState)(H),{data:et}=(0,g.useSelectedOrganizationQuery)(),{data:ea,isPending:er}=(0,m.useOrgProjectsInfiniteQuery)({slug:e}),ei=ea?.pages[0].pagination.count??0;(0,c.useEffect)(()=>{void 0!==H&&void 0===ee&&en(H)},[H,ee]),(0,c.useEffect)(()=>{void 0!==M&&void 0===Z&&J(M)},[M,Z]);let es=new Set(L.map(e=>e.foreign_project_id)),{data:eo}=(0,h.useProjectDetailQuery)({ref:ee}),ec=Z?F.find(e=>e.id?.toLowerCase()===Z?.toLowerCase()):void 0,el=({children:e,className:n,...a})=>(0,t.jsx)("div",{className:(0,R.cn)("flex-1 min-w-0 flex flex-col grow gap-6 px-5 mx-auto w-full justify-center items-center",n),...a,children:e}),ed=0===ei,eu=0===F.length,em=ed?"Supabase":Q,eh=ed?Q:"Supabase";return(0,t.jsxs)("div",{className:"flex flex-col bg border shadow rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"relative p-12 border-b border-muted",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-grid-black/5 [mask-image:linear-gradient(0deg,#fff,rgba(255,255,255,0.6))] dark:bg-grid-white/5 dark:[mask-image:linear-gradient(0deg,rgba(255,255,255,0.1),rgba(255,255,255,0.5))]",style:{backgroundPosition:"10px 10px"}}),z?(0,t.jsxs)("div",{className:"w-1/2 mx-auto space-y-2 py-4",children:[(0,t.jsx)("p",{className:"text-sm text-foreground text-center",children:"Loading projects"}),(0,t.jsx)(u.default,{active:!0})]}):$&&(ed||eu)?(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("h5",{className:"text-foreground",children:["No ",em," Projects found"]}),(0,t.jsxs)("p",{className:"text-foreground-light text-sm",children:["You will need to create a ",em," Project to link to a ",eh," ","Project.",(0,t.jsx)("br",{}),"You can skip this and create a Project Connection later."]})]}):(0,t.jsxs)("div",{className:"flex justify-center gap-0 w-full relative",children:[(0,t.jsxs)(el,{children:[(0,t.jsx)("div",{className:"bg-white shadow border rounded p-1 w-12 h-12 flex justify-center items-center",children:(0,t.jsx)("img",{src:`${x.BASE_PATH}/img/supabase-logo.svg`,alt:"Supabase",className:"w-6"})}),(0,t.jsx)(d.OrganizationProjectSelector,{sameWidthAsTrigger:!0,open:K,setOpen:q,slug:e,selectedRef:ee,onSelect:e=>{en(e.ref),q(!1)},renderRow:e=>(0,t.jsxs)("div",{className:(0,R.cn)("w-full flex items-center justify-between"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)("div",{className:"bg-white shadow border rounded p-1 w-6 h-6 flex justify-center items-center",children:(0,t.jsx)("img",{src:`${x.BASE_PATH}/img/supabase-logo.svg`,alt:"Supabase",className:"w-4"})}),(0,t.jsx)("p",{children:e.name}),"INACTIVE"===e.status&&(0,t.jsx)(b.Badge,{children:"Paused"}),"GOING_DOWN"===e.status&&(0,t.jsx)(b.Badge,{children:"Pausing"})]}),e.ref===ee&&(0,t.jsx)(a.Check,{size:16})]}),renderTrigger:()=>(0,t.jsx)(_.Button,{type:"default",block:!0,disabled:void 0!==H||er,loading:er,className:"justify-between h-[34px]",iconRight:void 0===H?(0,t.jsx)("span",{className:"grow flex justify-end",children:(0,t.jsx)(r.ChevronDown,{})}):null,children:(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)("div",{className:"bg-white shadow border rounded p-1 w-6 h-6 flex justify-center items-center",children:(0,t.jsx)("img",{src:`${x.BASE_PATH}/img/supabase-logo.svg`,alt:"Supabase",className:"w-4"})}),eo?eo.name:"Choose Supabase Project"]})}),renderActions:()=>W&&(0,t.jsx)(v.CommandGroup_Shadcn_,{children:(0,t.jsx)(C.CommandItem_Shadcn_,{className:"cursor-pointer w-full",onSelect:()=>{q(!1),U.push(`/new/${et?.slug}`)},onClick:()=>q(!1),children:(0,t.jsxs)(y.default,{href:`/new/${et?.slug}`,onClick:()=>{q(!1)},className:"w-full flex items-center gap-2",children:[(0,t.jsx)(i.Plus,{size:14,strokeWidth:1.5}),(0,t.jsx)("p",{children:"Create a new project"})]})})})})]}),(0,t.jsx)("div",{className:"border border-foreground-lighter h-px w-8 border-dashed self-end mb-4"}),(0,t.jsxs)(el,{children:[(0,t.jsx)("div",{className:"bg-black shadow rounded p-1 w-12 h-12 flex justify-center items-center",children:D}),(0,t.jsxs)(k.Popover_Shadcn_,{open:Y,onOpenChange:X,children:[(0,t.jsx)(E.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(_.Button,{type:"default",block:!0,disabled:z,loading:z,className:"justify-start h-[34px]",icon:(0,t.jsx)("div",{children:ec?V?.(ec)??D:D}),iconRight:(0,t.jsx)("span",{className:"grow flex justify-end",children:(0,t.jsx)(r.ChevronDown,{})}),children:(ec&&ec.name)??G})}),(0,t.jsx)(P.PopoverContent_Shadcn_,{className:"p-0",side:"bottom",align:"center",sameWidthAsTrigger:!0,children:(0,t.jsxs)(A.Command_Shadcn_,{children:[(0,t.jsx)(w.CommandInput_Shadcn_,{placeholder:"Search for a project"}),(0,t.jsxs)(N.CommandList_Shadcn_,{className:"!max-h-[170px]",children:[(0,t.jsx)(S.CommandEmpty_Shadcn_,{children:"No results found."}),(0,t.jsxs)(v.CommandGroup_Shadcn_,{children:[F.map((e,n)=>(0,t.jsxs)(C.CommandItem_Shadcn_,{value:`${e.name.replaceAll('"',"")}-${n}`,className:"flex gap-2 items-center",onSelect:()=>{e.id&&J(e.id),X(!1)},children:[(0,t.jsx)("div",{children:V?.(e)??D}),(0,t.jsx)("span",{className:"truncate",title:e.name,children:e.name})]},e.id)),0===F.length&&(0,t.jsx)(S.CommandEmpty_Shadcn_,{children:"No results found."})]}),"GitHub"===Q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.CommandSeparator_Shadcn_,{}),(0,t.jsx)(v.CommandGroup_Shadcn_,{children:(0,t.jsxs)(C.CommandItem_Shadcn_,{className:"flex gap-2 items-center cursor-pointer",onSelect:()=>(0,f.openInstallGitHubIntegrationWindow)("install"),children:[(0,t.jsx)(s.default,{size:16}),"Add GitHub Repositories"]})})]})]})]})})]})]})]})]}),(0,t.jsxs)("div",{className:"flex w-full justify-end gap-2 p-4 bg-surface-75",children:[void 0!==B&&(0,t.jsx)(_.Button,{size:"medium",type:"default",onClick:()=>{B()},children:"Skip"}),(0,t.jsx)(_.Button,{size:"medium",className:"self-end",onClick:function(){return ec?.id?eo?.ref?es.has(Z??"")?l.toast.error(`Unable to connect to ${ec.name}: Selected repository already has an installed connection to a project`):void T({organizationIntegrationId:n,connection:{foreign_project_id:ec?.id,supabase_project_ref:eo?.ref,integration_id:"0",metadata:{...ec}},orgSlug:et?.slug,new:{installation_id:ec.installation_id,project_ref:eo.ref,repository_id:Number(ec.id)}}):console.error("No Supabase project ref set"):console.error("No Foreign project ID set")},loading:O,disabled:z||er||O||!eo||!ec,children:"Connect project"})]})]})}],761906);var F=e.i(667042);let T=(0,t.jsx)("div",{className:"flex items-center justify-center rounded bg-black p-1",children:(0,t.jsx)("svg",{className:"m-auto fill-current text-white",width:"12px",height:"12px",viewBox:"0 0 1155 1000",children:(0,t.jsx)("path",{d:"M577.344 0L1154.69 1000H0L577.344 0Z"})})});F.Database,e.s(["vercelIcon",0,T],199602)},92769,e=>{"use strict";var n=e.i(234745);e.i(56031);var t=e.i(237948);function a(e){return null!=e&&!(e instanceof t.ResponseError)&&("object"!=typeof e||!("error"in e)||!e.error)}async function r(e,a=!0){let i=await (0,n.fetchHandler)(e);if(!i.ok)return{error:new t.ResponseError(i.statusText,i.status)};try{return a?await i.json():await i.text()}catch(e){return{error:new t.ResponseError(e.message,500)}}}async function i(e){if(!e)return null;let[,,,n,t,,i,...s]=e?.split("/")??[],o=s.join("/"),c=`https://api.github.com/repos/${n}/${t}/contents/${o}`,l=`${c}/supabase?ref=${i}`,d=`${c}/supabase/migrations${i?`?ref=${i}`:""}`,[u,m]=await Promise.all([r(l),r(d)]);if(!a(u))return console.warn(`Failed to fetch supabase files from GitHub: ${u.error}`),null;if(!a(m))return console.warn(`Failed to fetch migration files from GitHub: ${m.error}`),null;let h=u.find(e=>"seed.sql"===e.name)?.download_url,p=m.sort((e,n)=>e.name<n.name?-1:+(e.name>n.name)),g=p.map(e=>r(e.download_url,!1)),[x,...f]=await Promise.all([h?r(h,!1):Promise.resolve(""),...g]),j=f.filter(e=>a(e)).join(";"),y=a(x)?x:"",b=`
    create schema if not exists supabase_migrations;
    create table if not exists supabase_migrations.schema_migrations (
      version text not null primary key,
      statements text[],
      name text
    );
    ${p.map((e,n)=>{let t=f[n];if(!a(t))return"";let r=e.name.split("_")[0],i=JSON.stringify(t.split(";").map(e=>e.trim()).filter(Boolean));return`
        insert into supabase_migrations.schema_migrations (version, statements, name)
        select '${r}', array_agg(jsonb_statements)::text[], '${e.name}'
        from jsonb_array_elements_text($statements$${i}$statements$::jsonb) as jsonb_statements;
      `}).join("")}
  `;return`${j};${b};${y}`}function s(e){var n,t;return"Vercel"===e.integration.name?(n=e,`https://vercel.com/dashboard/${n.metadata?.account.type==="Team"?`${n.metadata?.account.team_slug}/`:""}integrations/${n.metadata?.configuration_id}`):"GitHub"===e.integration.name?(t=e,`https://github.com/${t.metadata?.account.type==="Organization"?`organizations/${t.metadata?.account.name}/`:""}settings/installations/${t.metadata?.installation_id}`):""}e.i(10429),e.i(892354),e.s(["getInitialMigrationSQLFromGitHubRepo",()=>i,"getIntegrationConfigurationUrl",()=>s],92769)},611991,e=>{"use strict";var n=e.i(242882),t=e.i(234745),a=e.i(224649);async function r(e){let{data:n,error:a}=await (0,t.get)("/platform/integrations/github/authorization",{signal:e});return a?null:n}e.s(["useGitHubAuthorizationQuery",0,({enabled:e=!0,...t}={})=>(0,n.useQuery)({queryKey:a.integrationKeys.githubAuthorization(),queryFn:({signal:e})=>r(e),enabled:e,staleTime:0,...t})])},783387,541881,859202,e=>{"use strict";var n=e.i(478902),t=e.i(88816),a=e.i(774803),r=e.i(61187),i=e.i(211570),s=e.i(210419),o=e.i(271226),c=e.i(389959),l=e.i(355901),d=e.i(55956),u=e.i(710377),m=e.i(17203),h=e.i(398696),p=e.i(776452),g=e.i(592383),x=e.i(215312),f=e.i(164045),j=e.i(10429),y=e.i(92769),b=e.i(587433),_=e.i(837710),S=e.i(843778);let v=({type:e,className:t})=>{switch(e){case"GitHub":return(0,n.jsx)(h.Github,{strokeWidth:2,size:14});case"Vercel":return(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",viewBox:"0 0 512 512",className:(0,S.cn)("w-3.5",t),children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M256,48,496,464H16Z"})});case"Supabase":return(0,n.jsx)("img",{src:`${j.BASE_PATH}/img/supabase-logo.svg`,alt:"Supabase",className:"w-3.5"});default:return(0,n.jsx)(n.Fragment,{})}},w=({src:e})=>(0,n.jsx)("div",{className:"relative border shadow-lg w-8 h-8 rounded-full overflow-hidden",children:(0,n.jsx)(p.default,{src:e||"",width:30,height:30,layout:"fill",alt:"avatar",className:"relative"})}),C=(0,c.forwardRef)(({integration:e,disabled:t,...a},r)=>(0,n.jsxs)("li",{ref:r,className:"bg-surface-100 border shadow-sm flex justify-between items-center px-8 py-4 rounded-lg",...a,children:[(0,n.jsxs)("div",{className:"flex gap-6 items-center",children:[(0,n.jsx)("div",{className:"flex gap-3 items-center",children:(0,n.jsxs)("div",{className:"flex -space-x-1",children:[(0,n.jsx)(()=>(0,n.jsx)("div",{className:"bg-black text-white w-8 h-8 rounded flex items-center justify-center",children:(0,n.jsx)(v,{type:e.integration.name})}),{}),(0,n.jsx)(w,{src:e?.metadata?.account.avatar})]})}),(0,n.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-foreground text-sm font-medium",children:e.metadata?.account.name||void 0!==e.metadata&&"gitHubConnectionOwner"in e.metadata&&e.metadata?.gitHubConnectionOwner}),(0,n.jsx)(b.Badge,{children:e.metadata?.account.type})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,n.jsxs)("span",{className:"text-foreground-lighter text-xs",children:["Created ",(0,d.default)(e.inserted_at).fromNow()]}),(0,n.jsxs)("span",{className:"text-foreground-lighter text-xs",children:["Added by ",e?.added_by?.primary_email]})]})]})]}),(0,n.jsx)(_.Button,{asChild:!0,disabled:t,type:"default",iconRight:(0,n.jsx)(m.ExternalLink,{}),children:t?(0,n.jsx)("p",{children:"Manage"}):(0,n.jsx)(s.default,{href:(0,y.getIntegrationConfigurationUrl)(e),target:"_blank",rel:"noopener noreferrer",children:"Manage"})})]},e.id)),N=(0,c.forwardRef)(({connection:e,type:t,actions:a,showNode:r=!0,orientation:i="horizontal",className:s,...o},c)=>{let{data:l}=(0,f.useProjectDetailQuery)({ref:e.supabase_project_ref});return(0,n.jsxs)("li",{ref:c,...o,className:(0,S.cn)(r&&"pl-8 ml-6 border-l border-muted","relative"),children:[r&&(0,n.jsx)("div",{className:"absolute w-8 rounded-bl-full border-b border-l border-muted h-10 -left-px"}),(0,n.jsxs)("div",{className:(0,S.cn)("horizontal"===i?"flex items-center justify-between gap-2":"flex flex-col gap-3","bg-surface-100 border shadow-sm px-6 py-4 rounded-lg",s),children:[(0,n.jsxs)("div",{className:"flex flex-col gap-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex-shrink-0 flex gap-x-2 items-center max-w-40 ",children:[(0,n.jsx)(v,{type:"Supabase"}),(0,n.jsx)("span",{title:l?.name,className:"text-sm truncate",children:l?.name})]}),(0,n.jsx)(u.ArrowRight,{size:14,className:"flex-shrink-0 text-foreground-lighter",strokeWidth:1.5}),(0,n.jsxs)("div",{className:"flex-1 min-w-0 flex gap-2 items-center",children:[e?.metadata?.framework?(0,n.jsx)("img",{src:`${j.BASE_PATH}/img/icons/frameworks/${e.metadata.framework}.svg`,width:21,height:21,alt:"icon"}):(0,n.jsx)("div",{className:"bg-black text-white w-4 h-4 rounded flex items-center justify-center",children:(0,n.jsx)(v,{type:t,className:"!w-2.5"})}),"GitHub"===t?(0,n.jsx)("a",{title:e.metadata.name,href:`https://github.com/${e.metadata?.name}`,className:"text-sm truncate",target:"_blank",rel:"noreferrer",children:e.metadata?.name}):(0,n.jsx)("span",{title:e.metadata.name,className:"text-sm truncate",children:e.metadata?.name})]})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,n.jsxs)("span",{className:"text-foreground-lighter text-xs",children:["Connected ",(0,d.default)(e?.inserted_at).fromNow()]}),(0,n.jsxs)("span",{className:"text-foreground-lighter text-xs",children:["Added by ",e?.added_by?.primary_email]})]})]}),(0,n.jsx)("div",{className:"flex-shrink-0",children:a})]})]},e.id)}),I=(0,c.forwardRef)(({connection:e,type:t,...a},r)=>{let{data:i}=(0,f.useProjectDetailQuery)({ref:e.supabase_project_ref});return(0,n.jsxs)("li",{ref:r,...a,className:(0,S.cn)("bg-surface-100 border shadow-sm flex justify-between items-center px-8 py-4 rounded-lg"),children:[(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,n.jsx)(v,{type:"Supabase"}),(0,n.jsx)("span",{className:"text-sm",children:i?.name}),(0,n.jsx)(u.ArrowRight,{size:14,className:"text-foreground-lighter",strokeWidth:1.5}),(0,n.jsx)(v,{type:t}),(0,n.jsx)("span",{className:"text-sm",children:e.metadata.name})]}),(0,n.jsxs)("span",{className:"text-foreground-lighter text-xs",children:["Connected ",(0,d.default)(e.inserted_at).fromNow()]})]}),(0,n.jsx)(_.Button,{type:"default",children:"Connect"})]},e.id)}),A=(0,c.forwardRef)(({className:e,showNode:t=!0,onClick:a,disabled:r,...i},s)=>(0,n.jsxs)("div",{ref:s,...i,className:(0,S.cn)(t&&"ml-6 pl-8 mt-4 border-l","relative pb-2","last:border-l-transparent",e),children:[t&&(0,n.jsx)("div",{className:"absolute w-8 rounded-bl-full border-b border-l border-muted h-14 -top-4 -left-px"}),(0,n.jsx)("div",{className:(0,S.cn)("w-full","border border-dashed bg-surface-100 border-overlay","flex h-20 px-10 rounded-lg justify-center items-center"),children:(0,n.jsx)(x.ButtonTooltip,{type:"default",disabled:r,onClick:()=>a(),tooltip:{content:{side:"bottom",text:r?"Additional permissions required to add connection":void 0}},children:"Add new project connection"})})]})),P=(0,c.forwardRef)(({className:e,markdown:t="",showNode:a=!0,...r},i)=>(0,n.jsxs)("div",{...r,ref:i,className:(0,S.cn)(a&&"border-l border-muted ml-6 pl-8","py-4 prose text-sm",e),children:[r.title&&(0,n.jsx)("h5",{className:"text-foreground",children:r.title}),(0,n.jsx)(g.Markdown,{content:t})]}));C.displayName="IntegrationInstallation",N.displayName="IntegrationConnection",P.displayName="IntegrationConnectionHeader",A.displayName="EmptyIntegrationConnection",I.displayName="IntegrationConnectionOption",e.s(["EmptyIntegrationConnection",0,A,"IntegrationConnection",0,N,"IntegrationConnectionHeader",0,P,"IntegrationInstallation",0,C],541881);var E=e.i(38429),k=e.i(234745);async function R({connectionId:e}){let{data:n,error:t}=await (0,k.post)("/platform/integrations/vercel/connections/{connection_id}/sync-envs",{params:{path:{connection_id:e}}});return t&&(0,k.handleError)(t),n}var F=e.i(265735),T=e.i(874311),L=e.i(466472);let O=(0,c.forwardRef)(({disabled:e,onDeleteConnection:d,...u},m)=>{let h=(0,o.useRouter)(),{data:p}=(0,F.useSelectedOrganizationQuery)(),{type:g,connection:j}=u,{data:y}=(0,f.useProjectDetailQuery)({ref:j.supabase_project_ref}),b=y?.is_branch_enabled===!0,[S,v]=(0,c.useState)(!1),[w,C]=(0,c.useState)(!1),[I,A]=(0,c.useState)(!1),P=(0,c.useCallback)(async()=>{try{C(!0),await d(j)}catch(e){}finally{C(!1),v(!1)}},[j,d]),k=(0,c.useCallback)(()=>{v(!1)},[]),{mutate:O,isPending:D}=(({onSuccess:e,onError:n,...t}={})=>(0,E.useMutation)({mutationFn:e=>R(e),async onSuccess(n,t,a){await e?.(n,t,a)},async onError(e,t,a){void 0===n?l.toast.error(`Failed to sync environment variables: ${e.message}`):n(e,t,a)},...t}))({onSuccess:()=>{l.toast.success("Successfully synced environment variables"),A(!1)}}),V=(0,c.useCallback)(async()=>{O({connectionId:j.id})},[j,O]),G="/project/[ref]/settings/integrations";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(N,{showNode:!1,actions:e?(0,n.jsx)(x.ButtonTooltip,{disabled:!0,iconRight:(0,n.jsx)(t.ChevronDown,{size:14}),type:"default",tooltip:{content:{side:"bottom",text:"You need additional permissions to manage this connection"}},children:"Manage"}):(0,n.jsxs)(T.DropdownMenu,{open:I,onOpenChange:()=>A(!I),modal:!1,children:[(0,n.jsx)(T.DropdownMenuTrigger,{asChild:!0,children:(0,n.jsx)(_.Button,{iconRight:(0,n.jsx)(t.ChevronDown,{size:14}),type:"default",children:(0,n.jsx)("span",{children:"Manage"})})}),(0,n.jsxs)(T.DropdownMenuContent,{side:"bottom",align:"end",children:[h.pathname!==G&&(0,n.jsx)(T.DropdownMenuItem,{asChild:!0,children:(0,n.jsx)(s.default,{href:G.replace("[ref]",j.supabase_project_ref),children:"Configure connection"})}),"Vercel"===g&&p?.managed_by!=="vercel-marketplace"&&(0,n.jsxs)(T.DropdownMenuItem,{className:"space-x-2",onSelect:e=>{e.preventDefault(),V()},disabled:D,children:[D?(0,n.jsx)(a.Loader2,{className:"animate-spin",size:14}):(0,n.jsx)(r.RefreshCw,{size:14}),(0,n.jsx)("p",{children:"Resync environment variables"})]}),("Vercel"===g&&p?.managed_by!=="vercel-marketplace"||h.pathname!==G)&&(0,n.jsx)(T.DropdownMenuSeparator,{}),(0,n.jsxs)(T.DropdownMenuItem,{className:"space-x-2",onSelect:()=>v(!0),children:[(0,n.jsx)(i.Trash,{size:14}),(0,n.jsx)("p",{children:"Delete connection"})]})]})]}),...u}),(0,n.jsx)(L.default,{variant:"destructive",size:"GitHub"===g&&b?"medium":"small",visible:S,title:`Confirm to delete ${g} connection`,confirmLabel:"Delete connection",onCancel:k,onConfirm:P,loading:w,children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Deleting this GitHub connection will stop automatic creation and merging of preview branches. Existing preview branches will remain unchanged."})})]})});O.displayName="IntegrationConnectionItem",e.s(["IntegrationConnectionItem",0,O],783387);var D=e.i(356003),V=e.i(224649);async function G({organization_integration_id:e,id:n},t){if(!e)throw Error("organization_integration_id is required");let{data:a,error:r}=await (0,k.del)("/platform/integrations/vercel/connections/{connection_id}",{params:{path:{connection_id:n}},signal:t});return r&&(0,k.handleError)(r),a}e.s(["useIntegrationsVercelInstalledConnectionDeleteMutation",0,({onSuccess:e,onError:n,...t}={})=>{let a=(0,D.useQueryClient)();return(0,E.useMutation)({mutationFn:e=>G(e),async onSuccess(n,t,r){await Promise.all([a.invalidateQueries({queryKey:V.integrationKeys.integrationsList()}),a.invalidateQueries({queryKey:V.integrationKeys.integrationsListWithOrg(t.orgSlug)}),a.invalidateQueries({queryKey:V.integrationKeys.vercelProjectList(t.organization_integration_id)}),a.invalidateQueries({queryKey:V.integrationKeys.vercelConnectionsList(t.organization_integration_id)})]),await e?.(n,t,r)},async onError(e,t,a){void 0===n?l.toast.error(`Failed to delete Vercel connection: ${e.message}`):n(e,t,a)},...t})}],859202)},325556,417738,375401,170958,386118,e=>{"use strict";var n=e.i(478902),t=e.i(658036),a=e.i(389959),r=e.i(355901);e.i(128328);var i=e.i(158639),s=e.i(82107),o=e.i(761906),c=e.i(592383),l=e.i(199602),d=e.i(823058),u=e.i(407230),m=e.i(692311),h=e.i(265735),p=e.i(10429),g=e.i(681328),x=e.i(991435),f=e.i(416785);let j=(0,x.proxy)({vercelConnectionsOpen:!1,setVercelConnectionsOpen:e=>{j.vercelConnectionsOpen=e},vercelConnectionsIntegrationId:void 0,setVercelConnectionsIntegrationId:e=>{j.vercelConnectionsIntegrationId=e}}),y=e=>(0,f.useSnapshot)(j,e);e.s(["useSidePanelsStateSnapshot",0,y],417738);var b=e.i(539013);let _=(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",viewBox:"0 0 512 512",className:"w-6",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M256,48,496,464H16Z"})}),S=()=>{let{ref:e}=(0,i.useParams)(),{data:x}=(0,h.useSelectedOrganizationQuery)(),f=y(),j=f.vercelConnectionsIntegrationId,{data:S}=(0,d.useOrgIntegrationsQuery)({orgSlug:x?.slug}),v=S?.filter(e=>"Vercel"===e.integration.name),w=v?.find(e=>e.id===j),{data:C}=(0,m.useVercelProjectsQuery)({organization_integration_id:j},{enabled:void 0!==j}),N=(0,a.useMemo)(()=>C??g.EMPTY_ARR,[C]),I=(0,a.useMemo)(()=>(0,t.default)(N,"id"),[N]),A=(0,a.useCallback)(e=>{let t=I[e.id];return t?.framework?(0,n.jsx)("img",{src:`${p.BASE_PATH}/img/icons/frameworks/${t.framework}.svg`,width:21,height:21,alt:"icon"}):l.vercelIcon},[I]),{mutate:P,isPending:E}=(0,u.useIntegrationVercelConnectionsCreateMutation)({async onSuccess({env_sync_error:e}){e&&r.toast.error(`Failed to sync environment variables: ${e.message}. Please try re-syncing manually from settings.`),f.setVercelConnectionsOpen(!1)}}),k=(0,a.useCallback)(e=>{P({...e,connection:{...e.connection,metadata:{...e.connection.metadata,supabaseConfig:{projectEnvVars:{write:!0}}}}})},[P]);return(0,n.jsx)(b.SidePanel,{hideFooter:!0,size:"large",header:"Add new Vercel project connection",visible:f.vercelConnectionsOpen,onCancel:()=>f.setVercelConnectionsOpen(!1),children:(0,n.jsxs)("div",{className:"py-6 flex flex-col gap-6 bg-studio h-full",children:[(0,n.jsx)(b.SidePanel.Content,{children:(0,n.jsx)(c.Markdown,{content:`
### Choose repository to connect to

Check the details below before proceeding
          `})}),(0,n.jsxs)(b.SidePanel.Content,{className:"flex flex-col gap-2",children:[(0,n.jsx)(o.default,{slug:x?.slug,defaultSupabaseProjectRef:e,organizationIntegrationId:w?.id,foreignProjects:N,onCreateConnections:k,installedConnections:w?.connections,isLoading:E,integrationIcon:_,getForeignProjectIcon:A,choosePrompt:"Choose Vercel Project",mode:"Vercel"}),(0,n.jsx)(c.Markdown,{content:`
The following environment variables will be added:

${s.ENV_VAR_RAW_KEYS.map(e=>`
 - \`${e}\``)}
`})]}),(0,n.jsx)(b.SidePanel.Content,{children:(0,n.jsx)("ul",{children:(0,n.jsx)("li",{className:"border px-10"})})})]})})};e.s(["SidePanelVercelProjectLinker",0,S,"default",0,S],325556),e.s(["AWSPrivateLinkSection",()=>er],375401);var v=e.i(167892),w=e.i(548760),C=e.i(235458),N=e.i(38429),I=e.i(356003),A=e.i(234745);let P=e=>["projects",e,"aws-accounts"];async function E({projectRef:e,awsAccountId:n}){let{data:t,error:a}=await (0,A.del)("/platform/projects/{ref}/privatelink/associations/aws-account/{aws_account_id}",{params:{path:{ref:e,aws_account_id:n}}});return a&&(0,A.handleError)(a),t}var k=e.i(242882);async function R({projectRef:e},n){if(!e)throw Error("Project ref is required");let{data:t,error:a}=await (0,A.get)("/platform/projects/{ref}/privatelink/associations",{params:{path:{ref:e}},signal:n});return a&&(0,A.handleError)(a),t.private_link_associations}var F=e.i(280590),T=e.i(635494),L=e.i(837710),O=e.i(627069),D=e.i(843778),V=e.i(466472),G=e.i(979078),B=e.i(53071),z=e.i(471998),$=e.i(211570),H=e.i(587433),M=e.i(874311);let Q=({aws_account_id:e,account_name:t,status:a,onEdit:r,onDelete:i})=>(0,n.jsxs)(O.CardContent,{className:"flex items-center justify-between text-sm gap-4",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{children:e}),(0,n.jsx)("div",{className:"text-sm text-foreground-lighter",children:t||"No description"})]}),(()=>{switch(a){case"ASSOCIATION_ACCEPTED":return(0,n.jsx)(H.Badge,{variant:"success",children:"Connected"});case"READY":return(0,n.jsx)(H.Badge,{variant:"success",children:"Ready"});case"CREATING":return(0,n.jsx)(H.Badge,{variant:"warning",children:"Creating"});case"DELETING":return(0,n.jsx)(H.Badge,{variant:"destructive",children:"Deleting"});case"ASSOCIATION_REQUEST_EXPIRED":return(0,n.jsx)(H.Badge,{variant:"destructive",children:"Expired"});case"CREATION_FAILED":return(0,n.jsx)(H.Badge,{variant:"destructive",children:"Failed"});default:return(0,n.jsx)(H.Badge,{children:"Unknown"})}})(),(0,n.jsxs)(M.DropdownMenu,{children:[(0,n.jsx)(M.DropdownMenuTrigger,{asChild:!0,children:(0,n.jsx)(L.Button,{type:"text",className:"px-1",icon:(0,n.jsx)(z.MoreVertical,{})})}),(0,n.jsxs)(M.DropdownMenuContent,{align:"end",className:"w-40",children:[(0,n.jsxs)(M.DropdownMenuItem,{onClick:r,className:"gap-x-2",children:[(0,n.jsx)(B.Edit,{size:14}),(0,n.jsx)("span",{children:"View account"})]}),(0,n.jsx)(M.DropdownMenuSeparator,{}),(0,n.jsxs)(M.DropdownMenuItem,{onClick:i,className:"gap-x-2",children:[(0,n.jsx)($.Trash,{size:14}),(0,n.jsx)("span",{children:"Delete account"})]})]})]})]});var U=e.i(210419),W=e.i(408891),K=e.i(937942);async function q({projectRef:e,awsAccountId:n,accountName:t}){let{data:a,error:r}=await (0,A.post)("/platform/projects/{ref}/privatelink/associations/aws-account",{params:{path:{ref:e}},body:{aws_account_id:n,account_name:t}});return r&&(0,A.handleError)(r),a}var Y=e.i(24315),X=e.i(61863),Z=e.i(428353),J=e.i(378277),ee=e.i(725137),en=e.i(710483),et=e.i(538482);let ea=({account:e,open:t,onOpenChange:i})=>{let s=!e,{data:o}=(0,T.useSelectedProjectQuery)(),{mutate:c,isPending:l}=(({onSuccess:e,onError:n,...t}={})=>{let a=(0,I.useQueryClient)();return(0,N.useMutation)({mutationFn:e=>q(e),async onSuccess(n,t,r){let{projectRef:i}=t;await a.invalidateQueries({queryKey:P(i)}),await e?.(n,t,r)},async onError(e,t,a){void 0===n?r.toast.error(`Failed to create AWS account: ${e.message}`):n(e,t,a)},...t})})(),d=(0,W.useForm)({defaultValues:{awsAccountId:e?.aws_account_id??"",accountName:e?.account_name??""}}),u=e?.status==="ASSOCIATION_ACCEPTED"?"This connection is active":e?.status==="READY"?"Connection is ready":e?.status==="CREATING"?"This account connection is being created":e?.status==="DELETING"?"This account is being deleted":e?.status==="ASSOCIATION_REQUEST_EXPIRED"?"Account acceptance request has expired":e?.status==="CREATION_FAILED"?"Failed to create account":"This account needs to be accepted by the AWS account owner.",m=e?.status==="ASSOCIATION_ACCEPTED"?"The resource share has been accepted by the AWS account owner and the connection is established.":e?.status==="READY"?"It may be waiting acceptance from the AWS account owner. Association requests are automatically deleted if not accepted within 12 hours.":e?.status==="ASSOCIATION_REQUEST_EXPIRED"||e?.status==="CREATION_FAILED"?"Reconnect this account to initiate a new connection request":"";return(0,a.useEffect)(()=>{d.reset({awsAccountId:e?.aws_account_id??"",accountName:e?.account_name??""})},[e,d]),(0,n.jsx)(ee.Sheet,{open:t,onOpenChange:i,children:(0,n.jsxs)(ee.SheetContent,{className:"flex flex-col gap-0",children:[(0,n.jsxs)(ee.SheetHeader,{children:[(0,n.jsx)(ee.SheetTitle,{children:s?"Add AWS Account":"AWS Account Details"}),(0,n.jsxs)(ee.SheetDescription,{children:["Connect to your Supabase project from your AWS VPC using AWS PrivateLink."," ",(0,n.jsx)(K.InlineLink,{href:`${p.DOCS_URL}/guides/platform/privatelink`,children:"Learn more"})]})]}),(0,n.jsx)(Z.Form_Shadcn_,{...d,children:(0,n.jsxs)("form",{onSubmit:d.handleSubmit(e=>{o&&s&&c({projectRef:o.ref,awsAccountId:e.awsAccountId,accountName:e.accountName},{onSuccess:()=>{r.toast.success("Successfully added AWS account"),i(!1)}})}),className:"flex flex-col flex-1",children:[(0,n.jsxs)(ee.SheetSection,{className:"space-y-4 flex-1",children:[!s&&e&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(en.Admonition,{showIcon:!1,type:"default",childProps:{title:{className:"flex-row gap-x-2 items-center"}},title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:u}),(0,n.jsx)(H.Badge,{variant:"ASSOCIATION_ACCEPTED"===e.status||"READY"===e.status?"success":"CREATING"===e.status?"warning":"CREATION_FAILED"===e.status||"ASSOCIATION_REQUEST_EXPIRED"===e.status?"destructive":"warning",children:"ASSOCIATION_ACCEPTED"===e.status?"Connected":"READY"===e.status?"Ready":"CREATING"===e.status?"Creating":"CREATION_FAILED"===e.status?"Failed":"ASSOCIATION_REQUEST_EXPIRED"===e.status?"Expired":"DELETING"===e.status?"Deleting":"Unknown"})]}),description:m,actions:"READY"===e.status&&(0,n.jsx)(L.Button,{type:"default",className:"w-min mt-2",children:(0,n.jsx)(U.default,{target:"_blank",rel:"noopener noreferrer",href:`${p.DOCS_URL}/guides/platform/privatelink#step-2-accept-resource-share`,children:"How to accept?"})})})}),(0,n.jsx)(X.FormField_Shadcn_,{control:d.control,name:"awsAccountId",render:({field:e})=>(0,n.jsx)(et.FormItemLayout,{label:"AWS Account ID",description:"The ID of the AWS account you want to connect to.",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(J.Input_Shadcn_,{...e,readOnly:!s,autoFocus:s,onFocus:e=>{s||e.target.blur()}})})})}),(0,n.jsx)(X.FormField_Shadcn_,{control:d.control,name:"accountName",render:({field:e})=>(0,n.jsx)(et.FormItemLayout,{label:"Account Name",description:"A name for this account connection.",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(J.Input_Shadcn_,{...e,readOnly:!s,onFocus:e=>{s||e.target.blur()}})})})})]}),(0,n.jsxs)(ee.SheetFooter,{children:[(0,n.jsx)(L.Button,{type:"default",disabled:l,onClick:()=>i(!1),children:"Cancel"}),s&&(0,n.jsx)(L.Button,{htmlType:"submit",loading:l,children:"Add Account"})]})]})})]})})},er=()=>{let{data:e}=(0,T.useSelectedProjectQuery)(),{data:t}=(({projectRef:e},{enabled:n=!0,...t}={})=>(0,k.useQuery)({queryKey:P(e),queryFn:({signal:n})=>R({projectRef:e},n),enabled:p.IS_PLATFORM&&n&&void 0!==e,refetchInterval:e=>{let n=e.state.data;return!!n?.some(e=>"CREATING"===e.status||"DELETING"===e.status)&&5e3},...t}))({projectRef:e?.ref}),[i,s]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),{mutate:u,isPending:m}=(({onSuccess:e,onError:n,...t}={})=>{let a=(0,I.useQueryClient)();return(0,N.useMutation)({mutationFn:e=>E(e),async onSuccess(n,t,r){let{projectRef:i}=t;await a.invalidateQueries({queryKey:P(i)}),await e?.(n,t,r)},async onError(e,t,a){void 0===n?r.toast.error(`Failed to delete AWS account: ${e.message}`):n(e,t,a)},...t})})({onSuccess:()=>{r.toast.success("Account will be deleted shortly"),d(!1),s(null)}}),{hasAccess:h}=(0,F.useCheckEntitlements)("security.private_link"),g=p.IS_PLATFORM&&!h;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.ScaffoldContainer,{children:(0,n.jsxs)(v.ScaffoldSection,{className:"py-12",children:[(0,n.jsxs)(v.ScaffoldSectionDetail,{title:"AWS PrivateLink",children:[(0,n.jsx)("p",{children:"Connect to your Supabase project from your AWS VPC using AWS PrivateLink."}),(0,n.jsx)(G.IntegrationImageHandler,{title:"aws"})]}),(0,n.jsx)(v.ScaffoldSectionContent,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"text-foreground mb-2",children:"How does the AWS PrivateLink integration work?"}),(0,n.jsx)("p",{className:"text-foreground-light text-sm mb-6",children:"Connecting to AWS PrivateLink allows you to create a private connection between your AWS VPC and your Supabase project."}),g&&(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(C.UpgradeToPro,{layout:"vertical",primaryText:"Only available on Team or Enterprise Plan and above",secondaryText:"Connect your AWS VPC privately to your Supabase project using AWS PrivateLink.",buttonText:"Upgrade to Team",source:"aws-privatelink-integration"})})]}),(0,n.jsxs)("div",{className:(0,D.cn)(g&&"opacity-25 pointer-events-none"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("h3",{className:"text-foreground text-sm",children:"AWS Accounts"}),(0,n.jsx)(L.Button,{type:g?"default":"primary",onClick:()=>{s(null),c(!0)},children:"Add Account"})]}),(t?.length??0)>0?(0,n.jsx)(w.ResourceList,{children:t?.map(e=>(0,n.jsx)(Q,{...e,onEdit:()=>{s(e),c(!0)},onDelete:()=>{s(e),d(!0)}},e.aws_account_id))}):(0,n.jsx)(O.Card,{children:(0,n.jsx)(O.CardContent,{children:(0,n.jsx)("p",{className:"text-foreground-lighter text-sm",children:"No accounts connected"})})})]})]})})]})}),(0,n.jsx)(ea,{account:i,open:o,onOpenChange:c}),(0,n.jsx)(V.ConfirmationModal,{variant:"destructive",visible:l,title:"Confirm to delete AWS Account",confirmLabel:"Delete",loading:m,onCancel:()=>d(!1),onConfirm:()=>{i&&e&&u({projectRef:e.ref,awsAccountId:i.aws_account_id})},children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to delete the AWS account connection for"," ",i?.aws_account_id,"?"]})})]})};var ei=e.i(902858),es=e.i(611991),eo=e.i(693241),ec=e.i(148210),el=e.i(2579),ed=e.i(108151),eu=e.i(532728),em=e.i(88816),eh=e.i(774803),ep=e.i(731401),eg=e.i(61187),ex=e.i(531837),ef=e.i(249909),ej=e.i(86086),ey=e.i(677436),eb=e.i(518723),e_=e.i(109),eS=e.i(362784),ev=e.i(224649);async function ew({connection:e}){let{data:n,error:t}=await (0,A.post)("/platform/integrations/github/connections",{body:e});return t&&(0,A.handleError)(t),n}async function eC({connectionId:e},n){let{data:t,error:a}=await (0,A.del)("/platform/integrations/github/connections/{connection_id}",{params:{path:{connection_id:String(e)}},signal:n});return a&&(0,A.handleError)(a),t}let eN=({onSuccess:e,onError:n,...t}={})=>{let a=(0,I.useQueryClient)();return(0,N.useMutation)({mutationFn:e=>eC(e),async onSuccess(n,t,r){await Promise.all([a.invalidateQueries({queryKey:ev.integrationKeys.githubConnectionsList(t.organizationId)})]),await e?.(n,t,r)},async onError(e,t,a){void 0===n?r.toast.error(`Failed to delete GitHub connection: ${e.message}`):n(e,t,a)},...t})};async function eI({connectionId:e,connection:n},t){let{data:a,error:r}=await (0,A.patch)("/platform/integrations/github/connections/{connection_id}",{params:{path:{connection_id:String(e)}},signal:t,body:n});return r&&(0,A.handleError)(r),a}async function eA(e){let{data:n,error:t}=await (0,A.get)("/platform/integrations/github/repositories",{signal:e});return t&&(0,A.handleError)(t),n}e.s(["useGitHubConnectionDeleteMutation",0,eN],170958);var eP=e.i(519835),eE=e.i(866205),ek=e.i(703526),eR=e.i(917007),eF=e.i(920432),eT=e.i(549815),eL=e.i(911509),eO=e.i(996960),eD=e.i(689805),eV=e.i(793912),eG=e.i(135144),eB=e.i(290811);let ez=(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 98 96",className:"w-6",children:[(0,n.jsx)("title",{children:"GitHub icon"}),(0,n.jsx)("path",{fill:"#ffffff",fillRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z",clipRule:"evenodd"})]}),e$=({disabled:e=!1,connection:t})=>{let{data:i}=(0,T.useSelectedProjectQuery)(),{data:s}=(0,h.useSelectedOrganizationQuery)(),[o,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),p=!i?.parent_project_ref,x=s?.plan?.id!=="free",f=ej.IS_PLATFORM&&!x,{can:j}=(0,el.useAsyncCheckPermissions)(ei.PermissionAction.UPDATE,"integrations.github_connections"),{can:y}=(0,el.useAsyncCheckPermissions)(ei.PermissionAction.CREATE,"integrations.github_connections"),{data:b,refetch:_}=(0,es.useGitHubAuthorizationQuery)(),{data:S,isPending:v,refetch:w}=(({enabled:e=!0,...n}={})=>(0,k.useQuery)({queryKey:ev.integrationKeys.githubRepositoriesList(),queryFn:({signal:e})=>eA(e),enabled:e,staleTime:0,...n}))({enabled:!!b}),C=()=>{setTimeout(()=>{_(),w()},2e3)},{mutate:A}=(0,eb.useBranchUpdateMutation)({onSuccess:()=>{r.toast.success("Production branch settings successfully updated")}}),{mutate:P}=(0,ey.useBranchCreateMutation)({onSuccess:()=>{r.toast.success("Production branch settings successfully updated")},onError:e=>{console.error("Failed to enable branching:",e)}}),{data:E}=(0,e_.useBranchesQuery)({projectRef:i?.ref},{enabled:!!i?.ref}),{mutateAsync:R,isPending:F}=(0,eS.useCheckGithubBranchValidity)({onError:()=>{}}),{mutate:G,isPending:B}=(({onSuccess:e,onError:n,...t}={})=>{let a=(0,I.useQueryClient)();return(0,N.useMutation)({mutationFn:e=>ew(e),async onSuccess(n,t,r){await Promise.all([a.invalidateQueries({queryKey:ev.integrationKeys.githubConnectionsList(t.organizationId)})]),await e?.(n,t,r)},async onError(e,t,a){void 0===n?r.toast.error(`Failed to create GitHub connection: ${e.message}`):n(e,t,a)},...t})})({onSuccess:()=>{r.toast.success("GitHub integration successfully updated")}}),{mutateAsync:z,isPending:$}=eN({onSuccess:()=>{r.toast.success("Successfully removed GitHub integration")}}),{mutate:H,isPending:M}=(({onSuccess:e,onError:n,...t}={})=>{let a=(0,I.useQueryClient)();return(0,N.useMutation)({mutationFn:e=>eI(e),async onSuccess(n,t,r){await Promise.all([a.invalidateQueries({queryKey:ev.integrationKeys.githubConnectionsList(t.organizationId)})]),await e?.(n,t,r)},async onError(e,t,a){void 0===n?r.toast.error(`Failed to update GitHub connection: ${e.message}`):n(e,t,a)},...t})})(),Q=(0,a.useMemo)(()=>S?.repositories?.map(e=>({id:e.id.toString(),name:e.name,installation_id:e.installation_id,default_branch:e.default_branch||"main"}))??g.EMPTY_ARR,[S]),U=S?.partial_response_due_to_sso??!1,K=E?.find(e=>e.is_default),q=ex.object({repositoryId:ex.string().min(1,"Please select a repository"),enableProductionSync:ex.boolean().default(!0),branchName:ex.string().default("main"),new_branch_per_pr:ex.boolean().default(!0),supabaseDirectory:ex.string().default("."),supabaseChangesOnly:ex.boolean().default(!0),branchLimit:ex.string().default("50")}).superRefine(async(e,n)=>{if(e.enableProductionSync&&e.branchName&&e.branchName.length>0){let a=e.repositoryId||t?.repository.id.toString();if(a)try{await R({repositoryId:Number(a),branchName:e.branchName})}catch{let r=Q.find(e=>e.id===a),i=r?.name||t?.repository.name||"selected repository";n.addIssue({code:ef.ZodIssueCode.custom,message:`Branch "${e.branchName}" not found in ${i}`,path:["branchName"]})}}}),ee=(0,W.useForm)({resolver:(0,eu.zodResolver)(q),mode:"onSubmit",reValidateMode:"onBlur",defaultValues:{repositoryId:t?.repository.id.toString()||"",enableProductionSync:!0,branchName:"main",new_branch_per_pr:!0,supabaseDirectory:".",supabaseChangesOnly:!0,branchLimit:"50"}}),en=ee.watch("enableProductionSync"),ea=ee.watch("new_branch_per_pr"),er=ee.watch("repositoryId"),eo=Q.find(e=>e.id===er),ec=async e=>{if(i?.ref&&s?.id)try{if(t){if(t.repository.id.toString()!==e.repositoryId)return void d(!0);await eC(e,t)}else{let n=Q.find(n=>n.id===e.repositoryId);if(!n)return void r.toast.error("Please select a repository");await ed(e,n)}}catch(e){console.error("Error managing connection:",e)}},ed=async(e,n)=>{i?.ref&&s?.id&&(G({organizationId:s.id,connection:{installation_id:n.installation_id,project_ref:i.ref,repository_id:Number(n.id),workdir:e.supabaseDirectory,supabase_changes_only:e.supabaseChangesOnly,branch_limit:Number(e.branchLimit),new_branch_per_pr:e.new_branch_per_pr}}),K?A({branchRef:K.project_ref,projectRef:i.ref,gitBranch:e.branchName}):P({projectRef:i.ref,branchName:"main",gitBranch:e.branchName,is_default:!0}))},eC=async(e,n)=>{if(!i?.ref||!s?.id)return;let t=K?.git_branch;t&&e.branchName!==t&&e.enableProductionSync?c(!0):await e$(e,n)},e$=async(e,n)=>{i?.ref&&s?.id&&(H({connectionId:n.id,organizationId:s.id,connection:{workdir:e.supabaseDirectory,supabase_changes_only:e.supabaseChangesOnly,branch_limit:Number(e.branchLimit),new_branch_per_pr:e.new_branch_per_pr}}),K&&A({branchRef:K.project_ref,projectRef:i.ref,gitBranch:e.enableProductionSync?e.branchName:"",branchName:e.branchName||"main"}),c(!1))},eH=async()=>{t&&await e$(ee.getValues(),t)},eM=async()=>{if(t&&s?.id)try{await z({organizationId:s.id,connectionId:t.id}),ee.reset({repositoryId:"",enableProductionSync:!0,branchName:"main",new_branch_per_pr:!0,supabaseDirectory:".",supabaseChangesOnly:!0,branchLimit:"50"})}catch(e){console.error("Error removing integration:",e),r.toast.error("Failed to remove integration")}},eQ=async()=>{let e=ee.getValues(),n=Q.find(n=>n.id===e.repositoryId);if(n&&t&&s?.id)try{await z({organizationId:s.id,connectionId:t.id}),await ed(e,n),d(!1)}catch(e){console.error("Error changing repository:",e),r.toast.error("Failed to change repository")}};if((0,a.useEffect)(()=>{if(t){let e=!!K?.git_branch?.trim();ee.reset({repositoryId:t.repository.id.toString(),enableProductionSync:e,branchName:K?.git_branch||"main",new_branch_per_pr:t.new_branch_per_pr,supabaseDirectory:t.workdir||"",supabaseChangesOnly:t.supabase_changes_only,branchLimit:String(t.branch_limit)})}},[t,K,ee]),(0,a.useEffect)(()=>{en?en&&!ee.getValues().branchName&&ee.setValue("branchName","main"):ee.setValue("branchName","")},[en,ee]),null===b)return(0,n.jsx)(O.Card,{children:(0,n.jsxs)(O.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,n.jsx)("p",{className:"text-sm text-center",children:"Authorize with GitHub"}),(0,n.jsx)("p",{className:"text-sm text-center text-foreground-light mb-4",children:"Connect your GitHub account to access and select repositories for integration."}),(0,n.jsx)(L.Button,{onClick:()=>{(0,eP.openInstallGitHubIntegrationWindow)("authorize",C)},children:"Authorize GitHub"})]})});let eU=B||M||$;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z.Form_Shadcn_,{...ee,children:(0,n.jsx)("form",{onSubmit:ee.handleSubmit(ec),className:(0,D.cn)(!p&&"opacity-25 pointer-events-none"),children:(0,n.jsxs)(O.Card,{children:[(0,n.jsx)(O.CardContent,{className:"space-y-6",children:(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"repositoryId",render:({field:a})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"GitHub Repository",description:t?"Change the connected repository":"Select the repository to connect to your project",children:(0,n.jsxs)(eD.Popover_Shadcn_,{open:u,onOpenChange:m,children:[(0,n.jsx)(eG.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(L.Button,{type:"default",className:"justify-start h-[34px] w-full",disabled:e||v,loading:v,icon:(0,n.jsx)("div",{className:"bg-black shadow rounded p-1 w-6 h-6 flex justify-center items-center",children:ez}),iconRight:(0,n.jsx)("span",{className:"grow flex justify-end",children:(0,n.jsx)(em.ChevronDown,{})}),children:eo||t?eo?.name||t?.repository.name:"Choose GitHub Repository"})})}),(0,n.jsx)(eV.PopoverContent_Shadcn_,{className:"p-0 w-80",side:"bottom",align:"start",children:(0,n.jsxs)(eE.Command_Shadcn_,{children:[(0,n.jsx)(eF.CommandInput_Shadcn_,{placeholder:"Search repositories..."}),(0,n.jsxs)(eL.CommandList_Shadcn_,{className:"!max-h-[200px]",children:[(0,n.jsx)(ek.CommandEmpty_Shadcn_,{children:"No repositories found."}),Q.length>0?(0,n.jsx)(eR.CommandGroup_Shadcn_,{children:Q.map((e,t)=>(0,n.jsxs)(eT.CommandItem_Shadcn_,{value:`${e.name.replaceAll('"',"")}-${t}`,className:"flex gap-2 items-center",onSelect:()=>{a.onChange(e.id),m(!1),ee.setValue("branchName",e.default_branch||"main")},children:[(0,n.jsx)("div",{className:"bg-black shadow rounded p-1 w-5 h-5 flex justify-center items-center",children:ez}),(0,n.jsx)("span",{className:"truncate",title:e.name,children:e.name})]},e.id))}):null,(0,n.jsx)(eR.CommandGroup_Shadcn_,{children:(0,n.jsxs)(eT.CommandItem_Shadcn_,{className:"flex gap-2 items-center cursor-pointer",onSelect:()=>(0,eP.openInstallGitHubIntegrationWindow)("install",C),children:[(0,n.jsx)(ep.PlusIcon,{size:16}),"Add GitHub Repositories"]})}),U&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eO.CommandSeparator_Shadcn_,{}),(0,n.jsx)(eR.CommandGroup_Shadcn_,{children:(0,n.jsxs)(eT.CommandItem_Shadcn_,{className:"flex gap-2 items-start cursor-pointer",onSelect:()=>{(0,eP.openInstallGitHubIntegrationWindow)("authorize",C)},children:[(0,n.jsx)(eg.RefreshCw,{size:16,className:"mt-0.5 shrink-0"}),(0,n.jsx)("div",{className:"text-xs text-foreground-light",children:"Re-authorize GitHub with SSO to show all repositories"})]})})]})]})]})})]})})})}),(0,n.jsx)(O.CardContent,{className:(0,D.cn)(!er&&"opacity-25 pointer-events-none"),children:(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"supabaseDirectory",render:({field:t})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"Working directory",description:"Path to working directory with your supabase folder",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(J.Input_Shadcn_,{...t,placeholder:"supabase",autoComplete:"off",disabled:e||!j})})})})}),(0,n.jsx)(O.CardContent,{className:(0,D.cn)(!er&&"opacity-25 pointer-events-none"),children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"enableProductionSync",render:({field:t})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"Deploy to production",description:"Deploy changes to production on push including PR merges",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(eB.Switch,{checked:t.value,onCheckedChange:t.onChange,disabled:e||!j})})})}),(0,n.jsx)("div",{className:(0,D.cn)("space-y-4 pl-6 border-l",(!en||e)&&"opacity-25 pointer-events-none"),children:(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"branchName",render:({field:t})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"Production branch name",description:"The GitHub branch to sync with your production database (e.g., main, master)",children:(0,n.jsxs)("div",{className:"relative w-full",children:[(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(J.Input_Shadcn_,{...t,autoComplete:"off",disabled:e||!j||!en})}),(0,n.jsx)("div",{className:"absolute top-2.5 right-3 flex items-center gap-2",children:F&&(0,n.jsx)(eh.Loader2,{size:14,className:"animate-spin"})})]})})})})]})}),(0,n.jsx)(O.CardContent,{className:(0,D.cn)(!er&&"opacity-25 pointer-events-none"),children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"new_branch_per_pr",render:({field:t})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"Automatic branching",description:"Create preview branches for every pull request",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(eB.Switch,{checked:t.value,onCheckedChange:t.onChange,disabled:e||!y})})})}),(0,n.jsxs)("div",{className:(0,D.cn)("space-y-4 pl-6 border-l",(!ea||e)&&"opacity-25 pointer-events-none"),children:[(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"branchLimit",render:({field:t})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"Branch limit",description:"Maximum number of preview branches",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(J.Input_Shadcn_,{...t,type:"number",autoComplete:"off",disabled:!ea||e||!j})})})}),(0,n.jsx)(X.FormField_Shadcn_,{control:ee.control,name:"supabaseChangesOnly",render:({field:t})=>(0,n.jsx)(et.FormItemLayout,{layout:"flex-row-reverse",label:"Supabase changes only",description:"Only create branches when Supabase files change",children:(0,n.jsx)(Y.FormControl_Shadcn_,{children:(0,n.jsx)(eB.Switch,{checked:t.value,onCheckedChange:e=>t.onChange(e),disabled:!ea||e||!j})})})})]})]})}),(0,n.jsxs)(O.CardFooter,{className:"flex justify-between items-center",children:[(0,n.jsx)("div",{children:t&&(0,n.jsx)(L.Button,{type:"outline",onClick:eM,disabled:$,loading:$,children:"Disable integration"})}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[ee.formState.isDirty&&(0,n.jsx)(L.Button,{type:"default",onClick:()=>{ee.reset()},disabled:e||!j,children:"Cancel"}),(0,n.jsx)(L.Button,{type:f?"default":"primary",htmlType:"submit",disabled:e||!t&&!y||t&&!j||F||eU||!t&&!ee.getValues().repositoryId||t&&!ee.formState.isDirty,loading:F||eU,children:t?"Save changes":"Enable integration"})]})]})]})})}),(0,n.jsx)(V.default,{variant:"warning",visible:o,title:"Changing production git branch",confirmLabel:"Confirm",size:"medium",onCancel:()=>c(!1),onConfirm:eH,loading:M,children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Open pull requests will only update your Supabase project on merge if the git base branch matches this new production git branch."})}),(0,n.jsx)(V.default,{variant:"warning",visible:l,title:"Changing GitHub repository",confirmLabel:"Change repository",size:"medium",onCancel:()=>d(!1),onConfirm:eQ,loading:eU,children:(0,n.jsx)("div",{className:"space-y-3",children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"This will disconnect your current repository and create a new connection with the selected repository. All existing Supabase branches that are connected to the old repository will no longer be synced."})})})]})},eH=({title:e})=>(0,n.jsx)("img",{className:"border rounded-lg shadow w-full sm:w-48 mt-6 border-body",src:`${p.BASE_PATH}/img/integrations/covers/${e}-cover.png`,alt:`${e} cover`});e.s(["GitHubSection",0,()=>{let{ref:e}=(0,i.useParams)(),{data:t}=(0,h.useSelectedOrganizationQuery)(),{can:r,isLoading:s}=(0,el.useAsyncCheckPermissions)(ei.PermissionAction.READ,"integrations.github_connections"),o=t?.plan?.id!=="free",c=p.IS_PLATFORM&&!o,{data:l}=(0,es.useGitHubAuthorizationQuery)(),{data:d}=(0,ec.useGitHubConnectionsQuery)({organizationId:t?.id},{enabled:!!e&&!!t?.id}),u=(0,a.useMemo)(()=>d?.find(n=>n.project.ref===e),[d,e]);return(0,n.jsx)(v.ScaffoldContainer,{children:(0,n.jsxs)(v.ScaffoldSection,{className:"py-12",children:[(0,n.jsxs)(v.ScaffoldSectionDetail,{title:"GitHub Integration",children:[(0,n.jsx)("p",{children:"Connect any of your GitHub repositories to a project."}),(0,n.jsx)(eH,{title:"github"})]}),(0,n.jsx)(v.ScaffoldSectionContent,{children:s?(0,n.jsx)(ed.GenericSkeletonLoader,{}):r?(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"text-foreground mb-2",children:"How does the GitHub integration work?"}),(0,n.jsx)("p",{className:"text-foreground-light text-sm mb-6",children:"Connecting to GitHub allows you to sync preview branches with a chosen GitHub branch, keep your production branch in sync, and automatically create preview branches for every pull request."}),c&&(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(C.UpgradeToPro,{layout:"vertical",source:"github-integration",featureProposition:"use GitHub integrations",primaryText:`Upgrade to ${u?"manage":"unlock"} GitHub integration`,secondaryText:"Connect your GitHub repository to automatically sync preview branches and deploy changes."})}),(!!l||!c)&&(0,n.jsx)(e$,{disabled:c,connection:u})]})}):(0,n.jsx)(eo.default,{resourceText:"view this organization's GitHub connections"})})]})})}],386118)},979078,e=>{"use strict";e.s(["IntegrationImageHandler",()=>f,"default",()=>j]);var n=e.i(478902),t=e.i(210419);e.i(128328);var a=e.i(657588),r=e.i(325556),i=e.i(167892),s=e.i(164045),o=e.i(912793),c=e.i(635494),l=e.i(10429),d=e.i(206413),u=e.i(592360),m=e.i(178527),h=e.i(877555),p=e.i(375401),g=e.i(386118),x=e.i(251747);let f=({title:e})=>(0,n.jsx)("img",{className:"border rounded-lg shadow w-full sm:w-48 mt-6 border-body",src:`${l.BASE_PATH}/img/integrations/covers/${e}-cover.png`,alt:`${e} cover`}),j=()=>{let{data:e}=(0,c.useSelectedProjectQuery)(),{data:l}=(0,s.useProjectDetailQuery)({ref:e?.parent_project_ref}),f=e?.parent_project_ref!==void 0,j=(0,o.useIsFeatureEnabled)("integrations:vercel"),y=(0,o.useIsFeatureEnabled)("integrations:aws_private_link"),b=(0,a.useFlag)("awsPrivateLinkIntegration"),_=e?.region==="eu-central-2";return(0,n.jsxs)(n.Fragment,{children:[f&&(0,n.jsx)(i.ScaffoldContainer,{children:(0,n.jsxs)(m.Alert_Shadcn_,{variant:"default",className:"mt-6",children:[(0,n.jsx)(h.WarningIcon,{}),(0,n.jsx)(u.AlertTitle_Shadcn_,{children:"You are currently on a preview branch of your project"}),(0,n.jsxs)(d.AlertDescription_Shadcn_,{children:["To adjust your project's integration settings, you may return to your"," ",(0,n.jsx)(t.default,{href:`/project/${l?.ref}/settings/general`,className:"text-brand",children:"main branch"}),"."]})]})}),(0,n.jsx)(g.GitHubSection,{}),j&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.ScaffoldDivider,{}),(0,n.jsx)(x.VercelSection,{isProjectScoped:!0}),(0,n.jsx)(r.SidePanelVercelProjectLinker,{})]}),y&&b&&!_&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.ScaffoldDivider,{}),(0,n.jsx)(p.AWSPrivateLinkSection,{})]})]})}},251747,e=>{"use strict";e.s(["VercelSection",()=>K],251747),e.i(869176);var n=e.i(478902),t=e.i(17203),a=e.i(210419),r=e.i(389959),i=e.i(355901),s=e.i(902858),o=e.i(783387),c=e.i(541881),l=e.i(592383),d=e.i(167892),u=e.i(693241),m=e.i(823058),h=e.i(859202),p=e.i(692311),g=e.i(2579),x=e.i(265735),f=e.i(635494),j=e.i(48189),y=e.i(92769),b=e.i(417738),_=e.i(837710),S=e.i(843778),v=e.i(108151),w=e.i(979078),C=e.i(532728),N=e.i(408891),I=e.i(531837),A=e.i(331720),P=e.i(38429),E=e.i(356003),k=e.i(234745),R=e.i(224649);async function F({id:e,envSyncTargets:n,publicEnvVarPrefix:t}){let{data:a,error:r}=await (0,k.patch)("/platform/integrations/vercel/connections/{connection_id}",{params:{path:{connection_id:e}},body:{env_sync_targets:n,public_env_var_prefix:t}});return r&&(0,k.handleError)(r),a}var T=e.i(10429),L=e.i(206413),O=e.i(592360),D=e.i(178527),V=e.i(24315),G=e.i(215317),B=e.i(61863),z=e.i(191209),$=e.i(837243),H=e.i(846887),M=e.i(428353),Q=e.i(378277),U=e.i(290811);let W=({disabled:e,connection:t,integration:r})=>{let{data:s}=(0,x.useSelectedOrganizationQuery)(),o=s?.managed_by==="vercel-marketplace"?[]:t.env_sync_targets??[],c=I.object({environmentVariablesProduction:I.boolean().default(o.includes("production")),environmentVariablesPreview:I.boolean().default(o.includes("preview")),environmentVariablesDevelopment:I.boolean().default(o.includes("development")),publicEnvVarPrefix:I.string().optional()}),l=(0,N.useForm)({resolver:(0,C.zodResolver)(c),defaultValues:{environmentVariablesProduction:o.includes("production"),environmentVariablesPreview:o.includes("preview"),environmentVariablesDevelopment:o.includes("development"),publicEnvVarPrefix:t.public_env_var_prefix}}),{mutate:d,isPending:u}=(({onSuccess:e,onError:n,...t}={})=>{let a=(0,E.useQueryClient)();return(0,P.useMutation)({mutationFn:e=>F(e),async onSuccess(n,t,r){await a.invalidateQueries({queryKey:R.integrationKeys.vercelConnectionsList(t.organizationIntegrationId)}),await e?.(n,t,r)},async onError(e,t,a){void 0===n?i.toast.error(`Failed to update Vercel connection: ${e.message}`):n(e,t,a)},...t})})({onSuccess:()=>{l.reset(l.getValues()),i.toast.success("Updated Vercel connection")}}),m=`vercel-connection-form-${t.id}`;return(0,n.jsx)(M.Form_Shadcn_,{...l,children:(0,n.jsx)("form",{id:m,onSubmit:l.handleSubmit(function(e){let{environmentVariablesProduction:n,environmentVariablesPreview:a,environmentVariablesDevelopment:i}=e,s=[];n&&s.push("production"),a&&s.push("preview"),i&&s.push("development"),d({id:t.id,envSyncTargets:s,publicEnvVarPrefix:e.publicEnvVarPrefix?.trim(),organizationIntegrationId:r.id})}),className:"w-full space-y-6",children:(0,n.jsxs)("div",{className:"px-6 py-4 flex flex-col gap-y-4",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4",children:s?.managed_by==="vercel-marketplace"?(0,n.jsxs)(D.Alert_Shadcn_,{children:[(0,n.jsx)(O.AlertTitle_Shadcn_,{className:"text-sm",children:"Vercel Marketplace managed project"}),(0,n.jsxs)(L.AlertDescription_Shadcn_,{className:"text-xs",children:["This project is managed via Vercel Marketplace. Environment variables are automatically synchronized for your connected Vercel projects. This integration purpose is synchronizing preview deployments environment variables with our"," ",(0,n.jsx)(a.default,{target:"_blank",rel:"noreferrer",href:`${T.DOCS_URL}/guides/platform/branching`,className:"underline",children:"Branching"})," ","feature."]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("h5",{className:"text-foreground ",children:"Sync environment variables for selected target environments"}),(0,n.jsx)(B.FormField_Shadcn_,{control:l.control,name:"environmentVariablesProduction",render:({field:t})=>(0,n.jsxs)(z.FormItem_Shadcn_,{className:"space-y-0 flex gap-x-4",children:[(0,n.jsx)(V.FormControl_Shadcn_,{children:(0,n.jsx)(U.Switch,{disabled:e,className:"mt-1",checked:t.value,onCheckedChange:t.onChange})}),(0,n.jsxs)("div",{children:[(0,n.jsx)($.FormLabel_Shadcn_,{className:"!text",children:"Production"}),(0,n.jsxs)(G.FormDescription_Shadcn_,{className:"text-xs text-foreground-lighter",children:["Sync environment variables for ",(0,n.jsx)("code",{children:"production"})," environment."]})]})]})}),(0,n.jsx)(B.FormField_Shadcn_,{control:l.control,name:"environmentVariablesPreview",render:({field:t})=>(0,n.jsxs)(z.FormItem_Shadcn_,{className:"space-y-0 flex gap-x-4",children:[(0,n.jsx)(V.FormControl_Shadcn_,{children:(0,n.jsx)(U.Switch,{disabled:e,className:"mt-1",checked:t.value,onCheckedChange:t.onChange})}),(0,n.jsxs)("div",{children:[(0,n.jsx)($.FormLabel_Shadcn_,{className:"!text",children:"Preview"}),(0,n.jsxs)(G.FormDescription_Shadcn_,{className:"text-xs text-foreground-lighter",children:["Sync environment variables for ",(0,n.jsx)("code",{children:"preview"})," environment."]})]})]})}),(0,n.jsx)(B.FormField_Shadcn_,{control:l.control,name:"environmentVariablesDevelopment",render:({field:t})=>(0,n.jsxs)(z.FormItem_Shadcn_,{className:"space-y-0 flex gap-x-4",children:[(0,n.jsx)(V.FormControl_Shadcn_,{children:(0,n.jsx)(U.Switch,{disabled:e,className:"mt-1",checked:t.value,onCheckedChange:t.onChange})}),(0,n.jsxs)("div",{children:[(0,n.jsx)($.FormLabel_Shadcn_,{className:"!text",children:"Development"}),(0,n.jsxs)(G.FormDescription_Shadcn_,{className:"text-xs text-foreground-lighter",children:["Sync environment variables for ",(0,n.jsx)("code",{children:"development"})," environment."]})]})]})})]})}),(0,n.jsx)("h5",{className:"mt-2 text-foreground",children:"Customize public environment variable prefix"}),(0,n.jsx)("div",{className:"flex flex-col gap-4",children:(0,n.jsx)(B.FormField_Shadcn_,{control:l.control,name:"publicEnvVarPrefix",render:({field:t})=>(0,n.jsxs)(z.FormItem_Shadcn_,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)($.FormLabel_Shadcn_,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Prefix"}),(0,n.jsx)(V.FormControl_Shadcn_,{className:"col-span-8",children:(0,n.jsx)(Q.Input_Shadcn_,{...t,className:"w-full",disabled:e,placeholder:"An empty prefix will result in no public env vars"})}),(0,n.jsxs)(G.FormDescription_Shadcn_,{className:"col-start-5 col-span-8 text-xs",children:["e.g."," ",(0,n.jsx)("code",{className:"cursor-pointer",role:"button",onClick:()=>{t.onChange("NEXT_PUBLIC_")},children:"NEXT_PUBLIC_"}),","," ",(0,n.jsx)("code",{className:"cursor-pointer",role:"button",onClick:()=>{t.onChange("VITE_PUBLIC_")},children:"VITE_PUBLIC_"}),","," ",(0,n.jsx)("code",{className:"cursor-pointer",role:"button",onClick:()=>{t.onChange("PUBLIC_")},children:"PUBLIC_"}),", etc."]}),(0,n.jsx)(H.FormMessage_Shadcn_,{className:"col-start-5 col-span-8"})]})})}),l.formState.isDirty?(0,n.jsxs)("p",{className:"mt-2 text-sm text-warning",children:["Note: Changing these settings will ",(0,n.jsx)("strong",{children:"not"})," trigger a resync of environment variables."]}):(0,n.jsx)("div",{className:"mt-2 h-5 w-full"}),(0,n.jsx)(A.FormActions,{disabled:e,form:m,hasChanges:l.formState.isDirty,isSubmitting:u,handleReset:()=>l.reset()})]})})})},K=({isProjectScoped:e})=>{let{data:C}=(0,f.useSelectedProjectQuery)(),{data:N}=(0,x.useSelectedOrganizationQuery)(),{data:I}=(0,m.useOrgIntegrationsQuery)({orgSlug:N?.slug}),A=(0,b.useSidePanelsStateSnapshot)(),P=C?.parent_project_ref!==void 0,{can:E,isLoading:k}=(0,g.useAsyncCheckPermissions)(s.PermissionAction.READ,"integrations.vercel_connections"),{can:R}=(0,g.useAsyncCheckPermissions)(s.PermissionAction.CREATE,"integrations.vercel_connections"),{can:F}=(0,g.useAsyncCheckPermissions)(s.PermissionAction.UPDATE,"integrations.vercel_connections"),{mutate:T}=(0,h.useIntegrationsVercelInstalledConnectionDeleteMutation)({onSuccess:()=>{i.toast.success("Successfully deleted Vercel connection")}}),L=(0,r.useMemo)(()=>I?.filter(e=>"Vercel"===e.integration.name).map(e=>{if(e.metadata&&"Vercel"===e.integration.name){let n=e.metadata.account.avatar||"Team"!==e.metadata.account.type?`https://vercel.com/api/www/avatar/${e.metadata.account.avatar}?s=48`:`https://vercel.com/api/www/avatar?teamId=${e.metadata.account.team_id}&s=48&format=png`;return{...e,metadata:{...e.metadata,account:{...e.metadata.account,avatar:n}}}}return e}),[I]),O=L?.[0],{data:D}=(0,p.useVercelProjectsQuery)({organization_integration_id:O?.id},{enabled:O?.id!==void 0}),V=D?.length??0,G=(0,r.useCallback)(e=>{A.setVercelConnectionsIntegrationId(e),A.setVercelConnectionsOpen(!0)},[A]),B=(0,r.useCallback)(async e=>{T({id:e.id,organization_integration_id:e.organization_integration_id,orgSlug:N?.slug})},[T,N?.slug]),z=`

Connect your Vercel teams to your Supabase organization.
`,$=`

### How does the Vercel integration work?

Supabase will keep your environment variables up to date in each of the projects you assign to a Supabase project.
You can also link multiple Vercel Projects to the same Supabase project.
`,H=V>0&&void 0!==O?`
Your Vercel connection has access to ${V} Vercel Projects.
You can change the scope of the access for Supabase by configuring
[here](${(0,y.getIntegrationConfigurationUrl)(O)}).
`:"",M=(e?O?.connections.filter(e=>e.supabase_project_ref===C?.ref):O?.connections)||[],Q=`${M.length} project ${(0,j.pluralize)(M.length,"connection")} `;return(0,n.jsx)(d.ScaffoldContainer,{children:(0,n.jsxs)(d.ScaffoldSection,{className:"py-12",children:[(0,n.jsxs)(d.ScaffoldSectionDetail,{title:"Vercel Integration",children:[(0,n.jsx)(l.Markdown,{content:z}),(0,n.jsx)(w.IntegrationImageHandler,{title:"vercel"})]}),(0,n.jsx)(d.ScaffoldSectionContent,{children:k?(0,n.jsx)(v.GenericSkeletonLoader,{}):E?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Markdown,{content:$}),O?(0,n.jsxs)("div",{children:[(0,n.jsx)(c.IntegrationInstallation,{title:"Vercel",integration:O}),M.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.IntegrationConnectionHeader,{title:Q,markdown:"Repository connections for Vercel"}),(0,n.jsx)("ul",{className:"flex flex-col",children:M.map(t=>(0,n.jsxs)("div",{className:(0,S.cn)(e&&"relative flex flex-col -gap-[1px] [&>li]:pb-0"),children:[(0,n.jsx)(o.IntegrationConnectionItem,{connection:t,disabled:P||!F,type:"Vercel",onDeleteConnection:B,className:(0,S.cn)(e&&"!rounded-b-none !mb-0")}),e?(0,n.jsx)("div",{className:"relative pl-8 ml-6 border-l border-muted pb-6",children:(0,n.jsx)("div",{className:"border-b border-l border-r rounded-b-lg",children:(0,n.jsx)(W,{connection:t,integration:O,disabled:P||!F})})}):null]},t.id))})]}):(0,n.jsx)(c.IntegrationConnectionHeader,{title:Q,className:"pb-0",markdown:"Repository connections for Vercel"}),(0,n.jsx)(c.EmptyIntegrationConnection,{disabled:P||!R,onClick:()=>G(O.id),children:"Add new project connection"})]},O.id):(0,n.jsx)("div",{children:(0,n.jsx)(_.Button,{icon:(0,n.jsx)(t.ExternalLink,{}),asChild:!P,type:"default",disabled:P,children:P?(0,n.jsx)("p",{children:"Install Vercel Integration"}):(0,n.jsx)(a.default,{href:"https://vercel.com/integrations/supabase",target:"_blank",rel:"noreferrer",children:"Install Vercel Integration"})})}),H&&(0,n.jsx)(l.Markdown,{extLinks:!0,content:H,className:"text-foreground-lighter"})]}):(0,n.jsx)(u.default,{resourceText:"view this organization's Vercel connections"})})]})})}}]);

//# debugId=10174d80-9e03-f898-fab0-db5133b691f3
//# sourceMappingURL=0243110302d16200.js.map