;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6d4a0fec-ed7a-0f1c-1819-15923855be69")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,377722,e=>{"use strict";var t=e.i(478902),a=e.i(902858),r=e.i(354354),n=e.i(366652),i=e.i(533488),s=e.i(389959),l=e.i(355901),o=e.i(198693),c=e.i(892277),d=e.i(170149),u=e.i(635494);let h=({trigger:e,visible:a,setVisible:r,onDelete:n,isLoading:i})=>{let{data:s}=(0,u.useSelectedProjectQuery)(),{name:l,schema:o}=e??{};async function c(){return s?e?void n({projectRef:s.ref,connectionString:s.connectionString,trigger:e}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,t.jsx)(d.TextConfirmModal,{variant:"warning",visible:a,onCancel:()=>r(""),onConfirm:c,title:"Delete this trigger",loading:i,confirmLabel:`Delete trigger ${l}`,confirmPlaceholder:"Type in name of trigger",confirmString:l??"",text:(0,t.jsxs)(t.Fragment,{children:["This will delete your trigger called"," ",(0,t.jsx)("span",{className:"text-bold text-foreground",children:l})," of schema"," ",(0,t.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this trigger once deleted."}})};var g=e.i(532728),m=e.i(454931),x=e.i(408891),p=e.i(531837);let f=({icon:e,text:a})=>(0,t.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,t.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:e}),(0,t.jsx)("p",{className:"text-foreground-light",children:a})]});var j=e.i(200246),b=e.i(755216),S=e.i(38429),v=e.i(356003),y=e.i(714403),_=e.i(878827);async function N({originalTrigger:e,projectRef:t,connectionString:a,payload:r}){let{sql:n}=b.default.triggers.update(e,r),{result:i}=await (0,y.executeSql)({projectRef:t,connectionString:a,sql:n,queryKey:["trigger","update",e.id]});return i}var T=e.i(738196),C=e.i(412385),w=e.i(392491),E=e.i(837710),I=e.i(34411),D=e.i(843778),F=e.i(428353),A=e.i(24315),R=e.i(61863),P=e.i(378277),k=e.i(449123),L=e.i(451031),$=e.i(831927),O=e.i(156722),B=e.i(719754),M=e.i(479095),V=e.i(725137),z=e.i(466472),W=e.i(538482),Q=e.i(492247);e.i(128328);var Y=e.i(158639),H=e.i(671362),K=e.i(605031),U=e.i(210419),G=e.i(271226),q=e.i(539013),X=e.i(993463),Z=e.i(102703),J=e.i(913444),ee=e.i(869922),et=e.i(88816),ea=e.i(382490);let er=({visible:e,onChange:a,setVisible:r})=>{let{data:n}=(0,u.useSelectedProjectQuery)(),{data:i=[]}=(0,ee.useDatabaseFunctionsQuery)({projectRef:n?.ref,connectionString:n?.connectionString}),s=i.filter(e=>"trigger"===e.return_type),l=s.length>=1,o=(0,H.default)((0,K.default)(s,"schema"),"schema"),c=t=>{let n=s.find(e=>e.id===t);n&&a(n),r(!e)};return(0,t.jsx)(q.SidePanel,{size:"large",header:"Pick a function",visible:e,onCancel:()=>r(!e),className:"hooks-sidepanel",children:(0,t.jsx)("div",{className:"py-6",children:l?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(en,{}),o.map(e=>(0,t.jsx)(es,{schema:e,functions:s.filter(t=>t.schema==e),selectFunction:c},e))]}):(0,t.jsx)(ei,{})})})},en=()=>{let{ref:e}=(0,Y.useParams)();return(0,t.jsx)("div",{className:"px-6",children:(0,t.jsx)(Z.default,{icon:(0,t.jsx)(ea.HelpCircle,{size:"20",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,t.jsx)(E.Button,{asChild:!0,type:"default",children:(0,t.jsx)(U.default,{href:`/project/${e}/database/functions`,children:"Go to Functions"})})})})},ei=()=>{let e=(0,G.useRouter)(),{ref:a}=e.query;return(0,t.jsx)(X.default,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push(`/project/${a}/database/functions`)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},es=({schema:e,functions:a,selectFunction:r})=>(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,t.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,t.jsx)("h5",{children:e})]}),(0,t.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:a.map(e=>(0,t.jsx)(el,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:r},e.id))})]}),el=({id:e,completeStatement:a,name:r,onClick:n})=>{let[i,l]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>n(e),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,t.jsx)(m.Terminal,{strokeWidth:2,size:14})}),(0,t.jsx)("p",{className:"mb-0 text-sm",children:r})]}),(0,t.jsx)(E.Button,{type:"text",onClick:e=>{e.stopPropagation(),l(!i)},icon:(0,t.jsx)(et.ChevronDown,{className:i?"rotate-180 transform":"rotate-0 transform"}),children:i?"Hide definition":"View definition"})]}),(0,t.jsx)(Q.Transition,{show:i,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,t.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,t.jsx)(J.default,{defaultValue:a,readOnly:!0,contextmenu:!1})})})]})},eo=[{value:"INSERT",label:"Insert",description:"Any insert operation on the table"},{value:"UPDATE",label:"Update",description:"Any update operation of any column on the table"},{value:"DELETE",label:"Delete",description:"Any delete operation of a record"}],ec=[{value:"BEFORE",label:"Before the event",description:"Trigger fires before the operation is attempted"},{value:"AFTER",label:"After the event",description:"Trigger fires before the operation has completed"}],ed=[{value:"ROW",label:"Row",description:"Fires once for each processed row"},{value:"STATEMENT",label:"Statement",description:"Fires once for each statement"}],eu=[{value:"ORIGIN",label:"Origin",description:"This is the default behaviour"},{value:"REPLICA",label:"Replica",description:'Will only fire if the session is in "replica" mode'},{value:"ALWAYS",label:"Always",description:"Will fire regardless of the replication role"},{value:"DISABLED",label:"Disabled",description:"Will not fire"}],eh="create-trigger",eg=p.object({name:p.string().min(1,"Please provide a name for your trigger").regex(/^\S+$/,"Name should not contain spaces or whitespaces"),schema:p.string(),table:p.string(),activation:p.enum(["BEFORE","AFTER","INSTEAD OF"]),enabled_mode:p.enum(["ORIGIN","REPLICA","ALWAYS","DISABLED"]),orientation:p.enum(["ROW","STATEMENT"]),function_name:p.string().min(1,"Please select a database function for your trigger to call"),function_schema:p.string(),events:p.array(p.string()).min(1,"Please select at least one event"),tableId:p.string().optional()}),em={name:"",schema:"",table:"",activation:"AFTER",orientation:"ROW",function_name:"",function_schema:"",enabled_mode:"ORIGIN",events:[]},ex=({selectedTrigger:e,isDuplicatingTrigger:a,open:r,onClose:n})=>{let{data:i}=(0,u.useSelectedProjectQuery)(),[o,c]=(0,s.useState)(!1),{mutate:d,isPending:h}=(0,j.useDatabaseTriggerCreateMutation)({onSuccess:()=>{l.toast.success("Successfully created trigger"),n()},onError:e=>{l.toast.error(`Failed to create trigger: ${e.message}`)}}),{mutate:p,isPending:b}=(({onSuccess:e,onError:t,...a}={})=>{let r=(0,v.useQueryClient)();return(0,S.useMutation)({mutationFn:e=>N(e),async onSuccess(t,a,n){let{projectRef:i}=a;await r.invalidateQueries({queryKey:_.databaseTriggerKeys.list(i)}),await e?.(t,a,n)},async onError(e,a,r){void 0===t?l.toast.error(`Failed to update database trigger: ${e.message}`):t(e,a,r)},...a})})({onSuccess:()=>{l.toast.success("Successfully updated trigger"),n()},onError:e=>{l.toast.error(`Failed to update trigger: ${e.message}`)}}),{data:y=[],isSuccess:z}=(0,T.useTablesQuery)({projectRef:i?.ref,connectionString:i?.connectionString}),{data:Q,isSuccess:Y}=(0,w.useProtectedSchemas)(),H=z&&Y,K=y.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!Q.find(t=>t.name===e.schema)),U=!a&&!!e,G=(0,x.useForm)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,g.zodResolver)(eg),defaultValues:em}),{function_name:q,function_schema:X}=G.watch(),{confirmOnClose:Z,modalProps:J}=(0,C.useConfirmOnClose)({checkIsDirty:()=>G.formState.isDirty,onClose:n}),ee=async t=>{if(!i)return console.error("Project is required");let{tableId:a,...r}=t;U?p({projectRef:i?.ref,connectionString:i?.connectionString,originalTrigger:e,payload:{name:r.name,enabled_mode:r.enabled_mode}}):d({projectRef:i?.ref,connectionString:i?.connectionString,payload:r})};return(0,s.useEffect)(()=>{if(r&&H)if(G.clearErrors(),a&&e){let t=K.find(t=>t.name===e.table);G.reset({...e,tableId:t?.id.toString(),table:t?.name,schema:t?.schema})}else U?G.reset(e):K.length>0&&G.reset({...em,tableId:K[0].id.toString(),table:K[0].name,schema:K[0].schema})},[r,H]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.Sheet,{open:r,onOpenChange:Z,children:(0,t.jsxs)(V.SheetContent,{size:"lg",className:"flex flex-col gap-0",children:[(0,t.jsx)(V.SheetHeader,{children:(0,t.jsx)(V.SheetTitle,{children:a?"Duplicate trigger":U?`Edit database trigger: ${e.name}`:"Create a new database trigger"})}),(0,t.jsx)(F.Form_Shadcn_,{...G,children:(0,t.jsxs)("form",{id:eh,className:"flex-1 flex flex-col gap-y-6 overflow-auto py-6",onSubmit:G.handleSubmit(ee),children:[(0,t.jsx)(R.FormField_Shadcn_,{name:"name",control:G.control,render:({field:e})=>(0,t.jsx)(W.FormItemLayout,{className:"px-5",layout:"horizontal",label:"Name of trigger",description:"Do not use spaces/whitespace.",children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsx)(P.Input_Shadcn_,{...e,placeholder:"Name of trigger"})})})}),U?(0,t.jsx)(R.FormField_Shadcn_,{name:"enabled_mode",control:G.control,render:({field:e})=>(0,t.jsx)(W.FormItemLayout,{className:"px-5",layout:"horizontal",label:"Enabled mode",description:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsxs)(k.Select_Shadcn_,{defaultValue:e.value,onValueChange:e.onChange,children:[(0,t.jsx)(O.SelectTrigger_Shadcn_,{className:"col-span-8",children:eu.find(t=>t.value===e.value)?.label}),(0,t.jsx)(L.SelectContent_Shadcn_,{children:eu.map(e=>(0,t.jsxs)($.SelectItem_Shadcn_,{value:e.value,children:[(0,t.jsx)("p",{className:"text-foreground",children:e.label}),(0,t.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.value))})]})})})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.Separator,{}),(0,t.jsx)(R.FormField_Shadcn_,{name:"tableId",control:G.control,render:({field:e})=>(0,t.jsx)(W.FormItemLayout,{className:"px-5",layout:"horizontal",label:"Table",description:"Trigger will watch for changes on this table",children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsxs)(k.Select_Shadcn_,{defaultValue:e.value,onValueChange:t=>{e.onChange(t);let a=K.find(e=>e.id.toString()===t);a&&(G.setValue("table",a.name,{shouldDirty:!0}),G.setValue("schema",a.schema,{shouldDirty:!0}))},children:[(0,t.jsx)(O.SelectTrigger_Shadcn_,{className:"col-span-8",children:(0,t.jsx)(B.SelectValue_Shadcn_,{})}),(0,t.jsx)(L.SelectContent_Shadcn_,{children:K.map(e=>(0,t.jsxs)($.SelectItem_Shadcn_,{value:e.id.toString(),children:[(0,t.jsxs)("span",{className:"text-foreground-light",children:[e.schema,"."]}),(0,t.jsx)("span",{className:"text-foreground",children:e.name})]},e.id))})]})})})}),(0,t.jsx)(R.FormField_Shadcn_,{name:"events",control:G.control,render:()=>(0,t.jsx)(W.FormItemLayout,{className:"px-5",layout:"horizontal",label:"Events",description:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",children:eo.map(e=>(0,t.jsx)(R.FormField_Shadcn_,{control:G.control,name:"events",render:({field:a})=>(0,t.jsx)(W.FormItemLayout,{hideMessage:!0,layout:"flex",label:e.label,description:e.description,children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsx)(I.Checkbox_Shadcn_,{className:"translate-y-[2px]",checked:a.value?.includes(e.value),onCheckedChange:t=>t?a.onChange([...a.value,e.value]):a.onChange(a.value?.filter(t=>t!==e.value))})})})},e.value))})}),(0,t.jsx)(R.FormField_Shadcn_,{name:"activation",control:G.control,render:({field:e})=>(0,t.jsx)(W.FormItemLayout,{className:"px-5",layout:"horizontal",label:"Trigger type",description:"Determines when your trigger fires",children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsxs)(k.Select_Shadcn_,{defaultValue:e.value,onValueChange:e.onChange,children:[(0,t.jsx)(O.SelectTrigger_Shadcn_,{className:"col-span-8",children:ec.find(t=>t.value===e.value)?.label}),(0,t.jsx)(L.SelectContent_Shadcn_,{children:ec.map(e=>(0,t.jsxs)($.SelectItem_Shadcn_,{value:e.value,children:[(0,t.jsx)("p",{className:"text-foreground",children:e.label}),(0,t.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.value))})]})})})}),(0,t.jsx)(R.FormField_Shadcn_,{name:"orientation",control:G.control,render:({field:e})=>(0,t.jsx)(W.FormItemLayout,{className:"px-5",layout:"horizontal",label:"Orientation",description:"Identifies whether the trigger fires once for each processed row or once for each statement",children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsxs)(k.Select_Shadcn_,{defaultValue:e.value,onValueChange:e.onChange,children:[(0,t.jsx)(O.SelectTrigger_Shadcn_,{className:"col-span-8",children:ed.find(t=>t.value===e.value)?.label}),(0,t.jsx)(L.SelectContent_Shadcn_,{children:ed.map(e=>(0,t.jsxs)($.SelectItem_Shadcn_,{value:e.value,children:[(0,t.jsx)("p",{className:"text-foreground",children:e.label}),(0,t.jsx)("p",{className:"text-foreground-lighter",children:e.description})]},e.value))})]})})})}),(0,t.jsx)(M.Separator,{}),(0,t.jsx)(R.FormField_Shadcn_,{name:"function_name",control:G.control,render:()=>(0,t.jsx)(W.FormItemLayout,{layout:"vertical",className:"px-5",children:(0,t.jsx)(A.FormControl_Shadcn_,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)("p",{className:"text-sm",children:"Function to trigger"}),0===q.length?(0,t.jsx)("button",{type:"button",className:(0,D.cn)("relative w-full rounded border border-default","bg-surface-200 px-5 py-1 shadow-sm transition-all","hover:border-strong hover:bg-overlay-hover"),onClick:()=>c(!0),children:(0,t.jsx)(f,{icon:(0,t.jsx)(m.Terminal,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})}):(0,t.jsxs)("div",{className:(0,D.cn)("relative w-full flex items-center justify-between","space-x-3 px-5 py-4 border border-default","rounded shadow-sm transition-shadow"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,t.jsx)(m.Terminal,{size:"18",strokeWidth:2,width:14})}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-sm text-foreground-light",children:X}),".",(0,t.jsx)("span",{className:"text-sm text-foreground",children:q})]})]}),(0,t.jsx)(E.Button,{type:"default",onClick:()=>c(!0),children:"Change function"})]})]})})})})]})]})}),(0,t.jsxs)(V.SheetFooter,{className:"shrink-0",children:[(0,t.jsx)(E.Button,{type:"default",htmlType:"reset",disabled:h||b,onClick:Z,children:"Cancel"}),(0,t.jsxs)(E.Button,{form:eh,htmlType:"submit",loading:h||b,children:[U?"Save":"Create"," trigger"]})]}),(0,t.jsx)(ep,{...J})]})}),(0,t.jsx)(er,{visible:o,setVisible:c,onChange:e=>{G.setValue("function_name",e.name),G.setValue("function_schema",e.schema)}})]})},ep=({visible:e,onClose:a,onCancel:r})=>(0,t.jsx)(z.default,{visible:e,title:"Discard changes",confirmLabel:"Discard",onCancel:r,onConfirm:a,children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})});var ef=e.i(215618),ej=e.i(567558),eb=e.i(300424),eS=e.i(253369),ev=e.i(534587),ey=e.i(2579),e_=e.i(114378),eN=e.i(983783),eT=e.i(10429),eC=e.i(317040),ew=e.i(931942),eE=e.i(441081),eI=e.i(627069),eD=e.i(171997),eF=e.i(492418),eA=e.i(394983),eR=e.i(108151),eP=e.i(513826),ek=e.i(479232),eL=e.i(215312),e$=e.i(602089);let eO=({hasTables:e,canCreateTriggers:a,selectedSchema:r,onCreateTrigger:n,showPlusIcon:i=!0,buttonType:s})=>{let l=(0,eC.useAiAssistantStateSnapshot)(),{openSidebar:o}=(0,eE.useSidebarManagerSnapshot)();return(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(eL.ButtonTooltip,{type:s,disabled:!e||!a,onClick:n,className:"flex-grow",icon:i?(0,t.jsx)(ek.Plus,{}):void 0,tooltip:{content:{side:"bottom",text:e?a?void 0:"You need additional permissions to create triggers":"Create a table first before creating triggers"}},children:"New trigger"}),e&&(0,t.jsx)(eL.ButtonTooltip,{type:"default",disabled:!e||!a,className:"px-1 pointer-events-auto",icon:(0,t.jsx)(e$.AiIconAnimation,{size:16}),onClick:()=>{o(ef.SIDEBAR_KEYS.AI_ASSISTANT),l.newChat({name:"Create new trigger",initialInput:`Create a new trigger for the schema ${r} that does ...`,suggestions:{title:"I can help you create a new trigger, here are a few example prompts to get you started:",prompts:[{label:"Log Changes",description:"Create a trigger that logs changes to the users table"},{label:"Update Timestamp",description:"Create a trigger that updates updated_at timestamp"},{label:"Validate Email",description:"Create a trigger that validates email format before insert"}]}})},tooltip:{content:{side:"bottom",text:a?"Create with Supabase Assistant":"You need additional permissions to create triggers"}}})]})};var eB=e.i(702454),eM=e.i(339098),eV=e.i(370410),ez=e.i(816467),eW=e.i(53071),eQ=e.i(582391),eY=e.i(471998),eH=e.i(211570),eK=e.i(975924),eU=e.i(587433),eG=e.i(874311);let eq=e=>{let t=e.events.join(" OR "),a=e.function_args.length>0?`(${e.function_args.join(", ")})`:"()",r=`
DROP TRIGGER IF EXISTS "${e.name}" ON "${e.schema}"."${e.table}";

CREATE TRIGGER "${e.name}"
${e.activation} ${t}
ON "${e.schema}"."${e.table}"
FOR EACH ${e.orientation}
`;return e.condition&&(r+=`WHEN (${e.condition})
`),(r+=`EXECUTE FUNCTION "${e.function_schema}"."${e.function_name}"${a};`).trim()},eX=({schema:e,filterString:r,isLocked:n,editTrigger:i,duplicateTrigger:s,deleteTrigger:l})=>{let{ref:o}=(0,Y.useParams)(),{data:c}=(0,u.useSelectedProjectQuery)(),d=(0,eC.useAiAssistantStateSnapshot)(),{openSidebar:h}=(0,eE.useSidebarManagerSnapshot)(),{can:g}=(0,ey.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"triggers"),{data:m}=(0,ev.useDatabaseTriggersQuery)({projectRef:c?.ref,connectionString:c?.connectionString}),x=(m??[]).filter(e=>(0,eB.default)(e.name.toLowerCase(),r.toLowerCase())||e.function_name&&(0,eB.default)(e.function_name.toLowerCase(),r.toLowerCase())),p=(0,eM.default)(x.filter(t=>t.schema==e),e=>e.name.toLocaleLowerCase());return 0===p.length&&0===r.length?(0,t.jsx)(eF.TableRow,{children:(0,t.jsxs)(eF.TableCell,{colSpan:7,children:[(0,t.jsx)("p",{className:"text-sm text-foreground",children:"No triggers created yet"}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no triggers found in the schema "',e,'"']})]})},e):0===p.length&&r.length>0?(0,t.jsx)(eF.TableRow,{children:(0,t.jsxs)(eF.TableCell,{colSpan:7,children:[(0,t.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,t.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',r,'" did not return any results']})]})},e):(0,t.jsx)(t.Fragment,{children:p.map(e=>(0,t.jsxs)(eF.TableRow,{children:[(0,t.jsx)(eF.TableCell,{className:"space-x-2",children:(0,t.jsx)(E.Button,{type:"text",disabled:n||!g,onClick:()=>i(e),title:e.name,className:"text-link-table-cell text-left text-sm disabled:opacity-90 disabled:no-underline min-w-0 p-0 hover:bg-transparent font-medium max-w-48 title",children:e.name})}),(0,t.jsx)(eF.TableCell,{className:"break-all",children:e.table_id?(0,t.jsx)(U.default,{href:`/project/${o}/editor/${e.table_id}`,className:"text-link-table-cell block max-w-40 text-foreground-light",children:e.table}):(0,t.jsx)("p",{title:e.table,className:"truncate",children:e.table})}),(0,t.jsx)(eF.TableCell,{className:"space-x-2",children:e.function_name?(0,t.jsx)(U.default,{href:`/project/${o}/database/functions?search=${e.function_name}&schema=${e.function_schema}`,className:"text-link-table-cell block max-w-40 text-foreground-light",children:e.function_name}):(0,t.jsx)("p",{className:"truncate text-foreground-light",children:"-"})}),(0,t.jsx)(eF.TableCell,{children:(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:e.events.map(a=>(0,t.jsx)(eU.Badge,{children:`${e.activation} ${a}`},a))})}),(0,t.jsx)(eF.TableCell,{className:"space-x-2",children:(0,t.jsx)("p",{title:e.orientation,className:"truncate",children:e.orientation})}),(0,t.jsx)(eF.TableCell,{children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:"DISABLED"!==e.enabled_mode?(0,t.jsx)(eV.Check,{strokeWidth:2,className:"text-brand"}):(0,t.jsx)(eK.X,{strokeWidth:2})})}),(0,t.jsx)(eF.TableCell,{className:"text-right",children:!n&&(0,t.jsx)("div",{className:"flex items-center justify-end",children:g?(0,t.jsxs)(eG.DropdownMenu,{children:[(0,t.jsx)(eG.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(E.Button,{"aria-label":"More options",type:"default",className:"px-1",icon:(0,t.jsx)(eY.MoreVertical,{})})}),(0,t.jsxs)(eG.DropdownMenuContent,{side:"bottom",align:"end",className:"w-52",children:[(0,t.jsxs)(eG.DropdownMenuItem,{className:"space-x-2",onClick:()=>{eq(e),i(e)},children:[(0,t.jsx)(eQ.Edit2,{size:14}),(0,t.jsx)("p",{children:"Edit trigger"})]}),(0,t.jsxs)(eG.DropdownMenuItem,{className:"space-x-2",onClick:()=>{let t=eq(e);h(ef.SIDEBAR_KEYS.AI_ASSISTANT),d.newChat({name:`Update trigger ${e.name}`,initialInput:`Update this trigger which exists on the ${e.schema}.${e.table} table to...`,suggestions:{title:"I can help you make a change to this trigger, here are a few example prompts to get you started:",prompts:[{label:"Rename Trigger",description:"Rename this trigger to ..."},{label:"Change Events",description:"Change the events this trigger responds to ..."},{label:"Modify Timing",description:"Modify this trigger to run after instead of before ..."}]},sqlSnippets:[t]})},children:[(0,t.jsx)(eW.Edit,{size:14}),(0,t.jsx)("p",{children:"Edit with Assistant"})]}),(0,t.jsxs)(eG.DropdownMenuItem,{className:"space-x-2",onClick:()=>s(e),children:[(0,t.jsx)(ez.Copy,{size:14}),(0,t.jsx)("p",{children:"Duplicate trigger"})]}),(0,t.jsx)(eG.DropdownMenuSeparator,{}),(0,t.jsxs)(eG.DropdownMenuItem,{className:"space-x-2",onClick:()=>l(e),children:[(0,t.jsx)(eH.Trash,{stroke:"red",size:14}),(0,t.jsx)("p",{children:"Delete trigger"})]})]})]}):(0,t.jsx)(eL.ButtonTooltip,{disabled:!0,type:"default",className:"px-1",icon:(0,t.jsx)(eY.MoreVertical,{}),tooltip:{content:{side:"bottom",text:"You need additional permissions to update triggers"}}})})})]},e.id))})},eZ=()=>{let[e,d]=(0,s.useState)(),g=(0,s.useRef)(null),{data:m}=(0,u.useSelectedProjectQuery)();(0,eC.useAiAssistantStateSnapshot)();let{openSidebar:x}=(0,eE.useSidebarManagerSnapshot)(),{selectedSchema:p,setSelectedSchema:f}=(0,eN.useQuerySchemaState)(),[j,b]=(0,i.useQueryState)("search",i.parseAsString.withDefault("").withOptions({history:"replace",clearOnDefault:!0})),S=(0,o.useIsInlineEditorEnabled)(),{templates:v,setValue:y,setTemplates:_,setInitialPrompt:N}=(0,ew.useEditorPanelStateSnapshot)(),{data:C}=(0,w.useProtectedSchemas)(),{isSchemaLocked:E}=(0,w.useIsProtectedSchema)({schema:p}),{data:I=[]}=(0,T.useTablesQuery)({projectRef:m?.ref,connectionString:m?.connectionString}),D=I.filter(e=>!C.find(t=>t.name===e.schema)).length>0,{data:F,error:A,isPending:R,isError:P}=(0,ev.useDatabaseTriggersQuery)({projectRef:m?.ref,connectionString:m?.connectionString}),{can:k}=(0,ey.useAsyncCheckPermissions)(a.PermissionAction.TENANT_SQL_ADMIN_WRITE,"triggers"),[L,$]=(0,i.useQueryState)("new",i.parseAsBoolean.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),{setValue:O,value:B}=(0,e_.useQueryStateWithSelect)({urlKey:"edit",select:e=>e?F?.find(t=>t.id.toString()===e):void 0,enabled:!!F,onError:()=>l.toast.error("Trigger not found")}),{setValue:M,value:V}=(0,e_.useQueryStateWithSelect)({urlKey:"duplicate",select:e=>{if(!e)return;let t=F?.find(t=>t.id.toString()===e);return t?{...t,name:`${t.name}_duplicate`}:void 0},enabled:!!F,onError:()=>l.toast.error("Trigger not found")}),{setValue:z,value:W}=(0,e_.useQueryStateWithSelect)({urlKey:"delete",select:e=>e?F?.find(t=>t.id.toString()===e):void 0,enabled:!!F,onError:(e,t)=>(0,e_.handleErrorOnDelete)(g,t,"Database Trigger not found")}),{mutate:Q,isPending:Y}=(0,eS.useDatabaseTriggerDeleteMutation)({onSuccess:(e,t)=>{l.toast.success(`Successfully removed ${t.trigger.name}`),z(null)},onError:()=>{g.current=null}}),H=()=>{M(null),S?(N("Create a new database trigger that..."),y(`create trigger trigger_name
after insert or update or delete on table_name
for each row
execute function function_name();`),v.length>0&&_([]),x(ef.SIDEBAR_KEYS.EDITOR_PANEL)):(d(void 0),$(!0))};if(R)return(0,t.jsx)(eR.GenericSkeletonLoader,{});if(P)return(0,t.jsx)(ej.default,{error:A,subject:"Failed to retrieve database triggers"});let K=F.filter(e=>e.schema===p);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2 flex-wrap",children:[(0,t.jsx)(eb.default,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:p,onSelectSchema:f}),(0,t.jsx)(eD.Input,{placeholder:"Search for a trigger",size:"tiny",icon:(0,t.jsx)(n.Search,{}),value:j,className:"w-full lg:w-52",onChange:e=>b(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eP.DocsButton,{href:`${eT.DOCS_URL}/guides/database/postgres/triggers`}),!E&&(0,t.jsx)(eO,{hasTables:D,canCreateTriggers:k,selectedSchema:p,onCreateTrigger:H,showPlusIcon:!0})]})]}),E&&(0,t.jsx)(c.ProtectedSchemaWarning,{schema:p,entity:"triggers"}),E||0!==(K??[]).length?(0,t.jsx)("div",{className:"w-full overflow-hidden overflow-x-auto",children:(0,t.jsx)(eI.Card,{children:(0,t.jsxs)(eF.Table,{children:[(0,t.jsx)(eF.TableHeader,{children:(0,t.jsxs)(eF.TableRow,{children:[(0,t.jsx)(eF.TableHead,{children:"Name"},"name"),(0,t.jsx)(eF.TableHead,{children:"Table"},"table"),(0,t.jsx)(eF.TableHead,{children:"Function"},"function"),(0,t.jsx)(eF.TableHead,{children:"Events"},"events"),(0,t.jsx)(eF.TableHead,{children:"Orientation"},"orientation"),(0,t.jsx)(eF.TableHead,{className:"w-20",children:"Enabled"},"enabled"),(0,t.jsx)(eF.TableHead,{className:"w-1/12"},"buttons")]})}),(0,t.jsx)(eF.TableBody,{children:(0,t.jsx)(eX,{schema:p,filterString:j,isLocked:E,editTrigger:e=>{M(null),S?(y(eq(e)),_([]),x(ef.SIDEBAR_KEYS.EDITOR_PANEL)):O(e.id.toString())},duplicateTrigger:e=>{S?(y(eq({...e,name:`${e.name}_duplicate`})),_([]),x(ef.SIDEBAR_KEYS.EDITOR_PANEL)):M(e.id.toString())},deleteTrigger:e=>{z(e.id.toString())}})})]})})}):(0,t.jsx)(eA.EmptyStatePresentational,{icon:r.DatabaseZap,title:"Add your first trigger",description:"Make your database reactive. Send updates in realtime, call edge functions, or validate data as it comes in.",children:(0,t.jsx)(eO,{hasTables:D,canCreateTriggers:k,selectedSchema:p,onCreateTrigger:H,showPlusIcon:!1,buttonType:"default"})})]}),(0,t.jsx)(ex,{selectedTrigger:e,open:L,onClose:()=>{$(!1)},isDuplicatingTrigger:!1}),(0,t.jsx)(ex,{selectedTrigger:B||V,open:!!B||!!V,onClose:()=>{O(null),M(null)},isDuplicatingTrigger:!!V}),(0,t.jsx)(h,{trigger:W,visible:!!W,setVisible:z,onDelete:e=>{g.current=e.trigger.id.toString(),Q(e)},isLoading:Y})]})};var eJ=e.i(436855),e0=e.i(448710),e1=e.i(127739),e2=e.i(228027);let e4=()=>(0,t.jsx)(e1.PageContainer,{size:"large",children:(0,t.jsx)(e2.PageSection,{children:(0,t.jsx)(e2.PageSectionContent,{children:(0,t.jsx)(eZ,{})})})});e4.getLayout=e=>(0,t.jsx)(e0.DefaultLayout,{children:(0,t.jsx)(eJ.default,{children:e})}),e.s(["TriggersDataPage",0,e4,"default",0,e4],377722)},841510,(e,t,a)=>{let r="/project/[ref]/database/triggers/data";(window.__NEXT_P=window.__NEXT_P||[]).push([r,()=>e.r(377722)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([r])})}]);

//# debugId=6d4a0fec-ed7a-0f1c-1819-15923855be69
//# sourceMappingURL=ce09bd10cf9a05ce.js.map