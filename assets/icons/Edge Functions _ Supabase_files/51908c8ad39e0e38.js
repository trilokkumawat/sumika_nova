;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="81934e83-36cd-d2c7-f789-479fe8ee85a7")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,363744,(e,t,a)=>{t.exports=function(e){return function(t){return null==e?void 0:e[t]}}},217264,(e,t,a)=>{t.exports=function(e,t,a,s){var i=-1,r=null==e?0:e.length;for(s&&r&&(a=e[++i]);++i<r;)a=t(a,e[i],i,e);return a}},228613,(e,t,a)=>{t.exports=e.r(363744)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"})},901549,(e,t,a)=>{var s=e.r(228613),i=e.r(896955),r=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,n=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");t.exports=function(e){return(e=i(e))&&e.replace(r,s).replace(n,"")}},295464,(e,t,a)=>{var s=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;t.exports=function(e){return e.match(s)||[]}},184140,(e,t,a)=>{var s=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;t.exports=function(e){return s.test(e)}},395330,(e,t,a)=>{var s="\ud800-\udfff",i="\\u2700-\\u27bf",r="a-z\\xdf-\\xf6\\xf8-\\xff",n="A-Z\\xc0-\\xd6\\xd8-\\xde",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",l="['’]",d="["+o+"]",c="["+r+"]",u="[^"+s+o+"\\d+"+i+r+n+"]",p="(?:\ud83c[\udde6-\uddff]){2}",h="[\ud800-\udbff][\udc00-\udfff]",m="["+n+"]",f="(?:"+c+"|"+u+")",x="(?:"+m+"|"+u+")",g="(?:"+l+"(?:d|ll|m|re|s|t|ve))?",j="(?:"+l+"(?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\ud83c[\udffb-\udfff])?",S="[\\ufe0e\\ufe0f]?",v="(?:\\u200d(?:"+["[^"+s+"]",p,h].join("|")+")"+S+y+")*",b="(?:"+["["+i+"]",p,h].join("|")+")"+(S+y+v),C=RegExp([m+"?"+c+"+"+g+"(?="+[d,m,"$"].join("|")+")",x+"+"+j+"(?="+[d,m+f,"$"].join("|")+")",m+"?"+f+"+"+g,m+"+"+j,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",b].join("|"),"g");t.exports=function(e){return e.match(C)||[]}},777699,(e,t,a)=>{var s=e.r(295464),i=e.r(184140),r=e.r(896955),n=e.r(395330);t.exports=function(e,t,a){return(e=r(e),void 0===(t=a?void 0:t))?i(e)?n(e):s(e):e.match(t)||[]}},226581,(e,t,a)=>{var s=e.r(217264),i=e.r(901549),r=e.r(777699),n=RegExp("['’]","g");t.exports=function(e){return function(t){return s(r(i(t).replace(n,"")),e,"")}}},621018,(e,t,a)=>{t.exports=e.r(226581)(function(e,t,a){return e+(a?"_":"")+t.toLowerCase()})},369459,e=>{"use strict";var t=e.i(867088),a=e.i(234745),s=e.i(718727),i=e.i(364850);async function r({projectRef:e,cursor:t,visibility:s,favorite:r,name:n,sort:o},l){if(void 0===e)throw Error("projectRef is required for getSqlSnippets");let{data:d,error:c}=await (0,a.get)("/platform/projects/{ref}/content",{params:{path:{ref:e},query:{type:"sql",cursor:t,visibility:s,favorite:r,name:n,limit:i.SNIPPET_PAGE_LIMIT.toString(),sort_by:o,sort_order:"name"===o?"asc":"desc"}},signal:l});if(c)throw c;return{cursor:d.cursor,contents:d.data}}e.s(["useSqlSnippetsQuery",0,({projectRef:e,sort:a,name:i,visibility:n,favorite:o},{enabled:l=!0,...d}={})=>(0,t.useInfiniteQuery)({queryKey:s.contentKeys.sqlSnippets(e,{sort:a,name:i,visibility:n,favorite:o}),queryFn:({signal:t,pageParam:s})=>r({projectRef:e,cursor:s,sort:a,name:i,visibility:n,favorite:o},t),enabled:l&&void 0!==e,initialPageParam:void 0,getNextPageParam:e=>e.cursor,...d})])},669653,e=>{"use strict";var t=e.i(867088),a=e.i(234745),s=e.i(718727);async function i({projectRef:e,type:t,name:s,limit:i=10,sort:r,cursor:n},o){if(void 0===e)throw Error("projectRef is required for getContent");let{data:l,error:d}=await (0,a.get)("/platform/projects/{ref}/content",{params:{path:{ref:e},query:{type:t,name:s,sort_by:r,limit:i.toString(),cursor:n}},signal:o});return d&&(0,a.handleError)(d),{cursor:l.cursor,content:l.data}}e.s(["useContentInfiniteQuery",0,({projectRef:e,type:a,name:r,limit:n,sort:o},{enabled:l=!0,...d}={})=>(0,t.useInfiniteQuery)({queryKey:s.contentKeys.infiniteList(e,{type:a,name:r,limit:n,sort:o}),queryFn:({signal:t,pageParam:s})=>i({projectRef:e,type:a,name:r,limit:n,sort:o,cursor:s},t),enabled:l&&void 0!==e,initialPageParam:void 0,getNextPageParam:e=>e.cursor,...d})])},364850,e=>{"use strict";var t=e.i(867088),a=e.i(234745),s=e.i(718727);async function i({projectRef:e,cursor:t,sort:s,name:i},r){if(void 0===e)throw Error("projectRef is required");let{data:n,error:o}=await (0,a.get)("/platform/projects/{ref}/content/folders",{params:{path:{ref:e},query:{type:"sql",cursor:t,limit:"100",sort_by:s,sort_order:"name"===s?"asc":"desc",name:i,visibility:"user"}},signal:r});return o&&(0,a.handleError)(o),{...n.data,cursor:n.cursor}}e.s(["SNIPPET_PAGE_LIMIT",0,100,"useSQLSnippetFoldersQuery",0,({projectRef:e,name:a,sort:r},{enabled:n=!0,...o}={})=>(0,t.useInfiniteQuery)({queryKey:s.contentKeys.folders(e,{name:a,sort:r}),queryFn:({signal:t,pageParam:s})=>i({projectRef:e,cursor:s,name:a,sort:r},t),enabled:n&&void 0!==e,initialPageParam:void 0,getNextPageParam:e=>e.cursor,...o})])},830734,e=>{"use strict";let t=(0,e.i(388019).default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);e.s(["default",()=>t])},853322,e=>{"use strict";var t=e.i(242882),a=e.i(234745),s=e.i(718727);async function i({projectRef:e,id:t},s){if(void 0===e)throw Error("projectRef is required");if(void 0===t)throw Error("Content ID is required");let{data:i,error:r}=await (0,a.get)("/platform/projects/{ref}/content/item/{id}",{params:{path:{ref:e,id:t}},signal:s});if(r)throw(0,a.handleError)(r);return i}e.s(["getContentById",()=>i,"useContentIdQuery",0,({projectRef:e,id:a},{enabled:r=!0,...n}={})=>(0,t.useQuery)({queryKey:s.contentKeys.resource(e,a),queryFn:({signal:t})=>i({projectRef:e,id:a},t),enabled:r&&void 0!==e&&void 0!==a,...n})])},528462,e=>{"use strict";var t=e.i(478902),a=e.i(311827),s=e.i(543851),i=e.i(300906),r=e.i(219195),n=e.i(843778),o=e.i(792459);e.s(["EntityTypeIcon",0,({type:e,size:l=15,strokeWidth:d=1.5,isActive:c})=>"sql"===e?(0,t.jsx)(o.SQL_ICON,{size:l,className:(0,n.cn)("transition-colors","fill-foreground-muted","group-aria-selected:fill-foreground","w-4 h-4","-ml-0.5"),strokeWidth:d}):e===a.ENTITY_TYPE.TABLE?(0,t.jsx)(r.Table2,{size:l,strokeWidth:d,className:(0,n.cn)("text-foreground-muted group-hover:text-foreground-lighter group-aria-selected:text-foreground",c&&"text-foreground-light","transition-colors")}):"schema"===e?(0,t.jsx)(i.GitBranch,{size:l,strokeWidth:d}):e===a.ENTITY_TYPE.VIEW?(0,t.jsx)(s.Eye,{size:l,strokeWidth:d,className:(0,n.cn)("text-foreground-muted group-hover:text-foreground-lighter",c&&"text-foreground-lighter","transition-colors")}):(0,t.jsx)("div",{className:(0,n.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",e===a.ENTITY_TYPE.FOREIGN_TABLE&&"text-warning-600/80 dark:text-yellow-900 bg-yellow-500",e===a.ENTITY_TYPE.MATERIALIZED_VIEW&&"text-purple-1100 bg-purple-500",e===a.ENTITY_TYPE.PARTITIONED_TABLE&&"text-foreground-light bg-surface-400 dark:bg-border-stronger"),children:Object.entries(a.ENTITY_TYPE).find(([,t])=>t===e)?.[0]?.[0]?.toUpperCase()})])},951684,e=>{"use strict";let t=(0,e.i(388019).default)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);e.s(["default",()=>t])},300906,e=>{"use strict";var t=e.i(951684);e.s(["GitBranch",()=>t.default])},983783,e=>{"use strict";var t=e.i(533488),a=e.i(389959);e.i(128328);var s=e.i(947748),i=e.i(158639);e.s(["useQuerySchemaState",0,()=>{var e;let{ref:r}=(0,i.useParams)(),n=r&&r.length>0&&window.localStorage.getItem(s.LOCAL_STORAGE_KEYS.LAST_SELECTED_SCHEMA(r))||"public",[o,l]=(e=(0,a.useMemo)(()=>n,[r]),(0,t.useQueryState)("schema",t.parseAsString.withDefault(e).withOptions({clearOnDefault:!1})));return(0,a.useEffect)(()=>{r&&r.length>0&&window.localStorage.setItem(s.LOCAL_STORAGE_KEYS.LAST_SELECTED_SCHEMA(r),o)},[o,r]),{selectedSchema:o,setSelectedSchema:l}}])},152285,e=>{"use strict";var t=e.i(478902),a=e.i(700856),s=e.i(389959),i=e.i(938933);let r=({defaultActiveId:e,activeId:r,type:n="pills",size:o="tiny",block:l,onChange:d,onClick:c,scrollable:u,wrappable:p,addOnBefore:h,addOnAfter:m,listClassNames:f,baseClassNames:x,refs:g,children:j})=>{let y=s.Children.toArray(j),[S,v]=(0,s.useState)(r??e??y?.[0]?.props?.id);(0,s.useMemo)(()=>{r&&r!==S&&v(r)},[r]);let b=(0,i.default)("tabs");function C(e){c?.(e),e!==S&&(d?.(e),v(e))}let w=[b[n].list];return u&&w.push(b.scrollable),p&&w.push(b.wrappable),f&&w.push(f),(0,t.jsxs)(a.Root,{value:S,className:[b.base,x].join(" "),ref:g?.base,children:[(0,t.jsxs)(a.List,{className:w.join(" "),ref:g?.list,children:[h,y.map(e=>{let s=S===e.props.id,i=[b[n].base,b.size[o]];return s?i.push(b[n].active):i.push(b[n].inactive),l&&i.push(b.block),(0,t.jsxs)(a.Trigger,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),C(e.props.id))},onClick:()=>C(e.props.id),value:e.props.id,className:i.join(" "),children:[e.props.icon,(0,t.jsx)("span",{children:e.props.label}),e.props.iconRight]},`${e.props.id}-tab-button`)}),m]}),y]})};r.Panel=({children:e,id:s,className:r})=>{let n=(0,i.default)("tabs");return(0,t.jsx)(a.Content,{value:s,className:[n.content,r].join(" "),children:e})},e.s(["default",0,r])},200409,e=>{"use strict";var t=e.i(152285);e.s(["Tabs",()=>t.default])},238944,e=>{"use strict";var t=e.i(323796),a=e.i(271226),s=e.i(389959);function i({replace:e=!0,arrayKeys:r=[]}={}){let n=JSON.stringify(r),o=(0,s.useMemo)(()=>new Set(r),[n]),l=(0,a.useRouter)(),d=(0,s.useMemo)(()=>Object.fromEntries(Object.entries(l.query).map(([e,t])=>o.has(e)?Array.isArray(t)?[e,t]:[e,[t]]:[e,t])),[o,l.query]),c=(0,t.default)(d);return[d,(0,s.useCallback)(t=>{let a=c.current,s="function"==typeof t?t(a):t,i=Object.fromEntries(Object.entries({...a,...s}).filter(([,e])=>!!e));(e?l.replace:l.push)({pathname:l.pathname,query:i},void 0,{shallow:!0,scroll:!1})},[l,e])]}e.s(["useUrlState",()=>i])},990510,e=>{"use strict";e.i(128328);var t=e.i(947748),a=e.i(158639),s=e.i(124416);let i={editor:void 0,sql:void 0};e.s(["useDashboardHistory",0,()=>{let{ref:e}=(0,a.useParams)(),[r,n,{isSuccess:o}]=(0,s.useLocalStorageQuery)(t.LOCAL_STORAGE_KEYS.DASHBOARD_HISTORY(e??""),i);return{history:r,setLastVisitedTable:e=>{n({...r,editor:e})},setLastVisitedSnippet:e=>{n({...r,sql:e})},isHistoryLoaded:o}}])},839360,e=>{"use strict";let t=(0,e.i(388019).default)("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);e.s(["PanelLeftClose",()=>t],839360)},249960,e=>{"use strict";let t=(0,e.i(388019).default)("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);e.s(["PanelLeftOpen",()=>t],249960)},569715,278889,e=>{"use strict";var t=e.i(478902),a=e.i(742251);e.i(128328);var s=e.i(158639),i=e.i(63519),r=e.i(843778),n=e.i(825713),o=e.i(839360),l=e.i(249960),d=e.i(876298),c=e.i(613580),u=e.i(232107);function p({hideTabs:e}){let{showSidebar:a,setShowSidebar:s,mobileMenuOpen:i,setMobileMenuOpen:n}=(0,d.useAppStateSnapshot)(),p=(0,u.useBreakpoint)("md");return(0,t.jsxs)(c.Tooltip,{children:[(0,t.jsx)(c.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:(0,r.cn)("hidden md:flex items-center justify-center w-10 h-10 hover:bg-surface-100 shrink-0",!e&&"border-b border-b-default"),onClick:()=>{p?n(!i):s(!a)},children:a?(0,t.jsx)(o.PanelLeftClose,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"}):(0,t.jsx)(l.PanelLeftOpen,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"})})}),(0,t.jsxs)(c.TooltipContent,{side:"bottom",children:[a?"Collapse":"Expand"," sidebar"]})]})}var h=e.i(731394),m=e.i(960547),f=e.i(809323),x=e.i(265100),g=e.i(479232),j=e.i(975924),y=e.i(271226),S=e.i(990510),v=e.i(62307),b=e.i(756441),C=e.i(917134),w=e.i(794965),q=e.i(500850),N=e.i(314805),T=e.i(408279),_=e.i(795826),P=e.i(84643),I=e.i(389959),E=e.i(528462),k=e.i(983783);let M=({tab:e,index:a,openTabs:s,onClose:n})=>{let o=(0,_.useEditorType)(),l=(0,i.useTabsStateSnapshot)(),{selectedSchema:d}=(0,k.useQuerySchemaState)(),{attributes:c,listeners:u,setNodeRef:p,transform:h,transition:g,isDragging:y}=(0,m.useSortable)({id:e.id}),S={transform:P.CSS.Transform.toString(h),transition:g,zIndex:+!!y},v=(0,I.useMemo)(()=>s.some(e=>"table"===o&&e.metadata?.schema!==d),[s,d,o]);return(0,t.jsxs)(x.motion.div,{ref:p,style:S,...c,layoutId:e.id,transition:{duration:.045},animate:{opacity:+!y},className:(0,r.cn)("flex items-center h-10 first-of-type:border-l"),children:[(0,t.jsxs)(T.TabsTrigger_Shadcn_,{value:e.id,onAuxClick:t=>{1===t.button&&(t.preventDefault(),n(e.id))},onDoubleClick:()=>l.makeTabPermanent(e.id),className:(0,r.cn)("flex items-center gap-2 pl-3 pr-2.5 text-xs","bg-dash-sidebar/50 dark:bg-surface-100/50","data-[state=active]:bg-dash-sidebar dark:data-[state=active]:bg-surface-100","border-b border-default","data-[state=active]:border-b-background-dash-sidebar dark:data-[state=active]:border-b-background-surface-100","relative group h-full","hover:bg-surface-300 dark:hover:bg-surface-100",e.isPreview&&"italic font-light"),...u,children:[(0,t.jsx)(E.EntityTypeIcon,{type:e.type}),(0,t.jsxs)("div",{className:"flex items-center gap-0",children:[(0,t.jsx)(f.AnimatePresence,{mode:"popLayout",initial:!0,children:v&&(0,t.jsxs)(x.motion.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},transition:{duration:.15},className:"text-foreground-muted group-data-[state=active]:text-foreground-lighter",children:[e?.metadata?.schema,"."]})}),(0,t.jsx)("span",{children:e.label||"Untitled"})]}),(0,t.jsx)("span",{role:"button",onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"p-0.5 ml-1 opacity-0 group-hover:opacity-100 hover:bg-200 rounded-sm cursor-pointer",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onPointerDown:t=>{t.preventDefault(),t.stopPropagation(),n(e.id)},children:(0,t.jsx)(j.X,{size:12,className:"text-foreground-light"})}),(0,t.jsx)("div",{className:"absolute w-full top-0 left-0 right-0 h-px bg-foreground opacity-0 group-data-[state=active]:opacity-100"})]}),a<s.length&&(0,t.jsx)("div",{role:"separator",className:"h-full w-px bg-border"},`separator-${e.id}`)]})},L=({tab:e})=>{let{ref:a}=(0,s.useParams)(),r=(0,i.useTabsStateSnapshot)().tabsMap[e];return r?(0,t.jsxs)(x.motion.div,{layoutId:e,transition:{duration:.045},animate:{opacity:.7},className:"flex relative items-center gap-2 px-3 text-xs bg-dash-sidebar dark:bg-surface-100 shadow-lg rounded-sm h-10",children:[(0,t.jsx)(E.EntityTypeIcon,{type:r.type}),(0,t.jsx)("span",{children:r.label||"Untitled"}),(0,t.jsx)("div",{className:"absolute w-full top-0 left-0 right-0 h-px bg-foreground-muted"})]}):null};var D=e.i(323796);function F(){let e=(0,i.useTabsStateSnapshot)(),t=(0,D.default)(e.tabsMap),a=(0,D.default)(e.recentItems),s=(0,D.default)(e.openTabs);return(0,I.useCallback)(({schemas:r,entities:n})=>{let o=n.map(e=>(0,i.createTabId)(e.type,{id:e.id})),l=[];for(let e of r)l.push(...a.current.filter(t=>t.metadata?.schema===e).map(e=>e.id));let d=[...l.filter(e=>!o.includes(e))];e.removeRecentItems(d);let c=[];for(let e of r)c.push(...s.current.filter(a=>{let s=t.current[a];return s?.metadata?.schema===e}));let u=[...c.filter(e=>!e.startsWith("sql")&&!e.startsWith("schema")&&!o.includes(e))];e.removeTabs(u),s.current.map(e=>t.current[e]).filter(e=>!!e&&i.editorEntityTypes.table?.includes(e.type)).forEach(t=>{let a=n?.find(e=>t.metadata?.tableId===e.id);a&&a.name!==t.label&&e.updateTab(t.id,{label:a.name})})},[])}function O(){let e=(0,i.useTabsStateSnapshot)(),t=(0,D.default)(e.tabsMap),a=(0,D.default)(e.openTabs);return(0,I.useCallback)(({snippets:s})=>{let r=[...s.filter(e=>"sql"===e.type).map(e=>(0,i.createTabId)("sql",{id:e.id})),"sql-templates","sql-quickstarts"],n=a.current.filter(e=>e.startsWith("sql")&&!r.includes(e));e.removeTabs(n);let o=e.getRecentItemsByType("sql");e.removeRecentItems(o?o.filter(e=>!r.includes(e.id)).map(e=>e.id):[]),a.current.map(e=>t.current[e]).filter(e=>!!e&&i.editorEntityTypes.sql?.includes(e.type)).forEach(t=>{let a=s?.find(e=>t.metadata?.sqlId===e.id);a&&a.name!==t.label&&e.updateTab(t.id,{label:a.name})})},[])}function A({activeTab:e,tabCount:t}){let a=(0,I.useRef)(null),s=(0,I.useRef)(t),i=(0,I.useRef)(!0);return(0,I.useEffect)(()=>{a.current&&(a.current.scrollLeft=a.current.scrollWidth)},[]),(0,I.useEffect)(()=>{if(i.current){i.current=!1;return}if(a.current){if(t>s.current)a.current.scrollLeft=a.current.scrollWidth;else if(e){let e=a.current.querySelector('[data-state="active"]');e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}s.current=t}},[e,t]),{tabsListRef:a}}e.s(["useSqlEditorTabsCleanup",()=>O,"useTableEditorTabsCleanUp",()=>F,"useTabsScroll",()=>A],278889);let R=()=>{let{ref:e,id:a}=(0,s.useParams)(),n=(0,y.useRouter)(),{setLastVisitedSnippet:o,setLastVisitedTable:l}=(0,S.useDashboardHistory)(),d=(0,_.useEditorType)(),c=(0,i.useTabsStateSnapshot)(),u=(0,h.useSensors)((0,h.useSensor)(h.PointerSensor,{activationConstraint:{distance:1}})),P=c.openTabs.map(e=>c.tabsMap[e]).filter(e=>void 0!==e),I=n.asPath.includes("/new"),E=d?P.filter(e=>i.editorEntityTypes[d]?.includes(e.type)):[],k=()=>{"table"===d?l(void 0):"sql"===d&&o(void 0)},D=e=>{c.handleTabClose({id:e,router:n,editor:d,onClearDashboardHistory:k})},F=()=>{if(d){let t="table"===d?c.openTabs.filter(e=>!e.startsWith("sql")):c.openTabs.filter(e=>e.startsWith("sql"));c.removeTabs(t),k(),n.push(`/project/${e}/${"table"===d?"editor":"sql"}`)}},{tabsListRef:O}=A({activeTab:c.activeTab,tabCount:E.length});return(0,t.jsxs)(h.DndContext,{sensors:u,onDragEnd:e=>{let{active:t,over:a}=e;if(!a||t.id===a.id)return;let s=c.openTabs.indexOf(t.id.toString()),i=c.openTabs.indexOf(a.id.toString());s!==i&&c.handleTabDragEnd(s,i,t.id.toString(),n)},children:[(0,t.jsxs)(q.Tabs_Shadcn_,{className:"w-full flex",value:I?"new":c.activeTab??void 0,onValueChange:e=>{c.handleTabNavigation(e,n)},children:[(0,t.jsx)(p,{hideTabs:!1}),(0,t.jsxs)(N.TabsList_Shadcn_,{ref:O,className:(0,r.cn)("rounded-b-none gap-0 h-10 flex items-center w-full z-[1]","bg-surface-200 dark:bg-alternative border-none overflow-clip overflow-x-auto"),children:[(0,t.jsx)(m.SortableContext,{items:E.map(e=>e.id),strategy:m.horizontalListSortingStrategy,children:E.map((s,i)=>(0,t.jsxs)(v.ContextMenu_Shadcn_,{children:[(0,t.jsx)(w.ContextMenuTrigger_Shadcn_,{children:(0,t.jsx)(M,{tab:s,index:i,openTabs:P,onClose:()=>D(s.id)},s.id)}),(0,t.jsxs)(b.ContextMenuContent_Shadcn_,{children:[(0,t.jsx)(C.ContextMenuItem_Shadcn_,{onClick:()=>D(s.id),children:"Close"}),(0,t.jsx)(C.ContextMenuItem_Shadcn_,{onClick:()=>(t=>{if(d){let s="table"===d?c.openTabs.filter(e=>!e.startsWith("sql")&&e!==t):c.openTabs.filter(e=>e.startsWith("sql")&&e!==t);c.removeTabs(s),k();let i="table"===d?t.split("-")[1]:t.split("sql-")[1];a!==i&&n.push(`/project/${e}/${"table"===d?"editor":"sql"}/${i}`)}})(s.id),children:"Close Others"}),(0,t.jsx)(C.ContextMenuItem_Shadcn_,{onClick:()=>(t=>{if(d){let a="table"===d?c.openTabs.filter(e=>!e.startsWith("sql")):c.openTabs.filter(e=>e.startsWith("sql")),s=a.indexOf(t),i=a.indexOf(c.activeTab),r=a.slice(s+1);if(c.removeTabs(r),s<i){let a="table"===d?t.split("-")[1]:t.split("sql-")[1];n.push(`/project/${e}/${"table"===d?"editor":"sql"}/${a}`)}}})(s.id),children:"Close to the Right"}),(0,t.jsx)(C.ContextMenuItem_Shadcn_,{onClick:F,children:"Close All"})]})]},s.id))}),I&&(0,t.jsxs)(T.TabsTrigger_Shadcn_,{value:"new",className:(0,r.cn)("flex items-center gap-2 px-3 text-xs","bg-dash-sidebar/50 dark:bg-surface-100/50","data-[state=active]:bg-dash-sidebar dark:data-[state=active]:bg-surface-100","relative group h-full border-t-2 !border-b-0","hover:bg-surface-300 dark:hover:bg-surface-100"),children:[(0,t.jsx)(g.Plus,{size:16,strokeWidth:1.5,className:"text-foreground-lighter"}),(0,t.jsx)("div",{className:"flex items-center gap-0",children:(0,t.jsx)("span",{children:"New"})}),(0,t.jsx)("span",{role:"button",onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"ml-1 opacity-0 group-hover:opacity-100 hover:bg-200 rounded-sm cursor-pointer",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),D("new")},children:(0,t.jsx)(j.X,{size:12,className:"text-foreground-light"})})," ",(0,t.jsx)("div",{className:"absolute w-full -bottom-[1px] left-0 right-0 h-px bg-dash-sidebar dark:bg-surface-100 opacity-0 group-data-[state=active]:opacity-100"})]}),(0,t.jsx)(f.AnimatePresence,{initial:!1,children:!I&&(0,t.jsx)(x.motion.button,{className:"flex items-center justify-center w-10 h-10 hover:bg-surface-100 shrink-0 border-b",onClick:()=>n.push(`/project/${n.query.ref}/${"table"===d?"editor":"sql"}/new?skip=true`),initial:{opacity:0,scale:.8,x:-10},animate:{opacity:1,scale:1,x:0},transition:{duration:.2},children:(0,t.jsx)(g.Plus,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"})})}),(0,t.jsx)("div",{className:"grow h-full border-b pr-6"})]})]}),(0,t.jsx)(h.DragOverlay,{dropAnimation:null,children:c.activeTab?(0,t.jsx)(L,{tab:c.activeTab}):null})]})};e.s(["EditorBaseLayout",0,({children:e,title:o,product:l,productMenuClassName:d,productMenu:c})=>{let{ref:u}=(0,s.useParams)(),h=(0,a.usePathname)(),m=(0,_.useEditorType)(),f=(0,i.useTabsStateSnapshot)(),x="table"===m&&0===f.openTabs.filter(e=>!e.startsWith("sql")).length,g=h===`/project/${u}/editor`||h===`/project/${u}/sql`||x;return(0,t.jsx)(n.ProjectLayoutWithAuth,{resizableSidebar:!0,title:o,product:l,productMenuClassName:d,productMenu:c,children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:(0,r.cn)("h-10 flex items-center",g?"bg-surface-100":"bg-surface-200 dark:bg-alternative"),children:g?(0,t.jsx)(p,{hideTabs:g}):(0,t.jsx)(R,{})}),(0,t.jsx)("div",{className:"h-full",children:e})]})})}],569715)},384706,e=>{"use strict";let t=(0,e.i(388019).default)("Pointer",[["path",{d:"M22 14a8 8 0 0 1-8 8",key:"56vcr3"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1agjmk"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1",key:"wdbh2u"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10",key:"1ibuk9"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"g6ys72"}]]);e.s(["Pointer",()=>t],384706)},556744,e=>{"use strict";var t=e.i(478902),a=e.i(389959),s=e.i(903248);let i=(0,a.memo)(function(){return(0,t.jsx)("div",{className:"px-4 flex flex-col gap-0",children:[{width:"w-40",opacity:"opacity-100"},{width:"w-32",opacity:"opacity-100"},{width:"w-20",opacity:"opacity-75"},{width:"w-40",opacity:"opacity-50"},{width:"w-20",opacity:"opacity-25"}].map((e,a)=>(0,t.jsxs)("div",{className:`flex flex-row h-6 items-center gap-3 ${e.opacity}`,children:[(0,t.jsx)(s.Skeleton,{className:"h-4 w-5"}),(0,t.jsx)(s.Skeleton,{className:`h-4 ${e.width}`})]},a))})});e.s(["default",0,i])},656071,e=>{"use strict";let t=(0,e.i(388019).default)("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]);e.s(["StopCircle",()=>t],656071)},763283,347447,e=>{"use strict";var t=e.i(388019);let a=(0,t.default)("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);e.s(["FolderPlus",()=>a],763283);let s=(0,t.default)("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);e.s(["Move",()=>s],347447)},300475,e=>{"use strict";var t=e.i(38429),a=e.i(355901),s=e.i(234745),i=e.i(10429);e.i(56031);var r=e.i(237948);async function n({sql:e}){let t,a=`${i.BASE_PATH}/api/ai/sql/title-v2`,n=await (0,s.constructHeaders)({"Content-Type":"application/json"}),o=await (0,s.fetchHandler)(a,{headers:n,method:"POST",body:JSON.stringify({sql:e})});try{t=await o.json()}catch{}if(!o.ok)throw new r.ResponseError(t?.message,o.status);return t}e.s(["useSqlTitleGenerateMutation",0,({onSuccess:e,onError:s,...i}={})=>(0,t.useMutation)({mutationFn:e=>n(e),async onSuccess(t,a,s){await e?.(t,a,s)},async onError(e,t,i){void 0===s?a.toast.error(`Failed to generate title: ${e.message}`):s(e,t,i)},...i})])},718726,e=>{"use strict";var t=e.i(830734);e.s(["Heart",()=>t.default])},79221,382986,174753,e=>{"use strict";var t=e.i(478902),a=e.i(55956),s=e.i(61187),i=e.i(656071),r=e.i(389959),n=e.i(355901);e.i(128328);var o=e.i(158639),l=e.i(567558),d=e.i(150671),c=e.i(38429),u=e.i(356003),p=e.i(714403),h=e.i(21150);async function m({pid:e,projectRef:t,connectionString:a}){let s=`select pg_terminate_backend(${e})`,{result:i}=await (0,p.executeSql)({projectRef:t,connectionString:a,sql:s});return i}var f=e.i(242882);async function x({projectRef:e,connectionString:t},a){let s=`
select pid, query, query_start from pg_stat_activity where state = 'active' and datname = 'postgres';
`.trim().trim(),{result:i}=await (0,p.executeSql)({projectRef:e,connectionString:t,sql:s,queryKey:["ongoing-queries"]},a);return(i??[]).filter(e=>!e.query.startsWith(s))}var g=e.i(635494),j=e.i(238944),y=e.i(10429),S=e.i(876298),v=e.i(189329),b=e.i(837710),C=e.i(672044),w=e.i(725137),q=e.i(613580),N=e.i(843778),T=e.i(466472);let _=()=>{let[e,p]=(0,j.useUrlState)({replace:!0}),{viewOngoingQueries:_}=(0,o.useParams)(),{data:P}=(0,g.useSelectedProjectQuery)(),I=(0,v.useDatabaseSelectorStateSnapshot)(),E=(0,S.useAppStateSnapshot)(),[k,M]=(0,r.useState)(),{data:L}=(0,d.useReadReplicasQuery)({projectRef:P?.ref}),D=(L??[]).find(e=>e.identifier===I.selectedDatabaseId),{data:F,error:O,isError:A,isPending:R,isFetching:$,refetch:z}=(({projectRef:e,connectionString:t},{enabled:a=!0,...s}={})=>(0,f.useQuery)({queryKey:h.sqlKeys.ongoingQueries(e),queryFn:({signal:a})=>x({projectRef:e,connectionString:t},a),enabled:a&&void 0!==e,...s}))({projectRef:P?.ref,connectionString:D?.connectionString},{enabled:!y.IS_PLATFORM||y.IS_PLATFORM&&D?.connectionString!==void 0,staleTime:5e3}),Q=F??[];(0,r.useEffect)(()=>{_&&(E.setOnGoingQueriesPanelOpen(!0),p({viewOngoingQueries:void 0}))},[_]);let{mutate:B,isPending:V}=(({onSuccess:e,onError:t,...a}={})=>{let s=(0,u.useQueryClient)();return(0,c.useMutation)({mutationFn:e=>m(e),async onSuccess(t,a,i){let{projectRef:r}=a;await s.invalidateQueries({queryKey:h.sqlKeys.ongoingQueries(r)}),await e?.(t,a,i)},async onError(e,a,s){void 0===t?n.toast.error(`Failed to abort query: ${e.message}`):t(e,a,s)},...a})})({onSuccess:()=>{n.toast.success(`Successfully aborted query (ID: ${k})`),M(void 0)}});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Sheet,{open:E.ongoingQueriesPanelOpen,onOpenChange:()=>void(p({viewOngoingQueries:void 0}),E.setOnGoingQueriesPanelOpen(!1)),children:(0,t.jsxs)(w.SheetContent,{size:"lg",children:[(0,t.jsxs)(w.SheetHeader,{children:[(0,t.jsxs)(w.SheetTitle,{className:"flex items-center gap-x-2",children:["Running queries on"," ",D?.identifier===P?.ref?"primary database":"read replica",(0,t.jsx)(b.Button,{type:"default",className:"px-1.5",loading:R||$,icon:(0,t.jsx)(s.RefreshCw,{}),onClick:()=>z()})]}),(0,t.jsxs)(w.SheetDescription,{children:["There ",1===Q.length?"is":"are"," ",(0,t.jsx)("span",{className:"text-foreground-light",children:Q.length})," quer",1===Q.length?"y":"ies"," currently running"," ",D?.identifier!==P?.ref?`on replica ${D?.identifier}`:""]})]}),(0,t.jsxs)("div",{className:"max-h-full h-full divide-y overflow-y-auto",children:[A&&(0,t.jsx)("div",{className:"flex items-center justify-center h-full px-16",children:(0,t.jsx)(l.default,{subject:"Failed to retrieve ongoing queries",error:O})}),0===Q.length&&(0,t.jsxs)("div",{className:"flex flex-col gap-y-2 items-center justify-center h-full text-foreground-light text-sm",children:[(0,t.jsxs)("span",{children:["No queries are currently running on the"," ",D?.identifier!==P?.ref?`read replica ${D?.identifier}`:(L??[]).length>1?"primary database":"database"]}),(0,t.jsx)(b.Button,{type:"default",loading:R||$,icon:(0,t.jsx)(s.RefreshCw,{}),onClick:()=>z(),children:"Refresh"})]}),Q.map(e=>(0,t.jsxs)(w.SheetSection,{className:"flex justify-between gap-x-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-2 w-full",children:[(0,t.jsx)(C.CodeBlock,{hideLineNumbers:!0,value:e.query,language:"sql",className:(0,N.cn)("max-w-none max-h-52 w-full","!bg-transparent !py-3 !px-3.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsxs)("p",{className:"text-foreground-light text-xs",children:["PID: ",e.pid]}),(0,t.jsx)("p",{className:"text-foreground-light text-xs",children:"•"}),(0,t.jsxs)("p",{className:"text-foreground-light text-xs",children:["Started since: ",(0,a.default)(e.query_start).format("DD MMM YYYY HH:mm (ZZ)")]})]})]}),(0,t.jsxs)(q.Tooltip,{children:[(0,t.jsx)(q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(b.Button,{type:"warning",className:"px-1.5",icon:(0,t.jsx)(i.StopCircle,{}),onClick:()=>M(e.pid)})}),(0,t.jsx)(q.TooltipContent,{side:"bottom",children:"Abort query"})]})]},e.pid))]})]})}),(0,t.jsx)(T.default,{loading:V,variant:"warning",title:`Confirm to abort this query? (ID: ${k})`,visible:void 0!==k,onCancel:()=>M(void 0),onConfirm:()=>{void 0!==k&&B({pid:k,projectRef:P?.ref,connectionString:D?.connectionString})},children:(0,t.jsx)("p",{className:"text-sm",children:"This will force the query to stop running."})})]})},P=(0,e.i(951138).withAuth)(({children:e})=>(0,t.jsxs)(t.Fragment,{children:[e,(0,t.jsx)(_,{})]}));e.s(["default",0,P],79221);let I=(0,e.i(388019).default)("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]);e.s(["FilePlus",()=>I],382986);var E=e.i(621018),k=e.i(17203),M=e.i(210419),L=e.i(425861),D=e.i(739409),F=e.i(40892),O=e.i(200409),A=e.i(592383),R=e.i(888738);e.s(["default",0,({id:e,...a})=>{let s=(0,D.useSqlEditorV2StateSnapshot)(),i=s.snippets[e]?.snippet,n=(0,E.default)(i?.name),[o,l]=(0,r.useState)("CLI"),d=[{id:"migration",label:"Migration",title:"Download as migration",description:`Download the snippet in a new migration named \`${n}\``,cli:(0,R.generateMigrationCliCommand)(e,n),npm:(0,R.generateMigrationCliCommand)(e,n,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,R.generateSeedCliCommand)(e),npm:(0,R.generateSeedCliCommand)(e,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:`Download the snippet directly into a new SQL file named \`${n}.sql\``,cli:(0,R.generateFileCliCommand)(e,n),npm:(0,R.generateFileCliCommand)(e,n,!0)}];return(0,t.jsx)(F.Modal,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,t.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...a,children:(0,t.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 relative pt-2",children:[(0,t.jsx)(O.Tabs,{type:"underlined",listClassNames:"pl-5",children:d.map(e=>(0,t.jsx)(O.Tabs.Panel,{id:e.id,label:e.label,children:(0,t.jsxs)(F.Modal.Content,{className:"!py-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("p",{className:"text-base",children:e.title}),(0,t.jsx)(A.Markdown,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,t.jsx)(L.default,{width:50,options:["CLI","NPM"],activeOption:o,borderOverride:"border-muted",onClickOption:()=>"CLI"===o?l("NPM"):l("CLI")})]}),(0,t.jsx)("pre",{children:(0,t.jsx)(C.CodeBlock,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===o?e.cli:e.npm})})]})},e.id))}),(0,t.jsxs)(F.Modal.Content,{className:"w-full flex items-center justify-between pt-0",children:[(0,t.jsx)("p",{className:"text-xs text-lighter",children:"Run this command from your project directory"}),(0,t.jsxs)("div",{className:"flex justify-between items-center gap-x-2",children:[(0,t.jsx)(b.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(k.ExternalLink,{strokeWidth:1.5}),children:(0,t.jsx)(M.default,{href:`${y.DOCS_URL}/guides/deployment/database-migrations`,target:"_blank",rel:"noreferrer",children:"About migrations"})}),(0,t.jsx)(b.Button,{asChild:!0,type:"default",icon:(0,t.jsx)(k.ExternalLink,{strokeWidth:1.5}),children:(0,t.jsx)(M.default,{href:`${y.DOCS_URL}/guides/cli/local-development`,target:"_blank",rel:"noreferrer",children:"About CLI"})})]})]})]})})}],174753)},275044,973648,919332,578989,e=>{"use strict";var t=e.i(478902),a=e.i(389959),s=e.i(355901);e.i(128328);var i=e.i(158639),r=e.i(215312),n=e.i(598141),o=e.i(300475),l=e.i(377451),d=e.i(853322),c=e.i(420985),u=e.i(540203),p=e.i(265735),h=e.i(10429),m=e.i(271226),f=e.i(739409),x=e.i(63519),g=e.i(602089),j=e.i(837710),y=e.i(441345),S=e.i(171997),v=e.i(40892),b=e.i(743371);e.s(["default",0,({snippet:e={},visible:C,onCancel:w,onComplete:q})=>{let{ref:N}=(0,i.useParams)(),T=(0,m.useRouter)(),{data:_}=(0,p.useSelectedOrganizationQuery)(),P=(0,f.useSqlEditorV2StateSnapshot)(),I=(0,x.useTabsStateSnapshot)(),{data:E}=(0,u.useOrgSubscriptionQuery)({orgSlug:_?.slug},{enabled:C}),k="sql"===e.type,{data:M}=(0,l.useProjectSettingsV2Query)({projectRef:N}),L=(0,b.subscriptionHasHipaaAddon)(E)&&M?.is_sensitive,{id:D,name:F,description:O}=e,[A,R]=(0,a.useState)(F),[$,z]=(0,a.useState)(O),{mutate:Q,isPending:B}=(0,o.useSqlTitleGenerateMutation)({onSuccess:e=>{let{title:t,description:a}=e;R(t),$||z(a)},onError:e=>{s.toast.error(`Failed to rename query: ${e.message}`)}}),{data:V}=(0,n.useCheckOpenAIKeyQuery)(),U=!!V?.hasKey,K=async()=>{if("content"in e&&k)Q({sql:e.content.sql});else try{let{content:t}=await (0,d.getContentById)({projectRef:N,id:e.id});"sql"in t&&Q({sql:t.sql})}catch(e){s.toast.error("Unable to generate title based on query contents")}},{mutateAsync:W}=(0,c.useContentUpsertMutation)(),H=async(t,{setSubmitting:a})=>{if(!N)return console.error("Project ref is required");if(!D)return console.error("Snippet ID is required");a(!0);try{let t=e;"content"in t||(t=await (0,d.getContentById)({projectRef:N,id:D}),P.addSnippet({projectRef:N,snippet:t}));let a=await W({projectRef:N,payload:{...t,name:A,description:$}});if(h.IS_PLATFORM){P.renameSnippet({id:D,name:A,description:$});let e=(0,x.createTabId)("sql",{id:D});I.updateTab(e,{label:A})}else if(a){P.removeSnippet(D,!0),P.addSnippet({projectRef:N,snippet:a});let e=(0,x.createTabId)("sql",{id:D});I.hasTab(e)&&(I.removeTab(e),await T.push(`/project/${N}/sql/${a.id}`))}s.toast.success("Successfully renamed snippet!"),q&&q()}catch(e){a(!1),s.toast.error(`Failed to rename snippet: ${e.message}`)}};return(0,a.useEffect)(()=>{R(F),z(O)},[e.id]),(0,t.jsx)(v.Modal,{visible:C,onCancel:w,hideFooter:!0,header:"Rename",size:"small",children:(0,t.jsx)(y.Form,{onReset:w,validateOnBlur:!0,initialValues:{name:F??"",description:O??""},validate:()=>{let e={};return A||(e.name="Please enter a query name"),e},onSubmit:H,children:({isSubmitting:e})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(v.Modal.Content,{className:"space-y-4",children:[(0,t.jsx)(S.Input,{label:"Name",id:"name",name:"name",value:A,onChange:e=>R(e.target.value)}),(0,t.jsx)("div",{className:"flex w-full justify-end mt-2",children:!L&&(0,t.jsx)(r.ButtonTooltip,{type:"default",onClick:()=>K(),size:"tiny",disabled:B||!U,tooltip:{content:{side:"bottom",text:U?void 0:'Add your "OPENAI_API_KEY" to your environment variables to use this feature.'}},children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"scale-75",children:(0,t.jsx)(g.AiIconAnimation,{loading:B})}),(0,t.jsx)("span",{children:"Rename with Supabase AI"})]})})}),(0,t.jsx)(S.Input.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:$,onChange:e=>z(e.target.value)})]}),(0,t.jsx)(v.Modal.Separator,{}),(0,t.jsxs)(v.Modal.Content,{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(j.Button,{htmlType:"reset",type:"default",onClick:w,disabled:e,children:"Cancel"}),(0,t.jsx)(j.Button,{htmlType:"submit",loading:e,disabled:e,children:"Rename query"})]})]})})})}],275044);var C=e.i(242882),w=e.i(234745),q=e.i(718727);async function N({projectRef:e,type:t,name:a},s){if(void 0===e)throw Error("projectRef is required");let{data:i,error:r}=await (0,w.get)("/platform/projects/{ref}/content/count",{params:{path:{ref:e},query:{...t&&{type:t},...a&&{name:a}}},headers:{Version:"2"},signal:s});if(r)throw(0,w.handleError)(r);return i}e.s(["useContentCountQuery",0,({projectRef:e,type:t,name:a},{enabled:s=!0,...i}={})=>(0,C.useQuery)({queryKey:q.contentKeys.count(e,t,{name:a}),queryFn:({signal:s})=>N({projectRef:e,type:t,name:a},s),enabled:s&&void 0!==e,...i})],973648);var T=e.i(586011),_=e.i(466472);e.s(["DeleteSnippetsModal",0,({snippets:e,visible:a,onClose:r})=>{let n=(0,m.useRouter)(),{ref:o,id:l}=(0,i.useParams)(),d=(0,x.useTabsStateSnapshot)(),c=(0,f.useSqlEditorV2StateSnapshot)(),u=e=>{if(l&&e.includes(l)){let e=d.openTabs.filter(e=>e.startsWith("sql-")&&!e.includes(l));if(e.length>0){let t=e[0].split("sql-")[1];n.push(`/project/${o}/sql/${t}`)}else n.push(`/project/${o}/sql/new`)}e.length>0&&e.forEach(e=>c.removeSnippet(e))},{mutate:p,isPending:h}=(0,T.useContentDeleteMutation)({onSuccess:t=>{s.toast.success(`Successfully deleted ${e.length.toLocaleString()} quer${e.length>1?"ies":"y"}`);let a=t.map(e=>(0,x.createTabId)("sql",{id:e}));d.removeTabs(a),u(t),r()},onError:(e,t)=>{e.message.includes("Contents not found")?(u(t.ids),r()):s.toast.error(`Failed to delete query: ${e.message}`)}});return(0,t.jsx)(_.default,{size:"small",visible:a,title:`Confirm to delete ${1===e.length?"query":`${e.length.toLocaleString()} quer${e.length>1?"ies":"y"}`}`,confirmLabel:`Delete ${e.length.toLocaleString()} quer${e.length>1?"ies":"y"}`,confirmLabelLoading:"Deleting query",loading:h,variant:"destructive",onCancel:r,onConfirm:()=>{if(!o)return console.error("Project ref is required");p({projectRef:o,ids:e.map(e=>e.id)})},alert:e[0]?.visibility==="project"?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,children:(0,t.jsxs)("p",{className:"text-sm",children:["This action cannot be undone."," ",1===e.length?`Are you sure you want to delete '${e[0]?.name}'?`:`Are you sure you want to delete the selected ${e.length} quer${e.length>1?"ies":"y"}?`]})})}],919332);let P={id:0,name:"",parent:null,children:[]};function I(e){let t=new Set,a=e.filter(e=>0===e.parent);if(a.length>0){let e=a[a.length-1];"string"==typeof e.id&&t.add(e.id),a.forEach(e=>{if(e.children.length>0){let a=e.children[e.children.length-1];"string"==typeof a&&t.add(a)}})}return t}e.s(["ROOT_NODE",0,P,"formatFolderResponseForTreeView",0,e=>{if(void 0===e)return[P];let{folders:t,contents:a}=e,s=t?.map(e=>{let{id:t,name:s}=e;return{id:t,name:s,parent:0,isBranch:!0,children:a?.filter(e=>e.folder_id===t).map(e=>e.id)??[],metadata:e}})||[],i=a?.map(e=>{let{id:t,name:a,folder_id:s}=e;return{id:t,name:a,parent:s??0,children:[],metadata:e}})||[];return[{id:0,name:"",parent:null,children:[...(t||[])?.map(e=>e.id),...(a||[]).filter(e=>!e.folder_id)?.map(e=>e.id)]},...s,...i]},"getLastItemIds",()=>I],578989)},326204,e=>{"use strict";var t=e.i(478902),a=e.i(902858),s=e.i(202584);e.i(128328);var i=e.i(947748),r=e.i(158639),n=e.i(382986),o=e.i(763283),l=e.i(479232),d=e.i(975924),c=e.i(271226),u=e.i(389959),p=e.i(355901),h=e.i(2579),m=e.i(124416),f=e.i(635494),x=e.i(432478),g=e.i(876298),j=e.i(739409),y=e.i(837710),S=e.i(874311),v=e.i(613580),b=e.i(498377),C=e.i(774803),w=e.i(201844),q=e.i(174753),N=e.i(275044),T=e.i(973648),_=e.i(669653),P=e.i(364850),I=e.i(63519),E=e.i(792459),k=e.i(108151),M=e.i(919332),L=e.i(578989),D=e.i(816467),F=e.i(786741),O=e.i(53071),A=e.i(17203),R=e.i(718726),$=e.i(250503),z=e.i(347447),Q=e.i(388019);let B=(0,Q.default)("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var V=e.i(211570),U=e.i(210419),K=e.i(86086),W=e.i(888738),H=e.i(853322),Y=e.i(867088),G=e.i(234745),Z=e.i(718727);async function X({projectRef:e,folderId:t,cursor:a,sort:s,name:i},r){if(void 0===e)throw Error("projectRef is required");if(void 0===t)throw Error("folderId is required");let{data:n,error:o}=await (0,G.get)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:e,id:t},query:{cursor:a,limit:P.SNIPPET_PAGE_LIMIT.toString(),sort_by:s,sort_order:"name"===s?"asc":"desc",name:i}},signal:r});return o&&(0,G.handleError)(o),{...n.data,cursor:n.cursor}}var J=e.i(323796),ee=e.i(756441),et=e.i(917134),ea=e.i(644131),es=e.i(794965),ei=e.i(62307),er=e.i(843778);let en=({element:e,isBranch:s,isExpanded:i,level:n,status:o,isSelected:d,isMultiSelected:p,getNodeProps:m,onSelectCreate:g,onSelectDelete:S,onSelectRename:v,onSelectMove:b,onSelectShare:C,onSelectUnshare:q,onSelectDownload:N,onEditSave:T,onMultiSelect:_,isLastItem:P,hasNextPage:I,fetchNextPage:k,isFetchingNextPage:M,sort:L,name:Q,onFolderContentsChange:G,...en})=>{let eo=(0,c.useRouter)(),{id:el,ref:ed}=(0,r.useParams)(),{profile:ec}=(0,x.useProfile)(),{data:eu}=(0,f.useSelectedProjectQuery)(),{className:ep,onClick:eh}=m(),em=(0,j.useSqlEditorV2StateSnapshot)(),ef=ec?.id===e?.metadata.owner_id,ex="project"===e.metadata.visibility,eg=e.metadata.favorite,ej="editing"===o,{can:ey}=(0,h.useAsyncCheckPermissions)(a.PermissionAction.CREATE,"user_content",{resource:{type:"sql",owner_id:ec?.id},subject:{id:ec?.id}}),eS=0===e.parent?void 0:e.parent,ev=s&&i,{data:eb,isSuccess:eC,isLoading:ew,isFetchingNextPage:eq,hasNextPage:eN,fetchNextPage:eT,isPlaceholderData:e_,isFetching:eP}=(({projectRef:e,folderId:t,name:a,sort:s},{enabled:i=!0,...r}={})=>(0,Y.useInfiniteQuery)({queryKey:Z.contentKeys.folderContents(e,t,{name:a,sort:s}),queryFn:({signal:i,pageParam:r})=>X({projectRef:e,folderId:t,cursor:r,name:a,sort:s},i),enabled:i&&void 0!==e&&void 0!==t,initialPageParam:void 0,getNextPageParam:e=>e.cursor,...r}))({projectRef:ed,folderId:eS??e.id,name:Q,sort:L},{enabled:ev,placeholderData:w.keepPreviousData});(0,u.useEffect)(()=>{ed&&eC&&eb.pages.forEach(e=>{e.contents?.forEach(e=>{em.addSnippet({projectRef:ed,snippet:e})})})},[ed,eb?.pages]);let eI=(0,J.default)(G);(0,u.useEffect)(()=>{ev&&eI.current?.({isLoading:ew||e_&&eP,snippets:eb?.pages.flatMap(e=>e.contents??[])})},[eb?.pages,eP,ew,e_,ev]);let eE=void 0!==eS,ek=async()=>{if(!ec)return console.error("Profile is required");if(!eu)return console.error("Project is required");if(!ed)return console.error("Project ref is required");if(!el)return console.error("Snippet ID is required");let t=e.metadata,a="";if(t.content&&t.content.sql)a=t.content.sql;else{let{content:e}=await (0,H.getContentById)({projectRef:ed,id:t.id});"sql"in e&&(a=e.sql)}let s=(0,W.createSqlSnippetSkeletonV2)({name:`${t.name} (Duplicate)`,sql:a,owner_id:ec?.id,project_id:eu?.id});em.addSnippet({projectRef:ed,snippet:s}),em.addNeedsSaving(s.id),eo.push(`/project/${ed}/sql/${s.id}`)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(ei.ContextMenu_Shadcn_,{modal:!1,children:[(0,t.jsx)(es.ContextMenuTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(E.TreeViewItem,{className:ep,level:n,isExpanded:i,isBranch:s,isSelected:d,isPreview:en.isPreview,isEditing:ej,isLoading:ev&&ew||"saving"===o,onEditSubmit:e=>{void 0!==T&&T(e)},onClick:t=>{s?ej||eh(t):t.shiftKey&&"new"!==el?_?.(e.id):eo.push(`/project/${ed}/sql/${e.id}`)},...en,name:e.name,nameForTitle:en.nameForTitle,description:e.metadata?.description||void 0,xPadding:16})}),(0,t.jsx)(ee.ContextMenuContent_Shadcn_,{onCloseAutoFocus:e=>e.stopPropagation(),children:s?(0,t.jsxs)(t.Fragment,{children:[void 0!==g&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>g(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(l.Plus,{size:14}),"Create new snippet"]}),void 0!==v&&ef&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(O.Edit,{size:14}),"Rename folder"]}),void 0!==S&&ef&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.ContextMenuSeparator_Shadcn_,{}),(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>S(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(V.Trash,{size:14}),"Delete folder"]})]})]}):p?(0,t.jsxs)(t.Fragment,{children:[void 0!==b&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>b(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(z.Move,{size:14}),"Move selected queries"]}),(0,t.jsx)(ea.ContextMenuSeparator_Shadcn_,{}),void 0!==S&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>S(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(V.Trash,{size:14}),"Delete selected queries"]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(et.ContextMenuItem_Shadcn_,{asChild:!0,className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),children:(0,t.jsxs)(U.default,{target:"_self",rel:"noreferrer",href:`/project/${ed}/sql/${e.id}`,children:[(0,t.jsx)(A.ExternalLink,{size:14}),"Open in new tab"]})}),(0,t.jsx)(ea.ContextMenuSeparator_Shadcn_,{}),void 0!==v&&ef&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(O.Edit,{size:14}),"Rename query"]}),void 0!==b&&ef&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>b(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(z.Move,{size:14}),"Move query"]}),void 0!==C&&!ex&&ey&&K.IS_PLATFORM&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>C(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(B,{size:14}),"Share query with team"]}),void 0!==q&&ex&&ef&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>q(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)($.Lock,{size:14}),"Unshare query with team"]}),void 0!==ek&&ey&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>ek(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(D.Copy,{size:14}),"Duplicate query"]}),K.IS_PLATFORM&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>{let t;(t=e.metadata.id)&&(eg?em.removeFavorite(t):em.addFavorite(t))},onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(R.Heart,{size:14,className:(0,er.cn)(eg?"fill-brand stroke-none":"fill-none stroke-foreground-light")}),eg?"Remove from":"Add to"," favorites"]}),void 0!==N&&K.IS_PLATFORM&&(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>N(),onFocusCapture:e=>e.stopPropagation(),children:[(0,t.jsx)(F.Download,{size:14}),"Download as migration file"]}),void 0!==S&&ef&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.ContextMenuSeparator_Shadcn_,{}),(0,t.jsxs)(et.ContextMenuItem_Shadcn_,{className:"gap-x-2",onSelect:()=>S(),children:[(0,t.jsx)(V.Trash,{size:14}),"Delete query"]})]})]})})]}),(eE?eN:I)&&"string"==typeof e.id&&P&&(0,t.jsx)("div",{className:"px-4 py-1",style:{paddingLeft:!e.isBranch&&e.level>1?48*(e.level-1):void 0},children:(0,t.jsx)(y.Button,{type:"outline",size:"tiny",block:!0,loading:eE?eq:M,disabled:eE?eq:M,onClick:function(){eE?eT():"function"==typeof k&&k()},children:"Load More"})})]})};var eo=e.i(543851),el=e.i(701087),ed=e.i(420985),ec=e.i(466472);let eu=({snippet:e,onClose:a,onSuccess:s})=>{let{ref:i}=(0,r.useParams)(),n=(0,j.useSqlEditorV2StateSnapshot)(),{mutate:o,isPending:l}=(0,ed.useContentUpsertMutation)({onError:e=>{p.toast.error(`Failed to update query: ${e.message}`)}}),d=async()=>{if(!i)return console.error("Project ref is required");if(!e)return console.error("Snippet ID is required");let t=n.snippets[e.id],r=t?.snippet?.content;if(void 0===r){let{content:t}=await (0,H.getContentById)({projectRef:i,id:e.id});r=t}if(void 0===r)return p.toast.error("Unable to update snippet visibility: Content is missing");o({projectRef:i,payload:{...e,visibility:"project",folder_id:null,content:r}},{onSuccess:()=>{n.updateSnippet({id:e.id,snippet:{visibility:"project",folder_id:null},skipSave:!0}),p.toast.success("Snippet is now shared to the project"),s?.(),a()}})};return(0,t.jsx)(ec.default,{size:"medium",loading:l,title:`Confirm to share query: ${e?.name}`,confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:void 0!==e,onCancel:()=>a(),onConfirm:()=>d(),alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},children:(0,t.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,t.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,t.jsx)(eo.Eye,{size:16}),(0,t.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,t.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,t.jsx)(el.Unlock,{size:16}),(0,t.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})})};var ep=e.i(216518),ep=ep;let eh=({snippet:e,onClose:a,onSuccess:s})=>{let{ref:i}=(0,r.useParams)(),n=(0,j.useSqlEditorV2StateSnapshot)(),{mutate:o,isPending:l}=(0,ed.useContentUpsertMutation)({onError:e=>{p.toast.error(`Failed to update query: ${e.message}`)}}),d=async()=>{if(!i)return console.error("Project ref is required");if(!e)return console.error("Snippet ID is required");let t=n.snippets[e.id],r=t?.snippet?.content;if(void 0===r){let{content:t}=await (0,H.getContentById)({projectRef:i,id:e.id});r=t}if(void 0===r)return p.toast.error("Unable to update snippet visibility: Content is missing");o({projectRef:i,payload:{...e,visibility:"user",folder_id:null,content:r}},{onSuccess:()=>{n.updateSnippet({id:e.id,snippet:{visibility:"user",folder_id:null},skipSave:!0}),p.toast.success("Snippet is now unshared from the project"),s?.(),a()}})};return(0,t.jsx)(ec.default,{size:"medium",title:`Confirm to unshare query: ${e?.name}`,confirmLabel:"Unshare query",confirmLabelLoading:"Unsharing query",visible:void 0!==e,onCancel:()=>a(),onConfirm:()=>d(),alert:{title:"This SQL query will no longer be public to all team members",description:"Only you will have access to this query"},children:(0,t.jsx)("ul",{"data-testid":"confirm-unshare-snippet-modal",className:"text-sm text-foreground-light space-y-5",children:(0,t.jsxs)("li",{className:"flex gap-3",children:[(0,t.jsx)(ep.default,{}),(0,t.jsx)("span",{children:"Project members will no longer be able to view this query."})]})})})},em=({search:e})=>{let{id:a}=(0,r.useParams)(),s=(0,I.useTabsStateSnapshot)(),{ref:i}=(0,r.useParams)(),[n,o]=(0,u.useState)(),[l,d]=(0,u.useState)(),[c,p]=(0,u.useState)(),[h,m]=(0,u.useState)(),[f,x]=(0,u.useState)(),{data:g,isPending:j,hasNextPage:y,fetchNextPage:S,isFetchingNextPage:v}=(0,_.useContentInfiniteQuery)({projectRef:i,type:"sql",limit:P.SNIPPET_PAGE_LIMIT,name:0===e.length?void 0:e},{placeholderData:w.keepPreviousData}),{data:b,isPending:D}=(0,T.useContentCountQuery)({projectRef:i,type:"sql",name:e},{placeholderData:w.keepPreviousData}),F=b?b.private+b.shared:0,O=(0,u.useMemo)(()=>g?.pages.flatMap(e=>e.content.map(e=>({...e,folder_id:null}))),[g?.pages]),A=(0,L.formatFolderResponseForTreeView)({folders:[],contents:O}),R=(0,u.useMemo)(()=>(0,L.getLastItemIds)(A),[A]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col flex-grow",children:[D?(0,t.jsx)("div",{className:"px-4 py-1 pb-2.5",children:(0,t.jsx)(C.Loader2,{className:"animate-spin",size:14})}):b?(0,t.jsxs)("p",{className:"px-4 pb-2 text-sm text-foreground-lighter",children:[F," result",F>1?"s":""," found"]}):null,j?(0,t.jsxs)("div",{className:"px-4 flex flex-col gap-y-1",children:[(0,t.jsx)(k.ShimmeringLoader,{className:"py-2.5"}),(0,t.jsx)(k.ShimmeringLoader,{className:"py-2.5 w-5/6"}),(0,t.jsx)(k.ShimmeringLoader,{className:"py-2.5 w-3/4"})]}):(0,t.jsx)(E.TreeView,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:A,"aria-label":"private-snippets",nodeRenderer:({element:e,...i})=>{let r=Object.values(s.tabsMap).some(t=>t.metadata?.sqlId===e.metadata?.id),n=(0,I.createTabId)("sql",{id:e?.metadata?.id}),l=s.previewTabId===n,c=!l&&e.metadata?.id===a,u=e.metadata?.visibility==="user"?"Private":e.metadata?.visibility==="project"?"Shared":void 0;return(0,t.jsx)(en,{...i,element:{...e,name:(0,t.jsxs)("span",{className:"flex flex-col py-0.5",children:[(0,t.jsx)("span",{className:"truncate",children:e.name}),!!u&&(0,t.jsx)("span",{className:"text-foreground-lighter text-xs",children:u})]})},nameForTitle:e.name,isBranch:!1,isOpened:r&&!l,isSelected:c,isPreview:l,isLastItem:R.has(e.id),status:"idle",className:"items-start h-[40px] [&>svg]:translate-y-0.5",onSelectDelete:()=>x(e.metadata),onSelectRename:()=>m(e.metadata),onSelectDownload:()=>p(e.metadata),onSelectShare:()=>o(e.metadata),onSelectUnshare:()=>d(e.metadata),hasNextPage:y,fetchNextPage:S,isFetchingNextPage:v,onDoubleClick:e=>{e.preventDefault(),s.makeTabPermanent(n)}})}})]}),(0,t.jsx)(eu,{snippet:n,onClose:()=>o(void 0)}),(0,t.jsx)(eh,{snippet:l,onClose:()=>d(void 0)}),(0,t.jsx)(q.default,{id:c?.id??"",visible:void 0!==c,onCancel:()=>p(void 0)}),(0,t.jsx)(N.default,{snippet:h,visible:!!h,onCancel:()=>m(void 0),onComplete:()=>m(void 0)}),(0,t.jsx)(M.DeleteSnippetsModal,{visible:!!f,snippets:f?[f]:[],onClose:()=>x(void 0)})]})};var ef=e.i(532728),ex=e.i(370410),eg=e.i(454370),ej=e.i(408891),ey=e.i(531837),eS=e.i(42017),ev=e.i(703526),eb=e.i(917007),eC=e.i(920432),ew=e.i(549815),eq=e.i(911509),eN=e.i(996960),eT=e.i(866205),e_=e.i(253214),eP=e.i(24315),eI=e.i(61863),eE=e.i(191209),ek=e.i(837243),eM=e.i(846887),eL=e.i(428353),eD=e.i(378277),eF=e.i(9679),eO=e.i(793912),eA=e.i(135144),eR=e.i(689805),e$=e.i(396831);let ez=({visible:e,snippets:a=[],onClose:s})=>{let{ref:i}=(0,r.useParams)(),n=(0,j.useSqlEditorV2StateSnapshot)(),o=(0,I.useTabsStateSnapshot)(),d=(0,c.useRouter)(),[h,m]=(0,u.useState)(!1),[f,x]=(0,u.useState)(),{mutateAsync:g,isPending:S}=(0,eS.useSQLSnippetFolderCreateMutation)({onError:e=>{p.toast.error(`Failed to create new folder: ${e.message}`)}}),{mutateAsync:v,isPending:b}=(0,ed.useContentUpsertMutation)({onError:e=>{p.toast.error(`Failed to move query: ${e.message}`)}}),C="new-folder"===f?ey.object({name:ey.string().min(1,"Please provide a name for the folder")}).refine(e=>!n.allFolderNames.includes(e.name),{message:"This folder name already exists",path:["name"]}):ey.object({}),w=(0,ej.useForm)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,ef.zodResolver)(C),defaultValues:{name:""}}),q=(0,j.useSnippetFolders)(i),N="root"===f?"Root of the editor":"new-folder"===f?"Create a new folder":q.find(e=>e.id===f)?.name,T=1===a.length&&(!a[0].folder_id&&"root"===f||a[0].folder_id===f),_=1===a.length&&(!a[0].folder_id&&"root"===f||a[0].folder_id===f),P=async e=>{if(!i)return console.error("Project ref is required");try{let t=f;if("new-folder"===f&&"name"in e){let{id:a}=await g({projectRef:i,name:e.name});t=a}await Promise.all(a.map(async e=>{let a=e?.content;if(void 0===a){let{content:t}=await (0,H.getContentById)({projectRef:i,id:e.id});"sql"in t&&(a=t)}if(void 0===a)return p.toast.error("Failed to save snippet: Unable to retrieve snippet contents");{let s=await v({projectRef:i,payload:{id:e.id,type:"sql",name:e.name,description:e.description,visibility:e.visibility,project_id:e.project_id,owner_id:e.owner_id,folder_id:"root"===f?null:t,content:a}});if(K.IS_PLATFORM)n.updateSnippet({id:e.id,snippet:{...e,folder_id:"root"===f?null:t},skipSave:!0});else if(s){n.removeSnippet(e.id,!0),n.addSnippet({projectRef:i,snippet:s});let t=(0,I.createTabId)("sql",{id:e.id});o.hasTab(t)&&(o.removeTab(t),await d.push(`/project/${i}/sql/${s.id}`))}}})),p.toast.success(`Successfully moved ${1===a.length?`"${a[0].name}"`:`${a.length} snippets`} to ${"root"===f?"the root of the editor":N}`),s()}catch(e){console.error("Error moving snippets:",e)}};return(0,u.useEffect)(()=>{e&&void 0!==a&&(1===a.length?x(a[0].folder_id??"root"):x("root"),w.reset({name:""}))},[e,a]),(0,t.jsx)(e_.Dialog,{open:e,onOpenChange:()=>s(),children:(0,t.jsx)(e_.DialogContent,{children:(0,t.jsx)(eL.Form_Shadcn_,{...w,children:(0,t.jsxs)("form",{id:"move-snippet",onSubmit:w.handleSubmit(P),children:[(0,t.jsxs)(e_.DialogHeader,{children:[(0,t.jsxs)(e_.DialogTitle,{children:["Move ",1===a.length?`"${a[0].name}"`:`${a.length}`," ","snippet",a.length>1?"s":""," to a folder"]}),(0,t.jsxs)(e_.DialogDescription,{children:["Select which folder to move your quer",a.length>1?"ies":"y"," to"]})]}),(0,t.jsx)(e_.DialogSectionSeparator,{}),(0,t.jsxs)(e_.DialogSection,{className:"py-5 flex flex-col gap-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)(eF.Label_Shadcn_,{className:"text-foreground-light",children:"Select a folder"}),(0,t.jsxs)(eR.Popover_Shadcn_,{open:h,onOpenChange:m,modal:!1,children:[(0,t.jsx)(eA.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(y.Button,{block:!0,size:"small",type:"default",className:"pr-2 justify-between",iconRight:(0,t.jsx)(eg.Code,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[N,T&&" (Current)"]})})}),(0,t.jsx)(eO.PopoverContent_Shadcn_,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,t.jsxs)(eT.Command_Shadcn_,{children:[(0,t.jsx)(eC.CommandInput_Shadcn_,{placeholder:"Find folder..."}),(0,t.jsxs)(eq.CommandList_Shadcn_,{children:[(0,t.jsx)(ev.CommandEmpty_Shadcn_,{children:"No folders found"}),(0,t.jsx)(eb.CommandGroup_Shadcn_,{children:(0,t.jsxs)(e$.ScrollArea,{className:(q||[]).length>6?"h-[210px]":"",children:[(0,t.jsxs)(ew.CommandItem_Shadcn_,{value:"root",className:"cursor-pointer w-full justify-between",onSelect:()=>{m(!1),x("root")},onClick:()=>{m(!1),x("root")},children:[(0,t.jsxs)("span",{children:["Root of the editor",1===a.length&&null===a[0].folder_id&&" (Current)"]}),"root"===f&&(0,t.jsx)(ex.Check,{size:14})]},"root"),q?.map(e=>(0,t.jsxs)(ew.CommandItem_Shadcn_,{value:e.name,className:"cursor-pointer w-full justify-between",onSelect:()=>{m(!1),x(e.id)},onClick:()=>{m(!1),x(e.id)},children:[(0,t.jsxs)("span",{children:[e.name,1===a.length&&a[0].folder_id===e.id&&" (Current)"]}),e.id===f&&(0,t.jsx)(ex.Check,{size:14})]},e.id))]})}),(0,t.jsx)(eN.CommandSeparator_Shadcn_,{}),(0,t.jsx)(eb.CommandGroup_Shadcn_,{children:(0,t.jsxs)(ew.CommandItem_Shadcn_,{className:"cursor-pointer w-full justify-start gap-x-2",onSelect:e=>{m(!1),x("new-folder")},onClick:()=>{m(!1),x("new-folder")},children:[(0,t.jsx)(l.Plus,{size:14,strokeWidth:1.5}),(0,t.jsx)("p",{children:"New folder"})]})})]})]})})]})]}),"new-folder"===f&&(0,t.jsx)("div",{className:"flex flex-col gap-y-2",children:(0,t.jsx)(eI.FormField_Shadcn_,{name:"name",control:w.control,render:({field:e})=>(0,t.jsxs)(eE.FormItem_Shadcn_,{className:"flex flex-col gap-y-2",children:[(0,t.jsx)(ek.FormLabel_Shadcn_,{children:"Provide a name for your new folder"}),(0,t.jsx)(eP.FormControl_Shadcn_,{children:(0,t.jsx)(eD.Input_Shadcn_,{autoFocus:!0,...e,autoComplete:"off",disabled:b||S})}),(0,t.jsx)(eM.FormMessage_Shadcn_,{})]})})})]}),(0,t.jsxs)(e_.DialogFooter,{children:[(0,t.jsx)(y.Button,{type:"default",disabled:b||S,onClick:()=>s(),children:"Cancel"}),(0,t.jsx)(y.Button,{type:"primary",htmlType:"submit",disabled:_,loading:b||S,children:"Move file"})]})]})})})})};var eQ=e.i(260305),eB=e.i(384706);let eV=()=>(0,t.jsx)(b.InnerSideBarEmptyPanel,{title:"No private queries created yet",description:"Queries will be automatically saved once you start writing in the editor",className:"mx-4",children:(0,t.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,t.jsxs)("div",{className:"relative h-content",children:[(0,t.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,t.jsx)("div",{className:"absolute left-[128px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,t.jsx)(eB.Pointer,{size:16,className:"text-foreground-light",strokeWidth:1.5})}),[void 0,void 0,void 0,void 0].map((e,a)=>(0,t.jsx)("div",{className:"border-l pointer-events-none",children:(0,t.jsx)(E.TreeViewItem,{isSelected:2===a,id:`dummy-${a+1}`,name:`dummy_query_${a+1}`,level:1,xPadding:16})},`dummy-${a+1}`))]})})});var eU=e.i(556744),eK=e.i(278889),eW=e.i(586011),eH=e.i(38429),eY=e.i(356003);async function eG({projectRef:e,ids:t},a){let{data:s,error:i}=await (0,G.del)("/platform/projects/{ref}/content/folders",{params:{path:{ref:e},query:{ids:t}},signal:a});if(i)throw(0,G.handleError)(i);return s}var eZ=e.i(369459);let eX=(0,Q.default)("BookText",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]]),eJ={shared:!1,favorite:!1,private:!0,community:!0},e0=["templates","quickstarts"];function e1(){let{ref:e}=(0,r.useParams)(),a=(0,c.useRouter)(),[s,n]=(0,m.useLocalStorage)(i.LOCAL_STORAGE_KEYS.SQL_EDITOR_SECTION_STATE(e??""),eJ),{community:o}=s;return(0,t.jsxs)(b.InnerSideMenuCollapsible,{className:"px-0",open:o,onOpenChange:e=>{n({...s??eJ,community:e})},children:[(0,t.jsx)(b.InnerSideMenuCollapsibleTrigger,{title:"Community"}),(0,t.jsx)(b.InnerSideMenuCollapsibleContent,{className:"group-data-[state=open]:pt-2",children:e0.map(s=>{let i=a.asPath===`/project/${e}/sql/${s}`;return(0,t.jsxs)(b.InnerSideMenuDataItem,{title:"templates"===s?"Templates":"Quickstarts",isActive:i,isOpened:!1,href:`/project/${e}/sql/${s}`,className:"capitalize",children:[(0,t.jsx)(eX,{size:16,className:"text-foreground-muted"}),s]},s)})})]})}var e2=e.i(903248);let e3=()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,t.jsx)(e2.Skeleton,{className:"h-4 w-5"}),(0,t.jsx)(e2.Skeleton,{className:"w-40 h-4"})]}),(0,t.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,t.jsx)(e2.Skeleton,{className:"h-4 w-5"}),(0,t.jsx)(e2.Skeleton,{className:"w-32 h-4"})]}),(0,t.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-75",children:[(0,t.jsx)(e2.Skeleton,{className:"h-4 w-5"}),(0,t.jsx)(e2.Skeleton,{className:"w-20 h-4"})]}),(0,t.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-50",children:[(0,t.jsx)(e2.Skeleton,{className:"h-4 w-5"}),(0,t.jsx)(e2.Skeleton,{className:"w-40 h-4"})]}),(0,t.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-25",children:[(0,t.jsx)(e2.Skeleton,{className:"h-4 w-5"}),(0,t.jsx)(e2.Skeleton,{className:"w-20 h-4"})]})]}),e8=({sort:e="inserted_at"})=>{let a=(0,c.useRouter)(),{ref:s,id:n}=(0,r.useParams)(),{profile:o}=(0,x.useProfile)(),{data:l}=(0,f.useSelectedProjectQuery)(),d=(0,I.useTabsStateSnapshot)(),h=(0,j.useSqlEditorV2StateSnapshot)(),[g,y]=(0,m.useLocalStorage)(i.LOCAL_STORAGE_KEYS.SQL_EDITOR_SECTION_STATE(s??""),eJ),{shared:S,favorite:v,private:C}=g,[_,k]=(0,u.useState)(!1),[D,F]=(0,u.useState)(!1),[O,A]=(0,u.useState)(!1),[$,z]=(0,u.useState)([]),[Q,B]=(0,u.useState)([]),[V,U]=(0,u.useState)(),[H,Y]=(0,u.useState)(),[G,X]=(0,u.useState)(),[J,ee]=(0,u.useState)(),[et,ea]=(0,u.useState)(),es=h.snippets[n]?.snippet,{data:ei,isSuccess:er,isLoading:eo,isPlaceholderData:el,isFetching:ed,hasNextPage:ep,fetchNextPage:em,isFetchingNextPage:ef,error:ex}=(0,P.useSQLSnippetFoldersQuery)({projectRef:s,sort:e},{placeholderData:w.keepPreviousData}),[eg,ej]=(0,u.useState)({}),ey=(0,u.useMemo)(()=>{let e=ei?.pages.flatMap(e=>e.contents??[])??[],t=Object.values(eg).reduce((e,t)=>{let a=(t.snippets??[]).filter(t=>!e.snippetIds.has(t.id)),s=new Set(a.map(e=>e.id));return{snippets:[...e.snippets,...a],isLoading:e.isLoading||t.isLoading,snippetIds:new Set([...e.snippetIds,...s])}},{snippets:e,isLoading:eo||el&&ed,snippetIds:new Set(e.map(e=>e.id))});return es&&"user"===es.visibility&&!t.snippetIds.has(es.id)&&(t.snippetIds.add(es.id),t.snippets=[...t.snippets,es]),t},[ei?.pages,eg,eo,el,ed,es]),eS=(0,u.useMemo)(()=>ey.snippets?.filter(e=>"user"===e.visibility).sort((t,a)=>"name"===e?t.name.localeCompare(a.name):new Date(a.inserted_at).valueOf()-new Date(t.inserted_at).valueOf())??[],[ey.snippets,e]),ev=(0,j.useSnippetFolders)(s),{data:eb,error:eC}=(0,T.useContentCountQuery)({projectRef:s,type:"sql"});(0,u.useEffect)(()=>{(eC||ex)&&p.toast.error(eC?.message||ex?.message||"Failed to load snippets")},[eC,ex]);let ew=eb?.private??0,eq=(0,u.useMemo)(()=>0===ev.length&&0===eS.length?[L.ROOT_NODE]:(0,L.formatFolderResponseForTreeView)({folders:ev,contents:eS}),[ev,eS]),eN=(0,u.useMemo)(()=>(0,L.getLastItemIds)(eq),[eq]),{data:eT,isPending:e_,hasNextPage:eP,fetchNextPage:eI,isFetchingNextPage:eE,isSuccess:ek}=(0,eZ.useSqlSnippetsQuery)({projectRef:s,favorite:!0,sort:e},{enabled:v,placeholderData:w.keepPreviousData}),eM=(0,u.useMemo)(()=>{let t=eT?.pages.flatMap(e=>e.contents??[])??[];return es&&es.favorite&&!t.find(e=>e.id===es.id)&&t.push(es),t.map(e=>({...e,folder_id:void 0})).sort((t,a)=>"name"===e?t.name.localeCompare(a.name):new Date(a.inserted_at).valueOf()-new Date(t.inserted_at).valueOf())??[]},[eT?.pages,es,e]),eL=eb?.favorites??0,eD=(0,u.useMemo)(()=>0===eM.length?[L.ROOT_NODE]:(0,L.formatFolderResponseForTreeView)({contents:eM,folders:[]}),[eM]),eF=(0,u.useMemo)(()=>(0,L.getLastItemIds)(eD),[eD]),{data:eO,isLoading:eA,hasNextPage:eR,fetchNextPage:e$,isFetchingNextPage:eB,isSuccess:eX}=(0,eZ.useSqlSnippetsQuery)({projectRef:s,visibility:"project",sort:e},{enabled:S,placeholderData:w.keepPreviousData}),e0=(0,u.useMemo)(()=>{let t=eO?.pages.flatMap(e=>e.contents??[])??[];return es&&"project"===es.visibility&&!t.find(e=>e.id===es.id)&&t.push(es),t.sort((t,a)=>"name"===e?t.name.localeCompare(a.name):new Date(a.inserted_at).valueOf()-new Date(t.inserted_at).valueOf())??[]},[eO?.pages,es,e]),e2=eb?.shared??0,e8=(0,u.useMemo)(()=>0===e0.length?[L.ROOT_NODE]:(0,L.formatFolderResponseForTreeView)({contents:e0,folders:[]}),[e0]),e4=(0,u.useMemo)(()=>(0,L.getLastItemIds)(e8),[e8]),e5=(0,u.useMemo)(()=>[...ei?.pages.flatMap(e=>e.contents)??[],...eO?.pages.flatMap(e=>e.contents)??[]],[ei,eO]),{mutate:e9}=(0,eW.useContentDeleteMutation)({onSuccess:e=>{let t=e.map(e=>(0,I.createTabId)("sql",{id:e}));d.removeTabs(t)},onError:(e,t)=>{e.message.includes("Contents not found")?te(t.ids):p.toast.error(`Failed to delete query: ${e.message}`)}}),{mutate:e7,isPending:e6}=(({onError:e,onSuccess:t,invalidateQueriesOnSuccess:a=!0,...s}={})=>{let i=(0,eY.useQueryClient)();return(0,eH.useMutation)({mutationFn:e=>eG(e),async onSuccess(e,s,r){let{projectRef:n}=s;a&&await i.invalidateQueries({queryKey:Z.contentKeys.folders(n)}),await t?.(e,s,r)},async onError(t,a,s){void 0===e?p.toast.error(`Failed to delete folder: ${t.message}`):e(t,a,s)},...s})})({onSuccess:(e,t)=>{p.toast.success("Successfully deleted folder");let{ids:a}=t;h.removeFolder(a[0]),ea(void 0)}}),te=e=>{F(!1),B([]);let t=Object.keys(h.snippets).filter(t=>!e.includes(t));0===t.length?a.push(`/project/${s}/sql/new`):e.includes(n)&&a.push(`/project/${s}/sql/${t[0]}`),e.length>0&&e.forEach(e=>h.removeSnippet(e))},tt=async()=>{if(!s)return console.error("Project ref is required");if(void 0===et)return console.error("No folder is selected");let e=eS.filter(e=>e.folder_id===et.id);if(e.length>0){let t=e.map(e=>e.id);e9({projectRef:s,ids:t},{onSuccess:()=>{t.forEach(e=>h.removeSnippet(e)),te(t),e7({projectRef:s,ids:[et?.id]})}})}else e7({projectRef:s,ids:[et?.id]})},ta=e=>{let t=eS.map(e=>e.id),a=t.indexOf(n),s=t.indexOf(e),i=Math.min(a,s),r=Math.max(a,s),o=[],l=eS[i].folder_id===eS[r].folder_id;for(let e=i;e<=r;e++)l&&eS[e].folder_id===eS[i].folder_id&&o.push(eS[e]);B(o)};(0,u.useEffect)(()=>{void 0!==es&&er&&("project"===es.visibility?y({...g,shared:!0}):"user"===es.visibility&&y({...g,private:!0}),es.folder_id&&!$.includes(es.folder_id)&&z([...$,es.folder_id]))},[es,e,er]),(0,u.useEffect)(()=>{B([])},[n]),(0,u.useEffect)(()=>{s&&ei?.pages&&ei.pages.forEach(e=>{e.contents?.forEach(e=>{h.addSnippet({projectRef:s,snippet:e})}),e.folders?.forEach(e=>h.addFolder({projectRef:s,folder:e}))})},[s,ei?.pages]),(0,u.useEffect)(()=>{void 0!==s&&ek&&eT.pages.forEach(e=>{e.contents?.forEach(e=>{h.addSnippet({projectRef:s,snippet:e})})})},[s,eT?.pages]),(0,u.useEffect)(()=>{void 0!==s&&eX&&eO.pages.forEach(e=>{e.contents?.forEach(e=>{h.addSnippet({projectRef:s,snippet:e})})})},[s,eO?.pages]);let ts=(0,eK.useSqlEditorTabsCleanup)();return(0,u.useEffect)(()=>{er&&ts({snippets:e5})},[e5,er,ts]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.InnerSideMenuSeparator,{}),K.IS_PLATFORM&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(b.InnerSideMenuCollapsible,{className:"px-0",open:S,onOpenChange:e=>{y({...g??eJ,shared:e})},children:[(0,t.jsx)(b.InnerSideMenuCollapsibleTrigger,{title:`Shared ${e2>0?` (${e2})`:""}`}),(0,t.jsx)(b.InnerSideMenuCollapsibleContent,{className:"group-data-[state=open]:pt-2",children:eA?(0,t.jsx)(e3,{}):0===e0.length?(0,t.jsx)(b.InnerSideBarEmptyPanel,{className:"mx-2",title:"No shared queries",description:"Share queries with your team by right-clicking on the query."}):(0,t.jsx)(E.TreeView,{data:e8,"aria-label":"project-level-snippets",nodeRenderer:({element:e,...a})=>{let s=Object.values(d.tabsMap).some(t=>t.metadata?.sqlId===e.metadata?.id),i=(0,I.createTabId)("sql",{id:e?.metadata?.id}),r=d.previewTabId===i,o=!r&&e.metadata?.id===n,l=Q.some(t=>t.id===e.metadata?.id);return(0,t.jsx)(en,{...a,isOpened:s&&!r,isSelected:o||l,isPreview:r,onDoubleClick:e=>{e.preventDefault(),d.makeTabPermanent(i)},element:e,onSelectDelete:()=>{F(!0),B([e.metadata])},onSelectRename:()=>{A(!0),X(e.metadata)},onSelectDownload:()=>{ee(e.metadata)},onSelectUnshare:()=>{Y(e.metadata)},isLastItem:e4.has(e.id),hasNextPage:eR,fetchNextPage:e$,isFetchingNextPage:eB})}})})]}),(0,t.jsx)(b.InnerSideMenuSeparator,{}),(0,t.jsxs)(b.InnerSideMenuCollapsible,{className:"px-0",open:v,onOpenChange:e=>{y({...g??eJ,favorite:e})},children:[(0,t.jsx)(b.InnerSideMenuCollapsibleTrigger,{title:`Favorites ${eL>0?` (${eL})`:""}`}),(0,t.jsx)(b.InnerSideMenuCollapsibleContent,{className:"group-data-[state=open]:pt-2",children:e_?(0,t.jsx)(e3,{}):0===eM.length?(0,t.jsx)(b.InnerSideBarEmptyPanel,{title:"No favorite queries",className:"mx-2 px-3",description:(0,t.jsxs)(t.Fragment,{children:["Save a query to favorites for easy accessibility by clicking the"," ",(0,t.jsx)(R.Heart,{size:12,className:"inline-block relative align-center -top-[1px]"})," ","icon."]})}):(0,t.jsx)(E.TreeView,{data:eD,"aria-label":"favorite-snippets",nodeRenderer:({element:e,...a})=>{let s=Object.values(d.tabsMap).some(t=>t.metadata?.sqlId===e.metadata?.id),i=(0,I.createTabId)("sql",{id:e?.metadata?.id}),r=d.previewTabId===i,o=!r&&e.metadata?.id===n,l=Q.some(t=>t.id===e.metadata?.id);return(0,t.jsx)(en,{...a,isSelected:o||l,isOpened:s&&!r,isPreview:r,onDoubleClick:e=>{e.preventDefault(),d.makeTabPermanent(i)},element:e,onSelectDelete:()=>{F(!0),B([e.metadata])},onSelectRename:()=>{A(!0),X(e.metadata)},onSelectDownload:()=>{ee(e.metadata)},onSelectShare:()=>U(e.metadata),onSelectUnshare:()=>{Y(e.metadata)},isLastItem:eF.has(e.id),hasNextPage:eP,fetchNextPage:eI,isFetchingNextPage:eE})}})})]}),(0,t.jsx)(b.InnerSideMenuSeparator,{})]}),(0,t.jsxs)(b.InnerSideMenuCollapsible,{open:C,onOpenChange:e=>{y({...g??eJ,private:e})},className:"px-0",children:[(0,t.jsx)(b.InnerSideMenuCollapsibleTrigger,{title:`PRIVATE
            ${ew>0?` (${ew})`:""}`}),(0,t.jsx)(b.InnerSideMenuCollapsibleContent,{className:"group-data-[state=open]:pt-2",children:eo?(0,t.jsx)(eU.default,{}):0===ev.length&&0===eS.length?(0,t.jsx)(eV,{}):(0,t.jsx)(E.TreeView,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:eq,selectedIds:Q.map(e=>e.id),"aria-label":"private-snippets",onExpand:e=>{let t=e.element.id.toString();e.isExpanded&&!$.includes(t)&&z([...$,t]),!e.isExpanded&&$.includes(t)&&z($.filter(e=>e!==t))},expandedIds:$,nodeRenderer:({element:i,...r})=>{let c=Object.values(d.tabsMap).some(e=>e.metadata?.sqlId===i.metadata?.id),u=(0,I.createTabId)("sql",{id:i?.metadata?.id}),p=d.previewTabId===u,m=!p&&i.metadata?.id===n,f=Q.some(e=>e.id===i.metadata?.id);return(0,t.jsx)(en,{...r,element:i,isOpened:c&&!p,isSelected:m||f,isPreview:p,isMultiSelected:Q.length>1,isLastItem:eN.has(i.id),status:r.isBranch?h.folders[i.id].status:"idle",onMultiSelect:ta,onSelectCreate:()=>{if(o&&l){let e=(0,W.createSqlSnippetSkeletonV2)({name:(0,eQ.generateSnippetTitle)(),owner_id:o?.id,project_id:l?.id,folder_id:i.id,sql:""});h.addSnippet({projectRef:l.ref,snippet:e}),a.push(`/project/${s}/sql/${e.id}`)}},onSelectDelete:()=>{r.isBranch?ea(i.metadata):(F(!0),0===Q.length&&B([i.metadata]))},onSelectRename:()=>{r.isBranch?h.editFolder(i.id):(A(!0),X(i.metadata))},onSelectMove:()=>{k(!0),0===Q.length&&B([i.metadata])},onSelectDownload:()=>ee(i.metadata),onSelectShare:()=>U(i.metadata),onEditSave:e=>{0===e.length&&"new-folder"===i.id?h.removeFolder(i.id):e.length>0&&h.saveFolder({id:i.id,name:e})},hasNextPage:ep,fetchNextPage:em,isFetchingNextPage:ef,sort:e,onFolderContentsChange:({isLoading:e,snippets:t})=>{ej(a=>({...a,[i.id]:{snippets:t,isLoading:e}}))},onDoubleClick:e=>{e.preventDefault(),d.makeTabPermanent(u)}})}})})]}),(0,t.jsx)(b.InnerSideMenuSeparator,{}),(0,t.jsx)(e1,{}),(0,t.jsx)(b.InnerSideMenuSeparator,{}),(0,t.jsx)(N.default,{snippet:G,visible:O,onCancel:()=>A(!1),onComplete:()=>A(!1)}),(0,t.jsx)(ez,{snippets:Q,visible:_,onClose:()=>{k(!1),B([])}}),(0,t.jsx)(q.default,{id:J?.id??"",visible:void 0!==J,onCancel:()=>ee(void 0)}),(0,t.jsx)(eu,{snippet:V,onClose:()=>U(void 0),onSuccess:()=>y({...g,shared:!0})}),(0,t.jsx)(eh,{snippet:H,onClose:()=>Y(void 0),onSuccess:()=>y({...g,private:!0})}),(0,t.jsx)(M.DeleteSnippetsModal,{visible:D,snippets:Q,onClose:()=>{F(!1),B([])}}),(0,t.jsx)(ec.default,{size:"small",title:"Confirm to delete folder",confirmLabel:"Delete folder",confirmLabelLoading:"Deleting folder",loading:e6,visible:void 0!==et,variant:"destructive",onCancel:()=>ea(void 0),onConfirm:tt,alert:{title:"This action cannot be undone",description:"All SQL snippets within the folder will be permanently removed, and cannot be recovered."},children:(0,t.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete the folder '",et?.name,"'?"]})})]})};e.s(["SQLEditorMenu",0,()=>{let e=(0,c.useRouter)(),{ref:C}=(0,r.useParams)(),{profile:w}=(0,x.useProfile)(),{data:q}=(0,f.useSelectedProjectQuery)(),N=(0,j.useSqlEditorV2StateSnapshot)(),[T,_]=(0,u.useState)(""),[P,I]=(0,u.useState)(!1),[E,k]=(0,m.useLocalStorage)(i.LOCAL_STORAGE_KEYS.SQL_EDITOR_SORT(C??""),"inserted_at"),M=(0,g.getAppStateSnapshot)(),L=(0,s.useDebounce)(T,500),{can:D}=(0,h.useAsyncCheckPermissions)(a.PermissionAction.CREATE,"user_content",{resource:{type:"sql",owner_id:w?.id},subject:{id:w?.id}}),F=async()=>{if(!C)return console.error("Project ref is required");if(!q)return console.error("Project is required");if(!w)return console.error("Profile is required");if(!D)return(0,p.toast)("Your queries will not be saved as you do not have sufficient permissions");try{e.push(`/project/${C}/sql/new?skip=true`),_(""),I(!1)}catch(e){p.toast.error(`Failed to create new query: ${e.message}`)}};return(0,u.useEffect)(()=>{I(L.length>0)},[L]),(0,t.jsxs)("div",{className:"h-full flex flex-col justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-4 flex-grow",children:[(0,t.jsxs)("div",{className:"mt-4 mx-4 flex items-center justify-between gap-x-2",children:[(0,t.jsx)(b.InnerSideBarFilters,{className:"w-full p-0 gap-0",children:(0,t.jsx)(b.InnerSideBarFilterSearchInput,{name:"search-queries",placeholder:"Search queries...","aria-labelledby":"Search queries",value:T,onChange:e=>{let t=e.target.value;_(t),0===t.length&&I(!1)},onKeyDown:e=>{"Escape"===e.code&&(_(""),I(!1))},children:P?(0,t.jsxs)(v.Tooltip,{children:[(0,t.jsx)(v.TooltipTrigger,{className:"absolute right-1 top-[.4rem] md:top-[.3rem] transition-colors text-foreground-light hover:text-foreground",onClick:()=>{_(""),I(!1)},children:(0,t.jsx)(d.X,{size:18})}),(0,t.jsx)(v.TooltipContent,{children:"Clear search"})]}):(0,t.jsxs)(b.InnerSideBarFilterSortDropdown,{value:E,onValueChange:e=>k(e),children:[(0,t.jsx)(b.InnerSideBarFilterSortDropdownItem,{value:"name",children:"Alphabetical"},"name"),(0,t.jsx)(b.InnerSideBarFilterSortDropdownItem,{value:"inserted_at",children:"Created At"},"inserted_at")]})})}),(0,t.jsxs)(S.DropdownMenu,{children:[(0,t.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(y.Button,{"data-testid":"sql-editor-new-query-button",type:"default",icon:(0,t.jsx)(l.Plus,{className:"text-foreground"}),className:"w-[26px]"})}),(0,t.jsxs)(S.DropdownMenuContent,{align:"end",side:"bottom",className:"w-48",children:[(0,t.jsxs)(S.DropdownMenuItem,{className:"gap-x-2",onClick:()=>F(),children:[(0,t.jsx)(n.FilePlus,{size:14}),"Create a new snippet"]}),(0,t.jsxs)(S.DropdownMenuItem,{className:"gap-x-2",onClick:()=>(()=>{if(!C)return console.error("Project ref is required");_(""),I(!1),N.addNewFolder({projectRef:C})})(),children:[(0,t.jsx)(o.FolderPlus,{size:14}),"Create a new folder"]})]})]})]}),P?(0,t.jsx)(em,{search:L}):(0,t.jsx)(e8,{sort:E})]}),(0,t.jsx)("div",{className:"p-4 border-t sticky bottom-0 bg-studio",children:(0,t.jsx)(y.Button,{block:!0,type:"default",onClick:()=>M.setOnGoingQueriesPanelOpen(!0),children:"View running queries"})})]})}],326204)}]);

//# debugId=81934e83-36cd-d2c7-f789-479fe8ee85a7
//# sourceMappingURL=b32a9ff60564e707.js.map