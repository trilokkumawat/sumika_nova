;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="a1594acd-e07d-4858-baaa-d75225e9b351")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,876298,e=>{"use strict";var t=e.i(991435),r=e.i(416785);e.i(128328);var s=e.i(947748);let n=(0,t.proxy)({activeDocsSection:["introduction"],docsLanguage:"js",showProjectApiDocs:!1,showCreateBranchModal:!1,showAiSettingsModal:!1,showConnectDialog:!1,ongoingQueriesPanelOpen:!1,mobileMenuOpen:!1,showSidebar:!0,showEditorPanel:!1,lastRouteBeforeVisitingAccountPage:"",activeDocsSection:["introduction"],docsLanguage:"js",showProjectApiDocs:!1,setShowProjectApiDocs:e=>{n.showProjectApiDocs=e},setActiveDocsSection:e=>{n.activeDocsSection=e},setDocsLanguage:e=>{n.docsLanguage=e},isOptedInTelemetry:!1,setIsOptedInTelemetry:e=>{n.isOptedInTelemetry=null!==e&&e,null!==e&&localStorage.setItem(s.LOCAL_STORAGE_KEYS.TELEMETRY_CONSENT,e.toString())},isMfaEnforced:!1,setIsMfaEnforced:e=>{n.isMfaEnforced=e},showCreateBranchModal:!1,setShowCreateBranchModal:e=>{n.showCreateBranchModal=e},showAiSettingsModal:!1,setShowAiSettingsModal:e=>{n.showAiSettingsModal=e},showSidebar:!0,setShowSidebar:e=>{n.showSidebar=e},showOngoingQueriesPanelOpen:!1,setOnGoingQueriesPanelOpen:e=>{n.ongoingQueriesPanelOpen=e},mobileMenuOpen:!1,setMobileMenuOpen:e=>{n.mobileMenuOpen=e},lastRouteBeforeVisitingAccountPage:"",setLastRouteBeforeVisitingAccountPage:e=>{n.lastRouteBeforeVisitingAccountPage=e}});e.s(["getAppStateSnapshot",0,()=>(0,t.snapshot)(n),"useAppStateSnapshot",0,e=>(0,r.useSnapshot)(n,e)])},194213,e=>{"use strict";let t=(0,e.i(388019).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],194213)},597511,e=>{"use strict";var t=e.i(478902),r=e.i(263787),s=e.i(774803),n=e.i(655605),i=e.i(896975),a=e.i(210419),o=e.i(271226),l=e.i(22194),c=e.i(10429),h=e.i(912793),u=e.i(432478),d=e.i(876298),p=e.i(837710),f=e.i(874311),m=e.i(899242),g=e.i(573375),y=e.i(920474),b=e.i(463333);function v(){let e=(0,o.useRouter)(),{theme:v,setTheme:w}=(0,i.useTheme)(),k=(0,d.useAppStateSnapshot)(),S=(0,h.useIsFeatureEnabled)("profile:show_email"),{username:E,avatarUrl:T,primaryEmail:_,isLoading:x}=(0,u.useProfileNameAndPicture)();(0,y.useSetCommandMenuOpen)(),(0,g.useCommandMenuOpenedTelemetry)();let{openFeaturePreviewModal:j}=(0,b.useFeaturePreviewModal)();return(0,t.jsxs)(f.DropdownMenu,{children:[(0,t.jsx)(f.DropdownMenuTrigger,{asChild:!0,className:"border flex-shrink-0 px-3",children:(0,t.jsx)(p.Button,{type:"default",className:"[&>span]:flex px-0 py-0 rounded-full overflow-hidden h-8 w-8",children:x?(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(s.Loader2,{className:"animate-spin text-foreground-lighter",size:16})}):(0,t.jsx)(l.ProfileImage,{alt:E,src:T,className:"w-8 h-8 rounded-md"})})}),(0,t.jsxs)(f.DropdownMenuContent,{side:"bottom",align:"end",children:[c.IS_PLATFORM&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"px-2 py-1 flex flex-col gap-0 text-sm",children:!!E&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{title:E,className:"w-full text-left text-foreground truncate",children:E}),_!==E&&S&&(0,t.jsx)("span",{title:_,className:"w-full text-left text-foreground-light text-xs truncate",children:_})]})}),(0,t.jsx)(f.DropdownMenuSeparator,{}),(0,t.jsxs)(f.DropdownMenuGroup,{children:[(0,t.jsx)(f.DropdownMenuItem,{className:"flex gap-2",asChild:!0,children:(0,t.jsxs)(a.default,{href:"/account/me",onClick:()=>{"/account/me"!==e.pathname&&k.setLastRouteBeforeVisitingAccountPage(e.asPath)},children:[(0,t.jsx)(n.Settings,{size:14,strokeWidth:1.5,className:"text-foreground-lighter"}),"Account preferences"]})}),(0,t.jsxs)(f.DropdownMenuItem,{className:"flex gap-2",onClick:j,onSelect:j,children:[(0,t.jsx)(r.FlaskConical,{size:14,strokeWidth:1.5,className:"text-foreground-lighter"}),"Feature previews"]}),(0,t.jsx)(f.DropdownMenuSeparator,{})]})]}),(0,t.jsxs)(f.DropdownMenuGroup,{children:[(0,t.jsx)(f.DropdownMenuLabel,{children:"Theme"}),(0,t.jsx)(f.DropdownMenuRadioGroup,{value:v,onValueChange:e=>{w(e)},children:m.singleThemes.map(e=>(0,t.jsx)(f.DropdownMenuRadioItem,{value:e.value,children:e.name},e.value))})]}),c.IS_PLATFORM&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.DropdownMenuSeparator,{}),(0,t.jsx)(f.DropdownMenuGroup,{children:(0,t.jsx)(f.DropdownMenuItem,{onSelect:()=>{e.push("/logout")},children:"Log out"})})]})]})]})}e.s(["UserDropdown",()=>v])},217561,e=>{"use strict";let t;var r=e.i(869176);let s=(t=0,()=>(t+=1,`u${`0000${(1679616*Math.random()|0).toString(36)}`.slice(-4)}${t}`));function n(e){let t=[];for(let r=0,s=e.length;r<s;r++)t.push(e[r]);return t}function i(e,t){let r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function a(e,t={}){let r,s,n,o;return{width:t.width||(r=i(e,"border-left-width"),s=i(e,"border-right-width"),e.clientWidth+r+s),height:t.height||(n=i(e,"border-top-width"),o=i(e,"border-bottom-width"),e.clientHeight+n+o)}}function o(e){return new Promise((t,r)=>{let s=new Image;s.decode=()=>t(s),s.onload=()=>t(s),s.onerror=r,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function l(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function c(e,t,r){let s="http://www.w3.org/2000/svg",n=document.createElementNS(s,"svg"),i=document.createElementNS(s,"foreignObject");return n.setAttribute("width",`${t}`),n.setAttribute("height",`${r}`),n.setAttribute("viewBox",`0 0 ${t} ${r}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),n.appendChild(i),i.appendChild(e),l(n)}let h=(e,t)=>{if(e instanceof t)return!0;let r=Object.getPrototypeOf(e);return null!==r&&(r.constructor.name===t.name||h(r,t))};function u(e,t,r){let i,a,o,l=window.getComputedStyle(e,r),c=l.getPropertyValue("content");if(""===c||"none"===c)return;let h=s();try{t.className=`${t.className} ${h}`}catch(e){return}let u=document.createElement("style");u.appendChild((i=`.${h}:${r}`,o=l.cssText?(a=l.getPropertyValue("content"),`${l.cssText} content: '${a.replace(/'|"/g,"")}';`):n(l).map(e=>{let t=l.getPropertyValue(e),r=l.getPropertyPriority(e);return`${e}: ${t}${r?" !important":""};`}).join(" "),document.createTextNode(`${i}{${o}}`))),t.appendChild(u)}let d="application/font-woff",p="image/jpeg",f={woff:d,woff2:d,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:p,jpeg:p,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function m(e){let t;return f[((t=/\.([^./]*?)$/g.exec(e))?t[1]:"").toLowerCase()]||""}function g(e){return -1!==e.search(/^(data:)/)}function y(e,t){return`data:${t};base64,${e}`}async function b(e,t,r){let s=await fetch(e,t);if(404===s.status)throw Error(`Resource "${s.url}" not found`);let n=await s.blob();return new Promise((e,t)=>{let i=new FileReader;i.onerror=t,i.onloadend=()=>{try{e(r({res:s,result:i.result}))}catch(e){t(e)}},i.readAsDataURL(n)})}let v={};async function w(e,t,r){var s,n,i;let a,o,l=(s=e,n=t,i=r.includeQueryParams,o=s.replace(/\?.*/,""),i&&(o=s),/ttf|otf|eot|woff2?/i.test(o)&&(o=o.replace(/.*\//,"")),n?`[${n}]${o}`:o);if(null!=v[l])return v[l];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());try{let s=await b(e,r.fetchRequestInit,({res:e,result:r})=>(t||(t=e.headers.get("Content-Type")||""),r.split(/,/)[1]));a=y(s,t)}catch(s){a=r.imagePlaceholder||"";let t=`Failed to fetch resource: ${e}`;s&&(t="string"==typeof s?s:s.message),t&&console.warn(t)}return v[l]=a,a}async function k(e){let t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):o(t)}async function S(e,t){if(e.currentSrc){let t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==r||r.drawImage(e,0,0,t.width,t.height),o(t.toDataURL())}let r=e.poster,s=m(r);return o(await w(r,s,t))}async function E(e){var t;try{if(null==(t=null==e?void 0:e.contentDocument)?void 0:t.body)return await j(e.contentDocument.body,{},!0)}catch(e){}return e.cloneNode(!1)}async function T(e,t){return h(e,HTMLCanvasElement)?k(e):h(e,HTMLVideoElement)?S(e,t):h(e,HTMLIFrameElement)?E(e):e.cloneNode(!1)}async function _(e,t,r){var s,i;let a=[];return 0===(a=null!=e.tagName&&"SLOT"===e.tagName.toUpperCase()&&e.assignedNodes?n(e.assignedNodes()):h(e,HTMLIFrameElement)&&(null==(s=e.contentDocument)?void 0:s.body)?n(e.contentDocument.body.childNodes):n((null!=(i=e.shadowRoot)?i:e).childNodes)).length||h(e,HTMLVideoElement)||await a.reduce((e,s)=>e.then(()=>j(s,r)).then(e=>{e&&t.appendChild(e)}),Promise.resolve()),t}async function x(e,t){let r=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===r.length)return e;let s={};for(let n=0;n<r.length;n++){let i=r[n].getAttribute("xlink:href");if(i){let r=e.querySelector(i),n=document.querySelector(i);r||!n||s[i]||(s[i]=await j(n,t,!0))}}let n=Object.values(s);if(n.length){let t="http://www.w3.org/1999/xhtml",r=document.createElementNS(t,"svg");r.setAttribute("xmlns",t),r.style.position="absolute",r.style.width="0",r.style.height="0",r.style.overflow="hidden",r.style.display="none";let s=document.createElementNS(t,"defs");r.appendChild(s);for(let e=0;e<n.length;e++)s.appendChild(n[e]);e.appendChild(r)}return e}async function j(e,t,r){return r||!t.filter||t.filter(e)?Promise.resolve(e).then(e=>T(e,t)).then(r=>_(e,r,t)).then(t=>(function(e,t){if(h(t,Element)&&(!function(e,t){let r=t.style;if(!r)return;let s=window.getComputedStyle(e);s.cssText?(r.cssText=s.cssText,r.transformOrigin=s.transformOrigin):n(s).forEach(n=>{let i=s.getPropertyValue(n);if("font-size"===n&&i.endsWith("px")){let e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}h(e,HTMLIFrameElement)&&"display"===n&&"inline"===i&&(i="block"),"d"===n&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),r.setProperty(n,i,s.getPropertyPriority(n))})}(e,t),u(e,t,":before"),u(e,t,":after"),h(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),h(e,HTMLInputElement)&&t.setAttribute("value",e.value),h(e,HTMLSelectElement))){let r=Array.from(t.children).find(t=>e.value===t.getAttribute("value"));r&&r.setAttribute("selected","")}return t})(e,t)).then(e=>x(e,t)):null}let O=/url\((['"]?)([^'"]+?)\1\)/g,$=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,P=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function C(e,t,r,s,n){try{let i,a,o=r?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;let r=document.implementation.createHTMLDocument(),s=r.createElement("base"),n=r.createElement("a");return r.head.appendChild(s),r.body.appendChild(n),t&&(s.href=t),n.href=e,n.href}(t,r):t,l=m(t);if(n){let e=await n(o);i=y(e,l)}else i=await w(o,l,s);return e.replace((a=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),RegExp(`(url\\(['"]?)(${a})(['"]?\\))`,"g")),`$1${i}$3`)}catch(e){}return e}function A(e){return -1!==e.search(O)}async function R(e,t,r){let s;if(!A(e))return e;let n=function(e,{preferredFontFormat:t}){return t?e.replace(P,e=>{for(;;){let[r,,s]=$.exec(e)||[];if(!s)return"";if(s===t)return`src: ${r};`}}):e}(e,r);return(s=[],n.replace(O,(e,t,r)=>(s.push(r),e)),s.filter(e=>!g(e))).reduce((e,s)=>e.then(e=>C(e,s,t,r)),Promise.resolve(n))}async function N(e,t,r){var s;let n=null==(s=t.style)?void 0:s.getPropertyValue(e);if(n){let s=await R(n,null,r);return t.style.setProperty(e,s,t.style.getPropertyPriority(e)),!0}return!1}async function L(e,t){await N("background",e,t)||await N("background-image",e,t),await N("mask",e,t)||await N("mask-image",e,t)}async function D(e,t){let r=h(e,HTMLImageElement);if(!(r&&!g(e.src))&&!(h(e,SVGImageElement)&&!g(e.href.baseVal)))return;let s=r?e.src:e.href.baseVal,n=await w(s,m(s),t);await new Promise((t,s)=>{e.onload=t,e.onerror=s,e.decode&&(e.decode=t),"lazy"===e.loading&&(e.loading="eager"),r?(e.srcset="",e.src=n):e.href.baseVal=n})}async function U(e,t){let r=n(e.childNodes).map(e=>B(e,t));await Promise.all(r).then(()=>e)}async function B(e,t){h(e,Element)&&(await L(e,t),await D(e,t),await U(e,t))}let I={};async function M(e){let t=I[e];if(null!=t)return t;let r=await fetch(e);return t={url:e,cssText:await r.text()},I[e]=t,t}async function F(e,t){let r=e.cssText,s=/url\(["']?([^"')]+)["']?\)/g;return Promise.all((r.match(/url\([^)]+\)/g)||[]).map(async n=>{let i=n.replace(s,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),b(i,t.fetchRequestInit,({result:e})=>(r=r.replace(n,`url(${e})`),[n,e]))})).then(()=>r)}function H(e){if(null==e)return[];let t=[],r=e.replace(/(\/\*[\s\S]*?\*\/)/gi,""),s=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let e=s.exec(r);if(null===e)break;t.push(e[0])}r=r.replace(s,"");let n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=n.exec(r);if(null===e){if(null===(e=i.exec(r)))break;n.lastIndex=i.lastIndex}else i.lastIndex=n.lastIndex;t.push(e[0])}return t}async function V(e,t){let r=[],s=[];return e.forEach(r=>{if("cssRules"in r)try{n(r.cssRules||[]).forEach((e,n)=>{if(e.type===CSSRule.IMPORT_RULE){let i=n+1,a=e.href,o=M(a).then(e=>F(e,t)).then(e=>H(e).forEach(e=>{try{r.insertRule(e,e.startsWith("@import")?i+=1:r.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})).catch(e=>{console.error("Error loading remote css",e.toString())});s.push(o)}})}catch(i){let n=e.find(e=>null==e.href)||document.styleSheets[0];null!=r.href&&s.push(M(r.href).then(e=>F(e,t)).then(e=>H(e).forEach(e=>{n.insertRule(e,r.cssRules.length)})).catch(e=>{console.error("Error loading remote stylesheet",e)})),console.error("Error inlining remote css file",i)}}),Promise.all(s).then(()=>(e.forEach(e=>{if("cssRules"in e)try{n(e.cssRules||[]).forEach(e=>{r.push(e)})}catch(t){console.error(`Error while reading CSS rules from ${e.href}`,t)}}),r))}async function W(e,t){if(null==e.ownerDocument)throw Error("Provided element is not within a Document");let r=n(e.ownerDocument.styleSheets);return(await V(r,t)).filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>A(e.style.getPropertyValue("src")))}async function q(e,t){let r=await W(e,t);return(await Promise.all(r.map(e=>{let r=e.parentStyleSheet?e.parentStyleSheet.href:null;return R(e.cssText,r,t)}))).join("\n")}async function z(e,t){let r=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await q(e,t);if(r){let t=document.createElement("style"),s=document.createTextNode(r);t.appendChild(s),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}async function J(e,t={}){let{width:r,height:s}=a(e,t),n=await j(e,t,!0);return await z(n,t),await B(n,t),!function(e,t){let{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);let s=t.style;null!=s&&Object.keys(s).forEach(e=>{r[e]=s[e]})}(n,t),await c(n,r,s)}async function G(e,t={}){let{width:s,height:n}=a(e,t),i=await J(e,t),l=await o(i),c=document.createElement("canvas"),h=c.getContext("2d"),u=t.pixelRatio||function(){let e,t;try{t=r.default}catch(e){}let s=t&&t.env?t.env.devicePixelRatio:null;return s&&Number.isNaN(e=parseInt(s,10))&&(e=1),e||window.devicePixelRatio||1}(),d=t.canvasWidth||s,p=t.canvasHeight||n;return c.width=d*u,c.height=p*u,!t.skipAutoScale&&(c.width>16384||c.height>16384)&&(c.width>16384&&c.height>16384?c.width>c.height?(c.height*=16384/c.width,c.width=16384):(c.width*=16384/c.height,c.height=16384):c.width>16384?(c.height*=16384/c.width,c.width=16384):(c.width*=16384/c.height,c.height=16384)),c.style.width=`${d}`,c.style.height=`${p}`,t.backgroundColor&&(h.fillStyle=t.backgroundColor,h.fillRect(0,0,c.width,c.height)),h.drawImage(l,0,0,c.width,c.height),c}async function K(e,t={}){return(await G(e,t)).toDataURL()}e.s(["toPng",()=>K,"toSvg",()=>J],217561)},911298,e=>{"use strict";let t=(0,e.i(388019).default)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>t],911298)},275185,e=>{"use strict";let t=(0,e.i(388019).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>t],275185)},361208,536841,e=>{"use strict";var t=e.i(242882),r=e.i(234745),s=e.i(10429);async function n({prompt:e},t){if(!e)return null;let n=await (0,r.constructHeaders)({"Content-Type":"application/json"}),i=await (0,r.fetchHandler)(`${s.BASE_PATH}/api/ai/feedback/classify`,{method:"POST",body:JSON.stringify({prompt:e}),headers:n,credentials:"include",signal:t});if(!i.ok){let{error:e}=await i.json();(0,r.handleError)("object"==typeof e?e:"string"==typeof e?{message:e}:{message:"Unknown error"})}return(await i.json()).feedback_category}e.s(["useFeedbackCategoryQuery",0,({prompt:e},{enabled:r=!0,...s}={})=>(0,t.useQuery)({queryKey:["feedback-category",e],queryFn:({signal:t})=>n({prompt:e},t),enabled:r&&!!e,...s})],361208);var i=e.i(38429),a=e.i(355901);async function o({message:e,pathname:t,projectRef:s,organizationSlug:n}){let{data:i,error:a}=await (0,r.post)("/platform/feedback/send",{body:{message:e,category:"Feedback",tags:["dashboard-feedback"],projectRef:s,organizationSlug:n,pathname:t}});return a&&(0,r.handleError)(a),i}e.s(["useSendFeedbackMutation",0,({onError:e,...t}={})=>(0,i.useMutation)({mutationFn:e=>o(e),async onError(t,r,s){void 0===e?a.toast.error(`Failed to submit feedback: ${t.message}`):e(t,r,s)},...t})],536841)},162530,e=>{"use strict";var t=e.i(767073);e.s(["PopoverSeparator_Shadcn_",()=>t.PopoverSeparator])},226927,786615,558118,e=>{"use strict";class t extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class r extends t{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class s extends t{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class n extends t{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}(i=a||(a={})).Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2",e.s(["FunctionRegion",()=>a,"FunctionsError",()=>t,"FunctionsFetchError",()=>r,"FunctionsHttpError",()=>n,"FunctionsRelayError",()=>s],226927);var i,a,o=e.i(274466);class l{constructor(e,{headers:t={},customFetch:r,region:s=a.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return(0,o.__awaiter)(this,arguments,void 0,function*(e,t={}){var i;let a,o;try{let l,{headers:c,method:h,body:u,signal:d,timeout:p}=t,f={},{region:m}=t;m||(m=this.region);let g=new URL(`${this.url}/${e}`);m&&"any"!==m&&(f["x-region"]=m,g.searchParams.set("forceFunctionRegion",m)),u&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)?"undefined"!=typeof Blob&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",l=u):"string"==typeof u?(f["Content-Type"]="text/plain",l=u):"undefined"!=typeof FormData&&u instanceof FormData?l=u:(f["Content-Type"]="application/json",l=JSON.stringify(u)):l=!u||"string"==typeof u||"undefined"!=typeof Blob&&u instanceof Blob||u instanceof ArrayBuffer||"undefined"!=typeof FormData&&u instanceof FormData?u:JSON.stringify(u);let y=d;p&&(o=new AbortController,a=setTimeout(()=>o.abort(),p),d?(y=o.signal,d.addEventListener("abort",()=>o.abort())):y=o.signal);let b=yield this.fetch(g.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),c),body:l,signal:y}).catch(e=>{throw new r(e)}),v=b.headers.get("x-relay-error");if(v&&"true"===v)throw new s(b);if(!b.ok)throw new n(b);let w=(null!=(i=b.headers.get("Content-Type"))?i:"text/plain").split(";")[0].trim();return{data:"application/json"===w?yield b.json():"application/octet-stream"===w||"application/pdf"===w?yield b.blob():"text/event-stream"===w?b:"multipart/form-data"===w?yield b.formData():yield b.text(),error:null,response:b}}catch(e){return{data:null,error:e,response:e instanceof n||e instanceof s?e.context:void 0}}finally{a&&clearTimeout(a)}})}}e.s(["FunctionsClient",()=>l],786615);var c=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},h=class{constructor(e){var t,r,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!=(t=e.shouldThrowOnError)&&t,this.signal=e.signal,this.isMaybeSingle=null!=(r=e.isMaybeSingle)&&r,this.urlLengthLimit=null!=(s=e.urlLengthLimit)?s:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,n,i;let a=null,o=null,l=null,h=e.status,u=e.statusText;if(e.ok){if("HEAD"!==r.method){let t=await e.text();""===t||(o="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null==(n=r.headers.get("Accept"))?void 0:n.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}let i=null==(t=r.headers.get("Prefer"))?void 0:t.match(/count=(exact|planned|estimated)/),c=null==(s=e.headers.get("content-range"))?void 0:s.split("/");i&&c&&c.length>1&&(l=parseInt(c[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(o)&&(o.length>1?(a={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,h=406,u="Not Acceptable"):o=1===o.length?o[0]:null)}else{let t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(o=[],a=null,h=200,u="OK")}catch(r){404===e.status&&""===t?(h=204,u="No Content"):a={message:t}}if(a&&r.isMaybeSingle&&(null==a||null==(i=a.details)?void 0:i.includes("0 rows"))&&(a=null,h=200,u="OK"),a&&r.shouldThrowOnError)throw new c(a)}return{error:a,data:o,count:l,status:h,statusText:u}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,r,s,n,i,a;let o="",l="",c="",h=null==e?void 0:e.cause;if(h){let t=null!=(r=null==h?void 0:h.message)?r:"",a=null!=(s=null==h?void 0:h.code)?s:"";o=`${null!=(n=null==e?void 0:e.name)?n:"FetchError"}: ${null==e?void 0:e.message}

Caused by: ${null!=(i=null==h?void 0:h.name)?i:"Error"}: ${t}`,a&&(o+=` (${a})`),(null==h?void 0:h.stack)&&(o+=`
${h.stack}`)}else o=null!=(a=null==e?void 0:e.stack)?a:"";let u=this.url.toString().length;return(null==e?void 0:e.name)==="AbortError"||(null==e?void 0:e.code)==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",u>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${u} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((null==h?void 0:h.name)==="HeadersOverflowError"||(null==h?void 0:h.code)==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",u>this.urlLengthLimit&&(l+=`. Your request URL is ${u} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${null!=(t=null==e?void 0:e.name)?t:"FetchError"}: ${null==e?void 0:e.message}`,details:o,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},u=class extends h{select(e){let t=!1,r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){let i=n?`${n}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){let s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){let n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var a;let o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!=(a=this.headers.get("Accept"))?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};let d=RegExp("[,()]");var p=class extends u{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&d.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&d.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");let i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){let s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},f=class{constructor(e,{headers:t={},schema:r,fetch:s,urlLengthLimit:n=8e3}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s,this.urlLengthLimit=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){let{head:r=!1,count:s}=null!=t?t:{},n=!1,i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join(""),{url:a,headers:o}=this.cloneRequestState();return a.searchParams.set("select",i),s&&o.append("Prefer",`count=${s}`),new p({method:r?"HEAD":"GET",url:a,headers:o,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:r=!0}={}){var s;let{url:n,headers:i}=this.cloneRequestState();if(t&&i.append("Prefer",`count=${t}`),r||i.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);n.searchParams.set("columns",e.join(","))}}return new p({method:"POST",url:n,headers:i,schema:this.schema,body:e,fetch:null!=(s=this.fetch)?s:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var i;let{url:a,headers:o}=this.cloneRequestState();if(o.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&a.searchParams.set("on_conflict",t),s&&o.append("Prefer",`count=${s}`),n||o.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);a.searchParams.set("columns",e.join(","))}}return new p({method:"POST",url:a,headers:o,schema:this.schema,body:e,fetch:null!=(i=this.fetch)?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var r;let{url:s,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new p({method:"PATCH",url:s,headers:n,schema:this.schema,body:e,fetch:null!=(r=this.fetch)?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;let{url:r,headers:s}=this.cloneRequestState();return e&&s.append("Prefer",`count=${e}`),new p({method:"DELETE",url:r,headers:s,schema:this.schema,fetch:null!=(t=this.fetch)?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){!function(e,t,r){var s;(s=function(e,t){if("object"!=m(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=m(s))return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==m(s)?s:s+"")in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var b=class e{constructor(e,{headers:t={},schema:r,fetch:s,timeout:n,urlLengthLimit:i=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.urlLengthLimit=i;const a=null!=s?s:globalThis.fetch;void 0!==n&&n>0?this.fetch=(e,t)=>{let r=new AbortController,s=setTimeout(()=>r.abort(),n),i=null==t?void 0:t.signal;if(i){if(i.aborted)return clearTimeout(s),a(e,t);let n=()=>{clearTimeout(s),r.abort()};return i.addEventListener("abort",n,{once:!0}),a(e,y(y({},t),{},{signal:r.signal})).finally(()=>{clearTimeout(s),i.removeEventListener("abort",n)})}return a(e,y(y({},t),{},{signal:r.signal})).finally(()=>clearTimeout(s))}:this.fetch=a}from(e){if(!e||"string"!=typeof e||""===e.trim())throw Error("Invalid relation name: relation must be a non-empty string.");return new f(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){var i;let a,o,l=new URL(`${this.url}/rpc/${e}`),c=e=>null!==e&&"object"==typeof e&&(!Array.isArray(e)||e.some(c)),h=r&&Object.values(t).some(c);h?(a="POST",o=t):r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a="POST",o=t);let u=new Headers(this.headers);return h?u.set("Prefer",n?`count=${n},return=minimal`:"return=minimal"):n&&u.set("Prefer",`count=${n}`),new p({method:a,url:l,headers:u,schema:this.schemaName,body:o,fetch:null!=(i=this.fetch)?i:fetch,urlLengthLimit:this.urlLengthLimit})}};e.s(["PostgrestClient",()=>b,"PostgrestError",()=>c],558118)},937453,612336,e=>{"use strict";var t,r,s,n,i,a,o,l,c,h,u,d,p,f,m,g,y,b,v;let w=class{constructor(){}static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==e.g.WebSocket)return{type:"native",constructor:e.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(t=navigator.userAgent)?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};let r=globalThis.process;if(r){let e=r.versions;if(e&&e.node){let t=parseInt(e.node.replace(/^v/,"").split(".")[0]);return t>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},k="2.0.0";(u=t||(t={}))[u.connecting=0]="connecting",u[u.open=1]="open",u[u.closing=2]="closing",u[u.closed=3]="closed",(d=r||(r={})).closed="closed",d.errored="errored",d.joined="joined",d.joining="joining",d.leaving="leaving",(p=s||(s={})).close="phx_close",p.error="phx_error",p.join="phx_join",p.reply="phx_reply",p.leave="phx_leave",p.access_token="access_token",(n||(n={})).websocket="websocket",(f=i||(i={})).Connecting="connecting",f.Open="open",f.Closing="closing",f.Closed="closed";class S{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){return e.event!==this.BROADCAST_EVENT||e.payload instanceof ArrayBuffer||"string"!=typeof e.payload.event?t(JSON.stringify([e.join_ref,e.ref,e.topic,e.event,e.payload])):t(this._binaryEncodeUserBroadcastPush(e))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null==(t=e.payload)?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;let s=null!=(r=null==(t=e.payload)?void 0:t.payload)?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,r;let s=null!=(r=null==(t=e.payload)?void 0:t.payload)?r:{},n=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,n)}_encodeUserBroadcastPush(e,t,r){let s=e.topic,n=null!=(p=e.ref)?p:"",i=null!=(f=e.join_ref)?f:"",a=e.payload.event,o=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},l=0===Object.keys(o).length?"":JSON.stringify(o);if(i.length>255)throw Error(`joinRef length ${i.length} exceeds maximum of 255`);if(n.length>255)throw Error(`ref length ${n.length} exceeds maximum of 255`);if(s.length>255)throw Error(`topic length ${s.length} exceeds maximum of 255`);if(a.length>255)throw Error(`userEvent length ${a.length} exceeds maximum of 255`);if(l.length>255)throw Error(`metadata length ${l.length} exceeds maximum of 255`);let c=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+n.length+s.length+a.length+l.length,h=new ArrayBuffer(this.HEADER_LENGTH+c),u=new DataView(h),d=0;u.setUint8(d++,this.KINDS.userBroadcastPush),u.setUint8(d++,i.length),u.setUint8(d++,n.length),u.setUint8(d++,s.length),u.setUint8(d++,a.length),u.setUint8(d++,l.length),u.setUint8(d++,t),Array.from(i,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(n,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(s,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(a,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(l,e=>u.setUint8(d++,e.charCodeAt(0)));var p,f,m=new Uint8Array(h.byteLength+r.byteLength);return m.set(new Uint8Array(h),0),m.set(new Uint8Array(r),h.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){let[r,s,n,i,a]=JSON.parse(e);return t({join_ref:r,ref:s,topic:n,event:i,payload:a})}return t({})}_binaryDecode(e){let t=new DataView(e),r=t.getUint8(0),s=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,s)}_decodeUserBroadcast(e,t,r){let s=t.getUint8(1),n=t.getUint8(2),i=t.getUint8(3),a=t.getUint8(4),o=this.HEADER_LENGTH+4,l=r.decode(e.slice(o,o+s));o+=s;let c=r.decode(e.slice(o,o+n));o+=n;let h=r.decode(e.slice(o,o+i));o+=i;let u=e.slice(o,e.byteLength),d=a===this.JSON_ENCODING?JSON.parse(r.decode(u)):u,p={type:this.BROADCAST_EVENT,event:c,payload:d};return i>0&&(p.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class E{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(m=a||(a={})).abstime="abstime",m.bool="bool",m.date="date",m.daterange="daterange",m.float4="float4",m.float8="float8",m.int2="int2",m.int4="int4",m.int4range="int4range",m.int8="int8",m.int8range="int8range",m.json="json",m.jsonb="jsonb",m.money="money",m.numeric="numeric",m.oid="oid",m.reltime="reltime",m.text="text",m.time="time",m.timestamp="timestamp",m.timestamptz="timestamptz",m.timetz="timetz",m.tsrange="tsrange",m.tstzrange="tstzrange";let T=(e,t,r={})=>{var s;let n=null!=(s=r.skipTypes)?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=_(s,e,t,n),r),{}):{}},_=(e,t,r,s)=>{let n=t.find(t=>t.name===e),i=null==n?void 0:n.type,a=r[e];return i&&!s.includes(i)?x(i,a):j(a)},x=(e,t)=>{if("_"===e.charAt(0))return C(t,e.slice(1,e.length));switch(e){case a.bool:return O(t);case a.float4:case a.float8:case a.int2:case a.int4:case a.int8:case a.numeric:case a.oid:return $(t);case a.json:case a.jsonb:return P(t);case a.timestamp:return A(t);case a.abstime:case a.date:case a.daterange:case a.int4range:case a.int8range:case a.money:case a.reltime:case a.text:case a.time:case a.timestamptz:case a.timetz:case a.tsrange:case a.tstzrange:default:return j(t)}},j=e=>e,O=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},$=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},P=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},C=(e,t)=>{if("string"!=typeof e)return e;let r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s,n=e.slice(1,r);try{s=JSON.parse("["+n+"]")}catch(e){s=n?n.split(","):[]}return s.map(e=>x(t,e))}return e},A=e=>"string"==typeof e?e.replace(" ","T"):e,R=e=>{let t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class N{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null==(r=this.receivedResp)?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}(g=o||(o={})).SYNC="sync",g.JOIN="join",g.LEAVE="leave";class L{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=L.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=L.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=L.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){let n=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(n,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{let r=n[e];if(r){let s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>0>n.indexOf(e.presence_ref)),l=r.filter(e=>0>s.indexOf(e.presence_ref));i.length>0&&(a[e]=i),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(n,{joins:a,leaves:o},r,s)}static syncDiff(e,t,r,s){let{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;let i=null!=(n=e[t])?n:[];if(e[t]=this.cloneDeep(s),i.length>0){let r=e[t].map(e=>e.presence_ref),s=i.filter(e=>0>r.indexOf(e.presence_ref));e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;let i=r.map(e=>e.presence_ref);n=n.filter(e=>0>i.indexOf(e.presence_ref)),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,r)=>{let s=e[r];return"metas"in s?t[r]=s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(y=l||(l={})).ALL="*",y.INSERT="INSERT",y.UPDATE="UPDATE",y.DELETE="DELETE",(b=c||(c={})).BROADCAST="broadcast",b.PRESENCE="presence",b.POSTGRES_CHANGES="postgres_changes",b.SYSTEM="system",(v=h||(h={})).SUBSCRIBED="SUBSCRIBED",v.TIMED_OUT="TIMED_OUT",v.CLOSED="CLOSED",v.CHANNEL_ERROR="CHANNEL_ERROR";class D{constructor(e,t={config:{}},n){var i,a;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=r.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new N(this,s.join,this.params,this.timeout),this.rejoinTimer=new E(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=r.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=r.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=r.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=r.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=r.errored,this.rejoinTimer.scheduleTimeout())}),this._on(s.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new L(this),this.broadcastEndpointURL=R(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(a=null==(i=this.params.config)?void 0:i.broadcast)?void 0:a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==r.closed){let{config:{broadcast:a,presence:o,private:l}}=this.params,u=null!=(n=null==(s=this.bindings.postgres_changes)?void 0:s.map(e=>e.filter))?n:[],d=!!this.bindings[c.PRESENCE]&&this.bindings[c.PRESENCE].length>0||(null==(i=this.params.config.presence)?void 0:i.enabled)===!0,p={},f={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(h.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(h.CLOSED)),this.updateJoinPayload(Object.assign({config:f},p)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket._isManualToken()||this.socket.setAuth(),void 0===t){null==e||e(h.SUBSCRIBED);return}{let n=this.bindings.postgres_changes,i=null!=(s=null==n?void 0:n.length)?s:0,a=[];for(let s=0;s<i;s++){let i=n[s],{filter:{event:o,schema:l,table:c,filter:u}}=i,d=t&&t[s];if(d&&d.event===o&&D.isFilterValueEqual(d.schema,l)&&D.isFilterValueEqual(d.table,c)&&D.isFilterValueEqual(d.filter,u))a.push(Object.assign(Object.assign({},i),{id:d.id}));else{this.unsubscribe(),this.state=r.errored,null==e||e(h.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=a,e&&e(h.SUBSCRIBED);return}}).receive("error",t=>{this.state=r.errored,null==e||e(h.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(h.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===r.joined&&e===c.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,s)}async httpSend(e,t,r={}){var s;if(null==t)return Promise.reject("Payload is required for httpSend()");let n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);let i={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!=(s=r.timeout)?s:this.timeout);if(202===a.status)return{success:!0};let o=a.statusText;try{let e=await a.json();o=e.error||e.message||o}catch(e){}return Promise.reject(Error(o))}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,i;let a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null==(i=null==(n=null==(s=this.params)?void 0:s.config)?void 0:n.broadcast)?void 0:i.ack)||r("ok"),a.receive("ok",()=>r("ok")),a.receive("error",()=>r("error")),a.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:n,payload:i}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);let o={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!=(r=t.timeout)?r:this.timeout);return await (null==(s=e.body)?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=r.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(s.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{(n=new N(this,s.leave,{},e)).receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null==n||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=r.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){let s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new N(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;let a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:h}=s;if(r&&[o,l,c,h].indexOf(a)>=0&&r!==this._joinRef())return;let u=this._onMessage(a,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null==(n=this.bindings.postgres_changes)||n.filter(e=>{var t,r,s;return(null==(t=e.filter)?void 0:t.event)==="*"||(null==(s=null==(r=e.filter)?void 0:r.event)?void 0:s.toLocaleLowerCase())===a}).map(e=>e.callback(u,r)):null==(i=this.bindings[a])||i.filter(e=>{var r,s,n,i,o,l;if(!["broadcast","presence","postgres_changes"].includes(a))return e.type.toLocaleLowerCase()===a;if("id"in e){let i=e.id,a=null==(r=e.filter)?void 0:r.event;return i&&(null==(s=t.ids)?void 0:s.includes(i))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null==(n=t.data)?void 0:n.type.toLocaleLowerCase()))}{let r=null==(o=null==(i=null==e?void 0:e.filter)?void 0:i.event)?void 0:o.toLocaleLowerCase();return"*"===r||r===(null==(l=null==t?void 0:t.event)?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof u&&"ids"in u){let e=u.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e;u=Object.assign(Object.assign({},{schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i}),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===r.closed}_isJoined(){return this.state===r.joined}_isJoining(){return this.state===r.joining}_isLeaving(){return this.state===r.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){let s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null==(s=e.type)?void 0:s.toLocaleLowerCase())===r&&D.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(s.close,{},e)}_onError(e){this._on(s.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=r.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=T(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=T(e.columns,e.old_record)),t}}let U=()=>{},B=[1e3,2e3,5e3,1e4],I=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class M{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=U,this.ref=0,this.reconnectTimer=null,this.vsn=k,this.logger=U,this.conn=null,this.sendBuffer=[],this.serializer=new S,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null==(r=null==t?void 0:t.params)?void 0:r.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${n.websocket}`,this.httpEndpoint=R(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=w.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;if(e.includes("Node.js"))throw Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case t.connecting:return i.Connecting;case t.open:return i.Open;case t.closing:return i.Closing;default:return i.Closed}}isConnected(){return this.connectionState()===i.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){let r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{let r=new D(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){let{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null==(t=this.conn)||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,null==(e=this.conn)||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||null==(e=this.reconnectTimer)||e.scheduleTimeout()},100);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){let t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(e){this.log("error","error in heartbeat callback",e)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}let{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:"",a=s.status||"";this.log("receive",`${a} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null==(t=this.reconnectTimer)||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===t.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===t.open||this.conn.readyState===t.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(t=this.reconnectTimer)||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(s.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([I],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{let r={access_token:t,version:"realtime-js/2.94.1"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(s.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new E(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,a,o,l,c,h,u,d;switch(this.transport=null!=(t=null==e?void 0:e.transport)?t:null,this.timeout=null!=(r=null==e?void 0:e.timeout)?r:1e4,this.heartbeatIntervalMs=null!=(s=null==e?void 0:e.heartbeatIntervalMs)?s:25e3,this.worker=null!=(n=null==e?void 0:e.worker)&&n,this.accessToken=null!=(i=null==e?void 0:e.accessToken)?i:null,this.heartbeatCallback=null!=(a=null==e?void 0:e.heartbeatCallback)?a:U,this.vsn=null!=(o=null==e?void 0:e.vsn)?o:k,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(l=null==e?void 0:e.reconnectAfterMs)?l:e=>B[e-1]||1e4,this.vsn){case"1.0.0":this.encode=null!=(c=null==e?void 0:e.encode)?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!=(h=null==e?void 0:e.decode)?h:(e,t)=>t(JSON.parse(e));break;case k:this.encode=null!=(u=null==e?void 0:e.encode)?u:this.serializer.encode.bind(this.serializer),this.decode=null!=(d=null==e?void 0:e.decode)?d:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}e.s([],937453),e.s(["RealtimeClient",()=>M],612336)},891584,e=>{"use strict";let t;e.i(226927);var r=e.i(786615),s=e.i(558118);e.i(937453);var n=e.i(612336),i=e.i(201780),a=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};async function o(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}function l(e){return e.join("\x1f")}var c=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){let t=e?{parent:l(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){let r={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${l(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${l(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${l(e.namespace)}`}),!0}catch(e){if(e instanceof a&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof a&&409===e.status)return;throw e}}};function h(e){return e.join("\x1f")}var u=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${h(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){let r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${h(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){let r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${h(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${h(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${h(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){let t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${h(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof a&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof a&&409===r.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},d=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=function(e){let t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:i,headers:l}){let c=function(e,t,r){let s=new URL(t,e);if(r)for(let[e,t]of Object.entries(r))void 0!==t&&s.searchParams.set(e,t);return s.toString()}(e.baseUrl,s,n),h=await o(e.auth),u=await t(c,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...h,...l},body:i?JSON.stringify(i):void 0}),d=await u.text(),p=(u.headers.get("content-type")||"").includes("application/json"),f=p&&d?JSON.parse(d):d;if(!u.ok){let e=p?f:void 0,t=e?.error;throw new a(t?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:u.status,headers:u.headers,data:f}}}}({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new c(this.client,t),this.tableOps=new u(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},p=class extends Error{constructor(e,t="storage",r,s){super(e),this.__isStorageError=!0,this.namespace=t,this.name="vectors"===t?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=s}};function f(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var m=class extends p{constructor(e,t,r,s="storage"){super(e,s,t,r),this.name="vectors"===s?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},g=class extends p{constructor(e,t,r="storage"){super(e,r),this.name="vectors"===r?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};let y=e=>{if(Array.isArray(e))return e.map(e=>y(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,r])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=y(r)}),t};function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){!function(e,t,r){var s;(s=function(e,t){if("object"!=b(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=b(s))return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==b(s)?s:s+"")in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let k=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null==(t=e.error)?void 0:t.message)||JSON.stringify(e)},S=async(e,t,r,s)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){let r=e.status||500;"function"==typeof e.json?e.json().then(e=>{let n=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+"";t(new m(k(e),r,n,s))}).catch(()=>{t(new m(e.statusText||`HTTP ${r} error`,r,r+"",s))}):t(new m(e.statusText||`HTTP ${r} error`,r,r+"",s))}else t(new g(k(e),e,s))};async function E(e,t,r,s,n,i,a){return new Promise((o,l)=>{let c;e(r,(c={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t||"HEAD"===t||!i||((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(i)?(c.headers=w({"Content-Type":"application/json"},null==s?void 0:s.headers),c.body=JSON.stringify(i)):c.body=i,(null==s?void 0:s.duplex)&&(c.duplex=s.duplex)),w(w({},c),n))).then(e=>{if(!e.ok)throw e;if(null==s?void 0:s.noResolveJson)return e;if("vectors"===a){let t=e.headers.get("content-type");if("0"===e.headers.get("content-length")||204===e.status||!t||!t.includes("application/json"))return{}}return e.json()}).then(e=>o(e)).catch(e=>S(e,l,s,a))})}function T(e="storage"){return{get:async(t,r,s,n)=>E(t,"GET",r,s,n,void 0,e),post:async(t,r,s,n,i)=>E(t,"POST",r,n,i,s,e),put:async(t,r,s,n,i)=>E(t,"PUT",r,n,i,s,e),head:async(t,r,s,n)=>E(t,"HEAD",r,w(w({},s),{},{noResolveJson:!0}),n,void 0,e),remove:async(t,r,s,n,i)=>E(t,"DELETE",r,n,i,s,e)}}let{get:_,post:x,put:j,head:O,remove:$}=T("storage"),P=T("vectors");var C=class{constructor(e,t={},r,s="storage"){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(e){try{return{data:await e(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(f(e))return{data:null,error:e};throw e}}},A=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(f(e))return{data:null,error:e};throw e}}};t=Symbol.toStringTag;var R=class{constructor(e,r){this.downloadFn=e,this.shouldThrowOnError=r,this[t]="BlobDownloadBuilder",this.promise=null}asStream(){return new A(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await (await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(f(e))return{data:null,error:e};throw e}}};let N={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},L={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var D=class extends C{constructor(e,t={},r,s){super(e,t,s,"storage"),this.bucketId=r}async uploadOrUpdate(e,t,r,s){var n=this;return n.handleOperation(async()=>{let i,a=w(w({},L),s),o=w(w({},n.headers),"POST"===e&&{"x-upsert":String(a.upsert)}),l=a.metadata;"undefined"!=typeof Blob&&r instanceof Blob?((i=new FormData).append("cacheControl",a.cacheControl),l&&i.append("metadata",n.encodeMetadata(l)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?((i=r).has("cacheControl")||i.append("cacheControl",a.cacheControl),l&&!i.has("metadata")&&i.append("metadata",n.encodeMetadata(l))):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=n.toBase64(n.encodeMetadata(l))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!a.duplex&&(a.duplex="half")),(null==s?void 0:s.headers)&&(o=w(w({},o),s.headers));let c=n._removeEmptyFolders(t),h=n._getFinalPath(c),u=await ("PUT"==e?j:x)(n.fetch,`${n.url}/object/${h}`,i,w({headers:o},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{path:c,id:u.Id,fullPath:u.Key}})}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,s){var n=this;let i=n._removeEmptyFolders(e),a=n._getFinalPath(i),o=new URL(n.url+`/object/upload/sign/${a}`);return o.searchParams.set("token",t),n.handleOperation(async()=>{let e,t=w({upsert:L.upsert},s),a=w(w({},n.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r).append("cacheControl",t.cacheControl):(e=r,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType),{path:i,fullPath:(await j(n.fetch,o.toString(),e,{headers:a})).Key}})}async createSignedUploadUrl(e,t){var r=this;return r.handleOperation(async()=>{let s=r._getFinalPath(e),n=w({},r.headers);(null==t?void 0:t.upsert)&&(n["x-upsert"]="true");let i=await x(r.fetch,`${r.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(r.url+i.url),o=a.searchParams.get("token");if(!o)throw new p("No token returned by API");return{signedUrl:a.toString(),path:e,token:o}})}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var s=this;return s.handleOperation(async()=>await x(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:s.headers}))}async copy(e,t,r){var s=this;return s.handleOperation(async()=>({path:(await x(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(e,t,r){var s=this;return s.handleOperation(async()=>{let n=s._getFinalPath(e),i=await x(s.fetch,`${s.url}/object/sign/${n}`,w({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:s.headers}),a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{signedUrl:encodeURI(`${s.url}${i.signedURL}${a}`)}})}async createSignedUrls(e,t,r){var s=this;return s.handleOperation(async()=>{let n=await x(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:t,paths:e},{headers:s.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n.map(e=>w(w({},e),{},{signedUrl:e.signedURL?encodeURI(`${s.url}${e.signedURL}${i}`):null}))})}download(e,t){let r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"",i=this._getFinalPath(e);return new R(()=>_(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){var t=this;let r=t._getFinalPath(e);return t.handleOperation(async()=>y(await _(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})))}async exists(e){let t=this._getFinalPath(e);try{return await O(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(f(e)&&e instanceof g){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){let r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);let i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&s.push(a);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${o}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await $(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,r){var s=this;return s.handleOperation(async()=>{let n=w(w(w({},N),t),{},{prefix:e||""});return await x(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},r)})}async listV2(e,t){var r=this;return r.handleOperation(async()=>{let s=w({},e);return await x(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,s,{headers:r.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return void 0!==i.Buffer?i.Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};let U={"X-Client-Info":"storage-js/2.94.1"};var B=class extends C{constructor(e,t={},r,s){const n=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),super(n.href.replace(/\/$/,""),w(w({},U),t),r,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{let r=t.listBucketOptionsToQueryString(e);return await _(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await _(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var r=this;return r.handleOperation(async()=>await x(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}))}async updateBucket(e,t){var r=this;return r.handleOperation(async()=>await j(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await x(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await $(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},I=class extends C{constructor(e,t={},r){super(e.replace(/\/$/,""),w(w({},U),t),r,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await x(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{let r=new URLSearchParams;(null==e?void 0:e.limit)!==void 0&&r.set("limit",e.limit.toString()),(null==e?void 0:e.offset)!==void 0&&r.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&r.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&r.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&r.set("search",e.search);let s=r.toString(),n=s?`${t.url}/bucket?${s}`:`${t.url}/bucket`;return await _(t.fetch,n,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await $(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!(!(!e||"string"!=typeof e||0===e.length||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\"))&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e)))throw new p("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");let r=new d({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(e,t){let r=e[t];return"function"!=typeof r?r:async(...t)=>{try{return{data:await r.apply(e,t),error:null}}catch(e){if(s)throw e;return{data:null,error:e}}}}})}},M=class extends C{constructor(e,t={},r){super(e.replace(/\/$/,""),w(w({},U),{},{"Content-Type":"application/json"},t),r,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var r=this;return r.handleOperation(async()=>await P.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var r=this;return r.handleOperation(async()=>await P.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{})}},F=class extends C{constructor(e,t={},r){super(e.replace(/\/$/,""),w(w({},U),{},{"Content-Type":"application/json"},t),r,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},H=class extends C{constructor(e,t={},r){super(e.replace(/\/$/,""),w(w({},U),{},{"Content-Type":"application/json"},t),r,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await P.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},V=class extends H{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new W(this.url,this.headers,e,this.fetch)}async createBucket(e){return super.createBucket.call(this,e)}async getBucket(e){return super.getBucket.call(this,e)}async listBuckets(e={}){return super.listBuckets.call(this,e)}async deleteBucket(e){return super.deleteBucket.call(this,e)}},W=class extends M{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}async createIndex(e){return super.createIndex.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return super.listIndexes.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return super.getIndex.call(this,this.vectorBucketName,e)}async deleteIndex(e){return super.deleteIndex.call(this,this.vectorBucketName,e)}index(e){return new q(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},q=class extends F{constructor(e,t,r,s,n){super(e,t,n),this.vectorBucketName=r,this.indexName=s}async putVectors(e){return super.putVectors.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async getVectors(e){return super.getVectors.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async listVectors(e={}){return super.listVectors.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async queryVectors(e){return super.queryVectors.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async deleteVectors(e){return super.deleteVectors.call(this,w(w({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}},z=class extends B{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new D(this.url,this.headers,e,this.fetch)}get vectors(){return new V(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new I(this.url+"/iceberg",this.headers,this.fetch)}};e.i(87437);var J=e.i(9280);let G="";G="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let K={headers:{"X-Client-Info":`supabase-js-${G}/2.94.1`}},Q={schema:"public"},Y={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},X={};function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach(function(t){!function(e,t,r){var s;(s=function(e,t){if("object"!=Z(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=Z(s))return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==Z(s)?s:s+"")in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var er=class extends J.AuthClient{constructor(e){super(e)}},es=class{constructor(e,t,r){var n,i,a;this.supabaseUrl=e,this.supabaseKey=t;const o=function(e){let t=null==e?void 0:e.trim();if(!t)throw Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t.endsWith("/")?t:t+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(e);if(!t)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,c=function(e,t){var r,s;let{db:n,auth:i,realtime:a,global:o}=e,{db:l,auth:c,realtime:h,global:u}=t,d={db:et(et({},l),n),auth:et(et({},c),i),realtime:et(et({},h),a),storage:{},global:et(et(et({},u),o),{},{headers:et(et({},null!=(r=null==u?void 0:u.headers)?r:{}),null!=(s=null==o?void 0:o.headers)?s:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:Q,realtime:X,auth:et(et({},Y),{},{storageKey:l}),global:K});this.storageKey=null!=(n=c.auth.storageKey)?n:"",this.headers=null!=(i=c.global.headers)?i:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(a=c.auth)?a:{},this.headers,c.global.fetch),this.fetch=((e,t,r)=>{let s=r?(...e)=>r(...e):(...e)=>fetch(...e),n=Headers;return async(r,i)=>{var a;let o=null!=(a=await t())?a:e,l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),s(r,et(et({},i),{},{headers:l}))}})(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(et({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new s.PostgrestClient(new URL("rest/v1",o).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new z(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new r.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:r}=await this.auth.getSession();return null!=(e=null==(t=r.session)?void 0:t.access_token)?e:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:a,lock:o,debug:l,throwOnError:c},h,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new er({url:this.authUrl.href,headers:et(et({},d),h),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,flowType:a,lock:o,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new n.RealtimeClient(this.realtimeUrl.href,et(et({},e),{},{params:et(et({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}};let en=(e,t,r)=>new es(e,t,r);(function(){if("undefined"!=typeof window)return!1;let e=globalThis.process;if(!e)return!1;let t=e.version;if(null==t)return!1;let r=t.match(/^v(\d+)\./);return!!r&&18>=parseInt(r[1],10)})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217"),e.s(["createClient",()=>en],891584)},2824,e=>{"use strict";var t=e.i(891584);e.s(["createSupportStorageClient",0,()=>(0,t.createClient)("https://obuldanrptloktxcffvn.supabase.co","sb_publishable_t45SVhgymMJOuamUXzJzPQ_sY-tSoUr",{auth:{persistSession:!1,autoRefreshToken:!1,multiTab:!1,detectSessionInUrl:!1,localStorage:{getItem:e=>void 0,setItem:(e,t)=>{},removeItem:e=>{}}}})])},210801,e=>{"use strict";var t=e.i(38429),r=e.i(355901),s=e.i(234745),n=e.i(10429);async function i({bucket:e,filenames:t}){let r=await (0,s.constructHeaders)(),i=e?JSON.stringify({filenames:t,bucket:e}):JSON.stringify({filenames:t});try{let e=await fetch(`${n.BASE_PATH}/api/generate-attachment-url`,{method:"POST",headers:r,body:i});if(!e.ok){let t=e.status,r=await e.text();throw Error(`Failed to generate attachment URLs at endpoint: ${t} ${r}`)}return await e.json()}catch(e){return[]}}e.s(["generateAttachmentURLs",()=>i,"useGenerateAttachmentURLsMutation",0,({onSuccess:e,onError:s,...n}={})=>(0,t.useMutation)({mutationFn:e=>i(e),async onSuccess(t,r,s){await e?.(t,r,s)},async onError(e,t,n){void 0===s?r.toast.error(`Failed to generate attachment URLS: ${e.message}`):s(e,t,n)},...n})])},208466,e=>{"use strict";var t=e.i(478902),r=e.i(389959),s=e.i(837710),n=e.i(793912),i=e.i(135144),a=e.i(689805),o=e.i(202584),l=e.i(809323),c=e.i(265100),h=e.i(217561),u=e.i(911298),d=e.i(418341),p=e.i(382490),f=e.i(275185),m=e.i(194213),g=e.i(975924),y=e.i(271226),b=e.i(355901);e.i(128328);var v=e.i(947748),w=e.i(158639),k=e.i(196621),S=e.i(937942),E=e.i(361208),T=e.i(536841),_=e.i(162082),x=e.i(124416),j=e.i(265735),O=e.i(48189),$=e.i(432478),P=e.i(843778),C=e.i(874311),A=e.i(162530),R=e.i(398876),N=e.i(710483),L=e.i(2824),D=e.i(210801);let U=e=>{let t="image/png",r=atob(e.substr(`data:${t};base64,`.length)),s=[];for(let e=0;e<r.length;e+=1024){let t=r.slice(e,e+1024),n=Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);let i=new Uint8Array(n);s.push(i)}return new Blob(s,{type:t})},B=async({image:e,userId:t})=>{if(!t)return void console.error("[FeedbackWidget > uploadAttachment] Unable to upload screenshot, missing user ID");let r=(0,L.createSupportStorageClient)(),s=U(e),n=`${t}/${(0,O.uuidv4)()}.png`,{data:i,error:a}=await r.storage.from("feedback-attachments").upload(n,s,{cacheControl:"3600"});return a||!i?void console.error("Failed to upload screenshot attachment:",a):(await (0,D.generateAttachmentURLs)({bucket:"feedback-attachments",filenames:[i.path]}))[0]},I=({onClose:e})=>{let n=(0,y.useRouter)(),{profile:i}=(0,$.useProfile)(),{ref:a,slug:d}=(0,w.useParams)(),{data:p}=(0,j.useSelectedOrganizationQuery)(),L=(0,r.useRef)(null),[D,I]=(0,r.useState)(""),[F,H]=(0,r.useState)(!1),[V,W]=(0,r.useState)(!1),[q,z]=(0,r.useState)(!1),J=(0,o.useDebounce)(D,500),[G,K]=(0,x.useLocalStorageQuery)(v.LOCAL_STORAGE_KEYS.FEEDBACK_WIDGET_CONTENT,null),[Q,Y,{isSuccess:X}]=(0,x.useLocalStorageQuery)(v.LOCAL_STORAGE_KEYS.FEEDBACK_WIDGET_SCREENSHOT,null),{data:Z}=(0,E.useFeedbackCategoryQuery)({prompt:J}),ee=function(e){if(!e||0===e.trim().length)return!1;let t=e.toLowerCase();return[/need help/i,/having trouble/i,/having issues/i,/having problems/i,/can you help/i,/could you help/i,/please help/i,/need help/i,/how do/i,/how can/i,/how to/i,/why isn't/i,/why doesn't/i,/why won't/i,/why can't/i,/it's not working/i,/it doesn't work/i,/it won't work/i,/it can't work/i,/isn't working/i,/doesn't work/i,/won't work/i,/can't work/i,/not work/i,/i can't/i,/i cannot/i,/unable to/i,/wrong/i,/bad/i,/\bbug\b/i,/\bbroken\b/i,/\berror\b/i,/\berrors\b/i,/\bfailed\b/i,/\bfailure\b/i,/\bfailing\b/i,/\bcrash\b/i,/\bcrashed\b/i,/\bcrashing\b/i,/\bissue\b/i,/\bissues\b/i,/\bproblem\b/i,/\bproblems\b/i,/\btrouble\b/i,/\bdifficulty\b/i,/\bdifficulties\b/i,/support ticket/i,/contact support/i,/get help/i,/need assistance/i,/require assistance/i,/technical support/i].some(e=>e.test(t))}(D),{mutate:et}=(0,_.useSendEventMutation)(),{mutate:er}=(0,T.useSendFeedbackMutation)({onSuccess:()=>{z(!0),I(""),K(null),Y(null),H(!1)},onError:e=>{b.toast.error(`Failed to submit feedback: ${e.message}`),H(!1)}}),es=async()=>{W(!0),await (0,O.timeout)(100),(0,h.toPng)(document.body,{filter:function(e){return!((e?.children??[]).length>0)||"feedback-widget"!==e.children[0].id}}).then(e=>Y(e)).catch(()=>b.toast.error("Failed to capture screenshot")).finally(()=>W(!1))},en=async e=>{e.persist();let[t]=e.target.files||e.dataTransfer.items,r=new FileReader;r.onload=function(e){let t=e.target?.result;"string"==typeof t&&Y(t)},r.readAsDataURL(t),e.target.value=""},ei=async()=>{let[e]=await navigator.clipboard.read();if(void 0===Q&&"image/png"===e.types[0]){let t=await e.getType("image/png"),r=new FileReader;r.onload=function(e){let t=e.target?.result;"string"==typeof t&&Y(t)},r.readAsDataURL(t)}},ea=async()=>{if(0===D.length&&void 0!==Q)return b.toast.error("Please include a message in your feedback.");if(D.length>0){H(!0);let e=Q&&i?.gotrue_id?await B({image:Q,userId:i.gotrue_id}):void 0;er({projectRef:a,organizationSlug:d,message:void 0!==e?`${D}

Attachments:
${e}`:D,pathname:n.asPath})}};return(0,r.useEffect)(()=>{G&&I(G),Q&&Y(Q)},[X]),(0,r.useEffect)(()=>{J.length>0&&K(J)},[J]),q?(0,t.jsx)(M,{onClose:e}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(R.TextArea_Shadcn_,{placeholder:"My idea for improving Supabase is...",rows:6,value:D,onChange:e=>I(e.target.value),onPaste:ei,className:"text-sm mb-1 resize-none"})}),(0,t.jsx)(l.AnimatePresence,{children:"support"===(Z??(ee?"support":null))&&(0,t.jsx)(c.motion.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:16},transition:{duration:.2},children:(0,t.jsx)(N.Admonition,{type:"caution",title:"This looks like an issue thats better handled by support",className:"rounded-none border-x-0 border-b-0",children:(0,t.jsxs)("p",{children:["Please"," ",(0,t.jsx)(k.SupportLink,{className:(0,P.cn)(S.InlineLinkClassName),queryParams:{projectRef:d,message:D},children:"open a support ticket"})," ","to get help, as we do not reply to all product feedback."]})})},"support-alert")}),(0,t.jsx)(A.PopoverSeparator_Shadcn_,{}),(0,t.jsx)("div",{className:"p-4 flex flex-row justify-end items-start",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-row",children:[Q?(0,t.jsx)("div",{style:{backgroundImage:`url("${Q}")`},onClick:()=>{let e=U(Q),t=URL.createObjectURL(e);window.open(t,"_blank")},className:"cursor-pointer rounded h-[26px] w-[26px] border border-control relative bg-cover bg-center bg-no-repeat",children:(0,t.jsx)("button",{className:"cursor-pointer rounded-full bg-red-900 h-3 w-3 flex items-center justify-center absolute -top-1 -right-1",onClick:e=>{e.stopPropagation(),Y(null)},children:(0,t.jsx)(g.X,{size:8,strokeWidth:3})})}):(0,t.jsxs)(C.DropdownMenu,{children:[(0,t.jsx)(C.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(s.Button,{type:"default",disabled:V,loading:V,className:"w-7",icon:(0,t.jsx)(f.Image,{size:14})})}),(0,t.jsxs)(C.DropdownMenuContent,{side:"bottom",align:"end",className:"w-fit",children:[(0,t.jsxs)(C.DropdownMenuItem,{className:"flex gap-2",onSelect:()=>{L.current&&L.current.click()},children:[(0,t.jsx)(m.Upload,{size:14}),"Upload screenshot"]},"upload-screenshot"),(0,t.jsx)(C.DropdownMenuSeparator,{}),(0,t.jsxs)(C.DropdownMenuItem,{className:"flex gap-2",onSelect:()=>es(),children:[(0,t.jsx)(u.Camera,{size:14}),"Capture screenshot"]},"capture-screenshot")]})]}),(0,t.jsx)("input",{type:"file",ref:L,className:"hidden",accept:"image/png",onChange:en}),(0,t.jsx)(s.Button,{disabled:0===D.length||F,loading:F,onClick:()=>{ea(),et({action:"send_feedback_button_clicked",groups:{project:a,organization:p?.slug}})},children:"Send"})]})})]})},M=({onClose:e})=>(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"grid gap-3 py-3",children:[(0,t.jsxs)("div",{className:"px-6 grid gap-4 text-center text-foreground-light",children:[(0,t.jsx)(d.CircleCheck,{className:"mx-auto text-brand-500",size:24}),(0,t.jsxs)("div",{className:"text-center flex flex-col",children:[(0,t.jsx)("p",{className:"text-foreground text-base",children:"Your feedback has been sent. Thanks!"}),(0,t.jsxs)("p",{className:"text-sm text-balance",children:["We dont always respond to feedback. If you require assistance, please contact support via the ",(0,t.jsx)(p.HelpCircle,{className:"inline-block",size:12,"aria-label":"Help"})," menu instead."]})]})]}),(0,t.jsx)(A.PopoverSeparator_Shadcn_,{}),(0,t.jsx)("div",{className:"flex items-center justify-end px-4",children:(0,t.jsx)(s.Button,{type:"default",onClick:e,children:"Close"})})]})});e.s(["FeedbackDropdown",0,({className:e})=>{let[o,l]=(0,r.useState)(!1);return(0,t.jsxs)(a.Popover_Shadcn_,{modal:!1,open:o,onOpenChange:e=>{l(e)},children:[(0,t.jsx)(i.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,t.jsx)(s.Button,{asChild:!0,onClick:()=>{l(e=>!e)},type:"text",className:"rounded-full h-[32px] text-foreground-light hover:text-foreground",children:(0,t.jsx)("span",{className:e,children:"Feedback"})})}),(0,t.jsx)(n.PopoverContent_Shadcn_,{side:"bottom",align:"end",className:"p-0 flex flex-col w-[22rem]",id:"feedback-widget",children:(0,t.jsx)(I,{onClose:()=>l(!1)})})]})}],208466)}]);

//# debugId=a1594acd-e07d-4858-baaa-d75225e9b351
//# sourceMappingURL=52a1de152e17fb87.js.map